/* Generated by Cython 0.11.2 on Tue Jul 28 19:46:47 2009 */

#define PY_SSIZE_T_CLEAN
#include "Python.h"
#include "structmember.h"
#ifndef Py_PYTHON_H
    #error Python headers needed to compile C extensions, please install development version of Python.
#endif
#ifndef PY_LONG_LONG
  #define PY_LONG_LONG LONG_LONG
#endif
#ifndef DL_EXPORT
  #define DL_EXPORT(t) t
#endif
#if PY_VERSION_HEX < 0x02040000
  #define METH_COEXIST 0
  #define PyDict_CheckExact(op) (Py_TYPE(op) == &PyDict_Type)
#endif
#if PY_VERSION_HEX < 0x02050000
  typedef int Py_ssize_t;
  #define PY_SSIZE_T_MAX INT_MAX
  #define PY_SSIZE_T_MIN INT_MIN
  #define PY_FORMAT_SIZE_T ""
  #define PyInt_FromSsize_t(z) PyInt_FromLong(z)
  #define PyInt_AsSsize_t(o)   PyInt_AsLong(o)
  #define PyNumber_Index(o)    PyNumber_Int(o)
  #define PyIndex_Check(o)     PyNumber_Check(o)
#endif
#if PY_VERSION_HEX < 0x02060000
  #define Py_REFCNT(ob) (((PyObject*)(ob))->ob_refcnt)
  #define Py_TYPE(ob)   (((PyObject*)(ob))->ob_type)
  #define Py_SIZE(ob)   (((PyVarObject*)(ob))->ob_size)
  #define PyVarObject_HEAD_INIT(type, size) \
          PyObject_HEAD_INIT(type) size,
  #define PyType_Modified(t)

  typedef struct {
       void *buf;
       PyObject *obj;
       Py_ssize_t len;
       Py_ssize_t itemsize;
       int readonly;
       int ndim;
       char *format;
       Py_ssize_t *shape;
       Py_ssize_t *strides;
       Py_ssize_t *suboffsets;
       void *internal;
  } Py_buffer;

  #define PyBUF_SIMPLE 0
  #define PyBUF_WRITABLE 0x0001
  #define PyBUF_FORMAT 0x0004
  #define PyBUF_ND 0x0008
  #define PyBUF_STRIDES (0x0010 | PyBUF_ND)
  #define PyBUF_C_CONTIGUOUS (0x0020 | PyBUF_STRIDES)
  #define PyBUF_F_CONTIGUOUS (0x0040 | PyBUF_STRIDES)
  #define PyBUF_ANY_CONTIGUOUS (0x0080 | PyBUF_STRIDES)
  #define PyBUF_INDIRECT (0x0100 | PyBUF_STRIDES)

#endif
#if PY_MAJOR_VERSION < 3
  #define __Pyx_BUILTIN_MODULE_NAME "__builtin__"
#else
  #define __Pyx_BUILTIN_MODULE_NAME "builtins"
#endif
#if PY_MAJOR_VERSION >= 3
  #define Py_TPFLAGS_CHECKTYPES 0
  #define Py_TPFLAGS_HAVE_INDEX 0
#endif
#if (PY_VERSION_HEX < 0x02060000) || (PY_MAJOR_VERSION >= 3)
  #define Py_TPFLAGS_HAVE_NEWBUFFER 0
#endif
#if PY_MAJOR_VERSION >= 3
  #define PyBaseString_Type            PyUnicode_Type
  #define PyString_Type                PyBytes_Type
  #define PyString_CheckExact          PyBytes_CheckExact
  #define PyInt_Type                   PyLong_Type
  #define PyInt_Check(op)              PyLong_Check(op)
  #define PyInt_CheckExact(op)         PyLong_CheckExact(op)
  #define PyInt_FromString             PyLong_FromString
  #define PyInt_FromUnicode            PyLong_FromUnicode
  #define PyInt_FromLong               PyLong_FromLong
  #define PyInt_FromSize_t             PyLong_FromSize_t
  #define PyInt_FromSsize_t            PyLong_FromSsize_t
  #define PyInt_AsLong                 PyLong_AsLong
  #define PyInt_AS_LONG                PyLong_AS_LONG
  #define PyInt_AsSsize_t              PyLong_AsSsize_t
  #define PyInt_AsUnsignedLongMask     PyLong_AsUnsignedLongMask
  #define PyInt_AsUnsignedLongLongMask PyLong_AsUnsignedLongLongMask
  #define __Pyx_PyNumber_Divide(x,y)         PyNumber_TrueDivide(x,y)
#else
  #define __Pyx_PyNumber_Divide(x,y)         PyNumber_Divide(x,y)
  #define PyBytes_Type                 PyString_Type
#endif
#if PY_MAJOR_VERSION >= 3
  #define PyMethod_New(func, self, klass) PyInstanceMethod_New(func)
#endif
#if !defined(WIN32) && !defined(MS_WINDOWS)
  #ifndef __stdcall
    #define __stdcall
  #endif
  #ifndef __cdecl
    #define __cdecl
  #endif
  #ifndef __fastcall
    #define __fastcall
  #endif
#else
  #define _USE_MATH_DEFINES
#endif
#if PY_VERSION_HEX < 0x02050000
  #define __Pyx_GetAttrString(o,n)   PyObject_GetAttrString((o),((char *)(n)))
  #define __Pyx_SetAttrString(o,n,a) PyObject_SetAttrString((o),((char *)(n)),(a))
  #define __Pyx_DelAttrString(o,n)   PyObject_DelAttrString((o),((char *)(n)))
#else
  #define __Pyx_GetAttrString(o,n)   PyObject_GetAttrString((o),(n))
  #define __Pyx_SetAttrString(o,n,a) PyObject_SetAttrString((o),(n),(a))
  #define __Pyx_DelAttrString(o,n)   PyObject_DelAttrString((o),(n))
#endif
#if PY_VERSION_HEX < 0x02050000
  #define __Pyx_NAMESTR(n) ((char *)(n))
  #define __Pyx_DOCSTR(n)  ((char *)(n))
#else
  #define __Pyx_NAMESTR(n) (n)
  #define __Pyx_DOCSTR(n)  (n)
#endif
#ifdef __cplusplus
#define __PYX_EXTERN_C extern "C"
#else
#define __PYX_EXTERN_C extern
#endif
#include <math.h>
#define __PYX_HAVE_API__yt__lagos__chainHOP__chainHOP
#include "stdlib.h"
#include "numpy/arrayobject.h"
#define __PYX_USE_C99_COMPLEX defined(_Complex_I)


#ifdef __GNUC__
#define INLINE __inline__
#elif _WIN32
#define INLINE __inline
#else
#define INLINE 
#endif

typedef struct {PyObject **p; char *s; long n; char is_unicode; char intern; char is_identifier;} __Pyx_StringTabEntry; /*proto*/



static int __pyx_skip_dispatch = 0;


/* Type Conversion Predeclarations */

#if PY_MAJOR_VERSION < 3
#define __Pyx_PyBytes_FromString          PyString_FromString
#define __Pyx_PyBytes_FromStringAndSize   PyString_FromStringAndSize
#define __Pyx_PyBytes_AsString            PyString_AsString
#else
#define __Pyx_PyBytes_FromString          PyBytes_FromString
#define __Pyx_PyBytes_FromStringAndSize   PyBytes_FromStringAndSize
#define __Pyx_PyBytes_AsString            PyBytes_AsString
#endif

#define __Pyx_PyBool_FromLong(b) ((b) ? (Py_INCREF(Py_True), Py_True) : (Py_INCREF(Py_False), Py_False))
static INLINE int __Pyx_PyObject_IsTrue(PyObject*);
static INLINE PyObject* __Pyx_PyNumber_Int(PyObject* x);

#if !defined(T_PYSSIZET)
#if PY_VERSION_HEX < 0x02050000
#define T_PYSSIZET T_INT
#elif !defined(T_LONGLONG)
#define T_PYSSIZET \
        ((sizeof(Py_ssize_t) == sizeof(int))  ? T_INT  : \
        ((sizeof(Py_ssize_t) == sizeof(long)) ? T_LONG : -1))
#else
#define T_PYSSIZET \
        ((sizeof(Py_ssize_t) == sizeof(int))          ? T_INT      : \
        ((sizeof(Py_ssize_t) == sizeof(long))         ? T_LONG     : \
        ((sizeof(Py_ssize_t) == sizeof(PY_LONG_LONG)) ? T_LONGLONG : -1)))
#endif
#endif

#if !defined(T_SIZET)
#if !defined(T_ULONGLONG)
#define T_SIZET \
        ((sizeof(size_t) == sizeof(unsigned int))  ? T_UINT  : \
        ((sizeof(size_t) == sizeof(unsigned long)) ? T_ULONG : -1))
#else
#define T_SIZET \
        ((sizeof(size_t) == sizeof(unsigned int))          ? T_UINT      : \
        ((sizeof(size_t) == sizeof(unsigned long))         ? T_ULONG     : \
        ((sizeof(size_t) == sizeof(unsigned PY_LONG_LONG)) ? T_ULONGLONG : -1)))
#endif
#endif

static INLINE Py_ssize_t __Pyx_PyIndex_AsSsize_t(PyObject*);
static INLINE PyObject * __Pyx_PyInt_FromSize_t(size_t);
static INLINE size_t __Pyx_PyInt_AsSize_t(PyObject*);

#define __pyx_PyFloat_AsDouble(x) (PyFloat_CheckExact(x) ? PyFloat_AS_DOUBLE(x) : PyFloat_AsDouble(x))


#ifdef __GNUC__
/* Test for GCC > 2.95 */
#if __GNUC__ > 2 ||               (__GNUC__ == 2 && (__GNUC_MINOR__ > 95)) 
#define likely(x)   __builtin_expect(!!(x), 1)
#define unlikely(x) __builtin_expect(!!(x), 0)
#else /* __GNUC__ > 2 ... */
#define likely(x)   (x)
#define unlikely(x) (x)
#endif /* __GNUC__ > 2 ... */
#else /* __GNUC__ */
#define likely(x)   (x)
#define unlikely(x) (x)
#endif /* __GNUC__ */
    
static PyObject *__pyx_m;
static PyObject *__pyx_b;
static PyObject *__pyx_empty_tuple;
static int __pyx_lineno;
static int __pyx_clineno = 0;
static const char * __pyx_cfilenm= __FILE__;
static const char *__pyx_filename;
static const char **__pyx_f;


#ifdef CYTHON_REFNANNY
typedef struct {
  void (*INCREF)(void*, PyObject*, int);
  void (*DECREF)(void*, PyObject*, int);
  void (*GOTREF)(void*, PyObject*, int);
  void (*GIVEREF)(void*, PyObject*, int);
  void* (*NewContext)(const char*, int, const char*);
  void (*FinishContext)(void**);
} __Pyx_RefnannyAPIStruct;
static __Pyx_RefnannyAPIStruct *__Pyx_Refnanny = NULL;
#define __Pyx_ImportRefcountAPI(name)   (__Pyx_RefnannyAPIStruct *) PyCObject_Import((char *)name, (char *)"RefnannyAPI")
#define __Pyx_INCREF(r) __Pyx_Refnanny->INCREF(__pyx_refchk, (PyObject *)(r), __LINE__)
#define __Pyx_DECREF(r) __Pyx_Refnanny->DECREF(__pyx_refchk, (PyObject *)(r), __LINE__)
#define __Pyx_GOTREF(r) __Pyx_Refnanny->GOTREF(__pyx_refchk, (PyObject *)(r), __LINE__)
#define __Pyx_GIVEREF(r) __Pyx_Refnanny->GIVEREF(__pyx_refchk, (PyObject *)(r), __LINE__)
#define __Pyx_XDECREF(r) if((r) == NULL) ; else __Pyx_DECREF(r)
#define __Pyx_SetupRefcountContext(name)   void* __pyx_refchk = __Pyx_Refnanny->NewContext((name), __LINE__, __FILE__)
#define __Pyx_FinishRefcountContext()   __Pyx_Refnanny->FinishContext(&__pyx_refchk)
#else
#define __Pyx_INCREF(r) Py_INCREF(r)
#define __Pyx_DECREF(r) Py_DECREF(r)
#define __Pyx_GOTREF(r)
#define __Pyx_GIVEREF(r)
#define __Pyx_XDECREF(r) Py_XDECREF(r)
#define __Pyx_SetupRefcountContext(name)
#define __Pyx_FinishRefcountContext()
#endif /* CYTHON_REFNANNY */
#define __Pyx_XGIVEREF(r) if((r) == NULL) ; else __Pyx_GIVEREF(r)
#define __Pyx_XGOTREF(r) if((r) == NULL) ; else __Pyx_GOTREF(r)

static void __Pyx_RaiseDoubleKeywordsError(
    const char* func_name, PyObject* kw_name); /*proto*/

static void __Pyx_RaiseArgtupleInvalid(const char* func_name, int exact,
    Py_ssize_t num_min, Py_ssize_t num_max, Py_ssize_t num_found); /*proto*/

static int __Pyx_ParseOptionalKeywords(PyObject *kwds, PyObject **argnames[],     PyObject *kwds2, PyObject *values[], Py_ssize_t num_pos_args,     const char* function_name); /*proto*/

static int __Pyx_TypeTest(PyObject *obj, PyTypeObject *type); /*proto*/


static INLINE PyObject *__Pyx_GetItemInt_Generic(PyObject *o, PyObject* j) {
    PyObject *r;
    if (!j) return NULL;
    r = PyObject_GetItem(o, j);
    Py_DECREF(j);
    return r;
}


#define __Pyx_GetItemInt_List(o, i, size, to_py_func) ((size <= sizeof(Py_ssize_t)) ? \
                                                    __Pyx_GetItemInt_List_Fast(o, i, size <= sizeof(long)) : \
                                                    __Pyx_GetItemInt_Generic(o, to_py_func(i)))

static INLINE PyObject *__Pyx_GetItemInt_List_Fast(PyObject *o, Py_ssize_t i, int fits_long) {
    if (likely(o != Py_None)) {
        if (likely((0 <= i) & (i < PyList_GET_SIZE(o)))) {
            PyObject *r = PyList_GET_ITEM(o, i);
            Py_INCREF(r);
            return r;
        }
        else if ((-PyList_GET_SIZE(o) <= i) & (i < 0)) {
            PyObject *r = PyList_GET_ITEM(o, PyList_GET_SIZE(o) + i);
            Py_INCREF(r);
            return r;
        }
    }
    return __Pyx_GetItemInt_Generic(o, fits_long ? PyInt_FromLong(i) : PyLong_FromLongLong(i));
}

#define __Pyx_GetItemInt_Tuple(o, i, size, to_py_func) ((size <= sizeof(Py_ssize_t)) ? \
                                                    __Pyx_GetItemInt_Tuple_Fast(o, i, size <= sizeof(long)) : \
                                                    __Pyx_GetItemInt_Generic(o, to_py_func(i)))

static INLINE PyObject *__Pyx_GetItemInt_Tuple_Fast(PyObject *o, Py_ssize_t i, int fits_long) {
    if (likely(o != Py_None)) {
        if (likely((0 <= i) & (i < PyTuple_GET_SIZE(o)))) {
            PyObject *r = PyTuple_GET_ITEM(o, i);
            Py_INCREF(r);
            return r;
        }
        else if ((-PyTuple_GET_SIZE(o) <= i) & (i < 0)) {
            PyObject *r = PyTuple_GET_ITEM(o, PyTuple_GET_SIZE(o) + i);
            Py_INCREF(r);
            return r;
        }
    }
    return __Pyx_GetItemInt_Generic(o, fits_long ? PyInt_FromLong(i) : PyLong_FromLongLong(i));
}


#define __Pyx_GetItemInt(o, i, size, to_py_func) ((size <= sizeof(Py_ssize_t)) ? \
                                                    __Pyx_GetItemInt_Fast(o, i, size <= sizeof(long)) : \
                                                    __Pyx_GetItemInt_Generic(o, to_py_func(i)))

static INLINE PyObject *__Pyx_GetItemInt_Fast(PyObject *o, Py_ssize_t i, int fits_long) {
    PyObject *r;
    if (PyList_CheckExact(o) && ((0 <= i) & (i < PyList_GET_SIZE(o)))) {
        r = PyList_GET_ITEM(o, i);
        Py_INCREF(r);
    }
    else if (PyTuple_CheckExact(o) && ((0 <= i) & (i < PyTuple_GET_SIZE(o)))) {
        r = PyTuple_GET_ITEM(o, i);
        Py_INCREF(r);
    }
    else if (Py_TYPE(o)->tp_as_sequence && Py_TYPE(o)->tp_as_sequence->sq_item && (likely(i >= 0))) {
        r = PySequence_GetItem(o, i);
    }
    else {
        r = __Pyx_GetItemInt_Generic(o, fits_long ? PyInt_FromLong(i) : PyLong_FromLongLong(i));
    }
    return r;
}

#define __Pyx_SetItemInt(o, i, v, size, to_py_func) ((size <= sizeof(Py_ssize_t)) ? \
                                                    __Pyx_SetItemInt_Fast(o, i, v, size <= sizeof(long)) : \
                                                    __Pyx_SetItemInt_Generic(o, to_py_func(i), v))

static INLINE int __Pyx_SetItemInt_Generic(PyObject *o, PyObject *j, PyObject *v) {
    int r;
    if (!j) return -1;
    r = PyObject_SetItem(o, j, v);
    Py_DECREF(j);
    return r;
}

static INLINE int __Pyx_SetItemInt_Fast(PyObject *o, Py_ssize_t i, PyObject *v, int fits_long) {
    if (PyList_CheckExact(o) && ((0 <= i) & (i < PyList_GET_SIZE(o)))) {
        Py_INCREF(v);
        Py_DECREF(PyList_GET_ITEM(o, i));
        PyList_SET_ITEM(o, i, v);
        return 1;
    }
    else if (Py_TYPE(o)->tp_as_sequence && Py_TYPE(o)->tp_as_sequence->sq_ass_item && (likely(i >= 0)))
        return PySequence_SetItem(o, i, v);
    else {
        PyObject *j = fits_long ? PyInt_FromLong(i) : PyLong_FromLongLong(i);
        return __Pyx_SetItemInt_Generic(o, j, v);
    }
}

static int __Pyx_GetException(PyObject **type, PyObject **value, PyObject **tb); /*proto*/

static INLINE void __Pyx_ExceptionSave(PyObject **type, PyObject **value, PyObject **tb); /*proto*/
static void __Pyx_ExceptionReset(PyObject *type, PyObject *value, PyObject *tb); /*proto*/

static PyObject *__Pyx_Import(PyObject *name, PyObject *from_list); /*proto*/

static PyObject *__Pyx_GetName(PyObject *dict, PyObject *name); /*proto*/

static PyObject *__Pyx_CreateClass(PyObject *bases, PyObject *dict, PyObject *name, const char *modname); /*proto*/

static INLINE void __Pyx_RaiseNeedMoreValuesError(Py_ssize_t index);

static INLINE void __Pyx_RaiseTooManyValuesError(void);

static PyObject *__Pyx_UnpackItem(PyObject *, Py_ssize_t index); /*proto*/
static int __Pyx_EndUnpack(PyObject *); /*proto*/

static INLINE PyObject* __Pyx_PyObject_Append(PyObject* L, PyObject* x) {
    if (likely(PyList_CheckExact(L))) {
        if (PyList_Append(L, x) < 0) return NULL;
        Py_INCREF(Py_None);
        return Py_None; /* this is just to have an accurate signature */
    }
    else {
        PyObject *r, *m;
        m = __Pyx_GetAttrString(L, "append");
        if (!m) return NULL;
        r = PyObject_CallFunctionObjArgs(m, x, NULL);
        Py_DECREF(m);
        return r;
    }
}

static int __Pyx_Print(PyObject *, int); /*proto*/
#if PY_MAJOR_VERSION >= 3
static PyObject* __pyx_print = 0;
static PyObject* __pyx_print_kwargs = 0;
#endif

#if __PYX_USE_C99_COMPLEX
    #define __Pyx_REAL_PART(z) __real__(z)
    #define __Pyx_IMAG_PART(z) __imag__(z)
#else
    #define __Pyx_REAL_PART(z) ((z).real)
    #define __Pyx_IMAG_PART(z) ((z).imag)
#endif

#define __pyx_PyObject_from_complex(z) PyComplex_FromDoubles((double)__Pyx_REAL_PART(z), (double)__Pyx_IMAG_PART(z))

#if __PYX_USE_C99_COMPLEX

    typedef float _Complex __pyx_t_float_complex;
    static INLINE __pyx_t_float_complex __pyx_t_float_complex_from_parts(float x, float y) {
      return x + y*(__pyx_t_float_complex)_Complex_I;
    }
    
    #define __pyx_t_float_complex_is_zero(a) ((a) == 0)
    #define __pyx_t_float_complex_eq(a, b) ((a) == (b))
    #define __pyx_t_float_complex_add(a, b) ((a)+(b))
    #define __pyx_t_float_complex_sub(a, b) ((a)-(b))
    #define __pyx_t_float_complex_mul(a, b) ((a)*(b))
    #define __pyx_t_float_complex_div(a, b) ((a)/(b))
    #define __pyx_t_float_complex_neg(a) (-(a))

#else

    typedef struct { float real, imag; } __pyx_t_float_complex;
    static INLINE __pyx_t_float_complex __pyx_t_float_complex_from_parts(float x, float y) {
      __pyx_t_float_complex c; c.real = x; c.imag = y; return c;
    }
    
    static INLINE int __pyx_t_float_complex_is_zero(__pyx_t_float_complex a) {
       return (a.real == 0) & (a.imag == 0);
    }

    static INLINE int __pyx_t_float_complex_eq(__pyx_t_float_complex a, __pyx_t_float_complex b) {
       return (a.real == b.real) & (a.imag == b.imag);
    }

    static INLINE __pyx_t_float_complex __pyx_t_float_complex_add(__pyx_t_float_complex a, __pyx_t_float_complex b) {
        __pyx_t_float_complex z;
        z.real = a.real + b.real;
        z.imag = a.imag + b.imag;
        return z;
    }

    static INLINE __pyx_t_float_complex __pyx_t_float_complex_sub(__pyx_t_float_complex a, __pyx_t_float_complex b) {
        __pyx_t_float_complex z;
        z.real = a.real - b.real;
        z.imag = a.imag - b.imag;
        return z;
    }

    static INLINE __pyx_t_float_complex __pyx_t_float_complex_mul(__pyx_t_float_complex a, __pyx_t_float_complex b) {
        __pyx_t_float_complex z;
        z.real = a.real * b.real - a.imag * b.imag;
        z.imag = a.real * b.imag + a.imag * b.real;
        return z;
    }

    static INLINE __pyx_t_float_complex __pyx_t_float_complex_div(__pyx_t_float_complex a, __pyx_t_float_complex b) {
        __pyx_t_float_complex z;
        float denom = b.real*b.real + b.imag*b.imag;
        z.real = (a.real * b.real + a.imag * b.imag) / denom;
        z.imag = (a.imag * b.real - a.real * b.imag) / denom;
        return z;
    }

    static INLINE __pyx_t_float_complex __pyx_t_float_complex_neg(__pyx_t_float_complex a) {
        __pyx_t_float_complex z;
        z.real = -a.real;
        z.imag = -a.imag;
        return z;
    }

#endif

#if __PYX_USE_C99_COMPLEX

    typedef double _Complex __pyx_t_double_complex;
    static INLINE __pyx_t_double_complex __pyx_t_double_complex_from_parts(double x, double y) {
      return x + y*(__pyx_t_double_complex)_Complex_I;
    }
    
    #define __pyx_t_double_complex_is_zero(a) ((a) == 0)
    #define __pyx_t_double_complex_eq(a, b) ((a) == (b))
    #define __pyx_t_double_complex_add(a, b) ((a)+(b))
    #define __pyx_t_double_complex_sub(a, b) ((a)-(b))
    #define __pyx_t_double_complex_mul(a, b) ((a)*(b))
    #define __pyx_t_double_complex_div(a, b) ((a)/(b))
    #define __pyx_t_double_complex_neg(a) (-(a))

#else

    typedef struct { double real, imag; } __pyx_t_double_complex;
    static INLINE __pyx_t_double_complex __pyx_t_double_complex_from_parts(double x, double y) {
      __pyx_t_double_complex c; c.real = x; c.imag = y; return c;
    }
    
    static INLINE int __pyx_t_double_complex_is_zero(__pyx_t_double_complex a) {
       return (a.real == 0) & (a.imag == 0);
    }

    static INLINE int __pyx_t_double_complex_eq(__pyx_t_double_complex a, __pyx_t_double_complex b) {
       return (a.real == b.real) & (a.imag == b.imag);
    }

    static INLINE __pyx_t_double_complex __pyx_t_double_complex_add(__pyx_t_double_complex a, __pyx_t_double_complex b) {
        __pyx_t_double_complex z;
        z.real = a.real + b.real;
        z.imag = a.imag + b.imag;
        return z;
    }

    static INLINE __pyx_t_double_complex __pyx_t_double_complex_sub(__pyx_t_double_complex a, __pyx_t_double_complex b) {
        __pyx_t_double_complex z;
        z.real = a.real - b.real;
        z.imag = a.imag - b.imag;
        return z;
    }

    static INLINE __pyx_t_double_complex __pyx_t_double_complex_mul(__pyx_t_double_complex a, __pyx_t_double_complex b) {
        __pyx_t_double_complex z;
        z.real = a.real * b.real - a.imag * b.imag;
        z.imag = a.real * b.imag + a.imag * b.real;
        return z;
    }

    static INLINE __pyx_t_double_complex __pyx_t_double_complex_div(__pyx_t_double_complex a, __pyx_t_double_complex b) {
        __pyx_t_double_complex z;
        double denom = b.real*b.real + b.imag*b.imag;
        z.real = (a.real * b.real + a.imag * b.imag) / denom;
        z.imag = (a.imag * b.real - a.real * b.imag) / denom;
        return z;
    }

    static INLINE __pyx_t_double_complex __pyx_t_double_complex_neg(__pyx_t_double_complex a) {
        __pyx_t_double_complex z;
        z.real = -a.real;
        z.imag = -a.imag;
        return z;
    }

#endif

#if __PYX_USE_C99_COMPLEX

    typedef long double _Complex __pyx_t_long__double_complex;
    static INLINE __pyx_t_long__double_complex __pyx_t_long__double_complex_from_parts(long double x, long double y) {
      return x + y*(__pyx_t_long__double_complex)_Complex_I;
    }
    
    #define __pyx_t_long__double_complex_is_zero(a) ((a) == 0)
    #define __pyx_t_long__double_complex_eq(a, b) ((a) == (b))
    #define __pyx_t_long__double_complex_add(a, b) ((a)+(b))
    #define __pyx_t_long__double_complex_sub(a, b) ((a)-(b))
    #define __pyx_t_long__double_complex_mul(a, b) ((a)*(b))
    #define __pyx_t_long__double_complex_div(a, b) ((a)/(b))
    #define __pyx_t_long__double_complex_neg(a) (-(a))

#else

    typedef struct { long double real, imag; } __pyx_t_long__double_complex;
    static INLINE __pyx_t_long__double_complex __pyx_t_long__double_complex_from_parts(long double x, long double y) {
      __pyx_t_long__double_complex c; c.real = x; c.imag = y; return c;
    }
    
    static INLINE int __pyx_t_long__double_complex_is_zero(__pyx_t_long__double_complex a) {
       return (a.real == 0) & (a.imag == 0);
    }

    static INLINE int __pyx_t_long__double_complex_eq(__pyx_t_long__double_complex a, __pyx_t_long__double_complex b) {
       return (a.real == b.real) & (a.imag == b.imag);
    }

    static INLINE __pyx_t_long__double_complex __pyx_t_long__double_complex_add(__pyx_t_long__double_complex a, __pyx_t_long__double_complex b) {
        __pyx_t_long__double_complex z;
        z.real = a.real + b.real;
        z.imag = a.imag + b.imag;
        return z;
    }

    static INLINE __pyx_t_long__double_complex __pyx_t_long__double_complex_sub(__pyx_t_long__double_complex a, __pyx_t_long__double_complex b) {
        __pyx_t_long__double_complex z;
        z.real = a.real - b.real;
        z.imag = a.imag - b.imag;
        return z;
    }

    static INLINE __pyx_t_long__double_complex __pyx_t_long__double_complex_mul(__pyx_t_long__double_complex a, __pyx_t_long__double_complex b) {
        __pyx_t_long__double_complex z;
        z.real = a.real * b.real - a.imag * b.imag;
        z.imag = a.real * b.imag + a.imag * b.real;
        return z;
    }

    static INLINE __pyx_t_long__double_complex __pyx_t_long__double_complex_div(__pyx_t_long__double_complex a, __pyx_t_long__double_complex b) {
        __pyx_t_long__double_complex z;
        long double denom = b.real*b.real + b.imag*b.imag;
        z.real = (a.real * b.real + a.imag * b.imag) / denom;
        z.imag = (a.imag * b.real - a.real * b.imag) / denom;
        return z;
    }

    static INLINE __pyx_t_long__double_complex __pyx_t_long__double_complex_neg(__pyx_t_long__double_complex a) {
        __pyx_t_long__double_complex z;
        z.real = -a.real;
        z.imag = -a.imag;
        return z;
    }

#endif

static void __Pyx_Raise(PyObject *type, PyObject *value, PyObject *tb); /*proto*/

static INLINE void __Pyx_ErrRestore(PyObject *type, PyObject *value, PyObject *tb); /*proto*/
static INLINE void __Pyx_ErrFetch(PyObject **type, PyObject **value, PyObject **tb); /*proto*/

static INLINE int __Pyx_StrEq(const char *, const char *); /*proto*/

static INLINE unsigned char __Pyx_PyInt_AsUnsignedChar(PyObject *);

static INLINE unsigned short __Pyx_PyInt_AsUnsignedShort(PyObject *);

static INLINE unsigned int __Pyx_PyInt_AsUnsignedInt(PyObject *);

static INLINE char __Pyx_PyInt_AsChar(PyObject *);

static INLINE short __Pyx_PyInt_AsShort(PyObject *);

static INLINE int __Pyx_PyInt_AsInt(PyObject *);

static INLINE signed char __Pyx_PyInt_AsSignedChar(PyObject *);

static INLINE signed short __Pyx_PyInt_AsSignedShort(PyObject *);

static INLINE signed int __Pyx_PyInt_AsSignedInt(PyObject *);

static INLINE unsigned long __Pyx_PyInt_AsUnsignedLong(PyObject *);

static INLINE unsigned PY_LONG_LONG __Pyx_PyInt_AsUnsignedLongLong(PyObject *);

static INLINE long __Pyx_PyInt_AsLong(PyObject *);

static INLINE PY_LONG_LONG __Pyx_PyInt_AsLongLong(PyObject *);

static INLINE signed long __Pyx_PyInt_AsSignedLong(PyObject *);

static INLINE signed PY_LONG_LONG __Pyx_PyInt_AsSignedLongLong(PyObject *);

static PyTypeObject *__Pyx_ImportType(const char *module_name, const char *class_name, long size);  /*proto*/

static PyObject *__Pyx_ImportModule(const char *name); /*proto*/

static void __Pyx_AddTraceback(const char *funcname); /*proto*/

static int __Pyx_InitStrings(__Pyx_StringTabEntry *t); /*proto*/

/* Type declarations */

typedef npy_int8 __pyx_t_5numpy_int8_t;

typedef npy_int16 __pyx_t_5numpy_int16_t;

typedef npy_int32 __pyx_t_5numpy_int32_t;

typedef npy_int64 __pyx_t_5numpy_int64_t;

typedef npy_uint8 __pyx_t_5numpy_uint8_t;

typedef npy_uint16 __pyx_t_5numpy_uint16_t;

typedef npy_uint32 __pyx_t_5numpy_uint32_t;

typedef npy_uint64 __pyx_t_5numpy_uint64_t;

typedef npy_float32 __pyx_t_5numpy_float32_t;

typedef npy_float64 __pyx_t_5numpy_float64_t;

typedef npy_complex64 __pyx_t_5numpy_complex64_t;

typedef npy_complex128 __pyx_t_5numpy_complex128_t;

typedef npy_long __pyx_t_5numpy_int_t;

typedef npy_longlong __pyx_t_5numpy_long_t;

typedef npy_ulong __pyx_t_5numpy_uint_t;

typedef npy_ulonglong __pyx_t_5numpy_ulong_t;

typedef npy_double __pyx_t_5numpy_float_t;

typedef npy_double __pyx_t_5numpy_double_t;

typedef npy_longdouble __pyx_t_5numpy_longdouble_t;

typedef npy_cfloat __pyx_t_5numpy_cfloat_t;

typedef npy_cdouble __pyx_t_5numpy_cdouble_t;

typedef npy_clongdouble __pyx_t_5numpy_clongdouble_t;

typedef npy_cdouble __pyx_t_5numpy_complex_t;
/* Module declarations from python_buffer */

/* Module declarations from stdlib */

/* Module declarations from numpy */

/* Module declarations from numpy */

static PyTypeObject *__pyx_ptype_5numpy_dtype = 0;
static PyTypeObject *__pyx_ptype_5numpy_ndarray = 0;
static INLINE char *__pyx_f_5numpy__util_dtypestring(PyArray_Descr *, char *, char *, int *); /*proto*/
/* Module declarations from yt.lagos.chainHOP.chainHOP */

static PyObject *__pyx_k_37 = 0;
#define __Pyx_MODULE_NAME "yt.lagos.chainHOP.chainHOP"
int __pyx_module_is_main_yt__lagos__chainHOP__chainHOP = 0;

/* Implementation of yt.lagos.chainHOP.chainHOP */
static PyObject *__pyx_int_3;
static PyObject *__pyx_int_4;
static PyObject *__pyx_int_neg_1;
static PyObject *__pyx_int_2;
static PyObject *__pyx_int_0;
static PyObject *__pyx_int_1;
static PyObject *__pyx_int_5;
static PyObject *__pyx_int_6;
static PyObject *__pyx_int_7;
static PyObject *__pyx_int_8;
static PyObject *__pyx_int_9;
static PyObject *__pyx_int_10;
static PyObject *__pyx_int_11;
static PyObject *__pyx_int_12;
static PyObject *__pyx_int_13;
static PyObject *__pyx_int_14;
static PyObject *__pyx_int_15;
static PyObject *__pyx_int_16;
static PyObject *__pyx_int_17;
static PyObject *__pyx_int_18;
static PyObject *__pyx_int_19;
static PyObject *__pyx_int_20;
static PyObject *__pyx_int_21;
static PyObject *__pyx_int_22;
static PyObject *__pyx_int_23;
static PyObject *__pyx_int_24;
static PyObject *__pyx_int_25;
static PyObject *__pyx_int_26;
static PyObject *__pyx_int_27;
static char __pyx_k___main__[] = "__main__";
static PyObject *__pyx_kp___main__;
static char __pyx_k_self[] = "self";
static PyObject *__pyx_kp_self;
static char __pyx_k_period[] = "period";
static PyObject *__pyx_kp_period;
static char __pyx_k_padding[] = "padding";
static PyObject *__pyx_kp_padding;
static char __pyx_k_num_neighbors[] = "num_neighbors";
static PyObject *__pyx_kp_num_neighbors;
static char __pyx_k_bounds[] = "bounds";
static PyObject *__pyx_kp_bounds;
static char __pyx_k_xpos[] = "xpos";
static PyObject *__pyx_kp_xpos;
static char __pyx_k_ypos[] = "ypos";
static PyObject *__pyx_kp_ypos;
static char __pyx_k_zpos[] = "zpos";
static PyObject *__pyx_kp_zpos;
static char __pyx_k_index[] = "index";
static PyObject *__pyx_kp_index;
static char __pyx_k_mass[] = "mass";
static PyObject *__pyx_kp_mass;
static char __pyx_k_threshold[] = "threshold";
static PyObject *__pyx_kp_threshold;
static char __pyx_k_i[] = "i";
static PyObject *__pyx_kp_i;
static char __pyx_k_shift[] = "shift";
static PyObject *__pyx_kp_shift;
static char __pyx_k_pi[] = "pi";
static PyObject *__pyx_kp_pi;
static char __pyx_k_chainIDmax[] = "chainIDmax";
static PyObject *__pyx_kp_chainIDmax;
static char __pyx_k_chain_count[] = "chain_count";
static PyObject *__pyx_kp_chain_count;
static char __pyx_k_31[] = "chainID_translate_map_global";
static PyObject *__pyx_kp_31;
static char __pyx_k_chainID[] = "chainID";
static PyObject *__pyx_kp_chainID;
static char __pyx_k_group_count[] = "group_count";
static PyObject *__pyx_kp_group_count;
static char __pyx_k_math[] = "math";
static PyObject *__pyx_kp_math;
static char __pyx_k_bisect[] = "bisect";
static PyObject *__pyx_kp_bisect;
static char __pyx_k_insort[] = "insort";
static PyObject *__pyx_kp_insort;
static char __pyx_k_sets[] = "sets";
static PyObject *__pyx_kp_sets;
static char __pyx_k_Set[] = "Set";
static PyObject *__pyx_kp_Set;
static char __pyx_k_32[] = "yt.lagos";
static PyObject *__pyx_kp_32;
static char __pyx_k_33[] = "*";
static PyObject *__pyx_kp_33;
static char __pyx_k_34[] = "yt.extensions.kdtree";
static PyObject *__pyx_kp_34;
static char __pyx_k_35[] = "mpi4py";
static PyObject *__pyx_kp_35;
static char __pyx_k_MPI[] = "MPI";
static PyObject *__pyx_kp_MPI;
static char __pyx_k_Forthon[] = "Forthon";
static PyObject *__pyx_kp_Forthon;
static char __pyx_k_RunChainHOP[] = "RunChainHOP";
static PyObject *__pyx_kp_RunChainHOP;
static char __pyx_k_36[] = "ParallelAnalysisInterface";
static PyObject *__pyx_kp_36;
static char __pyx_k___init__[] = "__init__";
static PyObject *__pyx_kp___init__;
static char __pyx_k__init_kd_tree[] = "_init_kd_tree";
static PyObject *__pyx_kp__init_kd_tree;
static char __pyx_k__is_inside[] = "_is_inside";
static PyObject *__pyx_kp__is_inside;
static char __pyx_k__find_shift_padded[] = "_find_shift_padded";
static PyObject *__pyx_kp__find_shift_padded;
static char __pyx_k__find_shift_real[] = "_find_shift_real";
static PyObject *__pyx_kp__find_shift_real;
static char __pyx_k__translate_shift[] = "_translate_shift";
static PyObject *__pyx_kp__translate_shift;
static char __pyx_k__densestNN[] = "_densestNN";
static PyObject *__pyx_kp__densestNN;
static char __pyx_k__build_chains[] = "_build_chains";
static PyObject *__pyx_kp__build_chains;
static char __pyx_k__recurse_links[] = "_recurse_links";
static PyObject *__pyx_kp__recurse_links;
static char __pyx_k_38[] = "_globally_assign_chainIDs";
static PyObject *__pyx_kp_38;
static char __pyx_k_39[] = "_create_global_densest_in_chain";
static PyObject *__pyx_kp_39;
static char __pyx_k_40[] = "_communicate_uphill_info";
static PyObject *__pyx_kp_40;
static char __pyx_k_41[] = "_recurse_global_chain_links";
static PyObject *__pyx_kp_41;
static char __pyx_k_42[] = "_connect_chains_across_tasks";
static PyObject *__pyx_kp_42;
static char __pyx_k_43[] = "_communicate_annulus_chainIDs";
static PyObject *__pyx_kp_43;
static char __pyx_k__connect_chains[] = "_connect_chains";
static PyObject *__pyx_kp__connect_chains;
static char __pyx_k_44[] = "_make_global_chain_densest_n";
static PyObject *__pyx_kp_44;
static char __pyx_k__build_groups[] = "_build_groups";
static PyObject *__pyx_kp__build_groups;
static char __pyx_k__translate_groupIDs[] = "_translate_groupIDs";
static PyObject *__pyx_kp__translate_groupIDs;
static char __pyx_k__chain_hop[] = "_chain_hop";
static PyObject *__pyx_kp__chain_hop;
static char __pyx_k_saddlethresh[] = "saddlethresh";
static PyObject *__pyx_kp_saddlethresh;
static char __pyx_k_peakthresh[] = "peakthresh";
static PyObject *__pyx_kp_peakthresh;
static char __pyx_k_size[] = "size";
static PyObject *__pyx_kp_size;
static char __pyx_k_na[] = "na";
static PyObject *__pyx_kp_na;
static char __pyx_k_array[] = "array";
static PyObject *__pyx_kp_array;
static char __pyx_k_dtype[] = "dtype";
static PyObject *__pyx_kp_dtype;
static char __pyx_k_45[] = "int64";
static PyObject *__pyx_kp_45;
static char __pyx_k_padded_particles[] = "padded_particles";
static PyObject *__pyx_kp_padded_particles;
static char __pyx_k_nMerge[] = "nMerge";
static PyObject *__pyx_kp_nMerge;
static char __pyx_k_d[] = "d";
static PyObject *__pyx_kp_d;
static char __pyx_k_ones[] = "ones";
static PyObject *__pyx_kp_ones;
static char __pyx_k_46[] = "int64";
static PyObject *__pyx_kp_46;
static char __pyx_k_empty[] = "empty";
static PyObject *__pyx_kp_empty;
static char __pyx_k_47[] = "l";
static PyObject *__pyx_kp_47;
static char __pyx_k_fKD[] = "fKD";
static PyObject *__pyx_kp_fKD;
static char __pyx_k_nn_tags[] = "nn_tags";
static PyObject *__pyx_kp_nn_tags;
static char __pyx_k_zeros[] = "zeros";
static PyObject *__pyx_kp_zeros;
static char __pyx_k_48[] = "d";
static PyObject *__pyx_kp_48;
static char __pyx_k_dens[] = "dens";
static PyObject *__pyx_kp_dens;
static char __pyx_k_49[] = "d";
static PyObject *__pyx_kp_49;
static char __pyx_k_50[] = "d";
static PyObject *__pyx_kp_50;
static char __pyx_k_pos[] = "pos";
static PyObject *__pyx_kp_pos;
static char __pyx_k_51[] = "d";
static PyObject *__pyx_kp_51;
static char __pyx_k_qv[] = "qv";
static PyObject *__pyx_kp_qv;
static char __pyx_k_nn[] = "nn";
static PyObject *__pyx_kp_nn;
static char __pyx_k_nparts[] = "nparts";
static PyObject *__pyx_kp_nparts;
static char __pyx_k_sort[] = "sort";
static PyObject *__pyx_kp_sort;
static char __pyx_k_rearrange[] = "rearrange";
static PyObject *__pyx_kp_rearrange;
static char __pyx_k_create_tree[] = "create_tree";
static PyObject *__pyx_kp_create_tree;
static char __pyx_k_transpose[] = "transpose";
static PyObject *__pyx_kp_transpose;
static char __pyx_k_all[] = "all";
static PyObject *__pyx_kp_all;
static char __pyx_k_axis[] = "axis";
static PyObject *__pyx_kp_axis;
static char __pyx_k_is_inside[] = "is_inside";
static PyObject *__pyx_kp_is_inside;
static char __pyx_k_invert[] = "invert";
static PyObject *__pyx_kp_invert;
static char __pyx_k_bitwise_and[] = "bitwise_and";
static PyObject *__pyx_kp_bitwise_and;
static char __pyx_k_is_inside_annulus[] = "is_inside_annulus";
static PyObject *__pyx_kp_is_inside_annulus;
static char __pyx_k_rev_index[] = "rev_index";
static PyObject *__pyx_kp_rev_index;
static char __pyx_k_xrange[] = "xrange";
static PyObject *__pyx_kp_xrange;
static char __pyx_k_52[] = "int64";
static PyObject *__pyx_kp_52;
static char __pyx_k_53[] = "int64";
static PyObject *__pyx_kp_53;
static char __pyx_k_54[] = "int64";
static PyObject *__pyx_kp_54;
static char __pyx_k_55[] = "int64";
static PyObject *__pyx_kp_55;
static char __pyx_k_56[] = "int64";
static PyObject *__pyx_kp_56;
static char __pyx_k_57[] = "int64";
static PyObject *__pyx_kp_57;
static char __pyx_k_append[] = "append";
static PyObject *__pyx_kp_append;
static char __pyx_k_argmax[] = "argmax";
static PyObject *__pyx_kp_argmax;
static char __pyx_k_abs[] = "abs";
static PyObject *__pyx_kp_abs;
static char __pyx_k_58[] = "int64";
static PyObject *__pyx_kp_58;
static char __pyx_k_59[] = "l";
static PyObject *__pyx_kp_59;
static char __pyx_k_densestNN[] = "densestNN";
static PyObject *__pyx_kp_densestNN;
static char __pyx_k_60[] = "l";
static PyObject *__pyx_kp_60;
static char __pyx_k_chunk_tags[] = "chunk_tags";
static PyObject *__pyx_kp_chunk_tags;
static char __pyx_k_min[] = "min";
static PyObject *__pyx_kp_min;
static char __pyx_k_start[] = "start";
static PyObject *__pyx_kp_start;
static char __pyx_k_finish[] = "finish";
static PyObject *__pyx_kp_finish;
static char __pyx_k_61[] = "find_chunk_nearest_neighbors";
static PyObject *__pyx_kp_61;
static char __pyx_k_take[] = "take";
static PyObject *__pyx_kp_take;
static char __pyx_k_density[] = "density";
static PyObject *__pyx_kp_density;
static char __pyx_k_densest_in_chain[] = "densest_in_chain";
static PyObject *__pyx_kp_densest_in_chain;
static char __pyx_k_62[] = "int64";
static PyObject *__pyx_kp_62;
static char __pyx_k__mpi_info_dict[] = "_mpi_info_dict";
static PyObject *__pyx_kp__mpi_info_dict;
static char __pyx_k_mine[] = "mine";
static PyObject *__pyx_kp_mine;
static char __pyx_k_sum[] = "sum";
static PyObject *__pyx_kp_sum;
static char __pyx_k_values[] = "values";
static PyObject *__pyx_kp_values;
static char __pyx_k_nchains[] = "nchains";
static PyObject *__pyx_kp_nchains;
static char __pyx_k_my_first_id[] = "my_first_id";
static PyObject *__pyx_kp_my_first_id;
static char __pyx_k_items[] = "items";
static PyObject *__pyx_kp_items;
static char __pyx_k_copy[] = "copy";
static PyObject *__pyx_kp_copy;
static char __pyx_k__mpi_joindict[] = "_mpi_joindict";
static PyObject *__pyx_kp__mpi_joindict;
static char __pyx_k_63[] = "_mpi_find_neighbor_3d";
static PyObject *__pyx_kp_63;
static char __pyx_k_global_padded_count[] = "global_padded_count";
static PyObject *__pyx_kp_global_padded_count;
static char __pyx_k_64[] = "int64";
static PyObject *__pyx_kp_64;
static char __pyx_k_recv_real_indices[] = "recv_real_indices";
static PyObject *__pyx_kp_recv_real_indices;
static char __pyx_k_65[] = "int64";
static PyObject *__pyx_kp_65;
static char __pyx_k_recv_chainIDs[] = "recv_chainIDs";
static PyObject *__pyx_kp_recv_chainIDs;
static char __pyx_k_66[] = "int64";
static PyObject *__pyx_kp_66;
static char __pyx_k_67[] = "int64";
static PyObject *__pyx_kp_67;
static char __pyx_k_COMM_WORLD[] = "COMM_WORLD";
static PyObject *__pyx_kp_COMM_WORLD;
static char __pyx_k_Sendrecv[] = "Sendrecv";
static PyObject *__pyx_kp_Sendrecv;
static char __pyx_k_uphill_real_indices[] = "uphill_real_indices";
static PyObject *__pyx_kp_uphill_real_indices;
static char __pyx_k_INT[] = "INT";
static PyObject *__pyx_kp_INT;
static char __pyx_k_uphill_chainIDs[] = "uphill_chainIDs";
static PyObject *__pyx_kp_uphill_chainIDs;
static char __pyx_k_enumerate[] = "enumerate";
static PyObject *__pyx_kp_enumerate;
static char __pyx_k_KeyError[] = "KeyError";
static PyObject *__pyx_kp_KeyError;
static char __pyx_k_max[] = "max";
static PyObject *__pyx_kp_max;
static char __pyx_k_68[] = "int64";
static PyObject *__pyx_kp_68;
static char __pyx_k_69[] = "int64";
static PyObject *__pyx_kp_69;
static char __pyx_k_chain_densest_n[] = "chain_densest_n";
static PyObject *__pyx_kp_chain_densest_n;
static char __pyx_k_reverse_map[] = "reverse_map";
static PyObject *__pyx_kp_reverse_map;
static char __pyx_k_NNtags[] = "NNtags";
static PyObject *__pyx_kp_NNtags;
static char __pyx_k__mpi_maxdict[] = "_mpi_maxdict";
static PyObject *__pyx_kp__mpi_maxdict;
static char __pyx_k_pop[] = "pop";
static PyObject *__pyx_kp_pop;
static char __pyx_k_densest_in_group[] = "densest_in_group";
static PyObject *__pyx_kp_densest_in_group;
static char __pyx_k_mylog[] = "mylog";
static PyObject *__pyx_kp_mylog;
static char __pyx_k_info[] = "info";
static PyObject *__pyx_kp_info;
static char __pyx_k_chainHOP_tags_dens[] = "chainHOP_tags_dens";
static PyObject *__pyx_kp_chainHOP_tags_dens;
static char __pyx_k_where[] = "where";
static PyObject *__pyx_kp_where;
static char __pyx_k_free_tree[] = "free_tree";
static PyObject *__pyx_kp_free_tree;
static PyObject *__pyx_builtin_xrange;
static PyObject *__pyx_builtin_min;
static PyObject *__pyx_builtin_sum;
static PyObject *__pyx_builtin_enumerate;
static PyObject *__pyx_builtin_KeyError;
static PyObject *__pyx_builtin_max;
static PyObject *__pyx_kp_70;
static PyObject *__pyx_kp_71;
static PyObject *__pyx_kp_72;
static PyObject *__pyx_kp_73;
static PyObject *__pyx_kp_74;
static PyObject *__pyx_kp_75;
static PyObject *__pyx_kp_76;
static PyObject *__pyx_kp_77;
static PyObject *__pyx_kp_78;
static PyObject *__pyx_kp_79;
static PyObject *__pyx_kp_80;
static PyObject *__pyx_kp_81;
static PyObject *__pyx_kp_82;
static PyObject *__pyx_kp_83;
static PyObject *__pyx_kp_84;
static char __pyx_k_70[] = "Running Cython version.";
static char __pyx_k_71[] = "Building kd tree for %d particles...";
static char __pyx_k_72[] = "Finding nearest neighbors/density...";
static char __pyx_k_73[] = "count above thresh";
static char __pyx_k_74[] = "Finding densest nearest neighbors...";
static char __pyx_k_75[] = "Building particle chains...";
static char __pyx_k_76[] = "Gobally assigning chainIDs...";
static char __pyx_k_77[] = "Globally finding densest in chains...";
static char __pyx_k_78[] = "Building chain connections across tasks...";
static char __pyx_k_79[] = "Communicating connected chains...";
static char __pyx_k_80[] = "Connecting %d chains into groups...";
static char __pyx_k_81[] = "Communicating group links globally...";
static char __pyx_k_82[] = "Building final groups...";
static char __pyx_k_83[] = "Remapping particles to final groups...";
static char __pyx_k_84[] = "Found %d groups...";
static char __pyx_k___getbuffer__[] = "__getbuffer__";
static PyObject *__pyx_kp___getbuffer__;
static char __pyx_k___releasebuffer__[] = "__releasebuffer__";
static PyObject *__pyx_kp___releasebuffer__;
static char __pyx_k_flags[] = "flags";
static PyObject *__pyx_kp_flags;
static char __pyx_k_ValueError[] = "ValueError";
static PyObject *__pyx_kp_ValueError;
static char __pyx_k_range[] = "range";
static PyObject *__pyx_kp_range;
static char __pyx_k_itervalues[] = "itervalues";
static PyObject *__pyx_kp_itervalues;
static char __pyx_k_RuntimeError[] = "RuntimeError";
static PyObject *__pyx_kp_RuntimeError;
static PyObject *__pyx_kp_1;
static PyObject *__pyx_kp_2;
static PyObject *__pyx_kp_5;
static PyObject *__pyx_kp_23;
static PyObject *__pyx_builtin_ValueError;
static PyObject *__pyx_builtin_range;
static PyObject *__pyx_builtin_RuntimeError;
static char __pyx_k_1[] = "ndarray is not C contiguous";
static char __pyx_k_2[] = "ndarray is not Fortran contiguous";
static char __pyx_k_3[] = ">";
static char __pyx_k_4[] = "<";
static char __pyx_k_5[] = "Non-native byte order not supported";
static char __pyx_k_6[] = "b";
static char __pyx_k_7[] = "B";
static char __pyx_k_8[] = "h";
static char __pyx_k_9[] = "H";
static char __pyx_k_10[] = "i";
static char __pyx_k_11[] = "I";
static char __pyx_k_12[] = "l";
static char __pyx_k_13[] = "L";
static char __pyx_k_14[] = "q";
static char __pyx_k_15[] = "Q";
static char __pyx_k_16[] = "f";
static char __pyx_k_17[] = "d";
static char __pyx_k_18[] = "g";
static char __pyx_k_19[] = "Zf";
static char __pyx_k_20[] = "Zd";
static char __pyx_k_21[] = "Zg";
static char __pyx_k_22[] = "O";
static char __pyx_k_23[] = "unknown dtype code in numpy.pxd (%d)";
static char __pyx_k_24[] = "^";
static PyObject *__pyx_kp_25;
static PyObject *__pyx_kp_28;
static PyObject *__pyx_kp_29;
static PyObject *__pyx_kp_30;
static char __pyx_k_25[] = "Format string allocated too short, see comment in numpy.pxd";
static char __pyx_k_26[] = ">";
static char __pyx_k_27[] = "<";
static char __pyx_k_28[] = "Non-native byte order not supported";
static char __pyx_k_29[] = "Format string allocated too short.";
static char __pyx_k_30[] = "unknown dtype code in numpy.pxd (%d)";

/* "/Users/sskory/Documents/yt-devel/yt/lagos/chainHOP/chainHOP.pyx":13
 * 
 * class RunChainHOP(ParallelAnalysisInterface):
 *     def __init__(self, period, padding, num_neighbors, bounds,             # <<<<<<<<<<<<<<
 *             xpos, ypos, zpos, index, mass, threshold=160.0):
 *         self.threshold = threshold
 */

static PyObject *__pyx_pf_2yt_5lagos_8chainHOP_8chainHOP_11RunChainHOP___init__(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static PyMethodDef __pyx_mdef_2yt_5lagos_8chainHOP_8chainHOP_11RunChainHOP___init__ = {__Pyx_NAMESTR("__init__"), (PyCFunction)__pyx_pf_2yt_5lagos_8chainHOP_8chainHOP_11RunChainHOP___init__, METH_VARARGS|METH_KEYWORDS, __Pyx_DOCSTR(0)};
static PyObject *__pyx_pf_2yt_5lagos_8chainHOP_8chainHOP_11RunChainHOP___init__(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  PyObject *__pyx_v_self = 0;
  PyObject *__pyx_v_period = 0;
  PyObject *__pyx_v_padding = 0;
  PyObject *__pyx_v_num_neighbors = 0;
  PyObject *__pyx_v_bounds = 0;
  PyObject *__pyx_v_xpos = 0;
  PyObject *__pyx_v_ypos = 0;
  PyObject *__pyx_v_zpos = 0;
  PyObject *__pyx_v_index = 0;
  PyObject *__pyx_v_mass = 0;
  PyObject *__pyx_v_threshold = 0;
  PyObject *__pyx_r = NULL;
  PyObject *__pyx_1 = 0;
  PyObject *__pyx_t_1 = NULL;
  PyObject *__pyx_t_2 = NULL;
  Py_ssize_t __pyx_t_3;
  PyObject *__pyx_t_4 = NULL;
  static PyObject **__pyx_pyargnames[] = {&__pyx_kp_self,&__pyx_kp_period,&__pyx_kp_padding,&__pyx_kp_num_neighbors,&__pyx_kp_bounds,&__pyx_kp_xpos,&__pyx_kp_ypos,&__pyx_kp_zpos,&__pyx_kp_index,&__pyx_kp_mass,&__pyx_kp_threshold,0};
  __Pyx_SetupRefcountContext("__init__");
  __pyx_self = __pyx_self;
  if (unlikely(__pyx_kwds)) {
    Py_ssize_t kw_args = PyDict_Size(__pyx_kwds);
    PyObject* values[11] = {0,0,0,0,0,0,0,0,0,0,0};
    values[10] = __pyx_k_37;
    switch (PyTuple_GET_SIZE(__pyx_args)) {
      case 11: values[10] = PyTuple_GET_ITEM(__pyx_args, 10);
      case 10: values[9] = PyTuple_GET_ITEM(__pyx_args, 9);
      case  9: values[8] = PyTuple_GET_ITEM(__pyx_args, 8);
      case  8: values[7] = PyTuple_GET_ITEM(__pyx_args, 7);
      case  7: values[6] = PyTuple_GET_ITEM(__pyx_args, 6);
      case  6: values[5] = PyTuple_GET_ITEM(__pyx_args, 5);
      case  5: values[4] = PyTuple_GET_ITEM(__pyx_args, 4);
      case  4: values[3] = PyTuple_GET_ITEM(__pyx_args, 3);
      case  3: values[2] = PyTuple_GET_ITEM(__pyx_args, 2);
      case  2: values[1] = PyTuple_GET_ITEM(__pyx_args, 1);
      case  1: values[0] = PyTuple_GET_ITEM(__pyx_args, 0);
      case  0: break;
      default: goto __pyx_L5_argtuple_error;
    }
    switch (PyTuple_GET_SIZE(__pyx_args)) {
      case  0:
      values[0] = PyDict_GetItem(__pyx_kwds, __pyx_kp_self);
      if (likely(values[0])) kw_args--;
      else goto __pyx_L5_argtuple_error;
      case  1:
      values[1] = PyDict_GetItem(__pyx_kwds, __pyx_kp_period);
      if (likely(values[1])) kw_args--;
      else {
        __Pyx_RaiseArgtupleInvalid("__init__", 0, 10, 11, 1); {__pyx_filename = __pyx_f[0]; __pyx_lineno = 13; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
      }
      case  2:
      values[2] = PyDict_GetItem(__pyx_kwds, __pyx_kp_padding);
      if (likely(values[2])) kw_args--;
      else {
        __Pyx_RaiseArgtupleInvalid("__init__", 0, 10, 11, 2); {__pyx_filename = __pyx_f[0]; __pyx_lineno = 13; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
      }
      case  3:
      values[3] = PyDict_GetItem(__pyx_kwds, __pyx_kp_num_neighbors);
      if (likely(values[3])) kw_args--;
      else {
        __Pyx_RaiseArgtupleInvalid("__init__", 0, 10, 11, 3); {__pyx_filename = __pyx_f[0]; __pyx_lineno = 13; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
      }
      case  4:
      values[4] = PyDict_GetItem(__pyx_kwds, __pyx_kp_bounds);
      if (likely(values[4])) kw_args--;
      else {
        __Pyx_RaiseArgtupleInvalid("__init__", 0, 10, 11, 4); {__pyx_filename = __pyx_f[0]; __pyx_lineno = 13; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
      }
      case  5:
      values[5] = PyDict_GetItem(__pyx_kwds, __pyx_kp_xpos);
      if (likely(values[5])) kw_args--;
      else {
        __Pyx_RaiseArgtupleInvalid("__init__", 0, 10, 11, 5); {__pyx_filename = __pyx_f[0]; __pyx_lineno = 13; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
      }
      case  6:
      values[6] = PyDict_GetItem(__pyx_kwds, __pyx_kp_ypos);
      if (likely(values[6])) kw_args--;
      else {
        __Pyx_RaiseArgtupleInvalid("__init__", 0, 10, 11, 6); {__pyx_filename = __pyx_f[0]; __pyx_lineno = 13; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
      }
      case  7:
      values[7] = PyDict_GetItem(__pyx_kwds, __pyx_kp_zpos);
      if (likely(values[7])) kw_args--;
      else {
        __Pyx_RaiseArgtupleInvalid("__init__", 0, 10, 11, 7); {__pyx_filename = __pyx_f[0]; __pyx_lineno = 13; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
      }
      case  8:
      values[8] = PyDict_GetItem(__pyx_kwds, __pyx_kp_index);
      if (likely(values[8])) kw_args--;
      else {
        __Pyx_RaiseArgtupleInvalid("__init__", 0, 10, 11, 8); {__pyx_filename = __pyx_f[0]; __pyx_lineno = 13; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
      }
      case  9:
      values[9] = PyDict_GetItem(__pyx_kwds, __pyx_kp_mass);
      if (likely(values[9])) kw_args--;
      else {
        __Pyx_RaiseArgtupleInvalid("__init__", 0, 10, 11, 9); {__pyx_filename = __pyx_f[0]; __pyx_lineno = 13; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
      }
      case 10:
      if (kw_args > 0) {
        PyObject* value = PyDict_GetItem(__pyx_kwds, __pyx_kp_threshold);
        if (unlikely(value)) { values[10] = value; kw_args--; }
      }
    }
    if (unlikely(kw_args > 0)) {
      if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, PyTuple_GET_SIZE(__pyx_args), "__init__") < 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 13; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
    }
    __pyx_v_self = values[0];
    __pyx_v_period = values[1];
    __pyx_v_padding = values[2];
    __pyx_v_num_neighbors = values[3];
    __pyx_v_bounds = values[4];
    __pyx_v_xpos = values[5];
    __pyx_v_ypos = values[6];
    __pyx_v_zpos = values[7];
    __pyx_v_index = values[8];
    __pyx_v_mass = values[9];
    __pyx_v_threshold = values[10];
  } else {
    __pyx_v_threshold = __pyx_k_37;
    switch (PyTuple_GET_SIZE(__pyx_args)) {
      case 11:
      __pyx_v_threshold = PyTuple_GET_ITEM(__pyx_args, 10);
      case 10:
      __pyx_v_mass = PyTuple_GET_ITEM(__pyx_args, 9);
      __pyx_v_index = PyTuple_GET_ITEM(__pyx_args, 8);
      __pyx_v_zpos = PyTuple_GET_ITEM(__pyx_args, 7);
      __pyx_v_ypos = PyTuple_GET_ITEM(__pyx_args, 6);
      __pyx_v_xpos = PyTuple_GET_ITEM(__pyx_args, 5);
      __pyx_v_bounds = PyTuple_GET_ITEM(__pyx_args, 4);
      __pyx_v_num_neighbors = PyTuple_GET_ITEM(__pyx_args, 3);
      __pyx_v_padding = PyTuple_GET_ITEM(__pyx_args, 2);
      __pyx_v_period = PyTuple_GET_ITEM(__pyx_args, 1);
      __pyx_v_self = PyTuple_GET_ITEM(__pyx_args, 0);
      break;
      default: goto __pyx_L5_argtuple_error;
    }
  }
  goto __pyx_L4_argument_unpacking_done;
  __pyx_L5_argtuple_error:;
  __Pyx_RaiseArgtupleInvalid("__init__", 0, 10, 11, PyTuple_GET_SIZE(__pyx_args)); {__pyx_filename = __pyx_f[0]; __pyx_lineno = 13; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
  __pyx_L3_error:;
  __Pyx_AddTraceback("yt.lagos.chainHOP.chainHOP.RunChainHOP.__init__");
  return NULL;
  __pyx_L4_argument_unpacking_done:;

  /* "/Users/sskory/Documents/yt-devel/yt/lagos/chainHOP/chainHOP.pyx":15
 *     def __init__(self, period, padding, num_neighbors, bounds,
 *             xpos, ypos, zpos, index, mass, threshold=160.0):
 *         self.threshold = threshold             # <<<<<<<<<<<<<<
 *         self.saddlethresh = 2.5 * threshold
 *         self.peakthresh = 3 * threshold
 */
  if (PyObject_SetAttr(__pyx_v_self, __pyx_kp_threshold, __pyx_v_threshold) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 15; __pyx_clineno = __LINE__; goto __pyx_L1_error;}

  /* "/Users/sskory/Documents/yt-devel/yt/lagos/chainHOP/chainHOP.pyx":16
 *             xpos, ypos, zpos, index, mass, threshold=160.0):
 *         self.threshold = threshold
 *         self.saddlethresh = 2.5 * threshold             # <<<<<<<<<<<<<<
 *         self.peakthresh = 3 * threshold
 *         self.period = period
 */
  __pyx_t_1 = PyFloat_FromDouble(2.5); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 16; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_t_2 = PyNumber_Multiply(__pyx_t_1, __pyx_v_threshold); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 16; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_2);
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  if (PyObject_SetAttr(__pyx_v_self, __pyx_kp_saddlethresh, __pyx_t_2) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 16; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;

  /* "/Users/sskory/Documents/yt-devel/yt/lagos/chainHOP/chainHOP.pyx":17
 *         self.threshold = threshold
 *         self.saddlethresh = 2.5 * threshold
 *         self.peakthresh = 3 * threshold             # <<<<<<<<<<<<<<
 *         self.period = period
 *         self.padding = padding
 */
  __pyx_t_2 = PyNumber_Multiply(__pyx_int_3, __pyx_v_threshold); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 17; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_2);
  if (PyObject_SetAttr(__pyx_v_self, __pyx_kp_peakthresh, __pyx_t_2) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 17; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;

  /* "/Users/sskory/Documents/yt-devel/yt/lagos/chainHOP/chainHOP.pyx":18
 *         self.saddlethresh = 2.5 * threshold
 *         self.peakthresh = 3 * threshold
 *         self.period = period             # <<<<<<<<<<<<<<
 *         self.padding = padding
 *         self.num_neighbors = num_neighbors
 */
  if (PyObject_SetAttr(__pyx_v_self, __pyx_kp_period, __pyx_v_period) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 18; __pyx_clineno = __LINE__; goto __pyx_L1_error;}

  /* "/Users/sskory/Documents/yt-devel/yt/lagos/chainHOP/chainHOP.pyx":19
 *         self.peakthresh = 3 * threshold
 *         self.period = period
 *         self.padding = padding             # <<<<<<<<<<<<<<
 *         self.num_neighbors = num_neighbors
 *         self.bounds = bounds
 */
  if (PyObject_SetAttr(__pyx_v_self, __pyx_kp_padding, __pyx_v_padding) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 19; __pyx_clineno = __LINE__; goto __pyx_L1_error;}

  /* "/Users/sskory/Documents/yt-devel/yt/lagos/chainHOP/chainHOP.pyx":20
 *         self.period = period
 *         self.padding = padding
 *         self.num_neighbors = num_neighbors             # <<<<<<<<<<<<<<
 *         self.bounds = bounds
 *         self.xpos = xpos
 */
  if (PyObject_SetAttr(__pyx_v_self, __pyx_kp_num_neighbors, __pyx_v_num_neighbors) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 20; __pyx_clineno = __LINE__; goto __pyx_L1_error;}

  /* "/Users/sskory/Documents/yt-devel/yt/lagos/chainHOP/chainHOP.pyx":21
 *         self.padding = padding
 *         self.num_neighbors = num_neighbors
 *         self.bounds = bounds             # <<<<<<<<<<<<<<
 *         self.xpos = xpos
 *         self.ypos = ypos
 */
  if (PyObject_SetAttr(__pyx_v_self, __pyx_kp_bounds, __pyx_v_bounds) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 21; __pyx_clineno = __LINE__; goto __pyx_L1_error;}

  /* "/Users/sskory/Documents/yt-devel/yt/lagos/chainHOP/chainHOP.pyx":22
 *         self.num_neighbors = num_neighbors
 *         self.bounds = bounds
 *         self.xpos = xpos             # <<<<<<<<<<<<<<
 *         self.ypos = ypos
 *         self.zpos = zpos
 */
  if (PyObject_SetAttr(__pyx_v_self, __pyx_kp_xpos, __pyx_v_xpos) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 22; __pyx_clineno = __LINE__; goto __pyx_L1_error;}

  /* "/Users/sskory/Documents/yt-devel/yt/lagos/chainHOP/chainHOP.pyx":23
 *         self.bounds = bounds
 *         self.xpos = xpos
 *         self.ypos = ypos             # <<<<<<<<<<<<<<
 *         self.zpos = zpos
 *         self.size = len(self.xpos)
 */
  if (PyObject_SetAttr(__pyx_v_self, __pyx_kp_ypos, __pyx_v_ypos) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 23; __pyx_clineno = __LINE__; goto __pyx_L1_error;}

  /* "/Users/sskory/Documents/yt-devel/yt/lagos/chainHOP/chainHOP.pyx":24
 *         self.xpos = xpos
 *         self.ypos = ypos
 *         self.zpos = zpos             # <<<<<<<<<<<<<<
 *         self.size = len(self.xpos)
 *         self.index = na.array(index, dtype='int64')
 */
  if (PyObject_SetAttr(__pyx_v_self, __pyx_kp_zpos, __pyx_v_zpos) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 24; __pyx_clineno = __LINE__; goto __pyx_L1_error;}

  /* "/Users/sskory/Documents/yt-devel/yt/lagos/chainHOP/chainHOP.pyx":25
 *         self.ypos = ypos
 *         self.zpos = zpos
 *         self.size = len(self.xpos)             # <<<<<<<<<<<<<<
 *         self.index = na.array(index, dtype='int64')
 *         self.mass = mass
 */
  __pyx_t_2 = PyObject_GetAttr(__pyx_v_self, __pyx_kp_xpos); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 25; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_2);
  __pyx_t_3 = PyObject_Length(__pyx_t_2); if (unlikely(__pyx_t_3 == -1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 25; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_t_2 = PyInt_FromSsize_t(__pyx_t_3); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 25; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_2);
  if (PyObject_SetAttr(__pyx_v_self, __pyx_kp_size, __pyx_t_2) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 25; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;

  /* "/Users/sskory/Documents/yt-devel/yt/lagos/chainHOP/chainHOP.pyx":26
 *         self.zpos = zpos
 *         self.size = len(self.xpos)
 *         self.index = na.array(index, dtype='int64')             # <<<<<<<<<<<<<<
 *         self.mass = mass
 *         self.padded_particles = []
 */
  __pyx_1 = __Pyx_GetName(__pyx_m, __pyx_kp_na); if (unlikely(!__pyx_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 26; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_1);
  __pyx_t_2 = PyObject_GetAttr(__pyx_1, __pyx_kp_array); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 26; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_2);
  __Pyx_DECREF(__pyx_1); __pyx_1 = 0;
  __pyx_t_1 = PyTuple_New(1); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 26; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(((PyObject *)__pyx_t_1));
  __Pyx_INCREF(__pyx_v_index);
  PyTuple_SET_ITEM(__pyx_t_1, 0, __pyx_v_index);
  __Pyx_GIVEREF(__pyx_v_index);
  __pyx_1 = PyDict_New(); if (unlikely(!__pyx_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 26; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(((PyObject *)__pyx_1));
  if (PyDict_SetItem(__pyx_1, __pyx_kp_dtype, __pyx_kp_45) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 26; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __pyx_t_4 = PyEval_CallObjectWithKeywords(__pyx_t_2, ((PyObject *)__pyx_t_1), ((PyObject *)__pyx_1)); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 26; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_4);
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __Pyx_DECREF(((PyObject *)__pyx_t_1)); __pyx_t_1 = 0;
  __Pyx_DECREF(((PyObject *)__pyx_1)); __pyx_1 = 0;
  if (PyObject_SetAttr(__pyx_v_self, __pyx_kp_index, __pyx_t_4) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 26; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;

  /* "/Users/sskory/Documents/yt-devel/yt/lagos/chainHOP/chainHOP.pyx":27
 *         self.size = len(self.xpos)
 *         self.index = na.array(index, dtype='int64')
 *         self.mass = mass             # <<<<<<<<<<<<<<
 *         self.padded_particles = []
 *         self.nMerge = 4
 */
  if (PyObject_SetAttr(__pyx_v_self, __pyx_kp_mass, __pyx_v_mass) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 27; __pyx_clineno = __LINE__; goto __pyx_L1_error;}

  /* "/Users/sskory/Documents/yt-devel/yt/lagos/chainHOP/chainHOP.pyx":28
 *         self.index = na.array(index, dtype='int64')
 *         self.mass = mass
 *         self.padded_particles = []             # <<<<<<<<<<<<<<
 *         self.nMerge = 4
 *         self.d = None
 */
  __pyx_t_4 = PyList_New(0); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 28; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(((PyObject *)__pyx_t_4));
  if (PyObject_SetAttr(__pyx_v_self, __pyx_kp_padded_particles, ((PyObject *)__pyx_t_4)) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 28; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_DECREF(((PyObject *)__pyx_t_4)); __pyx_t_4 = 0;

  /* "/Users/sskory/Documents/yt-devel/yt/lagos/chainHOP/chainHOP.pyx":29
 *         self.mass = mass
 *         self.padded_particles = []
 *         self.nMerge = 4             # <<<<<<<<<<<<<<
 *         self.d = None
 *         self.chainID = na.ones(self.size,dtype='int64') * -1
 */
  if (PyObject_SetAttr(__pyx_v_self, __pyx_kp_nMerge, __pyx_int_4) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 29; __pyx_clineno = __LINE__; goto __pyx_L1_error;}

  /* "/Users/sskory/Documents/yt-devel/yt/lagos/chainHOP/chainHOP.pyx":30
 *         self.padded_particles = []
 *         self.nMerge = 4
 *         self.d = None             # <<<<<<<<<<<<<<
 *         self.chainID = na.ones(self.size,dtype='int64') * -1
 *         self._chain_hop()
 */
  if (PyObject_SetAttr(__pyx_v_self, __pyx_kp_d, Py_None) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 30; __pyx_clineno = __LINE__; goto __pyx_L1_error;}

  /* "/Users/sskory/Documents/yt-devel/yt/lagos/chainHOP/chainHOP.pyx":31
 *         self.nMerge = 4
 *         self.d = None
 *         self.chainID = na.ones(self.size,dtype='int64') * -1             # <<<<<<<<<<<<<<
 *         self._chain_hop()
 * 
 */
  __pyx_1 = __Pyx_GetName(__pyx_m, __pyx_kp_na); if (unlikely(!__pyx_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 31; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_1);
  __pyx_t_4 = PyObject_GetAttr(__pyx_1, __pyx_kp_ones); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 31; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_4);
  __Pyx_DECREF(__pyx_1); __pyx_1 = 0;
  __pyx_t_1 = PyObject_GetAttr(__pyx_v_self, __pyx_kp_size); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 31; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_t_2 = PyTuple_New(1); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 31; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(((PyObject *)__pyx_t_2));
  PyTuple_SET_ITEM(__pyx_t_2, 0, __pyx_t_1);
  __Pyx_GIVEREF(__pyx_t_1);
  __pyx_t_1 = 0;
  __pyx_1 = PyDict_New(); if (unlikely(!__pyx_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 31; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(((PyObject *)__pyx_1));
  if (PyDict_SetItem(__pyx_1, __pyx_kp_dtype, __pyx_kp_46) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 31; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __pyx_t_1 = PyEval_CallObjectWithKeywords(__pyx_t_4, ((PyObject *)__pyx_t_2), ((PyObject *)__pyx_1)); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 31; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
  __Pyx_DECREF(((PyObject *)__pyx_t_2)); __pyx_t_2 = 0;
  __Pyx_DECREF(((PyObject *)__pyx_1)); __pyx_1 = 0;
  __pyx_t_2 = PyNumber_Multiply(__pyx_t_1, __pyx_int_neg_1); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 31; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_2);
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  if (PyObject_SetAttr(__pyx_v_self, __pyx_kp_chainID, __pyx_t_2) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 31; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;

  /* "/Users/sskory/Documents/yt-devel/yt/lagos/chainHOP/chainHOP.pyx":32
 *         self.d = None
 *         self.chainID = na.ones(self.size,dtype='int64') * -1
 *         self._chain_hop()             # <<<<<<<<<<<<<<
 * 
 * 
 */
  __pyx_t_2 = PyObject_GetAttr(__pyx_v_self, __pyx_kp__chain_hop); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 32; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_2);
  __pyx_t_1 = PyObject_Call(__pyx_t_2, ((PyObject *)__pyx_empty_tuple), NULL); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 32; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;

  __pyx_r = Py_None; __Pyx_INCREF(Py_None);
  goto __pyx_L0;
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_1);
  __Pyx_XDECREF(__pyx_t_1);
  __Pyx_XDECREF(__pyx_t_2);
  __Pyx_XDECREF(__pyx_t_4);
  __Pyx_AddTraceback("yt.lagos.chainHOP.chainHOP.RunChainHOP.__init__");
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_FinishRefcountContext();
  return __pyx_r;
}

/* "/Users/sskory/Documents/yt-devel/yt/lagos/chainHOP/chainHOP.pyx":35
 * 
 * 
 *     def _init_kd_tree(object self):             # <<<<<<<<<<<<<<
 *         """
 *         Set up the data objects that get passed to the kD-tree code.
 */

static PyObject *__pyx_pf_2yt_5lagos_8chainHOP_8chainHOP_11RunChainHOP__init_kd_tree(PyObject *__pyx_self, PyObject *__pyx_v_self); /*proto*/
static char __pyx_doc_2yt_5lagos_8chainHOP_8chainHOP_11RunChainHOP__init_kd_tree[] = "\n        Set up the data objects that get passed to the kD-tree code.\n        ";
static PyMethodDef __pyx_mdef_2yt_5lagos_8chainHOP_8chainHOP_11RunChainHOP__init_kd_tree = {__Pyx_NAMESTR("_init_kd_tree"), (PyCFunction)__pyx_pf_2yt_5lagos_8chainHOP_8chainHOP_11RunChainHOP__init_kd_tree, METH_O, __Pyx_DOCSTR(__pyx_doc_2yt_5lagos_8chainHOP_8chainHOP_11RunChainHOP__init_kd_tree)};
static PyObject *__pyx_pf_2yt_5lagos_8chainHOP_8chainHOP_11RunChainHOP__init_kd_tree(PyObject *__pyx_self, PyObject *__pyx_v_self) {
  PyObject *__pyx_r = NULL;
  PyObject *__pyx_1 = 0;
  PyObject *__pyx_2 = 0;
  PyObject *__pyx_t_1 = NULL;
  PyObject *__pyx_t_2 = NULL;
  PyObject *__pyx_t_3 = NULL;
  __Pyx_SetupRefcountContext("_init_kd_tree");
  __pyx_self = __pyx_self;

  /* "/Users/sskory/Documents/yt-devel/yt/lagos/chainHOP/chainHOP.pyx":41
 *         # Yes, we really do need to initialize this many arrays.
 *         # They're deleted in _chainHOP.
 *         fKD.nn_tags = empty((self.nMerge + 2,self.size), dtype='l')             # <<<<<<<<<<<<<<
 *         fKD.dens = zeros(self.size, dtype='d')
 *         fKD.mass = empty(self.size, dtype='d')
 */
  __pyx_1 = __Pyx_GetName(__pyx_m, __pyx_kp_empty); if (unlikely(!__pyx_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 41; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_1);
  __pyx_t_1 = PyObject_GetAttr(__pyx_v_self, __pyx_kp_nMerge); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 41; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_t_2 = PyNumber_Add(__pyx_t_1, __pyx_int_2); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 41; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_2);
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_t_1 = PyObject_GetAttr(__pyx_v_self, __pyx_kp_size); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 41; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_t_3 = PyTuple_New(2); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 41; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(((PyObject *)__pyx_t_3));
  PyTuple_SET_ITEM(__pyx_t_3, 0, __pyx_t_2);
  __Pyx_GIVEREF(__pyx_t_2);
  PyTuple_SET_ITEM(__pyx_t_3, 1, __pyx_t_1);
  __Pyx_GIVEREF(__pyx_t_1);
  __pyx_t_2 = 0;
  __pyx_t_1 = 0;
  __pyx_t_1 = PyTuple_New(1); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 41; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(((PyObject *)__pyx_t_1));
  PyTuple_SET_ITEM(__pyx_t_1, 0, ((PyObject *)__pyx_t_3));
  __Pyx_GIVEREF(((PyObject *)__pyx_t_3));
  __pyx_t_3 = 0;
  __pyx_2 = PyDict_New(); if (unlikely(!__pyx_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 41; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(((PyObject *)__pyx_2));
  if (PyDict_SetItem(__pyx_2, __pyx_kp_dtype, __pyx_kp_47) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 41; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __pyx_t_3 = PyEval_CallObjectWithKeywords(__pyx_1, ((PyObject *)__pyx_t_1), ((PyObject *)__pyx_2)); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 41; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_3);
  __Pyx_DECREF(__pyx_1); __pyx_1 = 0;
  __Pyx_DECREF(((PyObject *)__pyx_t_1)); __pyx_t_1 = 0;
  __Pyx_DECREF(((PyObject *)__pyx_2)); __pyx_2 = 0;
  __pyx_1 = __Pyx_GetName(__pyx_m, __pyx_kp_fKD); if (unlikely(!__pyx_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 41; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_1);
  if (PyObject_SetAttr(__pyx_1, __pyx_kp_nn_tags, __pyx_t_3) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 41; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  __Pyx_DECREF(__pyx_1); __pyx_1 = 0;

  /* "/Users/sskory/Documents/yt-devel/yt/lagos/chainHOP/chainHOP.pyx":42
 *         # They're deleted in _chainHOP.
 *         fKD.nn_tags = empty((self.nMerge + 2,self.size), dtype='l')
 *         fKD.dens = zeros(self.size, dtype='d')             # <<<<<<<<<<<<<<
 *         fKD.mass = empty(self.size, dtype='d')
 *         fKD.pos = empty((3,self.size), dtype='d')
 */
  __pyx_2 = __Pyx_GetName(__pyx_m, __pyx_kp_zeros); if (unlikely(!__pyx_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 42; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_2);
  __pyx_t_3 = PyObject_GetAttr(__pyx_v_self, __pyx_kp_size); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 42; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_3);
  __pyx_t_1 = PyTuple_New(1); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 42; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(((PyObject *)__pyx_t_1));
  PyTuple_SET_ITEM(__pyx_t_1, 0, __pyx_t_3);
  __Pyx_GIVEREF(__pyx_t_3);
  __pyx_t_3 = 0;
  __pyx_1 = PyDict_New(); if (unlikely(!__pyx_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 42; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(((PyObject *)__pyx_1));
  if (PyDict_SetItem(__pyx_1, __pyx_kp_dtype, __pyx_kp_48) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 42; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __pyx_t_3 = PyEval_CallObjectWithKeywords(__pyx_2, ((PyObject *)__pyx_t_1), ((PyObject *)__pyx_1)); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 42; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_3);
  __Pyx_DECREF(__pyx_2); __pyx_2 = 0;
  __Pyx_DECREF(((PyObject *)__pyx_t_1)); __pyx_t_1 = 0;
  __Pyx_DECREF(((PyObject *)__pyx_1)); __pyx_1 = 0;
  __pyx_2 = __Pyx_GetName(__pyx_m, __pyx_kp_fKD); if (unlikely(!__pyx_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 42; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_2);
  if (PyObject_SetAttr(__pyx_2, __pyx_kp_dens, __pyx_t_3) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 42; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  __Pyx_DECREF(__pyx_2); __pyx_2 = 0;

  /* "/Users/sskory/Documents/yt-devel/yt/lagos/chainHOP/chainHOP.pyx":43
 *         fKD.nn_tags = empty((self.nMerge + 2,self.size), dtype='l')
 *         fKD.dens = zeros(self.size, dtype='d')
 *         fKD.mass = empty(self.size, dtype='d')             # <<<<<<<<<<<<<<
 *         fKD.pos = empty((3,self.size), dtype='d')
 *         fKD.qv = empty(3, dtype='d')
 */
  __pyx_1 = __Pyx_GetName(__pyx_m, __pyx_kp_empty); if (unlikely(!__pyx_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 43; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_1);
  __pyx_t_3 = PyObject_GetAttr(__pyx_v_self, __pyx_kp_size); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 43; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_3);
  __pyx_t_1 = PyTuple_New(1); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 43; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(((PyObject *)__pyx_t_1));
  PyTuple_SET_ITEM(__pyx_t_1, 0, __pyx_t_3);
  __Pyx_GIVEREF(__pyx_t_3);
  __pyx_t_3 = 0;
  __pyx_2 = PyDict_New(); if (unlikely(!__pyx_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 43; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(((PyObject *)__pyx_2));
  if (PyDict_SetItem(__pyx_2, __pyx_kp_dtype, __pyx_kp_49) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 43; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __pyx_t_3 = PyEval_CallObjectWithKeywords(__pyx_1, ((PyObject *)__pyx_t_1), ((PyObject *)__pyx_2)); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 43; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_3);
  __Pyx_DECREF(__pyx_1); __pyx_1 = 0;
  __Pyx_DECREF(((PyObject *)__pyx_t_1)); __pyx_t_1 = 0;
  __Pyx_DECREF(((PyObject *)__pyx_2)); __pyx_2 = 0;
  __pyx_1 = __Pyx_GetName(__pyx_m, __pyx_kp_fKD); if (unlikely(!__pyx_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 43; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_1);
  if (PyObject_SetAttr(__pyx_1, __pyx_kp_mass, __pyx_t_3) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 43; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  __Pyx_DECREF(__pyx_1); __pyx_1 = 0;

  /* "/Users/sskory/Documents/yt-devel/yt/lagos/chainHOP/chainHOP.pyx":44
 *         fKD.dens = zeros(self.size, dtype='d')
 *         fKD.mass = empty(self.size, dtype='d')
 *         fKD.pos = empty((3,self.size), dtype='d')             # <<<<<<<<<<<<<<
 *         fKD.qv = empty(3, dtype='d')
 *         fKD.nn = self.num_neighbors
 */
  __pyx_2 = __Pyx_GetName(__pyx_m, __pyx_kp_empty); if (unlikely(!__pyx_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 44; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_2);
  __pyx_t_3 = PyObject_GetAttr(__pyx_v_self, __pyx_kp_size); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 44; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_3);
  __pyx_t_1 = PyTuple_New(2); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 44; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(((PyObject *)__pyx_t_1));
  __Pyx_INCREF(__pyx_int_3);
  PyTuple_SET_ITEM(__pyx_t_1, 0, __pyx_int_3);
  __Pyx_GIVEREF(__pyx_int_3);
  PyTuple_SET_ITEM(__pyx_t_1, 1, __pyx_t_3);
  __Pyx_GIVEREF(__pyx_t_3);
  __pyx_t_3 = 0;
  __pyx_t_3 = PyTuple_New(1); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 44; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(((PyObject *)__pyx_t_3));
  PyTuple_SET_ITEM(__pyx_t_3, 0, ((PyObject *)__pyx_t_1));
  __Pyx_GIVEREF(((PyObject *)__pyx_t_1));
  __pyx_t_1 = 0;
  __pyx_1 = PyDict_New(); if (unlikely(!__pyx_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 44; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(((PyObject *)__pyx_1));
  if (PyDict_SetItem(__pyx_1, __pyx_kp_dtype, __pyx_kp_50) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 44; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __pyx_t_1 = PyEval_CallObjectWithKeywords(__pyx_2, ((PyObject *)__pyx_t_3), ((PyObject *)__pyx_1)); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 44; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_DECREF(__pyx_2); __pyx_2 = 0;
  __Pyx_DECREF(((PyObject *)__pyx_t_3)); __pyx_t_3 = 0;
  __Pyx_DECREF(((PyObject *)__pyx_1)); __pyx_1 = 0;
  __pyx_2 = __Pyx_GetName(__pyx_m, __pyx_kp_fKD); if (unlikely(!__pyx_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 44; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_2);
  if (PyObject_SetAttr(__pyx_2, __pyx_kp_pos, __pyx_t_1) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 44; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  __Pyx_DECREF(__pyx_2); __pyx_2 = 0;

  /* "/Users/sskory/Documents/yt-devel/yt/lagos/chainHOP/chainHOP.pyx":45
 *         fKD.mass = empty(self.size, dtype='d')
 *         fKD.pos = empty((3,self.size), dtype='d')
 *         fKD.qv = empty(3, dtype='d')             # <<<<<<<<<<<<<<
 *         fKD.nn = self.num_neighbors
 *         fKD.nMerge = self.nMerge + 2
 */
  __pyx_1 = __Pyx_GetName(__pyx_m, __pyx_kp_empty); if (unlikely(!__pyx_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 45; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_1);
  __pyx_t_1 = PyTuple_New(1); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 45; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(((PyObject *)__pyx_t_1));
  __Pyx_INCREF(__pyx_int_3);
  PyTuple_SET_ITEM(__pyx_t_1, 0, __pyx_int_3);
  __Pyx_GIVEREF(__pyx_int_3);
  __pyx_2 = PyDict_New(); if (unlikely(!__pyx_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 45; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(((PyObject *)__pyx_2));
  if (PyDict_SetItem(__pyx_2, __pyx_kp_dtype, __pyx_kp_51) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 45; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __pyx_t_3 = PyEval_CallObjectWithKeywords(__pyx_1, ((PyObject *)__pyx_t_1), ((PyObject *)__pyx_2)); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 45; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_3);
  __Pyx_DECREF(__pyx_1); __pyx_1 = 0;
  __Pyx_DECREF(((PyObject *)__pyx_t_1)); __pyx_t_1 = 0;
  __Pyx_DECREF(((PyObject *)__pyx_2)); __pyx_2 = 0;
  __pyx_1 = __Pyx_GetName(__pyx_m, __pyx_kp_fKD); if (unlikely(!__pyx_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 45; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_1);
  if (PyObject_SetAttr(__pyx_1, __pyx_kp_qv, __pyx_t_3) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 45; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  __Pyx_DECREF(__pyx_1); __pyx_1 = 0;

  /* "/Users/sskory/Documents/yt-devel/yt/lagos/chainHOP/chainHOP.pyx":46
 *         fKD.pos = empty((3,self.size), dtype='d')
 *         fKD.qv = empty(3, dtype='d')
 *         fKD.nn = self.num_neighbors             # <<<<<<<<<<<<<<
 *         fKD.nMerge = self.nMerge + 2
 *         fKD.nparts = self.size
 */
  __pyx_t_3 = PyObject_GetAttr(__pyx_v_self, __pyx_kp_num_neighbors); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 46; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_3);
  __pyx_2 = __Pyx_GetName(__pyx_m, __pyx_kp_fKD); if (unlikely(!__pyx_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 46; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_2);
  if (PyObject_SetAttr(__pyx_2, __pyx_kp_nn, __pyx_t_3) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 46; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  __Pyx_DECREF(__pyx_2); __pyx_2 = 0;

  /* "/Users/sskory/Documents/yt-devel/yt/lagos/chainHOP/chainHOP.pyx":47
 *         fKD.qv = empty(3, dtype='d')
 *         fKD.nn = self.num_neighbors
 *         fKD.nMerge = self.nMerge + 2             # <<<<<<<<<<<<<<
 *         fKD.nparts = self.size
 *         fKD.sort = True # Slower, but needed in _connect_chains
 */
  __pyx_t_3 = PyObject_GetAttr(__pyx_v_self, __pyx_kp_nMerge); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 47; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_3);
  __pyx_t_1 = PyNumber_Add(__pyx_t_3, __pyx_int_2); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 47; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  __pyx_1 = __Pyx_GetName(__pyx_m, __pyx_kp_fKD); if (unlikely(!__pyx_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 47; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_1);
  if (PyObject_SetAttr(__pyx_1, __pyx_kp_nMerge, __pyx_t_1) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 47; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  __Pyx_DECREF(__pyx_1); __pyx_1 = 0;

  /* "/Users/sskory/Documents/yt-devel/yt/lagos/chainHOP/chainHOP.pyx":48
 *         fKD.nn = self.num_neighbors
 *         fKD.nMerge = self.nMerge + 2
 *         fKD.nparts = self.size             # <<<<<<<<<<<<<<
 *         fKD.sort = True # Slower, but needed in _connect_chains
 *         fKD.rearrange = True # Faster, but uses more memory
 */
  __pyx_t_1 = PyObject_GetAttr(__pyx_v_self, __pyx_kp_size); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 48; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_2 = __Pyx_GetName(__pyx_m, __pyx_kp_fKD); if (unlikely(!__pyx_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 48; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_2);
  if (PyObject_SetAttr(__pyx_2, __pyx_kp_nparts, __pyx_t_1) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 48; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  __Pyx_DECREF(__pyx_2); __pyx_2 = 0;

  /* "/Users/sskory/Documents/yt-devel/yt/lagos/chainHOP/chainHOP.pyx":49
 *         fKD.nMerge = self.nMerge + 2
 *         fKD.nparts = self.size
 *         fKD.sort = True # Slower, but needed in _connect_chains             # <<<<<<<<<<<<<<
 *         fKD.rearrange = True # Faster, but uses more memory
 *         # This actually copies the data into the fortran space.
 */
  __pyx_t_1 = __Pyx_PyBool_FromLong(1); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 49; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_1 = __Pyx_GetName(__pyx_m, __pyx_kp_fKD); if (unlikely(!__pyx_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 49; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_1);
  if (PyObject_SetAttr(__pyx_1, __pyx_kp_sort, __pyx_t_1) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 49; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  __Pyx_DECREF(__pyx_1); __pyx_1 = 0;

  /* "/Users/sskory/Documents/yt-devel/yt/lagos/chainHOP/chainHOP.pyx":50
 *         fKD.nparts = self.size
 *         fKD.sort = True # Slower, but needed in _connect_chains
 *         fKD.rearrange = True # Faster, but uses more memory             # <<<<<<<<<<<<<<
 *         # This actually copies the data into the fortran space.
 *         fKD.pos[0, :] = self.xpos
 */
  __pyx_t_1 = __Pyx_PyBool_FromLong(1); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 50; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_2 = __Pyx_GetName(__pyx_m, __pyx_kp_fKD); if (unlikely(!__pyx_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 50; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_2);
  if (PyObject_SetAttr(__pyx_2, __pyx_kp_rearrange, __pyx_t_1) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 50; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  __Pyx_DECREF(__pyx_2); __pyx_2 = 0;

  /* "/Users/sskory/Documents/yt-devel/yt/lagos/chainHOP/chainHOP.pyx":52
 *         fKD.rearrange = True # Faster, but uses more memory
 *         # This actually copies the data into the fortran space.
 *         fKD.pos[0, :] = self.xpos             # <<<<<<<<<<<<<<
 *         fKD.pos[1, :] = self.ypos
 *         fKD.pos[2, :] = self.zpos
 */
  __pyx_t_1 = PyObject_GetAttr(__pyx_v_self, __pyx_kp_xpos); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 52; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_1 = __Pyx_GetName(__pyx_m, __pyx_kp_fKD); if (unlikely(!__pyx_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 52; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_1);
  __pyx_t_3 = PyObject_GetAttr(__pyx_1, __pyx_kp_pos); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 52; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_3);
  __Pyx_DECREF(__pyx_1); __pyx_1 = 0;
  __pyx_2 = PySlice_New(Py_None, Py_None, Py_None); if (unlikely(!__pyx_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 52; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_2);
  __pyx_t_2 = PyTuple_New(2); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 52; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(((PyObject *)__pyx_t_2));
  __Pyx_INCREF(__pyx_int_0);
  PyTuple_SET_ITEM(__pyx_t_2, 0, __pyx_int_0);
  __Pyx_GIVEREF(__pyx_int_0);
  PyTuple_SET_ITEM(__pyx_t_2, 1, __pyx_2);
  __Pyx_GIVEREF(__pyx_2);
  __pyx_2 = 0;
  if (PyObject_SetItem(__pyx_t_3, ((PyObject *)__pyx_t_2), __pyx_t_1) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 52; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  __Pyx_DECREF(((PyObject *)__pyx_t_2)); __pyx_t_2 = 0;
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;

  /* "/Users/sskory/Documents/yt-devel/yt/lagos/chainHOP/chainHOP.pyx":53
 *         # This actually copies the data into the fortran space.
 *         fKD.pos[0, :] = self.xpos
 *         fKD.pos[1, :] = self.ypos             # <<<<<<<<<<<<<<
 *         fKD.pos[2, :] = self.zpos
 *         fKD.mass = self.mass
 */
  __pyx_t_1 = PyObject_GetAttr(__pyx_v_self, __pyx_kp_ypos); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 53; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_1 = __Pyx_GetName(__pyx_m, __pyx_kp_fKD); if (unlikely(!__pyx_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 53; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_1);
  __pyx_t_2 = PyObject_GetAttr(__pyx_1, __pyx_kp_pos); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 53; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_2);
  __Pyx_DECREF(__pyx_1); __pyx_1 = 0;
  __pyx_2 = PySlice_New(Py_None, Py_None, Py_None); if (unlikely(!__pyx_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 53; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_2);
  __pyx_t_3 = PyTuple_New(2); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 53; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(((PyObject *)__pyx_t_3));
  __Pyx_INCREF(__pyx_int_1);
  PyTuple_SET_ITEM(__pyx_t_3, 0, __pyx_int_1);
  __Pyx_GIVEREF(__pyx_int_1);
  PyTuple_SET_ITEM(__pyx_t_3, 1, __pyx_2);
  __Pyx_GIVEREF(__pyx_2);
  __pyx_2 = 0;
  if (PyObject_SetItem(__pyx_t_2, ((PyObject *)__pyx_t_3), __pyx_t_1) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 53; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __Pyx_DECREF(((PyObject *)__pyx_t_3)); __pyx_t_3 = 0;
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;

  /* "/Users/sskory/Documents/yt-devel/yt/lagos/chainHOP/chainHOP.pyx":54
 *         fKD.pos[0, :] = self.xpos
 *         fKD.pos[1, :] = self.ypos
 *         fKD.pos[2, :] = self.zpos             # <<<<<<<<<<<<<<
 *         fKD.mass = self.mass
 *         # Now call the fortran.
 */
  __pyx_t_1 = PyObject_GetAttr(__pyx_v_self, __pyx_kp_zpos); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 54; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_1 = __Pyx_GetName(__pyx_m, __pyx_kp_fKD); if (unlikely(!__pyx_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 54; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_1);
  __pyx_t_3 = PyObject_GetAttr(__pyx_1, __pyx_kp_pos); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 54; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_3);
  __Pyx_DECREF(__pyx_1); __pyx_1 = 0;
  __pyx_2 = PySlice_New(Py_None, Py_None, Py_None); if (unlikely(!__pyx_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 54; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_2);
  __pyx_t_2 = PyTuple_New(2); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 54; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(((PyObject *)__pyx_t_2));
  __Pyx_INCREF(__pyx_int_2);
  PyTuple_SET_ITEM(__pyx_t_2, 0, __pyx_int_2);
  __Pyx_GIVEREF(__pyx_int_2);
  PyTuple_SET_ITEM(__pyx_t_2, 1, __pyx_2);
  __Pyx_GIVEREF(__pyx_2);
  __pyx_2 = 0;
  if (PyObject_SetItem(__pyx_t_3, ((PyObject *)__pyx_t_2), __pyx_t_1) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 54; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  __Pyx_DECREF(((PyObject *)__pyx_t_2)); __pyx_t_2 = 0;
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;

  /* "/Users/sskory/Documents/yt-devel/yt/lagos/chainHOP/chainHOP.pyx":55
 *         fKD.pos[1, :] = self.ypos
 *         fKD.pos[2, :] = self.zpos
 *         fKD.mass = self.mass             # <<<<<<<<<<<<<<
 *         # Now call the fortran.
 *         create_tree()
 */
  __pyx_t_1 = PyObject_GetAttr(__pyx_v_self, __pyx_kp_mass); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 55; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_1 = __Pyx_GetName(__pyx_m, __pyx_kp_fKD); if (unlikely(!__pyx_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 55; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_1);
  if (PyObject_SetAttr(__pyx_1, __pyx_kp_mass, __pyx_t_1) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 55; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  __Pyx_DECREF(__pyx_1); __pyx_1 = 0;

  /* "/Users/sskory/Documents/yt-devel/yt/lagos/chainHOP/chainHOP.pyx":57
 *         fKD.mass = self.mass
 *         # Now call the fortran.
 *         create_tree()             # <<<<<<<<<<<<<<
 * 
 *     def _is_inside(object self):
 */
  __pyx_2 = __Pyx_GetName(__pyx_m, __pyx_kp_create_tree); if (unlikely(!__pyx_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 57; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_2);
  __pyx_t_1 = PyObject_Call(__pyx_2, ((PyObject *)__pyx_empty_tuple), NULL); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 57; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_DECREF(__pyx_2); __pyx_2 = 0;
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;

  __pyx_r = Py_None; __Pyx_INCREF(Py_None);
  goto __pyx_L0;
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_1);
  __Pyx_XDECREF(__pyx_2);
  __Pyx_XDECREF(__pyx_t_1);
  __Pyx_XDECREF(__pyx_t_2);
  __Pyx_XDECREF(__pyx_t_3);
  __Pyx_AddTraceback("yt.lagos.chainHOP.chainHOP.RunChainHOP._init_kd_tree");
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_FinishRefcountContext();
  return __pyx_r;
}

/* "/Users/sskory/Documents/yt-devel/yt/lagos/chainHOP/chainHOP.pyx":59
 *         create_tree()
 * 
 *     def _is_inside(object self):             # <<<<<<<<<<<<<<
 *         """
 *         There are three classes of particles.
 */

static PyObject *__pyx_pf_2yt_5lagos_8chainHOP_8chainHOP_11RunChainHOP__is_inside(PyObject *__pyx_self, PyObject *__pyx_v_self); /*proto*/
static char __pyx_doc_2yt_5lagos_8chainHOP_8chainHOP_11RunChainHOP__is_inside[] = "\n        There are three classes of particles.\n        1. Particles inside the 'real' region of each subvolume.\n        2. Particles ouside, added in the 'padding' for purposes of having \n           correct particle densities in the real region.\n        3. Particles that are one padding distance inside the edges of the\n           real region. The chainIDs of these particles are communicated\n           to the neighboring tasks so chains can be merged into groups.\n        ";
static PyMethodDef __pyx_mdef_2yt_5lagos_8chainHOP_8chainHOP_11RunChainHOP__is_inside = {__Pyx_NAMESTR("_is_inside"), (PyCFunction)__pyx_pf_2yt_5lagos_8chainHOP_8chainHOP_11RunChainHOP__is_inside, METH_O, __Pyx_DOCSTR(__pyx_doc_2yt_5lagos_8chainHOP_8chainHOP_11RunChainHOP__is_inside)};
static PyObject *__pyx_pf_2yt_5lagos_8chainHOP_8chainHOP_11RunChainHOP__is_inside(PyObject *__pyx_self, PyObject *__pyx_v_self) {
  PyArrayObject *__pyx_v_LE;
  PyArrayObject *__pyx_v_RE;
  PyArrayObject *__pyx_v_points;
  PyArrayObject *__pyx_v_inner;
  long __pyx_v_i;
  PyObject *__pyx_r = NULL;
  PyObject *__pyx_1 = 0;
  PyObject *__pyx_2 = 0;
  PyObject *__pyx_3 = 0;
  PyObject *__pyx_t_1 = NULL;
  PyObject *__pyx_t_2 = NULL;
  PyObject *__pyx_t_3 = NULL;
  PyObject *__pyx_t_4 = NULL;
  long __pyx_t_5;
  long __pyx_t_6;
  int __pyx_t_7;
  int __pyx_t_8;
  int __pyx_t_9;
  __Pyx_SetupRefcountContext("_is_inside");
  __pyx_self = __pyx_self;
  __pyx_v_LE = ((PyArrayObject *)Py_None); __Pyx_INCREF(Py_None);
  __pyx_v_RE = ((PyArrayObject *)Py_None); __Pyx_INCREF(Py_None);
  __pyx_v_points = ((PyArrayObject *)Py_None); __Pyx_INCREF(Py_None);
  __pyx_v_inner = ((PyArrayObject *)Py_None); __Pyx_INCREF(Py_None);

  /* "/Users/sskory/Documents/yt-devel/yt/lagos/chainHOP/chainHOP.pyx":72
 *         cdef long i
 *         # Test to see if the points are in the 'real' region
 *         (LE, RE) = self.bounds             # <<<<<<<<<<<<<<
 *         points = fKD.pos.transpose()
 *         self.is_inside = ( (points >= LE).all(axis=1) * \
 */
  __pyx_t_1 = PyObject_GetAttr(__pyx_v_self, __pyx_kp_bounds); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 72; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_1);
  if (PyTuple_CheckExact(__pyx_t_1) && likely(PyTuple_GET_SIZE(__pyx_t_1) == 2)) {
    PyObject* tuple = __pyx_t_1;
    __pyx_2 = PyTuple_GET_ITEM(tuple, 0); __Pyx_INCREF(__pyx_2);
    if (!(__Pyx_TypeTest(__pyx_2, __pyx_ptype_5numpy_ndarray))) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 72; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __pyx_3 = PyTuple_GET_ITEM(tuple, 1); __Pyx_INCREF(__pyx_3);
    if (!(__Pyx_TypeTest(__pyx_3, __pyx_ptype_5numpy_ndarray))) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 72; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
    __Pyx_DECREF(((PyObject *)__pyx_v_LE));
    __pyx_v_LE = ((PyArrayObject *)__pyx_2);
    __pyx_2 = 0;
    __Pyx_DECREF(((PyObject *)__pyx_v_RE));
    __pyx_v_RE = ((PyArrayObject *)__pyx_3);
    __pyx_3 = 0;
  } else {
    __pyx_1 = PyObject_GetIter(__pyx_t_1); if (unlikely(!__pyx_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 72; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_1);
    __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
    __pyx_2 = __Pyx_UnpackItem(__pyx_1, 0); if (unlikely(!__pyx_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 72; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_2);
    if (!(__Pyx_TypeTest(__pyx_2, __pyx_ptype_5numpy_ndarray))) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 72; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __pyx_3 = __Pyx_UnpackItem(__pyx_1, 1); if (unlikely(!__pyx_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 72; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_3);
    if (!(__Pyx_TypeTest(__pyx_3, __pyx_ptype_5numpy_ndarray))) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 72; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    if (__Pyx_EndUnpack(__pyx_1) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 72; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_DECREF(__pyx_1); __pyx_1 = 0;
    __Pyx_DECREF(((PyObject *)__pyx_v_LE));
    __pyx_v_LE = ((PyArrayObject *)__pyx_2);
    __pyx_2 = 0;
    __Pyx_DECREF(((PyObject *)__pyx_v_RE));
    __pyx_v_RE = ((PyArrayObject *)__pyx_3);
    __pyx_3 = 0;
  }

  /* "/Users/sskory/Documents/yt-devel/yt/lagos/chainHOP/chainHOP.pyx":73
 *         # Test to see if the points are in the 'real' region
 *         (LE, RE) = self.bounds
 *         points = fKD.pos.transpose()             # <<<<<<<<<<<<<<
 *         self.is_inside = ( (points >= LE).all(axis=1) * \
 *             (points < RE).all(axis=1) )
 */
  __pyx_1 = __Pyx_GetName(__pyx_m, __pyx_kp_fKD); if (unlikely(!__pyx_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 73; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_1);
  __pyx_t_1 = PyObject_GetAttr(__pyx_1, __pyx_kp_pos); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 73; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_DECREF(__pyx_1); __pyx_1 = 0;
  __pyx_t_2 = PyObject_GetAttr(__pyx_t_1, __pyx_kp_transpose); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 73; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_2);
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_t_1 = PyObject_Call(__pyx_t_2, ((PyObject *)__pyx_empty_tuple), NULL); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 73; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  if (!(__Pyx_TypeTest(__pyx_t_1, __pyx_ptype_5numpy_ndarray))) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 73; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_DECREF(((PyObject *)__pyx_v_points));
  __pyx_v_points = ((PyArrayObject *)__pyx_t_1);
  __pyx_t_1 = 0;

  /* "/Users/sskory/Documents/yt-devel/yt/lagos/chainHOP/chainHOP.pyx":74
 *         (LE, RE) = self.bounds
 *         points = fKD.pos.transpose()
 *         self.is_inside = ( (points >= LE).all(axis=1) * \             # <<<<<<<<<<<<<<
 *             (points < RE).all(axis=1) )
 *         # Below we find out which particles are in the `annulus', one padding
 */
  __pyx_t_1 = PyObject_RichCompare(((PyObject *)__pyx_v_points), ((PyObject *)__pyx_v_LE), Py_GE); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 74; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_t_2 = PyObject_GetAttr(__pyx_t_1, __pyx_kp_all); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 74; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_2);
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_2 = PyDict_New(); if (unlikely(!__pyx_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 74; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(((PyObject *)__pyx_2));
  if (PyDict_SetItem(__pyx_2, __pyx_kp_axis, __pyx_int_1) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 74; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __pyx_t_1 = PyEval_CallObjectWithKeywords(__pyx_t_2, ((PyObject *)__pyx_empty_tuple), ((PyObject *)__pyx_2)); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 74; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __Pyx_DECREF(((PyObject *)__pyx_2)); __pyx_2 = 0;

  /* "/Users/sskory/Documents/yt-devel/yt/lagos/chainHOP/chainHOP.pyx":75
 *         points = fKD.pos.transpose()
 *         self.is_inside = ( (points >= LE).all(axis=1) * \
 *             (points < RE).all(axis=1) )             # <<<<<<<<<<<<<<
 *         # Below we find out which particles are in the `annulus', one padding
 *         # distance inside the boundaries. First we find the particles outside
 */
  __pyx_t_2 = PyObject_RichCompare(((PyObject *)__pyx_v_points), ((PyObject *)__pyx_v_RE), Py_LT); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 75; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_2);
  __pyx_t_3 = PyObject_GetAttr(__pyx_t_2, __pyx_kp_all); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 75; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_3);
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_3 = PyDict_New(); if (unlikely(!__pyx_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 75; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(((PyObject *)__pyx_3));
  if (PyDict_SetItem(__pyx_3, __pyx_kp_axis, __pyx_int_1) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 75; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __pyx_t_2 = PyEval_CallObjectWithKeywords(__pyx_t_3, ((PyObject *)__pyx_empty_tuple), ((PyObject *)__pyx_3)); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 75; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_2);
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  __Pyx_DECREF(((PyObject *)__pyx_3)); __pyx_3 = 0;
  __pyx_t_3 = PyNumber_Multiply(__pyx_t_1, __pyx_t_2); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 74; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_3);
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;

  /* "/Users/sskory/Documents/yt-devel/yt/lagos/chainHOP/chainHOP.pyx":74
 *         (LE, RE) = self.bounds
 *         points = fKD.pos.transpose()
 *         self.is_inside = ( (points >= LE).all(axis=1) * \             # <<<<<<<<<<<<<<
 *             (points < RE).all(axis=1) )
 *         # Below we find out which particles are in the `annulus', one padding
 */
  if (PyObject_SetAttr(__pyx_v_self, __pyx_kp_is_inside, __pyx_t_3) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 74; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;

  /* "/Users/sskory/Documents/yt-devel/yt/lagos/chainHOP/chainHOP.pyx":79
 *         # distance inside the boundaries. First we find the particles outside
 *         # this inner boundary.
 *         LE += self.padding             # <<<<<<<<<<<<<<
 *         RE -= self.padding
 *         inner = na.invert( (points >= LE).all(axis=1) * \
 */
  __pyx_t_3 = PyObject_GetAttr(__pyx_v_self, __pyx_kp_padding); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 79; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_3);
  __pyx_1 = PyNumber_InPlaceAdd(((PyObject *)__pyx_v_LE), __pyx_t_3); if (unlikely(!__pyx_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 79; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_1);
  if (!(__Pyx_TypeTest(__pyx_1, __pyx_ptype_5numpy_ndarray))) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 79; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  __Pyx_DECREF(((PyObject *)__pyx_v_LE));
  __pyx_v_LE = ((PyArrayObject *)__pyx_1);
  __pyx_1 = 0;

  /* "/Users/sskory/Documents/yt-devel/yt/lagos/chainHOP/chainHOP.pyx":80
 *         # this inner boundary.
 *         LE += self.padding
 *         RE -= self.padding             # <<<<<<<<<<<<<<
 *         inner = na.invert( (points >= LE).all(axis=1) * \
 *             (points < RE).all(axis=1) )
 */
  __pyx_t_3 = PyObject_GetAttr(__pyx_v_self, __pyx_kp_padding); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 80; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_3);
  __pyx_2 = PyNumber_InPlaceSubtract(((PyObject *)__pyx_v_RE), __pyx_t_3); if (unlikely(!__pyx_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 80; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_2);
  if (!(__Pyx_TypeTest(__pyx_2, __pyx_ptype_5numpy_ndarray))) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 80; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  __Pyx_DECREF(((PyObject *)__pyx_v_RE));
  __pyx_v_RE = ((PyArrayObject *)__pyx_2);
  __pyx_2 = 0;

  /* "/Users/sskory/Documents/yt-devel/yt/lagos/chainHOP/chainHOP.pyx":81
 *         LE += self.padding
 *         RE -= self.padding
 *         inner = na.invert( (points >= LE).all(axis=1) * \             # <<<<<<<<<<<<<<
 *             (points < RE).all(axis=1) )
 *         # After inverting the logic above, we want points that are both
 */
  __pyx_3 = __Pyx_GetName(__pyx_m, __pyx_kp_na); if (unlikely(!__pyx_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 81; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_3);
  __pyx_t_3 = PyObject_GetAttr(__pyx_3, __pyx_kp_invert); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 81; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_3);
  __Pyx_DECREF(__pyx_3); __pyx_3 = 0;
  __pyx_t_2 = PyObject_RichCompare(((PyObject *)__pyx_v_points), ((PyObject *)__pyx_v_LE), Py_GE); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 81; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_2);
  __pyx_t_1 = PyObject_GetAttr(__pyx_t_2, __pyx_kp_all); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 81; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_1 = PyDict_New(); if (unlikely(!__pyx_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 81; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(((PyObject *)__pyx_1));
  if (PyDict_SetItem(__pyx_1, __pyx_kp_axis, __pyx_int_1) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 81; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __pyx_t_2 = PyEval_CallObjectWithKeywords(__pyx_t_1, ((PyObject *)__pyx_empty_tuple), ((PyObject *)__pyx_1)); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 81; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_2);
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  __Pyx_DECREF(((PyObject *)__pyx_1)); __pyx_1 = 0;

  /* "/Users/sskory/Documents/yt-devel/yt/lagos/chainHOP/chainHOP.pyx":82
 *         RE -= self.padding
 *         inner = na.invert( (points >= LE).all(axis=1) * \
 *             (points < RE).all(axis=1) )             # <<<<<<<<<<<<<<
 *         # After inverting the logic above, we want points that are both
 *         # inside the real region, but within one padding of the boundary,
 */
  __pyx_t_1 = PyObject_RichCompare(((PyObject *)__pyx_v_points), ((PyObject *)__pyx_v_RE), Py_LT); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 82; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_t_4 = PyObject_GetAttr(__pyx_t_1, __pyx_kp_all); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 82; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_4);
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_2 = PyDict_New(); if (unlikely(!__pyx_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 82; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(((PyObject *)__pyx_2));
  if (PyDict_SetItem(__pyx_2, __pyx_kp_axis, __pyx_int_1) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 82; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __pyx_t_1 = PyEval_CallObjectWithKeywords(__pyx_t_4, ((PyObject *)__pyx_empty_tuple), ((PyObject *)__pyx_2)); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 82; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
  __Pyx_DECREF(((PyObject *)__pyx_2)); __pyx_2 = 0;
  __pyx_t_4 = PyNumber_Multiply(__pyx_t_2, __pyx_t_1); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 81; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_4);
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_t_1 = PyTuple_New(1); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 81; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(((PyObject *)__pyx_t_1));
  PyTuple_SET_ITEM(__pyx_t_1, 0, __pyx_t_4);
  __Pyx_GIVEREF(__pyx_t_4);
  __pyx_t_4 = 0;
  __pyx_t_4 = PyObject_Call(__pyx_t_3, ((PyObject *)__pyx_t_1), NULL); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 81; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_4);
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  __Pyx_DECREF(((PyObject *)__pyx_t_1)); __pyx_t_1 = 0;
  if (!(__Pyx_TypeTest(__pyx_t_4, __pyx_ptype_5numpy_ndarray))) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 81; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_DECREF(((PyObject *)__pyx_v_inner));
  __pyx_v_inner = ((PyArrayObject *)__pyx_t_4);
  __pyx_t_4 = 0;

  /* "/Users/sskory/Documents/yt-devel/yt/lagos/chainHOP/chainHOP.pyx":86
 *         # inside the real region, but within one padding of the boundary,
 *         # and this will do it.
 *         self.is_inside_annulus = na.bitwise_and(self.is_inside, inner)             # <<<<<<<<<<<<<<
 *         # Below we make a mapping of real particle index->local ID
 *         # Unf. this has to be a dict, because any task can have
 */
  __pyx_3 = __Pyx_GetName(__pyx_m, __pyx_kp_na); if (unlikely(!__pyx_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 86; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_3);
  __pyx_t_4 = PyObject_GetAttr(__pyx_3, __pyx_kp_bitwise_and); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 86; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_4);
  __Pyx_DECREF(__pyx_3); __pyx_3 = 0;
  __pyx_t_1 = PyObject_GetAttr(__pyx_v_self, __pyx_kp_is_inside); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 86; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_t_3 = PyTuple_New(2); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 86; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(((PyObject *)__pyx_t_3));
  PyTuple_SET_ITEM(__pyx_t_3, 0, __pyx_t_1);
  __Pyx_GIVEREF(__pyx_t_1);
  __Pyx_INCREF(((PyObject *)__pyx_v_inner));
  PyTuple_SET_ITEM(__pyx_t_3, 1, ((PyObject *)__pyx_v_inner));
  __Pyx_GIVEREF(((PyObject *)__pyx_v_inner));
  __pyx_t_1 = 0;
  __pyx_t_1 = PyObject_Call(__pyx_t_4, ((PyObject *)__pyx_t_3), NULL); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 86; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
  __Pyx_DECREF(((PyObject *)__pyx_t_3)); __pyx_t_3 = 0;
  if (PyObject_SetAttr(__pyx_v_self, __pyx_kp_is_inside_annulus, __pyx_t_1) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 86; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;

  /* "/Users/sskory/Documents/yt-devel/yt/lagos/chainHOP/chainHOP.pyx":92
 *         # array every task would probably end up having this array be as long
 *         # as the full number of particles.
 *         self.rev_index = {}             # <<<<<<<<<<<<<<
 *         for i in xrange(self.size):
 *             # Only padded and annulus particles are needed in the dict.
 */
  __pyx_1 = PyDict_New(); if (unlikely(!__pyx_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 92; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(((PyObject *)__pyx_1));
  if (PyObject_SetAttr(__pyx_v_self, __pyx_kp_rev_index, ((PyObject *)__pyx_1)) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 92; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_DECREF(((PyObject *)__pyx_1)); __pyx_1 = 0;

  /* "/Users/sskory/Documents/yt-devel/yt/lagos/chainHOP/chainHOP.pyx":93
 *         # as the full number of particles.
 *         self.rev_index = {}
 *         for i in xrange(self.size):             # <<<<<<<<<<<<<<
 *             # Only padded and annulus particles are needed in the dict.
 *             if not self.is_inside[i] or self.is_inside_annulus[i]:
 */
  __pyx_t_1 = PyObject_GetAttr(__pyx_v_self, __pyx_kp_size); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 93; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_t_5 = __Pyx_PyInt_AsLong(__pyx_t_1); if (unlikely((__pyx_t_5 == (long)-1) && PyErr_Occurred())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 93; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  for (__pyx_t_6 = 0; __pyx_t_6 < __pyx_t_5; __pyx_t_6+=1) {
    __pyx_v_i = __pyx_t_6;

    /* "/Users/sskory/Documents/yt-devel/yt/lagos/chainHOP/chainHOP.pyx":95
 *         for i in xrange(self.size):
 *             # Only padded and annulus particles are needed in the dict.
 *             if not self.is_inside[i] or self.is_inside_annulus[i]:             # <<<<<<<<<<<<<<
 *                 self.rev_index[self.index[i]] = i
 * 
 */
    __pyx_t_1 = PyObject_GetAttr(__pyx_v_self, __pyx_kp_is_inside); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 95; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_1);
    __pyx_2 = __Pyx_GetItemInt(__pyx_t_1, __pyx_v_i, sizeof(long), PyInt_FromLong); if (!__pyx_2) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 95; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_2);
    __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
    __pyx_t_7 = __Pyx_PyObject_IsTrue(__pyx_2); if (unlikely(__pyx_t_7 < 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 95; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_DECREF(__pyx_2); __pyx_2 = 0;
    __pyx_t_8 = (!__pyx_t_7);
    if (!__pyx_t_8) {
      __pyx_t_1 = PyObject_GetAttr(__pyx_v_self, __pyx_kp_is_inside_annulus); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 95; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_t_1);
      __pyx_3 = __Pyx_GetItemInt(__pyx_t_1, __pyx_v_i, sizeof(long), PyInt_FromLong); if (!__pyx_3) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 95; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_3);
      __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
      __pyx_t_7 = __Pyx_PyObject_IsTrue(__pyx_3); if (unlikely(__pyx_t_7 < 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 95; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_DECREF(__pyx_3); __pyx_3 = 0;
      __pyx_t_9 = __pyx_t_7;
    } else {
      __pyx_t_9 = __pyx_t_8;
    }
    if (__pyx_t_9) {

      /* "/Users/sskory/Documents/yt-devel/yt/lagos/chainHOP/chainHOP.pyx":96
 *             # Only padded and annulus particles are needed in the dict.
 *             if not self.is_inside[i] or self.is_inside_annulus[i]:
 *                 self.rev_index[self.index[i]] = i             # <<<<<<<<<<<<<<
 * 
 *     # These next two functions aren't currently being used. They figure out
 */
      __pyx_t_1 = PyInt_FromLong(__pyx_v_i); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 96; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_t_1);
      __pyx_t_3 = PyObject_GetAttr(__pyx_v_self, __pyx_kp_rev_index); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 96; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_t_3);
      __pyx_t_4 = PyObject_GetAttr(__pyx_v_self, __pyx_kp_index); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 96; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_t_4);
      __pyx_1 = __Pyx_GetItemInt(__pyx_t_4, __pyx_v_i, sizeof(long), PyInt_FromLong); if (!__pyx_1) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 96; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_1);
      __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
      if (PyObject_SetItem(__pyx_t_3, __pyx_1, __pyx_t_1) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 96; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
      __Pyx_DECREF(__pyx_1); __pyx_1 = 0;
      __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
      goto __pyx_L7;
    }
    __pyx_L7:;
  }

  __pyx_r = Py_None; __Pyx_INCREF(Py_None);
  goto __pyx_L0;
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_1);
  __Pyx_XDECREF(__pyx_2);
  __Pyx_XDECREF(__pyx_3);
  __Pyx_XDECREF(__pyx_t_1);
  __Pyx_XDECREF(__pyx_t_2);
  __Pyx_XDECREF(__pyx_t_3);
  __Pyx_XDECREF(__pyx_t_4);
  __Pyx_AddTraceback("yt.lagos.chainHOP.chainHOP.RunChainHOP._is_inside");
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_DECREF((PyObject *)__pyx_v_LE);
  __Pyx_DECREF((PyObject *)__pyx_v_RE);
  __Pyx_DECREF((PyObject *)__pyx_v_points);
  __Pyx_DECREF((PyObject *)__pyx_v_inner);
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_FinishRefcountContext();
  return __pyx_r;
}

/* "/Users/sskory/Documents/yt-devel/yt/lagos/chainHOP/chainHOP.pyx":102
 *     # in handy in the future, if needed.
 * 
 *     def _find_shift_padded(self, i):             # <<<<<<<<<<<<<<
 *         """
 *         Find the shift vector for a padded particle.
 */

static PyObject *__pyx_pf_2yt_5lagos_8chainHOP_8chainHOP_11RunChainHOP__find_shift_padded(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static char __pyx_doc_2yt_5lagos_8chainHOP_8chainHOP_11RunChainHOP__find_shift_padded[] = "\n        Find the shift vector for a padded particle.\n        ";
static PyMethodDef __pyx_mdef_2yt_5lagos_8chainHOP_8chainHOP_11RunChainHOP__find_shift_padded = {__Pyx_NAMESTR("_find_shift_padded"), (PyCFunction)__pyx_pf_2yt_5lagos_8chainHOP_8chainHOP_11RunChainHOP__find_shift_padded, METH_VARARGS|METH_KEYWORDS, __Pyx_DOCSTR(__pyx_doc_2yt_5lagos_8chainHOP_8chainHOP_11RunChainHOP__find_shift_padded)};
static PyObject *__pyx_pf_2yt_5lagos_8chainHOP_8chainHOP_11RunChainHOP__find_shift_padded(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  PyObject *__pyx_v_self = 0;
  PyObject *__pyx_v_i = 0;
  PyObject *__pyx_v_LE;
  PyObject *__pyx_v_RE;
  PyObject *__pyx_v_xshift;
  PyObject *__pyx_v_yshift;
  PyObject *__pyx_v_zshift;
  PyObject *__pyx_v_shift;
  PyObject *__pyx_r = NULL;
  PyObject *__pyx_1 = 0;
  PyObject *__pyx_2 = 0;
  PyObject *__pyx_3 = 0;
  PyObject *__pyx_t_1 = NULL;
  int __pyx_t_2;
  PyObject *__pyx_t_3 = NULL;
  PyObject *__pyx_t_4 = NULL;
  static PyObject **__pyx_pyargnames[] = {&__pyx_kp_self,&__pyx_kp_i,0};
  __Pyx_SetupRefcountContext("_find_shift_padded");
  __pyx_self = __pyx_self;
  if (unlikely(__pyx_kwds)) {
    Py_ssize_t kw_args = PyDict_Size(__pyx_kwds);
    PyObject* values[2] = {0,0};
    switch (PyTuple_GET_SIZE(__pyx_args)) {
      case  2: values[1] = PyTuple_GET_ITEM(__pyx_args, 1);
      case  1: values[0] = PyTuple_GET_ITEM(__pyx_args, 0);
      case  0: break;
      default: goto __pyx_L5_argtuple_error;
    }
    switch (PyTuple_GET_SIZE(__pyx_args)) {
      case  0:
      values[0] = PyDict_GetItem(__pyx_kwds, __pyx_kp_self);
      if (likely(values[0])) kw_args--;
      else goto __pyx_L5_argtuple_error;
      case  1:
      values[1] = PyDict_GetItem(__pyx_kwds, __pyx_kp_i);
      if (likely(values[1])) kw_args--;
      else {
        __Pyx_RaiseArgtupleInvalid("_find_shift_padded", 1, 2, 2, 1); {__pyx_filename = __pyx_f[0]; __pyx_lineno = 102; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
      }
    }
    if (unlikely(kw_args > 0)) {
      if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, PyTuple_GET_SIZE(__pyx_args), "_find_shift_padded") < 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 102; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
    }
    __pyx_v_self = values[0];
    __pyx_v_i = values[1];
  } else if (PyTuple_GET_SIZE(__pyx_args) != 2) {
    goto __pyx_L5_argtuple_error;
  } else {
    __pyx_v_self = PyTuple_GET_ITEM(__pyx_args, 0);
    __pyx_v_i = PyTuple_GET_ITEM(__pyx_args, 1);
  }
  goto __pyx_L4_argument_unpacking_done;
  __pyx_L5_argtuple_error:;
  __Pyx_RaiseArgtupleInvalid("_find_shift_padded", 1, 2, 2, PyTuple_GET_SIZE(__pyx_args)); {__pyx_filename = __pyx_f[0]; __pyx_lineno = 102; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
  __pyx_L3_error:;
  __Pyx_AddTraceback("yt.lagos.chainHOP.chainHOP.RunChainHOP._find_shift_padded");
  return NULL;
  __pyx_L4_argument_unpacking_done:;
  __pyx_v_LE = Py_None; __Pyx_INCREF(Py_None);
  __pyx_v_RE = Py_None; __Pyx_INCREF(Py_None);
  __pyx_v_xshift = Py_None; __Pyx_INCREF(Py_None);
  __pyx_v_yshift = Py_None; __Pyx_INCREF(Py_None);
  __pyx_v_zshift = Py_None; __Pyx_INCREF(Py_None);
  __pyx_v_shift = Py_None; __Pyx_INCREF(Py_None);

  /* "/Users/sskory/Documents/yt-devel/yt/lagos/chainHOP/chainHOP.pyx":108
 *         # This shouldn't happen, but just in case, an internal particle
 *         # has no shift.
 *         if self.is_inside[i]: return na.array([0,0,0], dtype='int64')             # <<<<<<<<<<<<<<
 *         (LE, RE) = self.bounds
 *         xshift, yshift, zshift = 0, 0, 0
 */
  __pyx_t_1 = PyObject_GetAttr(__pyx_v_self, __pyx_kp_is_inside); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 108; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_1 = PyObject_GetItem(__pyx_t_1, __pyx_v_i); if (!__pyx_1) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 108; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_1);
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_t_2 = __Pyx_PyObject_IsTrue(__pyx_1); if (unlikely(__pyx_t_2 < 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 108; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_DECREF(__pyx_1); __pyx_1 = 0;
  if (__pyx_t_2) {
    __Pyx_XDECREF(__pyx_r);
    __pyx_1 = __Pyx_GetName(__pyx_m, __pyx_kp_na); if (unlikely(!__pyx_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 108; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_1);
    __pyx_t_1 = PyObject_GetAttr(__pyx_1, __pyx_kp_array); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 108; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_1);
    __Pyx_DECREF(__pyx_1); __pyx_1 = 0;
    __pyx_t_3 = PyList_New(3); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 108; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(((PyObject *)__pyx_t_3));
    __Pyx_INCREF(__pyx_int_0);
    PyList_SET_ITEM(__pyx_t_3, 0, __pyx_int_0);
    __Pyx_GIVEREF(__pyx_int_0);
    __Pyx_INCREF(__pyx_int_0);
    PyList_SET_ITEM(__pyx_t_3, 1, __pyx_int_0);
    __Pyx_GIVEREF(__pyx_int_0);
    __Pyx_INCREF(__pyx_int_0);
    PyList_SET_ITEM(__pyx_t_3, 2, __pyx_int_0);
    __Pyx_GIVEREF(__pyx_int_0);
    __pyx_t_4 = PyTuple_New(1); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 108; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(((PyObject *)__pyx_t_4));
    PyTuple_SET_ITEM(__pyx_t_4, 0, ((PyObject *)__pyx_t_3));
    __Pyx_GIVEREF(((PyObject *)__pyx_t_3));
    __pyx_t_3 = 0;
    __pyx_1 = PyDict_New(); if (unlikely(!__pyx_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 108; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(((PyObject *)__pyx_1));
    if (PyDict_SetItem(__pyx_1, __pyx_kp_dtype, __pyx_kp_52) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 108; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __pyx_t_3 = PyEval_CallObjectWithKeywords(__pyx_t_1, ((PyObject *)__pyx_t_4), ((PyObject *)__pyx_1)); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 108; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_3);
    __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
    __Pyx_DECREF(((PyObject *)__pyx_t_4)); __pyx_t_4 = 0;
    __Pyx_DECREF(((PyObject *)__pyx_1)); __pyx_1 = 0;
    __pyx_r = __pyx_t_3;
    __pyx_t_3 = 0;
    goto __pyx_L0;
    goto __pyx_L6;
  }
  __pyx_L6:;

  /* "/Users/sskory/Documents/yt-devel/yt/lagos/chainHOP/chainHOP.pyx":109
 *         # has no shift.
 *         if self.is_inside[i]: return na.array([0,0,0], dtype='int64')
 *         (LE, RE) = self.bounds             # <<<<<<<<<<<<<<
 *         xshift, yshift, zshift = 0, 0, 0
 *         if self.xpos[i] >= RE[0]:
 */
  __pyx_t_3 = PyObject_GetAttr(__pyx_v_self, __pyx_kp_bounds); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 109; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_3);
  if (PyTuple_CheckExact(__pyx_t_3) && likely(PyTuple_GET_SIZE(__pyx_t_3) == 2)) {
    PyObject* tuple = __pyx_t_3;
    __pyx_2 = PyTuple_GET_ITEM(tuple, 0); __Pyx_INCREF(__pyx_2);
    __pyx_3 = PyTuple_GET_ITEM(tuple, 1); __Pyx_INCREF(__pyx_3);
    __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
    __Pyx_DECREF(__pyx_v_LE);
    __pyx_v_LE = __pyx_2;
    __pyx_2 = 0;
    __Pyx_DECREF(__pyx_v_RE);
    __pyx_v_RE = __pyx_3;
    __pyx_3 = 0;
  } else {
    __pyx_1 = PyObject_GetIter(__pyx_t_3); if (unlikely(!__pyx_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 109; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_1);
    __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
    __pyx_2 = __Pyx_UnpackItem(__pyx_1, 0); if (unlikely(!__pyx_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 109; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_2);
    __pyx_3 = __Pyx_UnpackItem(__pyx_1, 1); if (unlikely(!__pyx_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 109; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_3);
    if (__Pyx_EndUnpack(__pyx_1) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 109; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_DECREF(__pyx_1); __pyx_1 = 0;
    __Pyx_DECREF(__pyx_v_LE);
    __pyx_v_LE = __pyx_2;
    __pyx_2 = 0;
    __Pyx_DECREF(__pyx_v_RE);
    __pyx_v_RE = __pyx_3;
    __pyx_3 = 0;
  }

  /* "/Users/sskory/Documents/yt-devel/yt/lagos/chainHOP/chainHOP.pyx":110
 *         if self.is_inside[i]: return na.array([0,0,0], dtype='int64')
 *         (LE, RE) = self.bounds
 *         xshift, yshift, zshift = 0, 0, 0             # <<<<<<<<<<<<<<
 *         if self.xpos[i] >= RE[0]:
 *             xshift = 1
 */
  __pyx_t_3 = __pyx_int_0;
  __Pyx_INCREF(__pyx_t_3);
  __pyx_t_4 = __pyx_int_0;
  __Pyx_INCREF(__pyx_t_4);
  __pyx_t_1 = __pyx_int_0;
  __Pyx_INCREF(__pyx_t_1);
  __Pyx_DECREF(__pyx_v_xshift);
  __pyx_v_xshift = __pyx_t_3;
  __pyx_t_3 = 0;
  __Pyx_DECREF(__pyx_v_yshift);
  __pyx_v_yshift = __pyx_t_4;
  __pyx_t_4 = 0;
  __Pyx_DECREF(__pyx_v_zshift);
  __pyx_v_zshift = __pyx_t_1;
  __pyx_t_1 = 0;

  /* "/Users/sskory/Documents/yt-devel/yt/lagos/chainHOP/chainHOP.pyx":111
 *         (LE, RE) = self.bounds
 *         xshift, yshift, zshift = 0, 0, 0
 *         if self.xpos[i] >= RE[0]:             # <<<<<<<<<<<<<<
 *             xshift = 1
 *             # this accounts for padded regions that haven't been repositioned
 */
  __pyx_t_1 = PyObject_GetAttr(__pyx_v_self, __pyx_kp_xpos); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 111; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_1 = PyObject_GetItem(__pyx_t_1, __pyx_v_i); if (!__pyx_1) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 111; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_1);
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_2 = __Pyx_GetItemInt(__pyx_v_RE, 0, sizeof(long), PyInt_FromLong); if (!__pyx_2) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 111; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_2);
  __pyx_t_1 = PyObject_RichCompare(__pyx_1, __pyx_2, Py_GE); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 111; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_DECREF(__pyx_1); __pyx_1 = 0;
  __Pyx_DECREF(__pyx_2); __pyx_2 = 0;
  __pyx_t_2 = __Pyx_PyObject_IsTrue(__pyx_t_1); if (unlikely(__pyx_t_2 < 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 111; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  if (__pyx_t_2) {

    /* "/Users/sskory/Documents/yt-devel/yt/lagos/chainHOP/chainHOP.pyx":112
 *         xshift, yshift, zshift = 0, 0, 0
 *         if self.xpos[i] >= RE[0]:
 *             xshift = 1             # <<<<<<<<<<<<<<
 *             # this accounts for padded regions that haven't been repositioned
 *             # around the periodic boundaries
 */
    __Pyx_INCREF(__pyx_int_1);
    __Pyx_DECREF(__pyx_v_xshift);
    __pyx_v_xshift = __pyx_int_1;

    /* "/Users/sskory/Documents/yt-devel/yt/lagos/chainHOP/chainHOP.pyx":115
 *             # this accounts for padded regions that haven't been repositioned
 *             # around the periodic boundaries
 *             if (self.xpos[i] - RE[0]) > self.padding:             # <<<<<<<<<<<<<<
 *                 xshift = -1
 *         elif self.xpos[i] < LE[0]:
 */
    __pyx_t_1 = PyObject_GetAttr(__pyx_v_self, __pyx_kp_xpos); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 115; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_1);
    __pyx_3 = PyObject_GetItem(__pyx_t_1, __pyx_v_i); if (!__pyx_3) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 115; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_3);
    __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
    __pyx_1 = __Pyx_GetItemInt(__pyx_v_RE, 0, sizeof(long), PyInt_FromLong); if (!__pyx_1) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 115; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_1);
    __pyx_t_1 = PyNumber_Subtract(__pyx_3, __pyx_1); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 115; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_1);
    __Pyx_DECREF(__pyx_3); __pyx_3 = 0;
    __Pyx_DECREF(__pyx_1); __pyx_1 = 0;
    __pyx_t_4 = PyObject_GetAttr(__pyx_v_self, __pyx_kp_padding); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 115; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_4);
    __pyx_t_3 = PyObject_RichCompare(__pyx_t_1, __pyx_t_4, Py_GT); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 115; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_3);
    __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
    __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
    __pyx_t_2 = __Pyx_PyObject_IsTrue(__pyx_t_3); if (unlikely(__pyx_t_2 < 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 115; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
    if (__pyx_t_2) {

      /* "/Users/sskory/Documents/yt-devel/yt/lagos/chainHOP/chainHOP.pyx":116
 *             # around the periodic boundaries
 *             if (self.xpos[i] - RE[0]) > self.padding:
 *                 xshift = -1             # <<<<<<<<<<<<<<
 *         elif self.xpos[i] < LE[0]:
 *             xshift = -1
 */
      __Pyx_INCREF(__pyx_int_neg_1);
      __Pyx_DECREF(__pyx_v_xshift);
      __pyx_v_xshift = __pyx_int_neg_1;
      goto __pyx_L8;
    }
    __pyx_L8:;
    goto __pyx_L7;
  }

  /* "/Users/sskory/Documents/yt-devel/yt/lagos/chainHOP/chainHOP.pyx":117
 *             if (self.xpos[i] - RE[0]) > self.padding:
 *                 xshift = -1
 *         elif self.xpos[i] < LE[0]:             # <<<<<<<<<<<<<<
 *             xshift = -1
 *             if (self.xpos[i] - LE[0]) >= self.padding:
 */
  __pyx_t_3 = PyObject_GetAttr(__pyx_v_self, __pyx_kp_xpos); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 117; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_3);
  __pyx_2 = PyObject_GetItem(__pyx_t_3, __pyx_v_i); if (!__pyx_2) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 117; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_2);
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  __pyx_3 = __Pyx_GetItemInt(__pyx_v_LE, 0, sizeof(long), PyInt_FromLong); if (!__pyx_3) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 117; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_3);
  __pyx_t_3 = PyObject_RichCompare(__pyx_2, __pyx_3, Py_LT); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 117; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_3);
  __Pyx_DECREF(__pyx_2); __pyx_2 = 0;
  __Pyx_DECREF(__pyx_3); __pyx_3 = 0;
  __pyx_t_2 = __Pyx_PyObject_IsTrue(__pyx_t_3); if (unlikely(__pyx_t_2 < 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 117; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  if (__pyx_t_2) {

    /* "/Users/sskory/Documents/yt-devel/yt/lagos/chainHOP/chainHOP.pyx":118
 *                 xshift = -1
 *         elif self.xpos[i] < LE[0]:
 *             xshift = -1             # <<<<<<<<<<<<<<
 *             if (self.xpos[i] - LE[0]) >= self.padding:
 *                 xshift = 1
 */
    __Pyx_INCREF(__pyx_int_neg_1);
    __Pyx_DECREF(__pyx_v_xshift);
    __pyx_v_xshift = __pyx_int_neg_1;

    /* "/Users/sskory/Documents/yt-devel/yt/lagos/chainHOP/chainHOP.pyx":119
 *         elif self.xpos[i] < LE[0]:
 *             xshift = -1
 *             if (self.xpos[i] - LE[0]) >= self.padding:             # <<<<<<<<<<<<<<
 *                 xshift = 1
 *         if self.ypos[i] >= RE[1]:
 */
    __pyx_t_3 = PyObject_GetAttr(__pyx_v_self, __pyx_kp_xpos); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 119; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_3);
    __pyx_1 = PyObject_GetItem(__pyx_t_3, __pyx_v_i); if (!__pyx_1) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 119; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_1);
    __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
    __pyx_2 = __Pyx_GetItemInt(__pyx_v_LE, 0, sizeof(long), PyInt_FromLong); if (!__pyx_2) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 119; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_2);
    __pyx_t_3 = PyNumber_Subtract(__pyx_1, __pyx_2); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 119; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_3);
    __Pyx_DECREF(__pyx_1); __pyx_1 = 0;
    __Pyx_DECREF(__pyx_2); __pyx_2 = 0;
    __pyx_t_4 = PyObject_GetAttr(__pyx_v_self, __pyx_kp_padding); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 119; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_4);
    __pyx_t_1 = PyObject_RichCompare(__pyx_t_3, __pyx_t_4, Py_GE); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 119; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_1);
    __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
    __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
    __pyx_t_2 = __Pyx_PyObject_IsTrue(__pyx_t_1); if (unlikely(__pyx_t_2 < 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 119; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
    if (__pyx_t_2) {

      /* "/Users/sskory/Documents/yt-devel/yt/lagos/chainHOP/chainHOP.pyx":120
 *             xshift = -1
 *             if (self.xpos[i] - LE[0]) >= self.padding:
 *                 xshift = 1             # <<<<<<<<<<<<<<
 *         if self.ypos[i] >= RE[1]:
 *             yshift = 1
 */
      __Pyx_INCREF(__pyx_int_1);
      __Pyx_DECREF(__pyx_v_xshift);
      __pyx_v_xshift = __pyx_int_1;
      goto __pyx_L9;
    }
    __pyx_L9:;
    goto __pyx_L7;
  }
  __pyx_L7:;

  /* "/Users/sskory/Documents/yt-devel/yt/lagos/chainHOP/chainHOP.pyx":121
 *             if (self.xpos[i] - LE[0]) >= self.padding:
 *                 xshift = 1
 *         if self.ypos[i] >= RE[1]:             # <<<<<<<<<<<<<<
 *             yshift = 1
 *             if (self.ypos[i] - RE[0]) > self.padding:
 */
  __pyx_t_1 = PyObject_GetAttr(__pyx_v_self, __pyx_kp_ypos); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 121; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_3 = PyObject_GetItem(__pyx_t_1, __pyx_v_i); if (!__pyx_3) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 121; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_3);
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_1 = __Pyx_GetItemInt(__pyx_v_RE, 1, sizeof(long), PyInt_FromLong); if (!__pyx_1) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 121; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_1);
  __pyx_t_1 = PyObject_RichCompare(__pyx_3, __pyx_1, Py_GE); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 121; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_DECREF(__pyx_3); __pyx_3 = 0;
  __Pyx_DECREF(__pyx_1); __pyx_1 = 0;
  __pyx_t_2 = __Pyx_PyObject_IsTrue(__pyx_t_1); if (unlikely(__pyx_t_2 < 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 121; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  if (__pyx_t_2) {

    /* "/Users/sskory/Documents/yt-devel/yt/lagos/chainHOP/chainHOP.pyx":122
 *                 xshift = 1
 *         if self.ypos[i] >= RE[1]:
 *             yshift = 1             # <<<<<<<<<<<<<<
 *             if (self.ypos[i] - RE[0]) > self.padding:
 *                 yshift = -1
 */
    __Pyx_INCREF(__pyx_int_1);
    __Pyx_DECREF(__pyx_v_yshift);
    __pyx_v_yshift = __pyx_int_1;

    /* "/Users/sskory/Documents/yt-devel/yt/lagos/chainHOP/chainHOP.pyx":123
 *         if self.ypos[i] >= RE[1]:
 *             yshift = 1
 *             if (self.ypos[i] - RE[0]) > self.padding:             # <<<<<<<<<<<<<<
 *                 yshift = -1
 *         elif self.ypos[i] < LE[1]:
 */
    __pyx_t_1 = PyObject_GetAttr(__pyx_v_self, __pyx_kp_ypos); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 123; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_1);
    __pyx_2 = PyObject_GetItem(__pyx_t_1, __pyx_v_i); if (!__pyx_2) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 123; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_2);
    __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
    __pyx_3 = __Pyx_GetItemInt(__pyx_v_RE, 0, sizeof(long), PyInt_FromLong); if (!__pyx_3) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 123; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_3);
    __pyx_t_1 = PyNumber_Subtract(__pyx_2, __pyx_3); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 123; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_1);
    __Pyx_DECREF(__pyx_2); __pyx_2 = 0;
    __Pyx_DECREF(__pyx_3); __pyx_3 = 0;
    __pyx_t_4 = PyObject_GetAttr(__pyx_v_self, __pyx_kp_padding); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 123; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_4);
    __pyx_t_3 = PyObject_RichCompare(__pyx_t_1, __pyx_t_4, Py_GT); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 123; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_3);
    __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
    __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
    __pyx_t_2 = __Pyx_PyObject_IsTrue(__pyx_t_3); if (unlikely(__pyx_t_2 < 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 123; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
    if (__pyx_t_2) {

      /* "/Users/sskory/Documents/yt-devel/yt/lagos/chainHOP/chainHOP.pyx":124
 *             yshift = 1
 *             if (self.ypos[i] - RE[0]) > self.padding:
 *                 yshift = -1             # <<<<<<<<<<<<<<
 *         elif self.ypos[i] < LE[1]:
 *             yshift = -1
 */
      __Pyx_INCREF(__pyx_int_neg_1);
      __Pyx_DECREF(__pyx_v_yshift);
      __pyx_v_yshift = __pyx_int_neg_1;
      goto __pyx_L11;
    }
    __pyx_L11:;
    goto __pyx_L10;
  }

  /* "/Users/sskory/Documents/yt-devel/yt/lagos/chainHOP/chainHOP.pyx":125
 *             if (self.ypos[i] - RE[0]) > self.padding:
 *                 yshift = -1
 *         elif self.ypos[i] < LE[1]:             # <<<<<<<<<<<<<<
 *             yshift = -1
 *             if (self.ypos[i] - LE[0]) >= self.padding:
 */
  __pyx_t_3 = PyObject_GetAttr(__pyx_v_self, __pyx_kp_ypos); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 125; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_3);
  __pyx_1 = PyObject_GetItem(__pyx_t_3, __pyx_v_i); if (!__pyx_1) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 125; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_1);
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  __pyx_2 = __Pyx_GetItemInt(__pyx_v_LE, 1, sizeof(long), PyInt_FromLong); if (!__pyx_2) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 125; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_2);
  __pyx_t_3 = PyObject_RichCompare(__pyx_1, __pyx_2, Py_LT); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 125; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_3);
  __Pyx_DECREF(__pyx_1); __pyx_1 = 0;
  __Pyx_DECREF(__pyx_2); __pyx_2 = 0;
  __pyx_t_2 = __Pyx_PyObject_IsTrue(__pyx_t_3); if (unlikely(__pyx_t_2 < 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 125; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  if (__pyx_t_2) {

    /* "/Users/sskory/Documents/yt-devel/yt/lagos/chainHOP/chainHOP.pyx":126
 *                 yshift = -1
 *         elif self.ypos[i] < LE[1]:
 *             yshift = -1             # <<<<<<<<<<<<<<
 *             if (self.ypos[i] - LE[0]) >= self.padding:
 *                 yshift = 1
 */
    __Pyx_INCREF(__pyx_int_neg_1);
    __Pyx_DECREF(__pyx_v_yshift);
    __pyx_v_yshift = __pyx_int_neg_1;

    /* "/Users/sskory/Documents/yt-devel/yt/lagos/chainHOP/chainHOP.pyx":127
 *         elif self.ypos[i] < LE[1]:
 *             yshift = -1
 *             if (self.ypos[i] - LE[0]) >= self.padding:             # <<<<<<<<<<<<<<
 *                 yshift = 1
 *         if self.zpos[i] >= RE[2]:
 */
    __pyx_t_3 = PyObject_GetAttr(__pyx_v_self, __pyx_kp_ypos); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 127; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_3);
    __pyx_3 = PyObject_GetItem(__pyx_t_3, __pyx_v_i); if (!__pyx_3) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 127; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_3);
    __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
    __pyx_1 = __Pyx_GetItemInt(__pyx_v_LE, 0, sizeof(long), PyInt_FromLong); if (!__pyx_1) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 127; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_1);
    __pyx_t_3 = PyNumber_Subtract(__pyx_3, __pyx_1); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 127; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_3);
    __Pyx_DECREF(__pyx_3); __pyx_3 = 0;
    __Pyx_DECREF(__pyx_1); __pyx_1 = 0;
    __pyx_t_4 = PyObject_GetAttr(__pyx_v_self, __pyx_kp_padding); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 127; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_4);
    __pyx_t_1 = PyObject_RichCompare(__pyx_t_3, __pyx_t_4, Py_GE); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 127; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_1);
    __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
    __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
    __pyx_t_2 = __Pyx_PyObject_IsTrue(__pyx_t_1); if (unlikely(__pyx_t_2 < 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 127; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
    if (__pyx_t_2) {

      /* "/Users/sskory/Documents/yt-devel/yt/lagos/chainHOP/chainHOP.pyx":128
 *             yshift = -1
 *             if (self.ypos[i] - LE[0]) >= self.padding:
 *                 yshift = 1             # <<<<<<<<<<<<<<
 *         if self.zpos[i] >= RE[2]:
 *             zshift = 1
 */
      __Pyx_INCREF(__pyx_int_1);
      __Pyx_DECREF(__pyx_v_yshift);
      __pyx_v_yshift = __pyx_int_1;
      goto __pyx_L12;
    }
    __pyx_L12:;
    goto __pyx_L10;
  }
  __pyx_L10:;

  /* "/Users/sskory/Documents/yt-devel/yt/lagos/chainHOP/chainHOP.pyx":129
 *             if (self.ypos[i] - LE[0]) >= self.padding:
 *                 yshift = 1
 *         if self.zpos[i] >= RE[2]:             # <<<<<<<<<<<<<<
 *             zshift = 1
 *             if (self.zpos[i] - RE[0]) > self.padding:
 */
  __pyx_t_1 = PyObject_GetAttr(__pyx_v_self, __pyx_kp_zpos); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 129; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_2 = PyObject_GetItem(__pyx_t_1, __pyx_v_i); if (!__pyx_2) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 129; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_2);
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_3 = __Pyx_GetItemInt(__pyx_v_RE, 2, sizeof(long), PyInt_FromLong); if (!__pyx_3) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 129; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_3);
  __pyx_t_1 = PyObject_RichCompare(__pyx_2, __pyx_3, Py_GE); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 129; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_DECREF(__pyx_2); __pyx_2 = 0;
  __Pyx_DECREF(__pyx_3); __pyx_3 = 0;
  __pyx_t_2 = __Pyx_PyObject_IsTrue(__pyx_t_1); if (unlikely(__pyx_t_2 < 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 129; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  if (__pyx_t_2) {

    /* "/Users/sskory/Documents/yt-devel/yt/lagos/chainHOP/chainHOP.pyx":130
 *                 yshift = 1
 *         if self.zpos[i] >= RE[2]:
 *             zshift = 1             # <<<<<<<<<<<<<<
 *             if (self.zpos[i] - RE[0]) > self.padding:
 *                 zshift = -1
 */
    __Pyx_INCREF(__pyx_int_1);
    __Pyx_DECREF(__pyx_v_zshift);
    __pyx_v_zshift = __pyx_int_1;

    /* "/Users/sskory/Documents/yt-devel/yt/lagos/chainHOP/chainHOP.pyx":131
 *         if self.zpos[i] >= RE[2]:
 *             zshift = 1
 *             if (self.zpos[i] - RE[0]) > self.padding:             # <<<<<<<<<<<<<<
 *                 zshift = -1
 *         elif self.zpos[i] < LE[2]:
 */
    __pyx_t_1 = PyObject_GetAttr(__pyx_v_self, __pyx_kp_zpos); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 131; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_1);
    __pyx_1 = PyObject_GetItem(__pyx_t_1, __pyx_v_i); if (!__pyx_1) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 131; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_1);
    __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
    __pyx_2 = __Pyx_GetItemInt(__pyx_v_RE, 0, sizeof(long), PyInt_FromLong); if (!__pyx_2) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 131; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_2);
    __pyx_t_1 = PyNumber_Subtract(__pyx_1, __pyx_2); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 131; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_1);
    __Pyx_DECREF(__pyx_1); __pyx_1 = 0;
    __Pyx_DECREF(__pyx_2); __pyx_2 = 0;
    __pyx_t_4 = PyObject_GetAttr(__pyx_v_self, __pyx_kp_padding); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 131; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_4);
    __pyx_t_3 = PyObject_RichCompare(__pyx_t_1, __pyx_t_4, Py_GT); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 131; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_3);
    __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
    __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
    __pyx_t_2 = __Pyx_PyObject_IsTrue(__pyx_t_3); if (unlikely(__pyx_t_2 < 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 131; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
    if (__pyx_t_2) {

      /* "/Users/sskory/Documents/yt-devel/yt/lagos/chainHOP/chainHOP.pyx":132
 *             zshift = 1
 *             if (self.zpos[i] - RE[0]) > self.padding:
 *                 zshift = -1             # <<<<<<<<<<<<<<
 *         elif self.zpos[i] < LE[2]:
 *             zshift = -1
 */
      __Pyx_INCREF(__pyx_int_neg_1);
      __Pyx_DECREF(__pyx_v_zshift);
      __pyx_v_zshift = __pyx_int_neg_1;
      goto __pyx_L14;
    }
    __pyx_L14:;
    goto __pyx_L13;
  }

  /* "/Users/sskory/Documents/yt-devel/yt/lagos/chainHOP/chainHOP.pyx":133
 *             if (self.zpos[i] - RE[0]) > self.padding:
 *                 zshift = -1
 *         elif self.zpos[i] < LE[2]:             # <<<<<<<<<<<<<<
 *             zshift = -1
 *             if (self.zpos[i] - LE[0]) >= self.padding:
 */
  __pyx_t_3 = PyObject_GetAttr(__pyx_v_self, __pyx_kp_zpos); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 133; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_3);
  __pyx_3 = PyObject_GetItem(__pyx_t_3, __pyx_v_i); if (!__pyx_3) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 133; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_3);
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  __pyx_1 = __Pyx_GetItemInt(__pyx_v_LE, 2, sizeof(long), PyInt_FromLong); if (!__pyx_1) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 133; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_1);
  __pyx_t_3 = PyObject_RichCompare(__pyx_3, __pyx_1, Py_LT); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 133; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_3);
  __Pyx_DECREF(__pyx_3); __pyx_3 = 0;
  __Pyx_DECREF(__pyx_1); __pyx_1 = 0;
  __pyx_t_2 = __Pyx_PyObject_IsTrue(__pyx_t_3); if (unlikely(__pyx_t_2 < 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 133; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  if (__pyx_t_2) {

    /* "/Users/sskory/Documents/yt-devel/yt/lagos/chainHOP/chainHOP.pyx":134
 *                 zshift = -1
 *         elif self.zpos[i] < LE[2]:
 *             zshift = -1             # <<<<<<<<<<<<<<
 *             if (self.zpos[i] - LE[0]) >= self.padding:
 *                 zshift = 1
 */
    __Pyx_INCREF(__pyx_int_neg_1);
    __Pyx_DECREF(__pyx_v_zshift);
    __pyx_v_zshift = __pyx_int_neg_1;

    /* "/Users/sskory/Documents/yt-devel/yt/lagos/chainHOP/chainHOP.pyx":135
 *         elif self.zpos[i] < LE[2]:
 *             zshift = -1
 *             if (self.zpos[i] - LE[0]) >= self.padding:             # <<<<<<<<<<<<<<
 *                 zshift = 1
 *         shift = na.array([xshift,yshift,zshift],dtype='int64')
 */
    __pyx_t_3 = PyObject_GetAttr(__pyx_v_self, __pyx_kp_zpos); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 135; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_3);
    __pyx_2 = PyObject_GetItem(__pyx_t_3, __pyx_v_i); if (!__pyx_2) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 135; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_2);
    __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
    __pyx_3 = __Pyx_GetItemInt(__pyx_v_LE, 0, sizeof(long), PyInt_FromLong); if (!__pyx_3) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 135; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_3);
    __pyx_t_3 = PyNumber_Subtract(__pyx_2, __pyx_3); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 135; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_3);
    __Pyx_DECREF(__pyx_2); __pyx_2 = 0;
    __Pyx_DECREF(__pyx_3); __pyx_3 = 0;
    __pyx_t_4 = PyObject_GetAttr(__pyx_v_self, __pyx_kp_padding); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 135; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_4);
    __pyx_t_1 = PyObject_RichCompare(__pyx_t_3, __pyx_t_4, Py_GE); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 135; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_1);
    __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
    __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
    __pyx_t_2 = __Pyx_PyObject_IsTrue(__pyx_t_1); if (unlikely(__pyx_t_2 < 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 135; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
    if (__pyx_t_2) {

      /* "/Users/sskory/Documents/yt-devel/yt/lagos/chainHOP/chainHOP.pyx":136
 *             zshift = -1
 *             if (self.zpos[i] - LE[0]) >= self.padding:
 *                 zshift = 1             # <<<<<<<<<<<<<<
 *         shift = na.array([xshift,yshift,zshift],dtype='int64')
 *         return shift
 */
      __Pyx_INCREF(__pyx_int_1);
      __Pyx_DECREF(__pyx_v_zshift);
      __pyx_v_zshift = __pyx_int_1;
      goto __pyx_L15;
    }
    __pyx_L15:;
    goto __pyx_L13;
  }
  __pyx_L13:;

  /* "/Users/sskory/Documents/yt-devel/yt/lagos/chainHOP/chainHOP.pyx":137
 *             if (self.zpos[i] - LE[0]) >= self.padding:
 *                 zshift = 1
 *         shift = na.array([xshift,yshift,zshift],dtype='int64')             # <<<<<<<<<<<<<<
 *         return shift
 * 
 */
  __pyx_1 = __Pyx_GetName(__pyx_m, __pyx_kp_na); if (unlikely(!__pyx_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 137; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_1);
  __pyx_t_1 = PyObject_GetAttr(__pyx_1, __pyx_kp_array); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 137; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_DECREF(__pyx_1); __pyx_1 = 0;
  __pyx_t_4 = PyList_New(3); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 137; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(((PyObject *)__pyx_t_4));
  __Pyx_INCREF(__pyx_v_xshift);
  PyList_SET_ITEM(__pyx_t_4, 0, __pyx_v_xshift);
  __Pyx_GIVEREF(__pyx_v_xshift);
  __Pyx_INCREF(__pyx_v_yshift);
  PyList_SET_ITEM(__pyx_t_4, 1, __pyx_v_yshift);
  __Pyx_GIVEREF(__pyx_v_yshift);
  __Pyx_INCREF(__pyx_v_zshift);
  PyList_SET_ITEM(__pyx_t_4, 2, __pyx_v_zshift);
  __Pyx_GIVEREF(__pyx_v_zshift);
  __pyx_t_3 = PyTuple_New(1); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 137; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(((PyObject *)__pyx_t_3));
  PyTuple_SET_ITEM(__pyx_t_3, 0, ((PyObject *)__pyx_t_4));
  __Pyx_GIVEREF(((PyObject *)__pyx_t_4));
  __pyx_t_4 = 0;
  __pyx_2 = PyDict_New(); if (unlikely(!__pyx_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 137; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(((PyObject *)__pyx_2));
  if (PyDict_SetItem(__pyx_2, __pyx_kp_dtype, __pyx_kp_53) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 137; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __pyx_t_4 = PyEval_CallObjectWithKeywords(__pyx_t_1, ((PyObject *)__pyx_t_3), ((PyObject *)__pyx_2)); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 137; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_4);
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  __Pyx_DECREF(((PyObject *)__pyx_t_3)); __pyx_t_3 = 0;
  __Pyx_DECREF(((PyObject *)__pyx_2)); __pyx_2 = 0;
  __Pyx_DECREF(__pyx_v_shift);
  __pyx_v_shift = __pyx_t_4;
  __pyx_t_4 = 0;

  /* "/Users/sskory/Documents/yt-devel/yt/lagos/chainHOP/chainHOP.pyx":138
 *                 zshift = 1
 *         shift = na.array([xshift,yshift,zshift],dtype='int64')
 *         return shift             # <<<<<<<<<<<<<<
 * 
 *     def _find_shift_real(self, i):
 */
  __Pyx_XDECREF(__pyx_r);
  __Pyx_INCREF(__pyx_v_shift);
  __pyx_r = __pyx_v_shift;
  goto __pyx_L0;

  __pyx_r = Py_None; __Pyx_INCREF(Py_None);
  goto __pyx_L0;
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_1);
  __Pyx_XDECREF(__pyx_2);
  __Pyx_XDECREF(__pyx_3);
  __Pyx_XDECREF(__pyx_t_1);
  __Pyx_XDECREF(__pyx_t_3);
  __Pyx_XDECREF(__pyx_t_4);
  __Pyx_AddTraceback("yt.lagos.chainHOP.chainHOP.RunChainHOP._find_shift_padded");
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_DECREF(__pyx_v_LE);
  __Pyx_DECREF(__pyx_v_RE);
  __Pyx_DECREF(__pyx_v_xshift);
  __Pyx_DECREF(__pyx_v_yshift);
  __Pyx_DECREF(__pyx_v_zshift);
  __Pyx_DECREF(__pyx_v_shift);
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_FinishRefcountContext();
  return __pyx_r;
}

/* "/Users/sskory/Documents/yt-devel/yt/lagos/chainHOP/chainHOP.pyx":140
 *         return shift
 * 
 *     def _find_shift_real(self, i):             # <<<<<<<<<<<<<<
 *         """
 *         Find shift vectors for a particle in the 'real' region. A particle
 */

static PyObject *__pyx_pf_2yt_5lagos_8chainHOP_8chainHOP_11RunChainHOP__find_shift_real(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static char __pyx_doc_2yt_5lagos_8chainHOP_8chainHOP_11RunChainHOP__find_shift_real[] = "\n        Find shift vectors for a particle in the 'real' region. A particle\n        in the real region, close to the boundary, may be a padded particle\n        in several neighbors, so we need to return multiple shift vectors.\n        ";
static PyMethodDef __pyx_mdef_2yt_5lagos_8chainHOP_8chainHOP_11RunChainHOP__find_shift_real = {__Pyx_NAMESTR("_find_shift_real"), (PyCFunction)__pyx_pf_2yt_5lagos_8chainHOP_8chainHOP_11RunChainHOP__find_shift_real, METH_VARARGS|METH_KEYWORDS, __Pyx_DOCSTR(__pyx_doc_2yt_5lagos_8chainHOP_8chainHOP_11RunChainHOP__find_shift_real)};
static PyObject *__pyx_pf_2yt_5lagos_8chainHOP_8chainHOP_11RunChainHOP__find_shift_real(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  PyObject *__pyx_v_self = 0;
  PyObject *__pyx_v_i = 0;
  PyObject *__pyx_v_LE;
  PyObject *__pyx_v_RE;
  PyObject *__pyx_v_xshift;
  PyObject *__pyx_v_yshift;
  PyObject *__pyx_v_zshift;
  PyObject *__pyx_v_count;
  PyObject *__pyx_v_vectors;
  PyObject *__pyx_v_base;
  PyObject *__pyx_v_diag;
  PyObject *__pyx_v_zero_e;
  PyObject *__pyx_v_j;
  PyObject *__pyx_r = NULL;
  PyObject *__pyx_1 = 0;
  PyObject *__pyx_2 = 0;
  PyObject *__pyx_3 = 0;
  PyObject *__pyx_t_1 = NULL;
  PyObject *__pyx_t_2 = NULL;
  PyObject *__pyx_t_3 = NULL;
  int __pyx_t_4;
  int __pyx_t_5;
  PyObject *__pyx_t_6 = NULL;
  PyObject *__pyx_t_7 = NULL;
  Py_ssize_t __pyx_t_8;
  Py_ssize_t __pyx_t_9;
  static PyObject **__pyx_pyargnames[] = {&__pyx_kp_self,&__pyx_kp_i,0};
  __Pyx_SetupRefcountContext("_find_shift_real");
  __pyx_self = __pyx_self;
  if (unlikely(__pyx_kwds)) {
    Py_ssize_t kw_args = PyDict_Size(__pyx_kwds);
    PyObject* values[2] = {0,0};
    switch (PyTuple_GET_SIZE(__pyx_args)) {
      case  2: values[1] = PyTuple_GET_ITEM(__pyx_args, 1);
      case  1: values[0] = PyTuple_GET_ITEM(__pyx_args, 0);
      case  0: break;
      default: goto __pyx_L5_argtuple_error;
    }
    switch (PyTuple_GET_SIZE(__pyx_args)) {
      case  0:
      values[0] = PyDict_GetItem(__pyx_kwds, __pyx_kp_self);
      if (likely(values[0])) kw_args--;
      else goto __pyx_L5_argtuple_error;
      case  1:
      values[1] = PyDict_GetItem(__pyx_kwds, __pyx_kp_i);
      if (likely(values[1])) kw_args--;
      else {
        __Pyx_RaiseArgtupleInvalid("_find_shift_real", 1, 2, 2, 1); {__pyx_filename = __pyx_f[0]; __pyx_lineno = 140; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
      }
    }
    if (unlikely(kw_args > 0)) {
      if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, PyTuple_GET_SIZE(__pyx_args), "_find_shift_real") < 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 140; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
    }
    __pyx_v_self = values[0];
    __pyx_v_i = values[1];
  } else if (PyTuple_GET_SIZE(__pyx_args) != 2) {
    goto __pyx_L5_argtuple_error;
  } else {
    __pyx_v_self = PyTuple_GET_ITEM(__pyx_args, 0);
    __pyx_v_i = PyTuple_GET_ITEM(__pyx_args, 1);
  }
  goto __pyx_L4_argument_unpacking_done;
  __pyx_L5_argtuple_error:;
  __Pyx_RaiseArgtupleInvalid("_find_shift_real", 1, 2, 2, PyTuple_GET_SIZE(__pyx_args)); {__pyx_filename = __pyx_f[0]; __pyx_lineno = 140; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
  __pyx_L3_error:;
  __Pyx_AddTraceback("yt.lagos.chainHOP.chainHOP.RunChainHOP._find_shift_real");
  return NULL;
  __pyx_L4_argument_unpacking_done:;
  __Pyx_INCREF(__pyx_v_i);
  __pyx_v_LE = Py_None; __Pyx_INCREF(Py_None);
  __pyx_v_RE = Py_None; __Pyx_INCREF(Py_None);
  __pyx_v_xshift = Py_None; __Pyx_INCREF(Py_None);
  __pyx_v_yshift = Py_None; __Pyx_INCREF(Py_None);
  __pyx_v_zshift = Py_None; __Pyx_INCREF(Py_None);
  __pyx_v_count = Py_None; __Pyx_INCREF(Py_None);
  __pyx_v_vectors = Py_None; __Pyx_INCREF(Py_None);
  __pyx_v_base = Py_None; __Pyx_INCREF(Py_None);
  __pyx_v_diag = Py_None; __Pyx_INCREF(Py_None);
  __pyx_v_zero_e = Py_None; __Pyx_INCREF(Py_None);
  __pyx_v_j = Py_None; __Pyx_INCREF(Py_None);

  /* "/Users/sskory/Documents/yt-devel/yt/lagos/chainHOP/chainHOP.pyx":146
 *         in several neighbors, so we need to return multiple shift vectors.
 *         """
 *         return [ na.array([1,0,0], dtype='int64') ]             # <<<<<<<<<<<<<<
 *         # skip padded particles
 *         if not self.is_inside[i]: return na.array([0]*3, dtype='int64')
 */
  __Pyx_XDECREF(__pyx_r);
  __pyx_1 = __Pyx_GetName(__pyx_m, __pyx_kp_na); if (unlikely(!__pyx_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 146; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_1);
  __pyx_t_1 = PyObject_GetAttr(__pyx_1, __pyx_kp_array); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 146; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_DECREF(__pyx_1); __pyx_1 = 0;
  __pyx_t_2 = PyList_New(3); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 146; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(((PyObject *)__pyx_t_2));
  __Pyx_INCREF(__pyx_int_1);
  PyList_SET_ITEM(__pyx_t_2, 0, __pyx_int_1);
  __Pyx_GIVEREF(__pyx_int_1);
  __Pyx_INCREF(__pyx_int_0);
  PyList_SET_ITEM(__pyx_t_2, 1, __pyx_int_0);
  __Pyx_GIVEREF(__pyx_int_0);
  __Pyx_INCREF(__pyx_int_0);
  PyList_SET_ITEM(__pyx_t_2, 2, __pyx_int_0);
  __Pyx_GIVEREF(__pyx_int_0);
  __pyx_t_3 = PyTuple_New(1); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 146; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(((PyObject *)__pyx_t_3));
  PyTuple_SET_ITEM(__pyx_t_3, 0, ((PyObject *)__pyx_t_2));
  __Pyx_GIVEREF(((PyObject *)__pyx_t_2));
  __pyx_t_2 = 0;
  __pyx_1 = PyDict_New(); if (unlikely(!__pyx_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 146; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(((PyObject *)__pyx_1));
  if (PyDict_SetItem(__pyx_1, __pyx_kp_dtype, __pyx_kp_54) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 146; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __pyx_t_2 = PyEval_CallObjectWithKeywords(__pyx_t_1, ((PyObject *)__pyx_t_3), ((PyObject *)__pyx_1)); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 146; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_2);
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  __Pyx_DECREF(((PyObject *)__pyx_t_3)); __pyx_t_3 = 0;
  __Pyx_DECREF(((PyObject *)__pyx_1)); __pyx_1 = 0;
  __pyx_t_3 = PyList_New(1); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 146; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(((PyObject *)__pyx_t_3));
  PyList_SET_ITEM(__pyx_t_3, 0, __pyx_t_2);
  __Pyx_GIVEREF(__pyx_t_2);
  __pyx_t_2 = 0;
  __pyx_r = ((PyObject *)__pyx_t_3);
  __pyx_t_3 = 0;
  goto __pyx_L0;

  /* "/Users/sskory/Documents/yt-devel/yt/lagos/chainHOP/chainHOP.pyx":148
 *         return [ na.array([1,0,0], dtype='int64') ]
 *         # skip padded particles
 *         if not self.is_inside[i]: return na.array([0]*3, dtype='int64')             # <<<<<<<<<<<<<<
 *         # Adjust the boundaries
 *         (LE, RE) = self.bounds
 */
  __pyx_t_3 = PyObject_GetAttr(__pyx_v_self, __pyx_kp_is_inside); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 148; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_3);
  __pyx_1 = PyObject_GetItem(__pyx_t_3, __pyx_v_i); if (!__pyx_1) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 148; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_1);
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  __pyx_t_4 = __Pyx_PyObject_IsTrue(__pyx_1); if (unlikely(__pyx_t_4 < 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 148; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_DECREF(__pyx_1); __pyx_1 = 0;
  __pyx_t_5 = (!__pyx_t_4);
  if (__pyx_t_5) {
    __Pyx_XDECREF(__pyx_r);
    __pyx_1 = __Pyx_GetName(__pyx_m, __pyx_kp_na); if (unlikely(!__pyx_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 148; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_1);
    __pyx_t_3 = PyObject_GetAttr(__pyx_1, __pyx_kp_array); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 148; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_3);
    __Pyx_DECREF(__pyx_1); __pyx_1 = 0;
    __pyx_t_2 = PyList_New(1); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 148; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(((PyObject *)__pyx_t_2));
    __Pyx_INCREF(__pyx_int_0);
    PyList_SET_ITEM(__pyx_t_2, 0, __pyx_int_0);
    __Pyx_GIVEREF(__pyx_int_0);
    __pyx_t_1 = PyNumber_Multiply(((PyObject *)__pyx_t_2), __pyx_int_3); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 148; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_1);
    __Pyx_DECREF(((PyObject *)__pyx_t_2)); __pyx_t_2 = 0;
    __pyx_t_2 = PyTuple_New(1); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 148; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(((PyObject *)__pyx_t_2));
    PyTuple_SET_ITEM(__pyx_t_2, 0, __pyx_t_1);
    __Pyx_GIVEREF(__pyx_t_1);
    __pyx_t_1 = 0;
    __pyx_1 = PyDict_New(); if (unlikely(!__pyx_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 148; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(((PyObject *)__pyx_1));
    if (PyDict_SetItem(__pyx_1, __pyx_kp_dtype, __pyx_kp_55) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 148; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __pyx_t_1 = PyEval_CallObjectWithKeywords(__pyx_t_3, ((PyObject *)__pyx_t_2), ((PyObject *)__pyx_1)); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 148; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_1);
    __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
    __Pyx_DECREF(((PyObject *)__pyx_t_2)); __pyx_t_2 = 0;
    __Pyx_DECREF(((PyObject *)__pyx_1)); __pyx_1 = 0;
    __pyx_r = __pyx_t_1;
    __pyx_t_1 = 0;
    goto __pyx_L0;
    goto __pyx_L6;
  }
  __pyx_L6:;

  /* "/Users/sskory/Documents/yt-devel/yt/lagos/chainHOP/chainHOP.pyx":150
 *         if not self.is_inside[i]: return na.array([0]*3, dtype='int64')
 *         # Adjust the boundaries
 *         (LE, RE) = self.bounds             # <<<<<<<<<<<<<<
 *         LE += na.array([self.padding]*3)
 *         RE -= na.array([self.padding]*3)
 */
  __pyx_t_1 = PyObject_GetAttr(__pyx_v_self, __pyx_kp_bounds); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 150; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_1);
  if (PyTuple_CheckExact(__pyx_t_1) && likely(PyTuple_GET_SIZE(__pyx_t_1) == 2)) {
    PyObject* tuple = __pyx_t_1;
    __pyx_2 = PyTuple_GET_ITEM(tuple, 0); __Pyx_INCREF(__pyx_2);
    __pyx_3 = PyTuple_GET_ITEM(tuple, 1); __Pyx_INCREF(__pyx_3);
    __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
    __Pyx_DECREF(__pyx_v_LE);
    __pyx_v_LE = __pyx_2;
    __pyx_2 = 0;
    __Pyx_DECREF(__pyx_v_RE);
    __pyx_v_RE = __pyx_3;
    __pyx_3 = 0;
  } else {
    __pyx_1 = PyObject_GetIter(__pyx_t_1); if (unlikely(!__pyx_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 150; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_1);
    __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
    __pyx_2 = __Pyx_UnpackItem(__pyx_1, 0); if (unlikely(!__pyx_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 150; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_2);
    __pyx_3 = __Pyx_UnpackItem(__pyx_1, 1); if (unlikely(!__pyx_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 150; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_3);
    if (__Pyx_EndUnpack(__pyx_1) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 150; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_DECREF(__pyx_1); __pyx_1 = 0;
    __Pyx_DECREF(__pyx_v_LE);
    __pyx_v_LE = __pyx_2;
    __pyx_2 = 0;
    __Pyx_DECREF(__pyx_v_RE);
    __pyx_v_RE = __pyx_3;
    __pyx_3 = 0;
  }

  /* "/Users/sskory/Documents/yt-devel/yt/lagos/chainHOP/chainHOP.pyx":151
 *         # Adjust the boundaries
 *         (LE, RE) = self.bounds
 *         LE += na.array([self.padding]*3)             # <<<<<<<<<<<<<<
 *         RE -= na.array([self.padding]*3)
 *         xshift, yshift, zshift = 0, 0, 0
 */
  __pyx_2 = __Pyx_GetName(__pyx_m, __pyx_kp_na); if (unlikely(!__pyx_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 151; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_2);
  __pyx_t_1 = PyObject_GetAttr(__pyx_2, __pyx_kp_array); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 151; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_DECREF(__pyx_2); __pyx_2 = 0;
  __pyx_t_2 = PyObject_GetAttr(__pyx_v_self, __pyx_kp_padding); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 151; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_2);
  __pyx_t_3 = PyList_New(1); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 151; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(((PyObject *)__pyx_t_3));
  PyList_SET_ITEM(__pyx_t_3, 0, __pyx_t_2);
  __Pyx_GIVEREF(__pyx_t_2);
  __pyx_t_2 = 0;
  __pyx_t_2 = PyNumber_Multiply(((PyObject *)__pyx_t_3), __pyx_int_3); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 151; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_2);
  __Pyx_DECREF(((PyObject *)__pyx_t_3)); __pyx_t_3 = 0;
  __pyx_t_3 = PyTuple_New(1); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 151; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(((PyObject *)__pyx_t_3));
  PyTuple_SET_ITEM(__pyx_t_3, 0, __pyx_t_2);
  __Pyx_GIVEREF(__pyx_t_2);
  __pyx_t_2 = 0;
  __pyx_t_2 = PyObject_Call(__pyx_t_1, ((PyObject *)__pyx_t_3), NULL); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 151; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_2);
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  __Pyx_DECREF(((PyObject *)__pyx_t_3)); __pyx_t_3 = 0;
  __pyx_1 = PyNumber_InPlaceAdd(__pyx_v_LE, __pyx_t_2); if (unlikely(!__pyx_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 151; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_1);
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __Pyx_DECREF(__pyx_v_LE);
  __pyx_v_LE = __pyx_1;
  __pyx_1 = 0;

  /* "/Users/sskory/Documents/yt-devel/yt/lagos/chainHOP/chainHOP.pyx":152
 *         (LE, RE) = self.bounds
 *         LE += na.array([self.padding]*3)
 *         RE -= na.array([self.padding]*3)             # <<<<<<<<<<<<<<
 *         xshift, yshift, zshift = 0, 0, 0
 *         if self.xpos[i] >= RE[0]:
 */
  __pyx_2 = __Pyx_GetName(__pyx_m, __pyx_kp_na); if (unlikely(!__pyx_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 152; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_2);
  __pyx_t_2 = PyObject_GetAttr(__pyx_2, __pyx_kp_array); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 152; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_2);
  __Pyx_DECREF(__pyx_2); __pyx_2 = 0;
  __pyx_t_3 = PyObject_GetAttr(__pyx_v_self, __pyx_kp_padding); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 152; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_3);
  __pyx_t_1 = PyList_New(1); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 152; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(((PyObject *)__pyx_t_1));
  PyList_SET_ITEM(__pyx_t_1, 0, __pyx_t_3);
  __Pyx_GIVEREF(__pyx_t_3);
  __pyx_t_3 = 0;
  __pyx_t_3 = PyNumber_Multiply(((PyObject *)__pyx_t_1), __pyx_int_3); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 152; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_3);
  __Pyx_DECREF(((PyObject *)__pyx_t_1)); __pyx_t_1 = 0;
  __pyx_t_1 = PyTuple_New(1); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 152; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(((PyObject *)__pyx_t_1));
  PyTuple_SET_ITEM(__pyx_t_1, 0, __pyx_t_3);
  __Pyx_GIVEREF(__pyx_t_3);
  __pyx_t_3 = 0;
  __pyx_t_3 = PyObject_Call(__pyx_t_2, ((PyObject *)__pyx_t_1), NULL); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 152; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_3);
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __Pyx_DECREF(((PyObject *)__pyx_t_1)); __pyx_t_1 = 0;
  __pyx_3 = PyNumber_InPlaceSubtract(__pyx_v_RE, __pyx_t_3); if (unlikely(!__pyx_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 152; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_3);
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  __Pyx_DECREF(__pyx_v_RE);
  __pyx_v_RE = __pyx_3;
  __pyx_3 = 0;

  /* "/Users/sskory/Documents/yt-devel/yt/lagos/chainHOP/chainHOP.pyx":153
 *         LE += na.array([self.padding]*3)
 *         RE -= na.array([self.padding]*3)
 *         xshift, yshift, zshift = 0, 0, 0             # <<<<<<<<<<<<<<
 *         if self.xpos[i] >= RE[0]:
 *             xshift = 1
 */
  __pyx_t_3 = __pyx_int_0;
  __Pyx_INCREF(__pyx_t_3);
  __pyx_t_1 = __pyx_int_0;
  __Pyx_INCREF(__pyx_t_1);
  __pyx_t_2 = __pyx_int_0;
  __Pyx_INCREF(__pyx_t_2);
  __Pyx_DECREF(__pyx_v_xshift);
  __pyx_v_xshift = __pyx_t_3;
  __pyx_t_3 = 0;
  __Pyx_DECREF(__pyx_v_yshift);
  __pyx_v_yshift = __pyx_t_1;
  __pyx_t_1 = 0;
  __Pyx_DECREF(__pyx_v_zshift);
  __pyx_v_zshift = __pyx_t_2;
  __pyx_t_2 = 0;

  /* "/Users/sskory/Documents/yt-devel/yt/lagos/chainHOP/chainHOP.pyx":154
 *         RE -= na.array([self.padding]*3)
 *         xshift, yshift, zshift = 0, 0, 0
 *         if self.xpos[i] >= RE[0]:             # <<<<<<<<<<<<<<
 *             xshift = 1
 *         elif self.xpos[i] < LE[0]:
 */
  __pyx_t_2 = PyObject_GetAttr(__pyx_v_self, __pyx_kp_xpos); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 154; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_2);
  __pyx_1 = PyObject_GetItem(__pyx_t_2, __pyx_v_i); if (!__pyx_1) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 154; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_1);
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_2 = __Pyx_GetItemInt(__pyx_v_RE, 0, sizeof(long), PyInt_FromLong); if (!__pyx_2) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 154; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_2);
  __pyx_t_2 = PyObject_RichCompare(__pyx_1, __pyx_2, Py_GE); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 154; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_2);
  __Pyx_DECREF(__pyx_1); __pyx_1 = 0;
  __Pyx_DECREF(__pyx_2); __pyx_2 = 0;
  __pyx_t_5 = __Pyx_PyObject_IsTrue(__pyx_t_2); if (unlikely(__pyx_t_5 < 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 154; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  if (__pyx_t_5) {

    /* "/Users/sskory/Documents/yt-devel/yt/lagos/chainHOP/chainHOP.pyx":155
 *         xshift, yshift, zshift = 0, 0, 0
 *         if self.xpos[i] >= RE[0]:
 *             xshift = 1             # <<<<<<<<<<<<<<
 *         elif self.xpos[i] < LE[0]:
 *             xshift = -1
 */
    __Pyx_INCREF(__pyx_int_1);
    __Pyx_DECREF(__pyx_v_xshift);
    __pyx_v_xshift = __pyx_int_1;
    goto __pyx_L7;
  }

  /* "/Users/sskory/Documents/yt-devel/yt/lagos/chainHOP/chainHOP.pyx":156
 *         if self.xpos[i] >= RE[0]:
 *             xshift = 1
 *         elif self.xpos[i] < LE[0]:             # <<<<<<<<<<<<<<
 *             xshift = -1
 *         if self.ypos[i] >= RE[1]:
 */
  __pyx_t_2 = PyObject_GetAttr(__pyx_v_self, __pyx_kp_xpos); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 156; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_2);
  __pyx_3 = PyObject_GetItem(__pyx_t_2, __pyx_v_i); if (!__pyx_3) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 156; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_3);
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_1 = __Pyx_GetItemInt(__pyx_v_LE, 0, sizeof(long), PyInt_FromLong); if (!__pyx_1) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 156; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_1);
  __pyx_t_2 = PyObject_RichCompare(__pyx_3, __pyx_1, Py_LT); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 156; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_2);
  __Pyx_DECREF(__pyx_3); __pyx_3 = 0;
  __Pyx_DECREF(__pyx_1); __pyx_1 = 0;
  __pyx_t_5 = __Pyx_PyObject_IsTrue(__pyx_t_2); if (unlikely(__pyx_t_5 < 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 156; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  if (__pyx_t_5) {

    /* "/Users/sskory/Documents/yt-devel/yt/lagos/chainHOP/chainHOP.pyx":157
 *             xshift = 1
 *         elif self.xpos[i] < LE[0]:
 *             xshift = -1             # <<<<<<<<<<<<<<
 *         if self.ypos[i] >= RE[1]:
 *             yshift = 1
 */
    __Pyx_INCREF(__pyx_int_neg_1);
    __Pyx_DECREF(__pyx_v_xshift);
    __pyx_v_xshift = __pyx_int_neg_1;
    goto __pyx_L7;
  }
  __pyx_L7:;

  /* "/Users/sskory/Documents/yt-devel/yt/lagos/chainHOP/chainHOP.pyx":158
 *         elif self.xpos[i] < LE[0]:
 *             xshift = -1
 *         if self.ypos[i] >= RE[1]:             # <<<<<<<<<<<<<<
 *             yshift = 1
 *         elif self.ypos[i] < LE[1]:
 */
  __pyx_t_2 = PyObject_GetAttr(__pyx_v_self, __pyx_kp_ypos); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 158; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_2);
  __pyx_2 = PyObject_GetItem(__pyx_t_2, __pyx_v_i); if (!__pyx_2) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 158; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_2);
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_3 = __Pyx_GetItemInt(__pyx_v_RE, 1, sizeof(long), PyInt_FromLong); if (!__pyx_3) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 158; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_3);
  __pyx_t_2 = PyObject_RichCompare(__pyx_2, __pyx_3, Py_GE); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 158; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_2);
  __Pyx_DECREF(__pyx_2); __pyx_2 = 0;
  __Pyx_DECREF(__pyx_3); __pyx_3 = 0;
  __pyx_t_5 = __Pyx_PyObject_IsTrue(__pyx_t_2); if (unlikely(__pyx_t_5 < 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 158; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  if (__pyx_t_5) {

    /* "/Users/sskory/Documents/yt-devel/yt/lagos/chainHOP/chainHOP.pyx":159
 *             xshift = -1
 *         if self.ypos[i] >= RE[1]:
 *             yshift = 1             # <<<<<<<<<<<<<<
 *         elif self.ypos[i] < LE[1]:
 *             yshift = -1
 */
    __Pyx_INCREF(__pyx_int_1);
    __Pyx_DECREF(__pyx_v_yshift);
    __pyx_v_yshift = __pyx_int_1;
    goto __pyx_L8;
  }

  /* "/Users/sskory/Documents/yt-devel/yt/lagos/chainHOP/chainHOP.pyx":160
 *         if self.ypos[i] >= RE[1]:
 *             yshift = 1
 *         elif self.ypos[i] < LE[1]:             # <<<<<<<<<<<<<<
 *             yshift = -1
 *         if self.zpos[i] >= RE[2]:
 */
  __pyx_t_2 = PyObject_GetAttr(__pyx_v_self, __pyx_kp_ypos); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 160; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_2);
  __pyx_1 = PyObject_GetItem(__pyx_t_2, __pyx_v_i); if (!__pyx_1) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 160; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_1);
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_2 = __Pyx_GetItemInt(__pyx_v_LE, 1, sizeof(long), PyInt_FromLong); if (!__pyx_2) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 160; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_2);
  __pyx_t_2 = PyObject_RichCompare(__pyx_1, __pyx_2, Py_LT); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 160; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_2);
  __Pyx_DECREF(__pyx_1); __pyx_1 = 0;
  __Pyx_DECREF(__pyx_2); __pyx_2 = 0;
  __pyx_t_5 = __Pyx_PyObject_IsTrue(__pyx_t_2); if (unlikely(__pyx_t_5 < 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 160; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  if (__pyx_t_5) {

    /* "/Users/sskory/Documents/yt-devel/yt/lagos/chainHOP/chainHOP.pyx":161
 *             yshift = 1
 *         elif self.ypos[i] < LE[1]:
 *             yshift = -1             # <<<<<<<<<<<<<<
 *         if self.zpos[i] >= RE[2]:
 *             zshift = 1
 */
    __Pyx_INCREF(__pyx_int_neg_1);
    __Pyx_DECREF(__pyx_v_yshift);
    __pyx_v_yshift = __pyx_int_neg_1;
    goto __pyx_L8;
  }
  __pyx_L8:;

  /* "/Users/sskory/Documents/yt-devel/yt/lagos/chainHOP/chainHOP.pyx":162
 *         elif self.ypos[i] < LE[1]:
 *             yshift = -1
 *         if self.zpos[i] >= RE[2]:             # <<<<<<<<<<<<<<
 *             zshift = 1
 *         elif self.zpos[i] < LE[2]:
 */
  __pyx_t_2 = PyObject_GetAttr(__pyx_v_self, __pyx_kp_zpos); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 162; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_2);
  __pyx_3 = PyObject_GetItem(__pyx_t_2, __pyx_v_i); if (!__pyx_3) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 162; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_3);
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_1 = __Pyx_GetItemInt(__pyx_v_RE, 2, sizeof(long), PyInt_FromLong); if (!__pyx_1) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 162; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_1);
  __pyx_t_2 = PyObject_RichCompare(__pyx_3, __pyx_1, Py_GE); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 162; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_2);
  __Pyx_DECREF(__pyx_3); __pyx_3 = 0;
  __Pyx_DECREF(__pyx_1); __pyx_1 = 0;
  __pyx_t_5 = __Pyx_PyObject_IsTrue(__pyx_t_2); if (unlikely(__pyx_t_5 < 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 162; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  if (__pyx_t_5) {

    /* "/Users/sskory/Documents/yt-devel/yt/lagos/chainHOP/chainHOP.pyx":163
 *             yshift = -1
 *         if self.zpos[i] >= RE[2]:
 *             zshift = 1             # <<<<<<<<<<<<<<
 *         elif self.zpos[i] < LE[2]:
 *             zshift = -1
 */
    __Pyx_INCREF(__pyx_int_1);
    __Pyx_DECREF(__pyx_v_zshift);
    __pyx_v_zshift = __pyx_int_1;
    goto __pyx_L9;
  }

  /* "/Users/sskory/Documents/yt-devel/yt/lagos/chainHOP/chainHOP.pyx":164
 *         if self.zpos[i] >= RE[2]:
 *             zshift = 1
 *         elif self.zpos[i] < LE[2]:             # <<<<<<<<<<<<<<
 *             zshift = -1
 *         count = abs(xshift) + abs(yshift) + abs(zshift)
 */
  __pyx_t_2 = PyObject_GetAttr(__pyx_v_self, __pyx_kp_zpos); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 164; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_2);
  __pyx_2 = PyObject_GetItem(__pyx_t_2, __pyx_v_i); if (!__pyx_2) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 164; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_2);
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_3 = __Pyx_GetItemInt(__pyx_v_LE, 2, sizeof(long), PyInt_FromLong); if (!__pyx_3) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 164; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_3);
  __pyx_t_2 = PyObject_RichCompare(__pyx_2, __pyx_3, Py_LT); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 164; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_2);
  __Pyx_DECREF(__pyx_2); __pyx_2 = 0;
  __Pyx_DECREF(__pyx_3); __pyx_3 = 0;
  __pyx_t_5 = __Pyx_PyObject_IsTrue(__pyx_t_2); if (unlikely(__pyx_t_5 < 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 164; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  if (__pyx_t_5) {

    /* "/Users/sskory/Documents/yt-devel/yt/lagos/chainHOP/chainHOP.pyx":165
 *             zshift = 1
 *         elif self.zpos[i] < LE[2]:
 *             zshift = -1             # <<<<<<<<<<<<<<
 *         count = abs(xshift) + abs(yshift) + abs(zshift)
 *         vectors = []
 */
    __Pyx_INCREF(__pyx_int_neg_1);
    __Pyx_DECREF(__pyx_v_zshift);
    __pyx_v_zshift = __pyx_int_neg_1;
    goto __pyx_L9;
  }
  __pyx_L9:;

  /* "/Users/sskory/Documents/yt-devel/yt/lagos/chainHOP/chainHOP.pyx":166
 *         elif self.zpos[i] < LE[2]:
 *             zshift = -1
 *         count = abs(xshift) + abs(yshift) + abs(zshift)             # <<<<<<<<<<<<<<
 *         vectors = []
 *         base = na.array([xshift,yshift,zshift], dtype='int64')
 */
  __pyx_t_2 = PyNumber_Absolute(__pyx_v_xshift); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 166; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_2);
  __pyx_t_1 = PyNumber_Absolute(__pyx_v_yshift); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 166; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_t_3 = PyNumber_Add(__pyx_t_2, __pyx_t_1); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 166; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_3);
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_t_1 = PyNumber_Absolute(__pyx_v_zshift); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 166; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_t_2 = PyNumber_Add(__pyx_t_3, __pyx_t_1); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 166; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_2);
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  __Pyx_DECREF(__pyx_v_count);
  __pyx_v_count = __pyx_t_2;
  __pyx_t_2 = 0;

  /* "/Users/sskory/Documents/yt-devel/yt/lagos/chainHOP/chainHOP.pyx":167
 *             zshift = -1
 *         count = abs(xshift) + abs(yshift) + abs(zshift)
 *         vectors = []             # <<<<<<<<<<<<<<
 *         base = na.array([xshift,yshift,zshift], dtype='int64')
 *         diag = na.array([[1,0,0], [0,1,0], [0,0,1]], dtype='int64')
 */
  __pyx_t_2 = PyList_New(0); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 167; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(((PyObject *)__pyx_t_2));
  __Pyx_DECREF(__pyx_v_vectors);
  __pyx_v_vectors = ((PyObject *)__pyx_t_2);
  __pyx_t_2 = 0;

  /* "/Users/sskory/Documents/yt-devel/yt/lagos/chainHOP/chainHOP.pyx":168
 *         count = abs(xshift) + abs(yshift) + abs(zshift)
 *         vectors = []
 *         base = na.array([xshift,yshift,zshift], dtype='int64')             # <<<<<<<<<<<<<<
 *         diag = na.array([[1,0,0], [0,1,0], [0,0,1]], dtype='int64')
 *         vectors.append(base)
 */
  __pyx_1 = __Pyx_GetName(__pyx_m, __pyx_kp_na); if (unlikely(!__pyx_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 168; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_1);
  __pyx_t_2 = PyObject_GetAttr(__pyx_1, __pyx_kp_array); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 168; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_2);
  __Pyx_DECREF(__pyx_1); __pyx_1 = 0;
  __pyx_t_1 = PyList_New(3); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 168; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(((PyObject *)__pyx_t_1));
  __Pyx_INCREF(__pyx_v_xshift);
  PyList_SET_ITEM(__pyx_t_1, 0, __pyx_v_xshift);
  __Pyx_GIVEREF(__pyx_v_xshift);
  __Pyx_INCREF(__pyx_v_yshift);
  PyList_SET_ITEM(__pyx_t_1, 1, __pyx_v_yshift);
  __Pyx_GIVEREF(__pyx_v_yshift);
  __Pyx_INCREF(__pyx_v_zshift);
  PyList_SET_ITEM(__pyx_t_1, 2, __pyx_v_zshift);
  __Pyx_GIVEREF(__pyx_v_zshift);
  __pyx_t_3 = PyTuple_New(1); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 168; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(((PyObject *)__pyx_t_3));
  PyTuple_SET_ITEM(__pyx_t_3, 0, ((PyObject *)__pyx_t_1));
  __Pyx_GIVEREF(((PyObject *)__pyx_t_1));
  __pyx_t_1 = 0;
  __pyx_2 = PyDict_New(); if (unlikely(!__pyx_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 168; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(((PyObject *)__pyx_2));
  if (PyDict_SetItem(__pyx_2, __pyx_kp_dtype, __pyx_kp_56) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 168; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __pyx_t_1 = PyEval_CallObjectWithKeywords(__pyx_t_2, ((PyObject *)__pyx_t_3), ((PyObject *)__pyx_2)); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 168; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __Pyx_DECREF(((PyObject *)__pyx_t_3)); __pyx_t_3 = 0;
  __Pyx_DECREF(((PyObject *)__pyx_2)); __pyx_2 = 0;
  __Pyx_DECREF(__pyx_v_base);
  __pyx_v_base = __pyx_t_1;
  __pyx_t_1 = 0;

  /* "/Users/sskory/Documents/yt-devel/yt/lagos/chainHOP/chainHOP.pyx":169
 *         vectors = []
 *         base = na.array([xshift,yshift,zshift], dtype='int64')
 *         diag = na.array([[1,0,0], [0,1,0], [0,0,1]], dtype='int64')             # <<<<<<<<<<<<<<
 *         vectors.append(base)
 *         if count == 2:
 */
  __pyx_3 = __Pyx_GetName(__pyx_m, __pyx_kp_na); if (unlikely(!__pyx_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 169; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_3);
  __pyx_t_1 = PyObject_GetAttr(__pyx_3, __pyx_kp_array); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 169; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_DECREF(__pyx_3); __pyx_3 = 0;
  __pyx_t_3 = PyList_New(3); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 169; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(((PyObject *)__pyx_t_3));
  __Pyx_INCREF(__pyx_int_1);
  PyList_SET_ITEM(__pyx_t_3, 0, __pyx_int_1);
  __Pyx_GIVEREF(__pyx_int_1);
  __Pyx_INCREF(__pyx_int_0);
  PyList_SET_ITEM(__pyx_t_3, 1, __pyx_int_0);
  __Pyx_GIVEREF(__pyx_int_0);
  __Pyx_INCREF(__pyx_int_0);
  PyList_SET_ITEM(__pyx_t_3, 2, __pyx_int_0);
  __Pyx_GIVEREF(__pyx_int_0);
  __pyx_t_2 = PyList_New(3); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 169; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(((PyObject *)__pyx_t_2));
  __Pyx_INCREF(__pyx_int_0);
  PyList_SET_ITEM(__pyx_t_2, 0, __pyx_int_0);
  __Pyx_GIVEREF(__pyx_int_0);
  __Pyx_INCREF(__pyx_int_1);
  PyList_SET_ITEM(__pyx_t_2, 1, __pyx_int_1);
  __Pyx_GIVEREF(__pyx_int_1);
  __Pyx_INCREF(__pyx_int_0);
  PyList_SET_ITEM(__pyx_t_2, 2, __pyx_int_0);
  __Pyx_GIVEREF(__pyx_int_0);
  __pyx_t_6 = PyList_New(3); if (unlikely(!__pyx_t_6)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 169; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(((PyObject *)__pyx_t_6));
  __Pyx_INCREF(__pyx_int_0);
  PyList_SET_ITEM(__pyx_t_6, 0, __pyx_int_0);
  __Pyx_GIVEREF(__pyx_int_0);
  __Pyx_INCREF(__pyx_int_0);
  PyList_SET_ITEM(__pyx_t_6, 1, __pyx_int_0);
  __Pyx_GIVEREF(__pyx_int_0);
  __Pyx_INCREF(__pyx_int_1);
  PyList_SET_ITEM(__pyx_t_6, 2, __pyx_int_1);
  __Pyx_GIVEREF(__pyx_int_1);
  __pyx_t_7 = PyList_New(3); if (unlikely(!__pyx_t_7)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 169; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(((PyObject *)__pyx_t_7));
  PyList_SET_ITEM(__pyx_t_7, 0, ((PyObject *)__pyx_t_3));
  __Pyx_GIVEREF(((PyObject *)__pyx_t_3));
  PyList_SET_ITEM(__pyx_t_7, 1, ((PyObject *)__pyx_t_2));
  __Pyx_GIVEREF(((PyObject *)__pyx_t_2));
  PyList_SET_ITEM(__pyx_t_7, 2, ((PyObject *)__pyx_t_6));
  __Pyx_GIVEREF(((PyObject *)__pyx_t_6));
  __pyx_t_3 = 0;
  __pyx_t_2 = 0;
  __pyx_t_6 = 0;
  __pyx_t_6 = PyTuple_New(1); if (unlikely(!__pyx_t_6)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 169; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(((PyObject *)__pyx_t_6));
  PyTuple_SET_ITEM(__pyx_t_6, 0, ((PyObject *)__pyx_t_7));
  __Pyx_GIVEREF(((PyObject *)__pyx_t_7));
  __pyx_t_7 = 0;
  __pyx_1 = PyDict_New(); if (unlikely(!__pyx_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 169; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(((PyObject *)__pyx_1));
  if (PyDict_SetItem(__pyx_1, __pyx_kp_dtype, __pyx_kp_57) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 169; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __pyx_t_7 = PyEval_CallObjectWithKeywords(__pyx_t_1, ((PyObject *)__pyx_t_6), ((PyObject *)__pyx_1)); if (unlikely(!__pyx_t_7)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 169; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_7);
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  __Pyx_DECREF(((PyObject *)__pyx_t_6)); __pyx_t_6 = 0;
  __Pyx_DECREF(((PyObject *)__pyx_1)); __pyx_1 = 0;
  __Pyx_DECREF(__pyx_v_diag);
  __pyx_v_diag = __pyx_t_7;
  __pyx_t_7 = 0;

  /* "/Users/sskory/Documents/yt-devel/yt/lagos/chainHOP/chainHOP.pyx":170
 *         base = na.array([xshift,yshift,zshift], dtype='int64')
 *         diag = na.array([[1,0,0], [0,1,0], [0,0,1]], dtype='int64')
 *         vectors.append(base)             # <<<<<<<<<<<<<<
 *         if count == 2:
 *             # find the zero element so we can skip it
 */
  __pyx_t_7 = __Pyx_PyObject_Append(__pyx_v_vectors, __pyx_v_base); if (unlikely(!__pyx_t_7)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 170; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_7);
  __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;

  /* "/Users/sskory/Documents/yt-devel/yt/lagos/chainHOP/chainHOP.pyx":171
 *         diag = na.array([[1,0,0], [0,1,0], [0,0,1]], dtype='int64')
 *         vectors.append(base)
 *         if count == 2:             # <<<<<<<<<<<<<<
 *             # find the zero element so we can skip it
 *             zero_e = na.argmax(na.abs(base) < 1)
 */
  __pyx_t_7 = PyObject_RichCompare(__pyx_v_count, __pyx_int_2, Py_EQ); if (unlikely(!__pyx_t_7)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 171; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_7);
  __pyx_t_5 = __Pyx_PyObject_IsTrue(__pyx_t_7); if (unlikely(__pyx_t_5 < 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 171; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
  if (__pyx_t_5) {

    /* "/Users/sskory/Documents/yt-devel/yt/lagos/chainHOP/chainHOP.pyx":173
 *         if count == 2:
 *             # find the zero element so we can skip it
 *             zero_e = na.argmax(na.abs(base) < 1)             # <<<<<<<<<<<<<<
 *             for i in xrange(3):
 *                 if i == zero_e: continue
 */
    __pyx_2 = __Pyx_GetName(__pyx_m, __pyx_kp_na); if (unlikely(!__pyx_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 173; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_2);
    __pyx_t_7 = PyObject_GetAttr(__pyx_2, __pyx_kp_argmax); if (unlikely(!__pyx_t_7)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 173; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_7);
    __Pyx_DECREF(__pyx_2); __pyx_2 = 0;
    __pyx_3 = __Pyx_GetName(__pyx_m, __pyx_kp_na); if (unlikely(!__pyx_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 173; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_3);
    __pyx_t_6 = PyObject_GetAttr(__pyx_3, __pyx_kp_abs); if (unlikely(!__pyx_t_6)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 173; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_6);
    __Pyx_DECREF(__pyx_3); __pyx_3 = 0;
    __pyx_t_1 = PyTuple_New(1); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 173; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(((PyObject *)__pyx_t_1));
    __Pyx_INCREF(__pyx_v_base);
    PyTuple_SET_ITEM(__pyx_t_1, 0, __pyx_v_base);
    __Pyx_GIVEREF(__pyx_v_base);
    __pyx_t_2 = PyObject_Call(__pyx_t_6, ((PyObject *)__pyx_t_1), NULL); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 173; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_2);
    __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
    __Pyx_DECREF(((PyObject *)__pyx_t_1)); __pyx_t_1 = 0;
    __pyx_t_1 = PyObject_RichCompare(__pyx_t_2, __pyx_int_1, Py_LT); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 173; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_1);
    __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
    __pyx_t_2 = PyTuple_New(1); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 173; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(((PyObject *)__pyx_t_2));
    PyTuple_SET_ITEM(__pyx_t_2, 0, __pyx_t_1);
    __Pyx_GIVEREF(__pyx_t_1);
    __pyx_t_1 = 0;
    __pyx_t_1 = PyObject_Call(__pyx_t_7, ((PyObject *)__pyx_t_2), NULL); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 173; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_1);
    __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
    __Pyx_DECREF(((PyObject *)__pyx_t_2)); __pyx_t_2 = 0;
    __Pyx_DECREF(__pyx_v_zero_e);
    __pyx_v_zero_e = __pyx_t_1;
    __pyx_t_1 = 0;

    /* "/Users/sskory/Documents/yt-devel/yt/lagos/chainHOP/chainHOP.pyx":174
 *             # find the zero element so we can skip it
 *             zero_e = na.argmax(na.abs(base) < 1)
 *             for i in xrange(3):             # <<<<<<<<<<<<<<
 *                 if i == zero_e: continue
 *                 vectors.append(diag[i] * base[i])
 */
    __pyx_t_1 = PyTuple_New(1); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 174; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(((PyObject *)__pyx_t_1));
    __Pyx_INCREF(__pyx_int_3);
    PyTuple_SET_ITEM(__pyx_t_1, 0, __pyx_int_3);
    __Pyx_GIVEREF(__pyx_int_3);
    __pyx_t_2 = PyObject_Call(__pyx_builtin_xrange, ((PyObject *)__pyx_t_1), NULL); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 174; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_2);
    __Pyx_DECREF(((PyObject *)__pyx_t_1)); __pyx_t_1 = 0;
    if (PyList_CheckExact(__pyx_t_2) || PyTuple_CheckExact(__pyx_t_2)) {
      __pyx_t_8 = 0; __pyx_t_1 = __pyx_t_2; __Pyx_INCREF(__pyx_t_1);
    } else {
      __pyx_t_8 = -1; __pyx_t_1 = PyObject_GetIter(__pyx_t_2); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 174; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_t_1);
    }
    __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
    for (;;) {
      if (likely(PyList_CheckExact(__pyx_t_1))) {
        if (__pyx_t_8 >= PyList_GET_SIZE(__pyx_t_1)) break;
        __pyx_t_2 = PyList_GET_ITEM(__pyx_t_1, __pyx_t_8); __Pyx_INCREF(__pyx_t_2); __pyx_t_8++;
      } else if (likely(PyTuple_CheckExact(__pyx_t_1))) {
        if (__pyx_t_8 >= PyTuple_GET_SIZE(__pyx_t_1)) break;
        __pyx_t_2 = PyTuple_GET_ITEM(__pyx_t_1, __pyx_t_8); __Pyx_INCREF(__pyx_t_2); __pyx_t_8++;
      } else {
        __pyx_t_2 = PyIter_Next(__pyx_t_1);
        if (!__pyx_t_2) {
          if (unlikely(PyErr_Occurred())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 174; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
          break;
        }
        __Pyx_GOTREF(__pyx_t_2);
      }
      __Pyx_DECREF(__pyx_v_i);
      __pyx_v_i = __pyx_t_2;
      __pyx_t_2 = 0;

      /* "/Users/sskory/Documents/yt-devel/yt/lagos/chainHOP/chainHOP.pyx":175
 *             zero_e = na.argmax(na.abs(base) < 1)
 *             for i in xrange(3):
 *                 if i == zero_e: continue             # <<<<<<<<<<<<<<
 *                 vectors.append(diag[i] * base[i])
 *         elif count == 3:
 */
      __pyx_t_2 = PyObject_RichCompare(__pyx_v_i, __pyx_v_zero_e, Py_EQ); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 175; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_t_2);
      __pyx_t_5 = __Pyx_PyObject_IsTrue(__pyx_t_2); if (unlikely(__pyx_t_5 < 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 175; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
      if (__pyx_t_5) {
        goto __pyx_L11_continue;
        goto __pyx_L13;
      }
      __pyx_L13:;

      /* "/Users/sskory/Documents/yt-devel/yt/lagos/chainHOP/chainHOP.pyx":176
 *             for i in xrange(3):
 *                 if i == zero_e: continue
 *                 vectors.append(diag[i] * base[i])             # <<<<<<<<<<<<<<
 *         elif count == 3:
 *             for i in xrange(3):
 */
      __pyx_1 = PyObject_GetItem(__pyx_v_diag, __pyx_v_i); if (!__pyx_1) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 176; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_1);
      __pyx_2 = PyObject_GetItem(__pyx_v_base, __pyx_v_i); if (!__pyx_2) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 176; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_2);
      __pyx_t_2 = PyNumber_Multiply(__pyx_1, __pyx_2); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 176; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_t_2);
      __Pyx_DECREF(__pyx_1); __pyx_1 = 0;
      __Pyx_DECREF(__pyx_2); __pyx_2 = 0;
      __pyx_t_7 = __Pyx_PyObject_Append(__pyx_v_vectors, __pyx_t_2); if (unlikely(!__pyx_t_7)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 176; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_t_7);
      __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
      __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
      __pyx_L11_continue:;
    }
    __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
    goto __pyx_L10;
  }

  /* "/Users/sskory/Documents/yt-devel/yt/lagos/chainHOP/chainHOP.pyx":177
 *                 if i == zero_e: continue
 *                 vectors.append(diag[i] * base[i])
 *         elif count == 3:             # <<<<<<<<<<<<<<
 *             for i in xrange(3):
 *                 # the singletons
 */
  __pyx_t_1 = PyObject_RichCompare(__pyx_v_count, __pyx_int_3, Py_EQ); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 177; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_t_5 = __Pyx_PyObject_IsTrue(__pyx_t_1); if (unlikely(__pyx_t_5 < 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 177; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  if (__pyx_t_5) {

    /* "/Users/sskory/Documents/yt-devel/yt/lagos/chainHOP/chainHOP.pyx":178
 *                 vectors.append(diag[i] * base[i])
 *         elif count == 3:
 *             for i in xrange(3):             # <<<<<<<<<<<<<<
 *                 # the singletons
 *                 vectors.append(diag[i] * base[i])
 */
    __pyx_t_1 = PyTuple_New(1); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 178; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(((PyObject *)__pyx_t_1));
    __Pyx_INCREF(__pyx_int_3);
    PyTuple_SET_ITEM(__pyx_t_1, 0, __pyx_int_3);
    __Pyx_GIVEREF(__pyx_int_3);
    __pyx_t_7 = PyObject_Call(__pyx_builtin_xrange, ((PyObject *)__pyx_t_1), NULL); if (unlikely(!__pyx_t_7)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 178; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_7);
    __Pyx_DECREF(((PyObject *)__pyx_t_1)); __pyx_t_1 = 0;
    if (PyList_CheckExact(__pyx_t_7) || PyTuple_CheckExact(__pyx_t_7)) {
      __pyx_t_8 = 0; __pyx_t_1 = __pyx_t_7; __Pyx_INCREF(__pyx_t_1);
    } else {
      __pyx_t_8 = -1; __pyx_t_1 = PyObject_GetIter(__pyx_t_7); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 178; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_t_1);
    }
    __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
    for (;;) {
      if (likely(PyList_CheckExact(__pyx_t_1))) {
        if (__pyx_t_8 >= PyList_GET_SIZE(__pyx_t_1)) break;
        __pyx_t_7 = PyList_GET_ITEM(__pyx_t_1, __pyx_t_8); __Pyx_INCREF(__pyx_t_7); __pyx_t_8++;
      } else if (likely(PyTuple_CheckExact(__pyx_t_1))) {
        if (__pyx_t_8 >= PyTuple_GET_SIZE(__pyx_t_1)) break;
        __pyx_t_7 = PyTuple_GET_ITEM(__pyx_t_1, __pyx_t_8); __Pyx_INCREF(__pyx_t_7); __pyx_t_8++;
      } else {
        __pyx_t_7 = PyIter_Next(__pyx_t_1);
        if (!__pyx_t_7) {
          if (unlikely(PyErr_Occurred())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 178; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
          break;
        }
        __Pyx_GOTREF(__pyx_t_7);
      }
      __Pyx_DECREF(__pyx_v_i);
      __pyx_v_i = __pyx_t_7;
      __pyx_t_7 = 0;

      /* "/Users/sskory/Documents/yt-devel/yt/lagos/chainHOP/chainHOP.pyx":180
 *             for i in xrange(3):
 *                 # the singletons
 *                 vectors.append(diag[i] * base[i])             # <<<<<<<<<<<<<<
 *                 for j in xrange(3):
 *                     # the doubles, the triple is already added, it's 'base'
 */
      __pyx_3 = PyObject_GetItem(__pyx_v_diag, __pyx_v_i); if (!__pyx_3) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 180; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_3);
      __pyx_1 = PyObject_GetItem(__pyx_v_base, __pyx_v_i); if (!__pyx_1) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 180; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_1);
      __pyx_t_7 = PyNumber_Multiply(__pyx_3, __pyx_1); if (unlikely(!__pyx_t_7)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 180; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_t_7);
      __Pyx_DECREF(__pyx_3); __pyx_3 = 0;
      __Pyx_DECREF(__pyx_1); __pyx_1 = 0;
      __pyx_t_2 = __Pyx_PyObject_Append(__pyx_v_vectors, __pyx_t_7); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 180; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_t_2);
      __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
      __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;

      /* "/Users/sskory/Documents/yt-devel/yt/lagos/chainHOP/chainHOP.pyx":181
 *                 # the singletons
 *                 vectors.append(diag[i] * base[i])
 *                 for j in xrange(3):             # <<<<<<<<<<<<<<
 *                     # the doubles, the triple is already added, it's 'base'
 *                     if i == j: continue
 */
      __pyx_t_2 = PyTuple_New(1); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 181; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(((PyObject *)__pyx_t_2));
      __Pyx_INCREF(__pyx_int_3);
      PyTuple_SET_ITEM(__pyx_t_2, 0, __pyx_int_3);
      __Pyx_GIVEREF(__pyx_int_3);
      __pyx_t_7 = PyObject_Call(__pyx_builtin_xrange, ((PyObject *)__pyx_t_2), NULL); if (unlikely(!__pyx_t_7)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 181; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_t_7);
      __Pyx_DECREF(((PyObject *)__pyx_t_2)); __pyx_t_2 = 0;
      if (PyList_CheckExact(__pyx_t_7) || PyTuple_CheckExact(__pyx_t_7)) {
        __pyx_t_9 = 0; __pyx_t_2 = __pyx_t_7; __Pyx_INCREF(__pyx_t_2);
      } else {
        __pyx_t_9 = -1; __pyx_t_2 = PyObject_GetIter(__pyx_t_7); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 181; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        __Pyx_GOTREF(__pyx_t_2);
      }
      __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
      for (;;) {
        if (likely(PyList_CheckExact(__pyx_t_2))) {
          if (__pyx_t_9 >= PyList_GET_SIZE(__pyx_t_2)) break;
          __pyx_t_7 = PyList_GET_ITEM(__pyx_t_2, __pyx_t_9); __Pyx_INCREF(__pyx_t_7); __pyx_t_9++;
        } else if (likely(PyTuple_CheckExact(__pyx_t_2))) {
          if (__pyx_t_9 >= PyTuple_GET_SIZE(__pyx_t_2)) break;
          __pyx_t_7 = PyTuple_GET_ITEM(__pyx_t_2, __pyx_t_9); __Pyx_INCREF(__pyx_t_7); __pyx_t_9++;
        } else {
          __pyx_t_7 = PyIter_Next(__pyx_t_2);
          if (!__pyx_t_7) {
            if (unlikely(PyErr_Occurred())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 181; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
            break;
          }
          __Pyx_GOTREF(__pyx_t_7);
        }
        __Pyx_DECREF(__pyx_v_j);
        __pyx_v_j = __pyx_t_7;
        __pyx_t_7 = 0;

        /* "/Users/sskory/Documents/yt-devel/yt/lagos/chainHOP/chainHOP.pyx":183
 *                 for j in xrange(3):
 *                     # the doubles, the triple is already added, it's 'base'
 *                     if i == j: continue             # <<<<<<<<<<<<<<
 *                     vectors.append( (diag[i] * base[i]) + (diag[j] * base[j]))
 *         return vectors
 */
        __pyx_t_7 = PyObject_RichCompare(__pyx_v_i, __pyx_v_j, Py_EQ); if (unlikely(!__pyx_t_7)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 183; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        __Pyx_GOTREF(__pyx_t_7);
        __pyx_t_5 = __Pyx_PyObject_IsTrue(__pyx_t_7); if (unlikely(__pyx_t_5 < 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 183; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
        if (__pyx_t_5) {
          goto __pyx_L16_continue;
          goto __pyx_L18;
        }
        __pyx_L18:;

        /* "/Users/sskory/Documents/yt-devel/yt/lagos/chainHOP/chainHOP.pyx":184
 *                     # the doubles, the triple is already added, it's 'base'
 *                     if i == j: continue
 *                     vectors.append( (diag[i] * base[i]) + (diag[j] * base[j]))             # <<<<<<<<<<<<<<
 *         return vectors
 * 
 */
        __pyx_2 = PyObject_GetItem(__pyx_v_diag, __pyx_v_i); if (!__pyx_2) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 184; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        __Pyx_GOTREF(__pyx_2);
        __pyx_3 = PyObject_GetItem(__pyx_v_base, __pyx_v_i); if (!__pyx_3) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 184; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        __Pyx_GOTREF(__pyx_3);
        __pyx_t_7 = PyNumber_Multiply(__pyx_2, __pyx_3); if (unlikely(!__pyx_t_7)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 184; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        __Pyx_GOTREF(__pyx_t_7);
        __Pyx_DECREF(__pyx_2); __pyx_2 = 0;
        __Pyx_DECREF(__pyx_3); __pyx_3 = 0;
        __pyx_1 = PyObject_GetItem(__pyx_v_diag, __pyx_v_j); if (!__pyx_1) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 184; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        __Pyx_GOTREF(__pyx_1);
        __pyx_2 = PyObject_GetItem(__pyx_v_base, __pyx_v_j); if (!__pyx_2) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 184; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        __Pyx_GOTREF(__pyx_2);
        __pyx_t_6 = PyNumber_Multiply(__pyx_1, __pyx_2); if (unlikely(!__pyx_t_6)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 184; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        __Pyx_GOTREF(__pyx_t_6);
        __Pyx_DECREF(__pyx_1); __pyx_1 = 0;
        __Pyx_DECREF(__pyx_2); __pyx_2 = 0;
        __pyx_t_3 = PyNumber_Add(__pyx_t_7, __pyx_t_6); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 184; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        __Pyx_GOTREF(__pyx_t_3);
        __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
        __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
        __pyx_t_6 = __Pyx_PyObject_Append(__pyx_v_vectors, __pyx_t_3); if (unlikely(!__pyx_t_6)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 184; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        __Pyx_GOTREF(__pyx_t_6);
        __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
        __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
        __pyx_L16_continue:;
      }
      __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
    }
    __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
    goto __pyx_L10;
  }
  __pyx_L10:;

  /* "/Users/sskory/Documents/yt-devel/yt/lagos/chainHOP/chainHOP.pyx":185
 *                     if i == j: continue
 *                     vectors.append( (diag[i] * base[i]) + (diag[j] * base[j]))
 *         return vectors             # <<<<<<<<<<<<<<
 * 
 * 
 */
  __Pyx_XDECREF(__pyx_r);
  __Pyx_INCREF(__pyx_v_vectors);
  __pyx_r = __pyx_v_vectors;
  goto __pyx_L0;

  __pyx_r = Py_None; __Pyx_INCREF(Py_None);
  goto __pyx_L0;
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_1);
  __Pyx_XDECREF(__pyx_2);
  __Pyx_XDECREF(__pyx_3);
  __Pyx_XDECREF(__pyx_t_1);
  __Pyx_XDECREF(__pyx_t_2);
  __Pyx_XDECREF(__pyx_t_3);
  __Pyx_XDECREF(__pyx_t_6);
  __Pyx_XDECREF(__pyx_t_7);
  __Pyx_AddTraceback("yt.lagos.chainHOP.chainHOP.RunChainHOP._find_shift_real");
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_DECREF(__pyx_v_LE);
  __Pyx_DECREF(__pyx_v_RE);
  __Pyx_DECREF(__pyx_v_xshift);
  __Pyx_DECREF(__pyx_v_yshift);
  __Pyx_DECREF(__pyx_v_zshift);
  __Pyx_DECREF(__pyx_v_count);
  __Pyx_DECREF(__pyx_v_vectors);
  __Pyx_DECREF(__pyx_v_base);
  __Pyx_DECREF(__pyx_v_diag);
  __Pyx_DECREF(__pyx_v_zero_e);
  __Pyx_DECREF(__pyx_v_j);
  __Pyx_DECREF(__pyx_v_i);
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_FinishRefcountContext();
  return __pyx_r;
}

/* "/Users/sskory/Documents/yt-devel/yt/lagos/chainHOP/chainHOP.pyx":188
 * 
 * 
 *     def _translate_shift(object self, i=None, shift=None):             # <<<<<<<<<<<<<<
 *         """
 *         Given an integer, return the corresponding shift, and given a shift
 */

static PyObject *__pyx_pf_2yt_5lagos_8chainHOP_8chainHOP_11RunChainHOP__translate_shift(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static char __pyx_doc_2yt_5lagos_8chainHOP_8chainHOP_11RunChainHOP__translate_shift[] = "\n        Given an integer, return the corresponding shift, and given a shift\n        return the integer. There may be a better way to do this.\n        ";
static PyMethodDef __pyx_mdef_2yt_5lagos_8chainHOP_8chainHOP_11RunChainHOP__translate_shift = {__Pyx_NAMESTR("_translate_shift"), (PyCFunction)__pyx_pf_2yt_5lagos_8chainHOP_8chainHOP_11RunChainHOP__translate_shift, METH_VARARGS|METH_KEYWORDS, __Pyx_DOCSTR(__pyx_doc_2yt_5lagos_8chainHOP_8chainHOP_11RunChainHOP__translate_shift)};
static PyObject *__pyx_pf_2yt_5lagos_8chainHOP_8chainHOP_11RunChainHOP__translate_shift(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  PyObject *__pyx_v_self = 0;
  PyObject *__pyx_v_i = 0;
  PyObject *__pyx_v_shift = 0;
  PyObject *__pyx_v_d;
  PyObject *__pyx_v_key;
  PyObject *__pyx_r = NULL;
  PyObject *__pyx_1 = 0;
  PyObject *__pyx_t_1 = NULL;
  int __pyx_t_2;
  Py_ssize_t __pyx_t_3;
  PyObject *__pyx_t_4 = NULL;
  PyObject *__pyx_t_5 = NULL;
  PyObject *__pyx_t_6 = NULL;
  int __pyx_t_7;
  int __pyx_t_8;
  static PyObject **__pyx_pyargnames[] = {&__pyx_kp_self,&__pyx_kp_i,&__pyx_kp_shift,0};
  __Pyx_SetupRefcountContext("_translate_shift");
  __pyx_self = __pyx_self;
  if (unlikely(__pyx_kwds)) {
    Py_ssize_t kw_args = PyDict_Size(__pyx_kwds);
    PyObject* values[3] = {0,0,0};
    values[1] = Py_None;
    values[2] = Py_None;
    switch (PyTuple_GET_SIZE(__pyx_args)) {
      case  3: values[2] = PyTuple_GET_ITEM(__pyx_args, 2);
      case  2: values[1] = PyTuple_GET_ITEM(__pyx_args, 1);
      case  1: values[0] = PyTuple_GET_ITEM(__pyx_args, 0);
      case  0: break;
      default: goto __pyx_L5_argtuple_error;
    }
    switch (PyTuple_GET_SIZE(__pyx_args)) {
      case  0:
      values[0] = PyDict_GetItem(__pyx_kwds, __pyx_kp_self);
      if (likely(values[0])) kw_args--;
      else goto __pyx_L5_argtuple_error;
      case  1:
      if (kw_args > 0) {
        PyObject* value = PyDict_GetItem(__pyx_kwds, __pyx_kp_i);
        if (unlikely(value)) { values[1] = value; kw_args--; }
      }
      case  2:
      if (kw_args > 0) {
        PyObject* value = PyDict_GetItem(__pyx_kwds, __pyx_kp_shift);
        if (unlikely(value)) { values[2] = value; kw_args--; }
      }
    }
    if (unlikely(kw_args > 0)) {
      if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, PyTuple_GET_SIZE(__pyx_args), "_translate_shift") < 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 188; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
    }
    __pyx_v_self = values[0];
    __pyx_v_i = values[1];
    __pyx_v_shift = values[2];
  } else {
    __pyx_v_i = Py_None;
    __pyx_v_shift = Py_None;
    switch (PyTuple_GET_SIZE(__pyx_args)) {
      case  3: __pyx_v_shift = PyTuple_GET_ITEM(__pyx_args, 2);
      case  2: __pyx_v_i = PyTuple_GET_ITEM(__pyx_args, 1);
      case  1: __pyx_v_self = PyTuple_GET_ITEM(__pyx_args, 0);
      break;
      default: goto __pyx_L5_argtuple_error;
    }
  }
  goto __pyx_L4_argument_unpacking_done;
  __pyx_L5_argtuple_error:;
  __Pyx_RaiseArgtupleInvalid("_translate_shift", 0, 1, 3, PyTuple_GET_SIZE(__pyx_args)); {__pyx_filename = __pyx_f[0]; __pyx_lineno = 188; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
  __pyx_L3_error:;
  __Pyx_AddTraceback("yt.lagos.chainHOP.chainHOP.RunChainHOP._translate_shift");
  return NULL;
  __pyx_L4_argument_unpacking_done:;
  __Pyx_INCREF(__pyx_v_shift);
  __pyx_v_d = Py_None; __Pyx_INCREF(Py_None);
  __pyx_v_key = Py_None; __Pyx_INCREF(Py_None);

  /* "/Users/sskory/Documents/yt-devel/yt/lagos/chainHOP/chainHOP.pyx":193
 *         return the integer. There may be a better way to do this.
 *         """
 *         if self.d is None:             # <<<<<<<<<<<<<<
 *             d = {0:[-1,-1,-1], 1:[-1,-1,0], 2:[-1,-1,1], 3:[-1,0,-1], 4:[-1,0,0],
 *                 5:[-1,0,1], 6:[-1,1,-1], 7:[-1,1,0], 8:[-1,1,1,], 9:[0,-1,-1],
 */
  __pyx_t_1 = PyObject_GetAttr(__pyx_v_self, __pyx_kp_d); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 193; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_t_2 = (__pyx_t_1 == Py_None);
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  if (__pyx_t_2) {

    /* "/Users/sskory/Documents/yt-devel/yt/lagos/chainHOP/chainHOP.pyx":194
 *         """
 *         if self.d is None:
 *             d = {0:[-1,-1,-1], 1:[-1,-1,0], 2:[-1,-1,1], 3:[-1,0,-1], 4:[-1,0,0],             # <<<<<<<<<<<<<<
 *                 5:[-1,0,1], 6:[-1,1,-1], 7:[-1,1,0], 8:[-1,1,1,], 9:[0,-1,-1],
 *                 10:[0,-1,0], 11:[0,-1,1], 12:[0,0,-1], 13:[0,0,0], 14:[0,0,1],
 */
    __pyx_1 = PyDict_New(); if (unlikely(!__pyx_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 194; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(((PyObject *)__pyx_1));
    __pyx_t_1 = PyList_New(3); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 194; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(((PyObject *)__pyx_t_1));
    __Pyx_INCREF(__pyx_int_neg_1);
    PyList_SET_ITEM(__pyx_t_1, 0, __pyx_int_neg_1);
    __Pyx_GIVEREF(__pyx_int_neg_1);
    __Pyx_INCREF(__pyx_int_neg_1);
    PyList_SET_ITEM(__pyx_t_1, 1, __pyx_int_neg_1);
    __Pyx_GIVEREF(__pyx_int_neg_1);
    __Pyx_INCREF(__pyx_int_neg_1);
    PyList_SET_ITEM(__pyx_t_1, 2, __pyx_int_neg_1);
    __Pyx_GIVEREF(__pyx_int_neg_1);
    if (PyDict_SetItem(__pyx_1, __pyx_int_0, ((PyObject *)__pyx_t_1)) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 194; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_DECREF(((PyObject *)__pyx_t_1)); __pyx_t_1 = 0;
    __pyx_t_1 = PyList_New(3); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 194; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(((PyObject *)__pyx_t_1));
    __Pyx_INCREF(__pyx_int_neg_1);
    PyList_SET_ITEM(__pyx_t_1, 0, __pyx_int_neg_1);
    __Pyx_GIVEREF(__pyx_int_neg_1);
    __Pyx_INCREF(__pyx_int_neg_1);
    PyList_SET_ITEM(__pyx_t_1, 1, __pyx_int_neg_1);
    __Pyx_GIVEREF(__pyx_int_neg_1);
    __Pyx_INCREF(__pyx_int_0);
    PyList_SET_ITEM(__pyx_t_1, 2, __pyx_int_0);
    __Pyx_GIVEREF(__pyx_int_0);
    if (PyDict_SetItem(__pyx_1, __pyx_int_1, ((PyObject *)__pyx_t_1)) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 194; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_DECREF(((PyObject *)__pyx_t_1)); __pyx_t_1 = 0;
    __pyx_t_1 = PyList_New(3); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 194; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(((PyObject *)__pyx_t_1));
    __Pyx_INCREF(__pyx_int_neg_1);
    PyList_SET_ITEM(__pyx_t_1, 0, __pyx_int_neg_1);
    __Pyx_GIVEREF(__pyx_int_neg_1);
    __Pyx_INCREF(__pyx_int_neg_1);
    PyList_SET_ITEM(__pyx_t_1, 1, __pyx_int_neg_1);
    __Pyx_GIVEREF(__pyx_int_neg_1);
    __Pyx_INCREF(__pyx_int_1);
    PyList_SET_ITEM(__pyx_t_1, 2, __pyx_int_1);
    __Pyx_GIVEREF(__pyx_int_1);
    if (PyDict_SetItem(__pyx_1, __pyx_int_2, ((PyObject *)__pyx_t_1)) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 194; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_DECREF(((PyObject *)__pyx_t_1)); __pyx_t_1 = 0;
    __pyx_t_1 = PyList_New(3); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 194; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(((PyObject *)__pyx_t_1));
    __Pyx_INCREF(__pyx_int_neg_1);
    PyList_SET_ITEM(__pyx_t_1, 0, __pyx_int_neg_1);
    __Pyx_GIVEREF(__pyx_int_neg_1);
    __Pyx_INCREF(__pyx_int_0);
    PyList_SET_ITEM(__pyx_t_1, 1, __pyx_int_0);
    __Pyx_GIVEREF(__pyx_int_0);
    __Pyx_INCREF(__pyx_int_neg_1);
    PyList_SET_ITEM(__pyx_t_1, 2, __pyx_int_neg_1);
    __Pyx_GIVEREF(__pyx_int_neg_1);
    if (PyDict_SetItem(__pyx_1, __pyx_int_3, ((PyObject *)__pyx_t_1)) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 194; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_DECREF(((PyObject *)__pyx_t_1)); __pyx_t_1 = 0;
    __pyx_t_1 = PyList_New(3); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 194; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(((PyObject *)__pyx_t_1));
    __Pyx_INCREF(__pyx_int_neg_1);
    PyList_SET_ITEM(__pyx_t_1, 0, __pyx_int_neg_1);
    __Pyx_GIVEREF(__pyx_int_neg_1);
    __Pyx_INCREF(__pyx_int_0);
    PyList_SET_ITEM(__pyx_t_1, 1, __pyx_int_0);
    __Pyx_GIVEREF(__pyx_int_0);
    __Pyx_INCREF(__pyx_int_0);
    PyList_SET_ITEM(__pyx_t_1, 2, __pyx_int_0);
    __Pyx_GIVEREF(__pyx_int_0);
    if (PyDict_SetItem(__pyx_1, __pyx_int_4, ((PyObject *)__pyx_t_1)) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 194; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_DECREF(((PyObject *)__pyx_t_1)); __pyx_t_1 = 0;

    /* "/Users/sskory/Documents/yt-devel/yt/lagos/chainHOP/chainHOP.pyx":195
 *         if self.d is None:
 *             d = {0:[-1,-1,-1], 1:[-1,-1,0], 2:[-1,-1,1], 3:[-1,0,-1], 4:[-1,0,0],
 *                 5:[-1,0,1], 6:[-1,1,-1], 7:[-1,1,0], 8:[-1,1,1,], 9:[0,-1,-1],             # <<<<<<<<<<<<<<
 *                 10:[0,-1,0], 11:[0,-1,1], 12:[0,0,-1], 13:[0,0,0], 14:[0,0,1],
 *                 15:[0,1,-1], 16:[0,1,0], 17:[0,1,1], 18:[1,-1,-1], 19:[1,-1,0],
 */
    __pyx_t_1 = PyList_New(3); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 195; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(((PyObject *)__pyx_t_1));
    __Pyx_INCREF(__pyx_int_neg_1);
    PyList_SET_ITEM(__pyx_t_1, 0, __pyx_int_neg_1);
    __Pyx_GIVEREF(__pyx_int_neg_1);
    __Pyx_INCREF(__pyx_int_0);
    PyList_SET_ITEM(__pyx_t_1, 1, __pyx_int_0);
    __Pyx_GIVEREF(__pyx_int_0);
    __Pyx_INCREF(__pyx_int_1);
    PyList_SET_ITEM(__pyx_t_1, 2, __pyx_int_1);
    __Pyx_GIVEREF(__pyx_int_1);
    if (PyDict_SetItem(__pyx_1, __pyx_int_5, ((PyObject *)__pyx_t_1)) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 194; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_DECREF(((PyObject *)__pyx_t_1)); __pyx_t_1 = 0;
    __pyx_t_1 = PyList_New(3); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 195; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(((PyObject *)__pyx_t_1));
    __Pyx_INCREF(__pyx_int_neg_1);
    PyList_SET_ITEM(__pyx_t_1, 0, __pyx_int_neg_1);
    __Pyx_GIVEREF(__pyx_int_neg_1);
    __Pyx_INCREF(__pyx_int_1);
    PyList_SET_ITEM(__pyx_t_1, 1, __pyx_int_1);
    __Pyx_GIVEREF(__pyx_int_1);
    __Pyx_INCREF(__pyx_int_neg_1);
    PyList_SET_ITEM(__pyx_t_1, 2, __pyx_int_neg_1);
    __Pyx_GIVEREF(__pyx_int_neg_1);
    if (PyDict_SetItem(__pyx_1, __pyx_int_6, ((PyObject *)__pyx_t_1)) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 194; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_DECREF(((PyObject *)__pyx_t_1)); __pyx_t_1 = 0;
    __pyx_t_1 = PyList_New(3); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 195; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(((PyObject *)__pyx_t_1));
    __Pyx_INCREF(__pyx_int_neg_1);
    PyList_SET_ITEM(__pyx_t_1, 0, __pyx_int_neg_1);
    __Pyx_GIVEREF(__pyx_int_neg_1);
    __Pyx_INCREF(__pyx_int_1);
    PyList_SET_ITEM(__pyx_t_1, 1, __pyx_int_1);
    __Pyx_GIVEREF(__pyx_int_1);
    __Pyx_INCREF(__pyx_int_0);
    PyList_SET_ITEM(__pyx_t_1, 2, __pyx_int_0);
    __Pyx_GIVEREF(__pyx_int_0);
    if (PyDict_SetItem(__pyx_1, __pyx_int_7, ((PyObject *)__pyx_t_1)) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 194; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_DECREF(((PyObject *)__pyx_t_1)); __pyx_t_1 = 0;
    __pyx_t_1 = PyList_New(3); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 195; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(((PyObject *)__pyx_t_1));
    __Pyx_INCREF(__pyx_int_neg_1);
    PyList_SET_ITEM(__pyx_t_1, 0, __pyx_int_neg_1);
    __Pyx_GIVEREF(__pyx_int_neg_1);
    __Pyx_INCREF(__pyx_int_1);
    PyList_SET_ITEM(__pyx_t_1, 1, __pyx_int_1);
    __Pyx_GIVEREF(__pyx_int_1);
    __Pyx_INCREF(__pyx_int_1);
    PyList_SET_ITEM(__pyx_t_1, 2, __pyx_int_1);
    __Pyx_GIVEREF(__pyx_int_1);
    if (PyDict_SetItem(__pyx_1, __pyx_int_8, ((PyObject *)__pyx_t_1)) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 194; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_DECREF(((PyObject *)__pyx_t_1)); __pyx_t_1 = 0;
    __pyx_t_1 = PyList_New(3); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 195; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(((PyObject *)__pyx_t_1));
    __Pyx_INCREF(__pyx_int_0);
    PyList_SET_ITEM(__pyx_t_1, 0, __pyx_int_0);
    __Pyx_GIVEREF(__pyx_int_0);
    __Pyx_INCREF(__pyx_int_neg_1);
    PyList_SET_ITEM(__pyx_t_1, 1, __pyx_int_neg_1);
    __Pyx_GIVEREF(__pyx_int_neg_1);
    __Pyx_INCREF(__pyx_int_neg_1);
    PyList_SET_ITEM(__pyx_t_1, 2, __pyx_int_neg_1);
    __Pyx_GIVEREF(__pyx_int_neg_1);
    if (PyDict_SetItem(__pyx_1, __pyx_int_9, ((PyObject *)__pyx_t_1)) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 194; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_DECREF(((PyObject *)__pyx_t_1)); __pyx_t_1 = 0;

    /* "/Users/sskory/Documents/yt-devel/yt/lagos/chainHOP/chainHOP.pyx":196
 *             d = {0:[-1,-1,-1], 1:[-1,-1,0], 2:[-1,-1,1], 3:[-1,0,-1], 4:[-1,0,0],
 *                 5:[-1,0,1], 6:[-1,1,-1], 7:[-1,1,0], 8:[-1,1,1,], 9:[0,-1,-1],
 *                 10:[0,-1,0], 11:[0,-1,1], 12:[0,0,-1], 13:[0,0,0], 14:[0,0,1],             # <<<<<<<<<<<<<<
 *                 15:[0,1,-1], 16:[0,1,0], 17:[0,1,1], 18:[1,-1,-1], 19:[1,-1,0],
 *                 20:[1,-1,1], 21:[1,0,-1], 22:[1,0,0], 23:[1,0,1], 24:[1,1,-1],
 */
    __pyx_t_1 = PyList_New(3); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 196; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(((PyObject *)__pyx_t_1));
    __Pyx_INCREF(__pyx_int_0);
    PyList_SET_ITEM(__pyx_t_1, 0, __pyx_int_0);
    __Pyx_GIVEREF(__pyx_int_0);
    __Pyx_INCREF(__pyx_int_neg_1);
    PyList_SET_ITEM(__pyx_t_1, 1, __pyx_int_neg_1);
    __Pyx_GIVEREF(__pyx_int_neg_1);
    __Pyx_INCREF(__pyx_int_0);
    PyList_SET_ITEM(__pyx_t_1, 2, __pyx_int_0);
    __Pyx_GIVEREF(__pyx_int_0);
    if (PyDict_SetItem(__pyx_1, __pyx_int_10, ((PyObject *)__pyx_t_1)) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 194; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_DECREF(((PyObject *)__pyx_t_1)); __pyx_t_1 = 0;
    __pyx_t_1 = PyList_New(3); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 196; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(((PyObject *)__pyx_t_1));
    __Pyx_INCREF(__pyx_int_0);
    PyList_SET_ITEM(__pyx_t_1, 0, __pyx_int_0);
    __Pyx_GIVEREF(__pyx_int_0);
    __Pyx_INCREF(__pyx_int_neg_1);
    PyList_SET_ITEM(__pyx_t_1, 1, __pyx_int_neg_1);
    __Pyx_GIVEREF(__pyx_int_neg_1);
    __Pyx_INCREF(__pyx_int_1);
    PyList_SET_ITEM(__pyx_t_1, 2, __pyx_int_1);
    __Pyx_GIVEREF(__pyx_int_1);
    if (PyDict_SetItem(__pyx_1, __pyx_int_11, ((PyObject *)__pyx_t_1)) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 194; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_DECREF(((PyObject *)__pyx_t_1)); __pyx_t_1 = 0;
    __pyx_t_1 = PyList_New(3); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 196; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(((PyObject *)__pyx_t_1));
    __Pyx_INCREF(__pyx_int_0);
    PyList_SET_ITEM(__pyx_t_1, 0, __pyx_int_0);
    __Pyx_GIVEREF(__pyx_int_0);
    __Pyx_INCREF(__pyx_int_0);
    PyList_SET_ITEM(__pyx_t_1, 1, __pyx_int_0);
    __Pyx_GIVEREF(__pyx_int_0);
    __Pyx_INCREF(__pyx_int_neg_1);
    PyList_SET_ITEM(__pyx_t_1, 2, __pyx_int_neg_1);
    __Pyx_GIVEREF(__pyx_int_neg_1);
    if (PyDict_SetItem(__pyx_1, __pyx_int_12, ((PyObject *)__pyx_t_1)) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 194; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_DECREF(((PyObject *)__pyx_t_1)); __pyx_t_1 = 0;
    __pyx_t_1 = PyList_New(3); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 196; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(((PyObject *)__pyx_t_1));
    __Pyx_INCREF(__pyx_int_0);
    PyList_SET_ITEM(__pyx_t_1, 0, __pyx_int_0);
    __Pyx_GIVEREF(__pyx_int_0);
    __Pyx_INCREF(__pyx_int_0);
    PyList_SET_ITEM(__pyx_t_1, 1, __pyx_int_0);
    __Pyx_GIVEREF(__pyx_int_0);
    __Pyx_INCREF(__pyx_int_0);
    PyList_SET_ITEM(__pyx_t_1, 2, __pyx_int_0);
    __Pyx_GIVEREF(__pyx_int_0);
    if (PyDict_SetItem(__pyx_1, __pyx_int_13, ((PyObject *)__pyx_t_1)) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 194; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_DECREF(((PyObject *)__pyx_t_1)); __pyx_t_1 = 0;
    __pyx_t_1 = PyList_New(3); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 196; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(((PyObject *)__pyx_t_1));
    __Pyx_INCREF(__pyx_int_0);
    PyList_SET_ITEM(__pyx_t_1, 0, __pyx_int_0);
    __Pyx_GIVEREF(__pyx_int_0);
    __Pyx_INCREF(__pyx_int_0);
    PyList_SET_ITEM(__pyx_t_1, 1, __pyx_int_0);
    __Pyx_GIVEREF(__pyx_int_0);
    __Pyx_INCREF(__pyx_int_1);
    PyList_SET_ITEM(__pyx_t_1, 2, __pyx_int_1);
    __Pyx_GIVEREF(__pyx_int_1);
    if (PyDict_SetItem(__pyx_1, __pyx_int_14, ((PyObject *)__pyx_t_1)) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 194; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_DECREF(((PyObject *)__pyx_t_1)); __pyx_t_1 = 0;

    /* "/Users/sskory/Documents/yt-devel/yt/lagos/chainHOP/chainHOP.pyx":197
 *                 5:[-1,0,1], 6:[-1,1,-1], 7:[-1,1,0], 8:[-1,1,1,], 9:[0,-1,-1],
 *                 10:[0,-1,0], 11:[0,-1,1], 12:[0,0,-1], 13:[0,0,0], 14:[0,0,1],
 *                 15:[0,1,-1], 16:[0,1,0], 17:[0,1,1], 18:[1,-1,-1], 19:[1,-1,0],             # <<<<<<<<<<<<<<
 *                 20:[1,-1,1], 21:[1,0,-1], 22:[1,0,0], 23:[1,0,1], 24:[1,1,-1],
 *                 25:[1,1,0], 26:[1,1,1]}
 */
    __pyx_t_1 = PyList_New(3); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 197; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(((PyObject *)__pyx_t_1));
    __Pyx_INCREF(__pyx_int_0);
    PyList_SET_ITEM(__pyx_t_1, 0, __pyx_int_0);
    __Pyx_GIVEREF(__pyx_int_0);
    __Pyx_INCREF(__pyx_int_1);
    PyList_SET_ITEM(__pyx_t_1, 1, __pyx_int_1);
    __Pyx_GIVEREF(__pyx_int_1);
    __Pyx_INCREF(__pyx_int_neg_1);
    PyList_SET_ITEM(__pyx_t_1, 2, __pyx_int_neg_1);
    __Pyx_GIVEREF(__pyx_int_neg_1);
    if (PyDict_SetItem(__pyx_1, __pyx_int_15, ((PyObject *)__pyx_t_1)) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 194; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_DECREF(((PyObject *)__pyx_t_1)); __pyx_t_1 = 0;
    __pyx_t_1 = PyList_New(3); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 197; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(((PyObject *)__pyx_t_1));
    __Pyx_INCREF(__pyx_int_0);
    PyList_SET_ITEM(__pyx_t_1, 0, __pyx_int_0);
    __Pyx_GIVEREF(__pyx_int_0);
    __Pyx_INCREF(__pyx_int_1);
    PyList_SET_ITEM(__pyx_t_1, 1, __pyx_int_1);
    __Pyx_GIVEREF(__pyx_int_1);
    __Pyx_INCREF(__pyx_int_0);
    PyList_SET_ITEM(__pyx_t_1, 2, __pyx_int_0);
    __Pyx_GIVEREF(__pyx_int_0);
    if (PyDict_SetItem(__pyx_1, __pyx_int_16, ((PyObject *)__pyx_t_1)) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 194; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_DECREF(((PyObject *)__pyx_t_1)); __pyx_t_1 = 0;
    __pyx_t_1 = PyList_New(3); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 197; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(((PyObject *)__pyx_t_1));
    __Pyx_INCREF(__pyx_int_0);
    PyList_SET_ITEM(__pyx_t_1, 0, __pyx_int_0);
    __Pyx_GIVEREF(__pyx_int_0);
    __Pyx_INCREF(__pyx_int_1);
    PyList_SET_ITEM(__pyx_t_1, 1, __pyx_int_1);
    __Pyx_GIVEREF(__pyx_int_1);
    __Pyx_INCREF(__pyx_int_1);
    PyList_SET_ITEM(__pyx_t_1, 2, __pyx_int_1);
    __Pyx_GIVEREF(__pyx_int_1);
    if (PyDict_SetItem(__pyx_1, __pyx_int_17, ((PyObject *)__pyx_t_1)) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 194; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_DECREF(((PyObject *)__pyx_t_1)); __pyx_t_1 = 0;
    __pyx_t_1 = PyList_New(3); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 197; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(((PyObject *)__pyx_t_1));
    __Pyx_INCREF(__pyx_int_1);
    PyList_SET_ITEM(__pyx_t_1, 0, __pyx_int_1);
    __Pyx_GIVEREF(__pyx_int_1);
    __Pyx_INCREF(__pyx_int_neg_1);
    PyList_SET_ITEM(__pyx_t_1, 1, __pyx_int_neg_1);
    __Pyx_GIVEREF(__pyx_int_neg_1);
    __Pyx_INCREF(__pyx_int_neg_1);
    PyList_SET_ITEM(__pyx_t_1, 2, __pyx_int_neg_1);
    __Pyx_GIVEREF(__pyx_int_neg_1);
    if (PyDict_SetItem(__pyx_1, __pyx_int_18, ((PyObject *)__pyx_t_1)) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 194; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_DECREF(((PyObject *)__pyx_t_1)); __pyx_t_1 = 0;
    __pyx_t_1 = PyList_New(3); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 197; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(((PyObject *)__pyx_t_1));
    __Pyx_INCREF(__pyx_int_1);
    PyList_SET_ITEM(__pyx_t_1, 0, __pyx_int_1);
    __Pyx_GIVEREF(__pyx_int_1);
    __Pyx_INCREF(__pyx_int_neg_1);
    PyList_SET_ITEM(__pyx_t_1, 1, __pyx_int_neg_1);
    __Pyx_GIVEREF(__pyx_int_neg_1);
    __Pyx_INCREF(__pyx_int_0);
    PyList_SET_ITEM(__pyx_t_1, 2, __pyx_int_0);
    __Pyx_GIVEREF(__pyx_int_0);
    if (PyDict_SetItem(__pyx_1, __pyx_int_19, ((PyObject *)__pyx_t_1)) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 194; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_DECREF(((PyObject *)__pyx_t_1)); __pyx_t_1 = 0;

    /* "/Users/sskory/Documents/yt-devel/yt/lagos/chainHOP/chainHOP.pyx":198
 *                 10:[0,-1,0], 11:[0,-1,1], 12:[0,0,-1], 13:[0,0,0], 14:[0,0,1],
 *                 15:[0,1,-1], 16:[0,1,0], 17:[0,1,1], 18:[1,-1,-1], 19:[1,-1,0],
 *                 20:[1,-1,1], 21:[1,0,-1], 22:[1,0,0], 23:[1,0,1], 24:[1,1,-1],             # <<<<<<<<<<<<<<
 *                 25:[1,1,0], 26:[1,1,1]}
 *             for key in d:
 */
    __pyx_t_1 = PyList_New(3); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 198; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(((PyObject *)__pyx_t_1));
    __Pyx_INCREF(__pyx_int_1);
    PyList_SET_ITEM(__pyx_t_1, 0, __pyx_int_1);
    __Pyx_GIVEREF(__pyx_int_1);
    __Pyx_INCREF(__pyx_int_neg_1);
    PyList_SET_ITEM(__pyx_t_1, 1, __pyx_int_neg_1);
    __Pyx_GIVEREF(__pyx_int_neg_1);
    __Pyx_INCREF(__pyx_int_1);
    PyList_SET_ITEM(__pyx_t_1, 2, __pyx_int_1);
    __Pyx_GIVEREF(__pyx_int_1);
    if (PyDict_SetItem(__pyx_1, __pyx_int_20, ((PyObject *)__pyx_t_1)) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 194; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_DECREF(((PyObject *)__pyx_t_1)); __pyx_t_1 = 0;
    __pyx_t_1 = PyList_New(3); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 198; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(((PyObject *)__pyx_t_1));
    __Pyx_INCREF(__pyx_int_1);
    PyList_SET_ITEM(__pyx_t_1, 0, __pyx_int_1);
    __Pyx_GIVEREF(__pyx_int_1);
    __Pyx_INCREF(__pyx_int_0);
    PyList_SET_ITEM(__pyx_t_1, 1, __pyx_int_0);
    __Pyx_GIVEREF(__pyx_int_0);
    __Pyx_INCREF(__pyx_int_neg_1);
    PyList_SET_ITEM(__pyx_t_1, 2, __pyx_int_neg_1);
    __Pyx_GIVEREF(__pyx_int_neg_1);
    if (PyDict_SetItem(__pyx_1, __pyx_int_21, ((PyObject *)__pyx_t_1)) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 194; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_DECREF(((PyObject *)__pyx_t_1)); __pyx_t_1 = 0;
    __pyx_t_1 = PyList_New(3); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 198; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(((PyObject *)__pyx_t_1));
    __Pyx_INCREF(__pyx_int_1);
    PyList_SET_ITEM(__pyx_t_1, 0, __pyx_int_1);
    __Pyx_GIVEREF(__pyx_int_1);
    __Pyx_INCREF(__pyx_int_0);
    PyList_SET_ITEM(__pyx_t_1, 1, __pyx_int_0);
    __Pyx_GIVEREF(__pyx_int_0);
    __Pyx_INCREF(__pyx_int_0);
    PyList_SET_ITEM(__pyx_t_1, 2, __pyx_int_0);
    __Pyx_GIVEREF(__pyx_int_0);
    if (PyDict_SetItem(__pyx_1, __pyx_int_22, ((PyObject *)__pyx_t_1)) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 194; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_DECREF(((PyObject *)__pyx_t_1)); __pyx_t_1 = 0;
    __pyx_t_1 = PyList_New(3); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 198; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(((PyObject *)__pyx_t_1));
    __Pyx_INCREF(__pyx_int_1);
    PyList_SET_ITEM(__pyx_t_1, 0, __pyx_int_1);
    __Pyx_GIVEREF(__pyx_int_1);
    __Pyx_INCREF(__pyx_int_0);
    PyList_SET_ITEM(__pyx_t_1, 1, __pyx_int_0);
    __Pyx_GIVEREF(__pyx_int_0);
    __Pyx_INCREF(__pyx_int_1);
    PyList_SET_ITEM(__pyx_t_1, 2, __pyx_int_1);
    __Pyx_GIVEREF(__pyx_int_1);
    if (PyDict_SetItem(__pyx_1, __pyx_int_23, ((PyObject *)__pyx_t_1)) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 194; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_DECREF(((PyObject *)__pyx_t_1)); __pyx_t_1 = 0;
    __pyx_t_1 = PyList_New(3); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 198; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(((PyObject *)__pyx_t_1));
    __Pyx_INCREF(__pyx_int_1);
    PyList_SET_ITEM(__pyx_t_1, 0, __pyx_int_1);
    __Pyx_GIVEREF(__pyx_int_1);
    __Pyx_INCREF(__pyx_int_1);
    PyList_SET_ITEM(__pyx_t_1, 1, __pyx_int_1);
    __Pyx_GIVEREF(__pyx_int_1);
    __Pyx_INCREF(__pyx_int_neg_1);
    PyList_SET_ITEM(__pyx_t_1, 2, __pyx_int_neg_1);
    __Pyx_GIVEREF(__pyx_int_neg_1);
    if (PyDict_SetItem(__pyx_1, __pyx_int_24, ((PyObject *)__pyx_t_1)) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 194; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_DECREF(((PyObject *)__pyx_t_1)); __pyx_t_1 = 0;

    /* "/Users/sskory/Documents/yt-devel/yt/lagos/chainHOP/chainHOP.pyx":199
 *                 15:[0,1,-1], 16:[0,1,0], 17:[0,1,1], 18:[1,-1,-1], 19:[1,-1,0],
 *                 20:[1,-1,1], 21:[1,0,-1], 22:[1,0,0], 23:[1,0,1], 24:[1,1,-1],
 *                 25:[1,1,0], 26:[1,1,1]}             # <<<<<<<<<<<<<<
 *             for key in d:
 *                 d[key] = na.array(d[key], dtype='int64')
 */
    __pyx_t_1 = PyList_New(3); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 199; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(((PyObject *)__pyx_t_1));
    __Pyx_INCREF(__pyx_int_1);
    PyList_SET_ITEM(__pyx_t_1, 0, __pyx_int_1);
    __Pyx_GIVEREF(__pyx_int_1);
    __Pyx_INCREF(__pyx_int_1);
    PyList_SET_ITEM(__pyx_t_1, 1, __pyx_int_1);
    __Pyx_GIVEREF(__pyx_int_1);
    __Pyx_INCREF(__pyx_int_0);
    PyList_SET_ITEM(__pyx_t_1, 2, __pyx_int_0);
    __Pyx_GIVEREF(__pyx_int_0);
    if (PyDict_SetItem(__pyx_1, __pyx_int_25, ((PyObject *)__pyx_t_1)) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 194; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_DECREF(((PyObject *)__pyx_t_1)); __pyx_t_1 = 0;
    __pyx_t_1 = PyList_New(3); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 199; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(((PyObject *)__pyx_t_1));
    __Pyx_INCREF(__pyx_int_1);
    PyList_SET_ITEM(__pyx_t_1, 0, __pyx_int_1);
    __Pyx_GIVEREF(__pyx_int_1);
    __Pyx_INCREF(__pyx_int_1);
    PyList_SET_ITEM(__pyx_t_1, 1, __pyx_int_1);
    __Pyx_GIVEREF(__pyx_int_1);
    __Pyx_INCREF(__pyx_int_1);
    PyList_SET_ITEM(__pyx_t_1, 2, __pyx_int_1);
    __Pyx_GIVEREF(__pyx_int_1);
    if (PyDict_SetItem(__pyx_1, __pyx_int_26, ((PyObject *)__pyx_t_1)) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 194; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_DECREF(((PyObject *)__pyx_t_1)); __pyx_t_1 = 0;
    __Pyx_DECREF(__pyx_v_d);
    __pyx_v_d = ((PyObject *)__pyx_1);
    __pyx_1 = 0;

    /* "/Users/sskory/Documents/yt-devel/yt/lagos/chainHOP/chainHOP.pyx":200
 *                 20:[1,-1,1], 21:[1,0,-1], 22:[1,0,0], 23:[1,0,1], 24:[1,1,-1],
 *                 25:[1,1,0], 26:[1,1,1]}
 *             for key in d:             # <<<<<<<<<<<<<<
 *                 d[key] = na.array(d[key], dtype='int64')
 *             self.d = d
 */
    if (PyList_CheckExact(__pyx_v_d) || PyTuple_CheckExact(__pyx_v_d)) {
      __pyx_t_3 = 0; __pyx_t_1 = __pyx_v_d; __Pyx_INCREF(__pyx_t_1);
    } else {
      __pyx_t_3 = -1; __pyx_t_1 = PyObject_GetIter(__pyx_v_d); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 200; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_t_1);
    }
    for (;;) {
      if (likely(PyList_CheckExact(__pyx_t_1))) {
        if (__pyx_t_3 >= PyList_GET_SIZE(__pyx_t_1)) break;
        __pyx_t_4 = PyList_GET_ITEM(__pyx_t_1, __pyx_t_3); __Pyx_INCREF(__pyx_t_4); __pyx_t_3++;
      } else if (likely(PyTuple_CheckExact(__pyx_t_1))) {
        if (__pyx_t_3 >= PyTuple_GET_SIZE(__pyx_t_1)) break;
        __pyx_t_4 = PyTuple_GET_ITEM(__pyx_t_1, __pyx_t_3); __Pyx_INCREF(__pyx_t_4); __pyx_t_3++;
      } else {
        __pyx_t_4 = PyIter_Next(__pyx_t_1);
        if (!__pyx_t_4) {
          if (unlikely(PyErr_Occurred())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 200; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
          break;
        }
        __Pyx_GOTREF(__pyx_t_4);
      }
      __Pyx_DECREF(__pyx_v_key);
      __pyx_v_key = __pyx_t_4;
      __pyx_t_4 = 0;

      /* "/Users/sskory/Documents/yt-devel/yt/lagos/chainHOP/chainHOP.pyx":201
 *                 25:[1,1,0], 26:[1,1,1]}
 *             for key in d:
 *                 d[key] = na.array(d[key], dtype='int64')             # <<<<<<<<<<<<<<
 *             self.d = d
 *         if i==None and shift==None: return None
 */
      __pyx_1 = __Pyx_GetName(__pyx_m, __pyx_kp_na); if (unlikely(!__pyx_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 201; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_1);
      __pyx_t_4 = PyObject_GetAttr(__pyx_1, __pyx_kp_array); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 201; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_t_4);
      __Pyx_DECREF(__pyx_1); __pyx_1 = 0;
      __pyx_1 = PyObject_GetItem(__pyx_v_d, __pyx_v_key); if (!__pyx_1) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 201; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_1);
      __pyx_t_5 = PyTuple_New(1); if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 201; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(((PyObject *)__pyx_t_5));
      PyTuple_SET_ITEM(__pyx_t_5, 0, __pyx_1);
      __Pyx_GIVEREF(__pyx_1);
      __pyx_1 = 0;
      __pyx_1 = PyDict_New(); if (unlikely(!__pyx_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 201; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(((PyObject *)__pyx_1));
      if (PyDict_SetItem(__pyx_1, __pyx_kp_dtype, __pyx_kp_58) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 201; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __pyx_t_6 = PyEval_CallObjectWithKeywords(__pyx_t_4, ((PyObject *)__pyx_t_5), ((PyObject *)__pyx_1)); if (unlikely(!__pyx_t_6)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 201; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_t_6);
      __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
      __Pyx_DECREF(((PyObject *)__pyx_t_5)); __pyx_t_5 = 0;
      __Pyx_DECREF(((PyObject *)__pyx_1)); __pyx_1 = 0;
      if (PyObject_SetItem(__pyx_v_d, __pyx_v_key, __pyx_t_6) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 201; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
    }
    __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;

    /* "/Users/sskory/Documents/yt-devel/yt/lagos/chainHOP/chainHOP.pyx":202
 *             for key in d:
 *                 d[key] = na.array(d[key], dtype='int64')
 *             self.d = d             # <<<<<<<<<<<<<<
 *         if i==None and shift==None: return None
 *         if i!=None:
 */
    if (PyObject_SetAttr(__pyx_v_self, __pyx_kp_d, __pyx_v_d) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 202; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    goto __pyx_L6;
  }
  __pyx_L6:;

  /* "/Users/sskory/Documents/yt-devel/yt/lagos/chainHOP/chainHOP.pyx":203
 *                 d[key] = na.array(d[key], dtype='int64')
 *             self.d = d
 *         if i==None and shift==None: return None             # <<<<<<<<<<<<<<
 *         if i!=None:
 *             return self.d[i]
 */
  __pyx_t_1 = PyObject_RichCompare(__pyx_v_i, Py_None, Py_EQ); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 203; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_t_2 = __Pyx_PyObject_IsTrue(__pyx_t_1); if (unlikely(__pyx_t_2 < 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 203; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  if (__pyx_t_2) {
    __pyx_t_1 = PyObject_RichCompare(__pyx_v_shift, Py_None, Py_EQ); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 203; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_1);
    __pyx_t_7 = __Pyx_PyObject_IsTrue(__pyx_t_1); if (unlikely(__pyx_t_7 < 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 203; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
    __pyx_t_8 = __pyx_t_7;
  } else {
    __pyx_t_8 = __pyx_t_2;
  }
  if (__pyx_t_8) {
    __Pyx_XDECREF(__pyx_r);
    __Pyx_INCREF(Py_None);
    __pyx_r = Py_None;
    goto __pyx_L0;
    goto __pyx_L9;
  }
  __pyx_L9:;

  /* "/Users/sskory/Documents/yt-devel/yt/lagos/chainHOP/chainHOP.pyx":204
 *             self.d = d
 *         if i==None and shift==None: return None
 *         if i!=None:             # <<<<<<<<<<<<<<
 *             return self.d[i]
 *         if shift!=None:
 */
  __pyx_t_1 = PyObject_RichCompare(__pyx_v_i, Py_None, Py_NE); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 204; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_t_8 = __Pyx_PyObject_IsTrue(__pyx_t_1); if (unlikely(__pyx_t_8 < 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 204; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  if (__pyx_t_8) {

    /* "/Users/sskory/Documents/yt-devel/yt/lagos/chainHOP/chainHOP.pyx":205
 *         if i==None and shift==None: return None
 *         if i!=None:
 *             return self.d[i]             # <<<<<<<<<<<<<<
 *         if shift!=None:
 *             shift = na.array(shift)
 */
    __Pyx_XDECREF(__pyx_r);
    __pyx_t_1 = PyObject_GetAttr(__pyx_v_self, __pyx_kp_d); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 205; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_1);
    __pyx_1 = PyObject_GetItem(__pyx_t_1, __pyx_v_i); if (!__pyx_1) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 205; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_1);
    __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
    __pyx_r = __pyx_1;
    __pyx_1 = 0;
    goto __pyx_L0;
    goto __pyx_L10;
  }
  __pyx_L10:;

  /* "/Users/sskory/Documents/yt-devel/yt/lagos/chainHOP/chainHOP.pyx":206
 *         if i!=None:
 *             return self.d[i]
 *         if shift!=None:             # <<<<<<<<<<<<<<
 *             shift = na.array(shift)
 *             for key in self.d:
 */
  __pyx_t_1 = PyObject_RichCompare(__pyx_v_shift, Py_None, Py_NE); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 206; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_t_8 = __Pyx_PyObject_IsTrue(__pyx_t_1); if (unlikely(__pyx_t_8 < 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 206; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  if (__pyx_t_8) {

    /* "/Users/sskory/Documents/yt-devel/yt/lagos/chainHOP/chainHOP.pyx":207
 *             return self.d[i]
 *         if shift!=None:
 *             shift = na.array(shift)             # <<<<<<<<<<<<<<
 *             for key in self.d:
 *                 if (self.d[key] == shift).all():
 */
    __pyx_1 = __Pyx_GetName(__pyx_m, __pyx_kp_na); if (unlikely(!__pyx_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 207; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_1);
    __pyx_t_1 = PyObject_GetAttr(__pyx_1, __pyx_kp_array); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 207; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_1);
    __Pyx_DECREF(__pyx_1); __pyx_1 = 0;
    __pyx_t_6 = PyTuple_New(1); if (unlikely(!__pyx_t_6)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 207; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(((PyObject *)__pyx_t_6));
    __Pyx_INCREF(__pyx_v_shift);
    PyTuple_SET_ITEM(__pyx_t_6, 0, __pyx_v_shift);
    __Pyx_GIVEREF(__pyx_v_shift);
    __pyx_t_5 = PyObject_Call(__pyx_t_1, ((PyObject *)__pyx_t_6), NULL); if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 207; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_5);
    __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
    __Pyx_DECREF(((PyObject *)__pyx_t_6)); __pyx_t_6 = 0;
    __Pyx_DECREF(__pyx_v_shift);
    __pyx_v_shift = __pyx_t_5;
    __pyx_t_5 = 0;

    /* "/Users/sskory/Documents/yt-devel/yt/lagos/chainHOP/chainHOP.pyx":208
 *         if shift!=None:
 *             shift = na.array(shift)
 *             for key in self.d:             # <<<<<<<<<<<<<<
 *                 if (self.d[key] == shift).all():
 *                     return key
 */
    __pyx_t_5 = PyObject_GetAttr(__pyx_v_self, __pyx_kp_d); if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 208; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_5);
    if (PyList_CheckExact(__pyx_t_5) || PyTuple_CheckExact(__pyx_t_5)) {
      __pyx_t_3 = 0; __pyx_t_6 = __pyx_t_5; __Pyx_INCREF(__pyx_t_6);
    } else {
      __pyx_t_3 = -1; __pyx_t_6 = PyObject_GetIter(__pyx_t_5); if (unlikely(!__pyx_t_6)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 208; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_t_6);
    }
    __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
    for (;;) {
      if (likely(PyList_CheckExact(__pyx_t_6))) {
        if (__pyx_t_3 >= PyList_GET_SIZE(__pyx_t_6)) break;
        __pyx_t_5 = PyList_GET_ITEM(__pyx_t_6, __pyx_t_3); __Pyx_INCREF(__pyx_t_5); __pyx_t_3++;
      } else if (likely(PyTuple_CheckExact(__pyx_t_6))) {
        if (__pyx_t_3 >= PyTuple_GET_SIZE(__pyx_t_6)) break;
        __pyx_t_5 = PyTuple_GET_ITEM(__pyx_t_6, __pyx_t_3); __Pyx_INCREF(__pyx_t_5); __pyx_t_3++;
      } else {
        __pyx_t_5 = PyIter_Next(__pyx_t_6);
        if (!__pyx_t_5) {
          if (unlikely(PyErr_Occurred())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 208; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
          break;
        }
        __Pyx_GOTREF(__pyx_t_5);
      }
      __Pyx_DECREF(__pyx_v_key);
      __pyx_v_key = __pyx_t_5;
      __pyx_t_5 = 0;

      /* "/Users/sskory/Documents/yt-devel/yt/lagos/chainHOP/chainHOP.pyx":209
 *             shift = na.array(shift)
 *             for key in self.d:
 *                 if (self.d[key] == shift).all():             # <<<<<<<<<<<<<<
 *                     return key
 * 
 */
      __pyx_t_5 = PyObject_GetAttr(__pyx_v_self, __pyx_kp_d); if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 209; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_t_5);
      __pyx_1 = PyObject_GetItem(__pyx_t_5, __pyx_v_key); if (!__pyx_1) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 209; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_1);
      __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
      __pyx_t_5 = PyObject_RichCompare(__pyx_1, __pyx_v_shift, Py_EQ); if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 209; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_t_5);
      __Pyx_DECREF(__pyx_1); __pyx_1 = 0;
      __pyx_t_1 = PyObject_GetAttr(__pyx_t_5, __pyx_kp_all); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 209; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_t_1);
      __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
      __pyx_t_5 = PyObject_Call(__pyx_t_1, ((PyObject *)__pyx_empty_tuple), NULL); if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 209; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_t_5);
      __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
      __pyx_t_8 = __Pyx_PyObject_IsTrue(__pyx_t_5); if (unlikely(__pyx_t_8 < 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 209; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
      if (__pyx_t_8) {

        /* "/Users/sskory/Documents/yt-devel/yt/lagos/chainHOP/chainHOP.pyx":210
 *             for key in self.d:
 *                 if (self.d[key] == shift).all():
 *                     return key             # <<<<<<<<<<<<<<
 * 
 *     def _densestNN(object self):
 */
        __Pyx_XDECREF(__pyx_r);
        __Pyx_INCREF(__pyx_v_key);
        __pyx_r = __pyx_v_key;
        __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
        goto __pyx_L0;
        goto __pyx_L14;
      }
      __pyx_L14:;
    }
    __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
    goto __pyx_L11;
  }
  __pyx_L11:;

  __pyx_r = Py_None; __Pyx_INCREF(Py_None);
  goto __pyx_L0;
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_1);
  __Pyx_XDECREF(__pyx_t_1);
  __Pyx_XDECREF(__pyx_t_4);
  __Pyx_XDECREF(__pyx_t_5);
  __Pyx_XDECREF(__pyx_t_6);
  __Pyx_AddTraceback("yt.lagos.chainHOP.chainHOP.RunChainHOP._translate_shift");
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_DECREF(__pyx_v_d);
  __Pyx_DECREF(__pyx_v_key);
  __Pyx_DECREF(__pyx_v_shift);
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_FinishRefcountContext();
  return __pyx_r;
}

/* "/Users/sskory/Documents/yt-devel/yt/lagos/chainHOP/chainHOP.pyx":212
 *                     return key
 * 
 *     def _densestNN(object self):             # <<<<<<<<<<<<<<
 *         """
 *         For all particles, find their densest nearest neighbor. It is done in
 */

static PyObject *__pyx_pf_2yt_5lagos_8chainHOP_8chainHOP_11RunChainHOP__densestNN(PyObject *__pyx_self, PyObject *__pyx_v_self); /*proto*/
static char __pyx_doc_2yt_5lagos_8chainHOP_8chainHOP_11RunChainHOP__densestNN[] = "\n        For all particles, find their densest nearest neighbor. It is done in\n        chunks to keep the memory usage down.\n        The first search of nearest neighbors (done earlier) did not return all \n        num_neighbor neighbors, so we need to do it again, but we're not\n        keeping the all of this data, just using it.\n        ";
static PyMethodDef __pyx_mdef_2yt_5lagos_8chainHOP_8chainHOP_11RunChainHOP__densestNN = {__Pyx_NAMESTR("_densestNN"), (PyCFunction)__pyx_pf_2yt_5lagos_8chainHOP_8chainHOP_11RunChainHOP__densestNN, METH_O, __Pyx_DOCSTR(__pyx_doc_2yt_5lagos_8chainHOP_8chainHOP_11RunChainHOP__densestNN)};
static PyObject *__pyx_pf_2yt_5lagos_8chainHOP_8chainHOP_11RunChainHOP__densestNN(PyObject *__pyx_self, PyObject *__pyx_v_self) {
  long __pyx_v_chunksize;
  long __pyx_v_start;
  long __pyx_v_finish;
  long __pyx_v_i;
  PyArrayObject *__pyx_v_chunk_NNtags;
  PyArrayObject *__pyx_v_n_dens;
  PyArrayObject *__pyx_v_max_loc;
  PyObject *__pyx_v_j;
  PyObject *__pyx_r = NULL;
  PyObject *__pyx_1 = 0;
  PyObject *__pyx_2 = 0;
  PyObject *__pyx_t_1 = NULL;
  PyObject *__pyx_t_2 = NULL;
  PyObject *__pyx_t_3 = NULL;
  int __pyx_t_4;
  long __pyx_t_5;
  __Pyx_SetupRefcountContext("_densestNN");
  __pyx_self = __pyx_self;
  __pyx_v_chunk_NNtags = ((PyArrayObject *)Py_None); __Pyx_INCREF(Py_None);
  __pyx_v_n_dens = ((PyArrayObject *)Py_None); __Pyx_INCREF(Py_None);
  __pyx_v_max_loc = ((PyArrayObject *)Py_None); __Pyx_INCREF(Py_None);
  __pyx_v_j = Py_None; __Pyx_INCREF(Py_None);

  /* "/Users/sskory/Documents/yt-devel/yt/lagos/chainHOP/chainHOP.pyx":222
 *         cdef long chunksize, start, finish, i
 *         cdef na.ndarray chunk_NNtags, n_dens, max_loc
 *         self.densestNN = na.ones(self.size,dtype='l')             # <<<<<<<<<<<<<<
 *         # We find nearest neighbors in chunks.
 *         chunksize = 10000
 */
  __pyx_1 = __Pyx_GetName(__pyx_m, __pyx_kp_na); if (unlikely(!__pyx_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 222; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_1);
  __pyx_t_1 = PyObject_GetAttr(__pyx_1, __pyx_kp_ones); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 222; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_DECREF(__pyx_1); __pyx_1 = 0;
  __pyx_t_2 = PyObject_GetAttr(__pyx_v_self, __pyx_kp_size); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 222; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_2);
  __pyx_t_3 = PyTuple_New(1); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 222; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(((PyObject *)__pyx_t_3));
  PyTuple_SET_ITEM(__pyx_t_3, 0, __pyx_t_2);
  __Pyx_GIVEREF(__pyx_t_2);
  __pyx_t_2 = 0;
  __pyx_1 = PyDict_New(); if (unlikely(!__pyx_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 222; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(((PyObject *)__pyx_1));
  if (PyDict_SetItem(__pyx_1, __pyx_kp_dtype, __pyx_kp_59) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 222; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __pyx_t_2 = PyEval_CallObjectWithKeywords(__pyx_t_1, ((PyObject *)__pyx_t_3), ((PyObject *)__pyx_1)); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 222; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_2);
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  __Pyx_DECREF(((PyObject *)__pyx_t_3)); __pyx_t_3 = 0;
  __Pyx_DECREF(((PyObject *)__pyx_1)); __pyx_1 = 0;
  if (PyObject_SetAttr(__pyx_v_self, __pyx_kp_densestNN, __pyx_t_2) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 222; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;

  /* "/Users/sskory/Documents/yt-devel/yt/lagos/chainHOP/chainHOP.pyx":224
 *         self.densestNN = na.ones(self.size,dtype='l')
 *         # We find nearest neighbors in chunks.
 *         chunksize = 10000             # <<<<<<<<<<<<<<
 *         fKD.chunk_tags = empty((self.num_neighbors, chunksize), dtype='l')
 *         start = 1 # Fortran counting!
 */
  __pyx_v_chunksize = 10000;

  /* "/Users/sskory/Documents/yt-devel/yt/lagos/chainHOP/chainHOP.pyx":225
 *         # We find nearest neighbors in chunks.
 *         chunksize = 10000
 *         fKD.chunk_tags = empty((self.num_neighbors, chunksize), dtype='l')             # <<<<<<<<<<<<<<
 *         start = 1 # Fortran counting!
 *         finish = 0
 */
  __pyx_1 = __Pyx_GetName(__pyx_m, __pyx_kp_empty); if (unlikely(!__pyx_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 225; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_1);
  __pyx_t_2 = PyObject_GetAttr(__pyx_v_self, __pyx_kp_num_neighbors); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 225; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_2);
  __pyx_t_3 = PyInt_FromLong(__pyx_v_chunksize); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 225; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_3);
  __pyx_t_1 = PyTuple_New(2); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 225; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(((PyObject *)__pyx_t_1));
  PyTuple_SET_ITEM(__pyx_t_1, 0, __pyx_t_2);
  __Pyx_GIVEREF(__pyx_t_2);
  PyTuple_SET_ITEM(__pyx_t_1, 1, __pyx_t_3);
  __Pyx_GIVEREF(__pyx_t_3);
  __pyx_t_2 = 0;
  __pyx_t_3 = 0;
  __pyx_t_3 = PyTuple_New(1); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 225; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(((PyObject *)__pyx_t_3));
  PyTuple_SET_ITEM(__pyx_t_3, 0, ((PyObject *)__pyx_t_1));
  __Pyx_GIVEREF(((PyObject *)__pyx_t_1));
  __pyx_t_1 = 0;
  __pyx_2 = PyDict_New(); if (unlikely(!__pyx_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 225; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(((PyObject *)__pyx_2));
  if (PyDict_SetItem(__pyx_2, __pyx_kp_dtype, __pyx_kp_60) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 225; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __pyx_t_1 = PyEval_CallObjectWithKeywords(__pyx_1, ((PyObject *)__pyx_t_3), ((PyObject *)__pyx_2)); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 225; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_DECREF(__pyx_1); __pyx_1 = 0;
  __Pyx_DECREF(((PyObject *)__pyx_t_3)); __pyx_t_3 = 0;
  __Pyx_DECREF(((PyObject *)__pyx_2)); __pyx_2 = 0;
  __pyx_1 = __Pyx_GetName(__pyx_m, __pyx_kp_fKD); if (unlikely(!__pyx_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 225; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_1);
  if (PyObject_SetAttr(__pyx_1, __pyx_kp_chunk_tags, __pyx_t_1) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 225; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  __Pyx_DECREF(__pyx_1); __pyx_1 = 0;

  /* "/Users/sskory/Documents/yt-devel/yt/lagos/chainHOP/chainHOP.pyx":226
 *         chunksize = 10000
 *         fKD.chunk_tags = empty((self.num_neighbors, chunksize), dtype='l')
 *         start = 1 # Fortran counting!             # <<<<<<<<<<<<<<
 *         finish = 0
 *         while finish < self.size:
 */
  __pyx_v_start = 1;

  /* "/Users/sskory/Documents/yt-devel/yt/lagos/chainHOP/chainHOP.pyx":227
 *         fKD.chunk_tags = empty((self.num_neighbors, chunksize), dtype='l')
 *         start = 1 # Fortran counting!
 *         finish = 0             # <<<<<<<<<<<<<<
 *         while finish < self.size:
 *             finish = min(finish+chunksize,self.size)
 */
  __pyx_v_finish = 0;

  /* "/Users/sskory/Documents/yt-devel/yt/lagos/chainHOP/chainHOP.pyx":228
 *         start = 1 # Fortran counting!
 *         finish = 0
 *         while finish < self.size:             # <<<<<<<<<<<<<<
 *             finish = min(finish+chunksize,self.size)
 *             #fKD.chunk_tags = empty((self.num_neighbors,finish-start+1), dtype='l')
 */
  while (1) {
    __pyx_t_1 = PyInt_FromLong(__pyx_v_finish); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 228; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_1);
    __pyx_t_3 = PyObject_GetAttr(__pyx_v_self, __pyx_kp_size); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 228; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_3);
    __pyx_t_2 = PyObject_RichCompare(__pyx_t_1, __pyx_t_3, Py_LT); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 228; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_2);
    __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
    __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
    __pyx_t_4 = __Pyx_PyObject_IsTrue(__pyx_t_2); if (unlikely(__pyx_t_4 < 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 228; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
    if (!__pyx_t_4) break;

    /* "/Users/sskory/Documents/yt-devel/yt/lagos/chainHOP/chainHOP.pyx":229
 *         finish = 0
 *         while finish < self.size:
 *             finish = min(finish+chunksize,self.size)             # <<<<<<<<<<<<<<
 *             #fKD.chunk_tags = empty((self.num_neighbors,finish-start+1), dtype='l')
 *             # Call the fortran. start and finish refer to the data locations
 */
    __pyx_t_2 = PyInt_FromLong((__pyx_v_finish + __pyx_v_chunksize)); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 229; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_2);
    __pyx_t_3 = PyObject_GetAttr(__pyx_v_self, __pyx_kp_size); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 229; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_3);
    __pyx_t_1 = PyTuple_New(2); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 229; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(((PyObject *)__pyx_t_1));
    PyTuple_SET_ITEM(__pyx_t_1, 0, __pyx_t_2);
    __Pyx_GIVEREF(__pyx_t_2);
    PyTuple_SET_ITEM(__pyx_t_1, 1, __pyx_t_3);
    __Pyx_GIVEREF(__pyx_t_3);
    __pyx_t_2 = 0;
    __pyx_t_3 = 0;
    __pyx_t_3 = PyObject_Call(__pyx_builtin_min, ((PyObject *)__pyx_t_1), NULL); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 229; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_3);
    __Pyx_DECREF(((PyObject *)__pyx_t_1)); __pyx_t_1 = 0;
    __pyx_t_5 = __Pyx_PyInt_AsLong(__pyx_t_3); if (unlikely((__pyx_t_5 == (long)-1) && PyErr_Occurred())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 229; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
    __pyx_v_finish = __pyx_t_5;

    /* "/Users/sskory/Documents/yt-devel/yt/lagos/chainHOP/chainHOP.pyx":234
 *             # in fKD.pos, and specify the range of particles to find nearest
 *             # neighbors
 *             fKD.start = start             # <<<<<<<<<<<<<<
 *             fKD.finish = finish
 *             find_chunk_nearest_neighbors()
 */
    __pyx_t_3 = PyInt_FromLong(__pyx_v_start); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 234; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_3);
    __pyx_2 = __Pyx_GetName(__pyx_m, __pyx_kp_fKD); if (unlikely(!__pyx_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 234; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_2);
    if (PyObject_SetAttr(__pyx_2, __pyx_kp_start, __pyx_t_3) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 234; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
    __Pyx_DECREF(__pyx_2); __pyx_2 = 0;

    /* "/Users/sskory/Documents/yt-devel/yt/lagos/chainHOP/chainHOP.pyx":235
 *             # neighbors
 *             fKD.start = start
 *             fKD.finish = finish             # <<<<<<<<<<<<<<
 *             find_chunk_nearest_neighbors()
 *             chunk_NNtags = (fKD.chunk_tags[:,:finish-start+1] - 1).transpose()
 */
    __pyx_t_3 = PyInt_FromLong(__pyx_v_finish); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 235; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_3);
    __pyx_1 = __Pyx_GetName(__pyx_m, __pyx_kp_fKD); if (unlikely(!__pyx_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 235; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_1);
    if (PyObject_SetAttr(__pyx_1, __pyx_kp_finish, __pyx_t_3) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 235; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
    __Pyx_DECREF(__pyx_1); __pyx_1 = 0;

    /* "/Users/sskory/Documents/yt-devel/yt/lagos/chainHOP/chainHOP.pyx":236
 *             fKD.start = start
 *             fKD.finish = finish
 *             find_chunk_nearest_neighbors()             # <<<<<<<<<<<<<<
 *             chunk_NNtags = (fKD.chunk_tags[:,:finish-start+1] - 1).transpose()
 *             # Find the densest nearest neighbors by referencing the already
 */
    __pyx_2 = __Pyx_GetName(__pyx_m, __pyx_kp_61); if (unlikely(!__pyx_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 236; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_2);
    __pyx_t_3 = PyObject_Call(__pyx_2, ((PyObject *)__pyx_empty_tuple), NULL); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 236; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_3);
    __Pyx_DECREF(__pyx_2); __pyx_2 = 0;
    __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;

    /* "/Users/sskory/Documents/yt-devel/yt/lagos/chainHOP/chainHOP.pyx":237
 *             fKD.finish = finish
 *             find_chunk_nearest_neighbors()
 *             chunk_NNtags = (fKD.chunk_tags[:,:finish-start+1] - 1).transpose()             # <<<<<<<<<<<<<<
 *             # Find the densest nearest neighbors by referencing the already
 *             # calculated density.
 */
    __pyx_1 = __Pyx_GetName(__pyx_m, __pyx_kp_fKD); if (unlikely(!__pyx_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 237; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_1);
    __pyx_t_3 = PyObject_GetAttr(__pyx_1, __pyx_kp_chunk_tags); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 237; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_3);
    __Pyx_DECREF(__pyx_1); __pyx_1 = 0;
    __pyx_2 = PySlice_New(Py_None, Py_None, Py_None); if (unlikely(!__pyx_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 237; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_2);
    __pyx_t_1 = PyInt_FromLong(((__pyx_v_finish - __pyx_v_start) + 1)); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 237; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_1);
    __pyx_1 = PySlice_New(Py_None, __pyx_t_1, Py_None); if (unlikely(!__pyx_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 237; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_1);
    __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
    __pyx_t_1 = PyTuple_New(2); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 237; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(((PyObject *)__pyx_t_1));
    PyTuple_SET_ITEM(__pyx_t_1, 0, __pyx_2);
    __Pyx_GIVEREF(__pyx_2);
    PyTuple_SET_ITEM(__pyx_t_1, 1, __pyx_1);
    __Pyx_GIVEREF(__pyx_1);
    __pyx_2 = 0;
    __pyx_1 = 0;
    __pyx_2 = PyObject_GetItem(__pyx_t_3, ((PyObject *)__pyx_t_1)); if (!__pyx_2) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 237; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_2);
    __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
    __Pyx_DECREF(((PyObject *)__pyx_t_1)); __pyx_t_1 = 0;
    __pyx_t_1 = PyNumber_Subtract(__pyx_2, __pyx_int_1); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 237; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_1);
    __Pyx_DECREF(__pyx_2); __pyx_2 = 0;
    __pyx_t_3 = PyObject_GetAttr(__pyx_t_1, __pyx_kp_transpose); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 237; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_3);
    __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
    __pyx_t_1 = PyObject_Call(__pyx_t_3, ((PyObject *)__pyx_empty_tuple), NULL); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 237; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_1);
    __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
    if (!(__Pyx_TypeTest(__pyx_t_1, __pyx_ptype_5numpy_ndarray))) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 237; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_DECREF(((PyObject *)__pyx_v_chunk_NNtags));
    __pyx_v_chunk_NNtags = ((PyArrayObject *)__pyx_t_1);
    __pyx_t_1 = 0;

    /* "/Users/sskory/Documents/yt-devel/yt/lagos/chainHOP/chainHOP.pyx":240
 *             # Find the densest nearest neighbors by referencing the already
 *             # calculated density.
 *             n_dens = na.take(self.density,chunk_NNtags)             # <<<<<<<<<<<<<<
 *             max_loc = na.argmax(n_dens,axis=1)
 *             for i in xrange(finish - start + 1): # +1 for fortran counting.
 */
    __pyx_1 = __Pyx_GetName(__pyx_m, __pyx_kp_na); if (unlikely(!__pyx_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 240; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_1);
    __pyx_t_1 = PyObject_GetAttr(__pyx_1, __pyx_kp_take); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 240; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_1);
    __Pyx_DECREF(__pyx_1); __pyx_1 = 0;
    __pyx_t_3 = PyObject_GetAttr(__pyx_v_self, __pyx_kp_density); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 240; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_3);
    __pyx_t_2 = PyTuple_New(2); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 240; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(((PyObject *)__pyx_t_2));
    PyTuple_SET_ITEM(__pyx_t_2, 0, __pyx_t_3);
    __Pyx_GIVEREF(__pyx_t_3);
    __Pyx_INCREF(((PyObject *)__pyx_v_chunk_NNtags));
    PyTuple_SET_ITEM(__pyx_t_2, 1, ((PyObject *)__pyx_v_chunk_NNtags));
    __Pyx_GIVEREF(((PyObject *)__pyx_v_chunk_NNtags));
    __pyx_t_3 = 0;
    __pyx_t_3 = PyObject_Call(__pyx_t_1, ((PyObject *)__pyx_t_2), NULL); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 240; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_3);
    __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
    __Pyx_DECREF(((PyObject *)__pyx_t_2)); __pyx_t_2 = 0;
    if (!(__Pyx_TypeTest(__pyx_t_3, __pyx_ptype_5numpy_ndarray))) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 240; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_DECREF(((PyObject *)__pyx_v_n_dens));
    __pyx_v_n_dens = ((PyArrayObject *)__pyx_t_3);
    __pyx_t_3 = 0;

    /* "/Users/sskory/Documents/yt-devel/yt/lagos/chainHOP/chainHOP.pyx":241
 *             # calculated density.
 *             n_dens = na.take(self.density,chunk_NNtags)
 *             max_loc = na.argmax(n_dens,axis=1)             # <<<<<<<<<<<<<<
 *             for i in xrange(finish - start + 1): # +1 for fortran counting.
 *                 j = start + i - 1 # -1 for fortran counting.
 */
    __pyx_2 = __Pyx_GetName(__pyx_m, __pyx_kp_na); if (unlikely(!__pyx_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 241; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_2);
    __pyx_t_3 = PyObject_GetAttr(__pyx_2, __pyx_kp_argmax); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 241; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_3);
    __Pyx_DECREF(__pyx_2); __pyx_2 = 0;
    __pyx_t_2 = PyTuple_New(1); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 241; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(((PyObject *)__pyx_t_2));
    __Pyx_INCREF(((PyObject *)__pyx_v_n_dens));
    PyTuple_SET_ITEM(__pyx_t_2, 0, ((PyObject *)__pyx_v_n_dens));
    __Pyx_GIVEREF(((PyObject *)__pyx_v_n_dens));
    __pyx_1 = PyDict_New(); if (unlikely(!__pyx_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 241; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(((PyObject *)__pyx_1));
    if (PyDict_SetItem(__pyx_1, __pyx_kp_axis, __pyx_int_1) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 241; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __pyx_t_1 = PyEval_CallObjectWithKeywords(__pyx_t_3, ((PyObject *)__pyx_t_2), ((PyObject *)__pyx_1)); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 241; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_1);
    __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
    __Pyx_DECREF(((PyObject *)__pyx_t_2)); __pyx_t_2 = 0;
    __Pyx_DECREF(((PyObject *)__pyx_1)); __pyx_1 = 0;
    if (!(__Pyx_TypeTest(__pyx_t_1, __pyx_ptype_5numpy_ndarray))) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 241; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_DECREF(((PyObject *)__pyx_v_max_loc));
    __pyx_v_max_loc = ((PyArrayObject *)__pyx_t_1);
    __pyx_t_1 = 0;

    /* "/Users/sskory/Documents/yt-devel/yt/lagos/chainHOP/chainHOP.pyx":242
 *             n_dens = na.take(self.density,chunk_NNtags)
 *             max_loc = na.argmax(n_dens,axis=1)
 *             for i in xrange(finish - start + 1): # +1 for fortran counting.             # <<<<<<<<<<<<<<
 *                 j = start + i - 1 # -1 for fortran counting.
 *                 self.densestNN[j] = chunk_NNtags[i,max_loc[i]]
 */
    for (__pyx_t_5 = 0; __pyx_t_5 < ((__pyx_v_finish - __pyx_v_start) + 1); __pyx_t_5+=1) {
      __pyx_v_i = __pyx_t_5;

      /* "/Users/sskory/Documents/yt-devel/yt/lagos/chainHOP/chainHOP.pyx":243
 *             max_loc = na.argmax(n_dens,axis=1)
 *             for i in xrange(finish - start + 1): # +1 for fortran counting.
 *                 j = start + i - 1 # -1 for fortran counting.             # <<<<<<<<<<<<<<
 *                 self.densestNN[j] = chunk_NNtags[i,max_loc[i]]
 *             start = finish + 1
 */
      __pyx_t_1 = PyInt_FromLong(((__pyx_v_start + __pyx_v_i) - 1)); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 243; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_t_1);
      __Pyx_DECREF(__pyx_v_j);
      __pyx_v_j = __pyx_t_1;
      __pyx_t_1 = 0;

      /* "/Users/sskory/Documents/yt-devel/yt/lagos/chainHOP/chainHOP.pyx":244
 *             for i in xrange(finish - start + 1): # +1 for fortran counting.
 *                 j = start + i - 1 # -1 for fortran counting.
 *                 self.densestNN[j] = chunk_NNtags[i,max_loc[i]]             # <<<<<<<<<<<<<<
 *             start = finish + 1
 * 
 */
      __pyx_t_1 = PyInt_FromLong(__pyx_v_i); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 244; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_t_1);
      __pyx_2 = __Pyx_GetItemInt(((PyObject *)__pyx_v_max_loc), __pyx_v_i, sizeof(long), PyInt_FromLong); if (!__pyx_2) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 244; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_2);
      __pyx_t_2 = PyTuple_New(2); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 244; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(((PyObject *)__pyx_t_2));
      PyTuple_SET_ITEM(__pyx_t_2, 0, __pyx_t_1);
      __Pyx_GIVEREF(__pyx_t_1);
      PyTuple_SET_ITEM(__pyx_t_2, 1, __pyx_2);
      __Pyx_GIVEREF(__pyx_2);
      __pyx_t_1 = 0;
      __pyx_2 = 0;
      __pyx_1 = PyObject_GetItem(((PyObject *)__pyx_v_chunk_NNtags), ((PyObject *)__pyx_t_2)); if (!__pyx_1) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 244; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_1);
      __Pyx_DECREF(((PyObject *)__pyx_t_2)); __pyx_t_2 = 0;
      __pyx_t_2 = PyObject_GetAttr(__pyx_v_self, __pyx_kp_densestNN); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 244; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_t_2);
      if (PyObject_SetItem(__pyx_t_2, __pyx_v_j, __pyx_1) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 244; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
      __Pyx_DECREF(__pyx_1); __pyx_1 = 0;
    }

    /* "/Users/sskory/Documents/yt-devel/yt/lagos/chainHOP/chainHOP.pyx":245
 *                 j = start + i - 1 # -1 for fortran counting.
 *                 self.densestNN[j] = chunk_NNtags[i,max_loc[i]]
 *             start = finish + 1             # <<<<<<<<<<<<<<
 * 
 *     def _build_chains(object self):
 */
    __pyx_v_start = (__pyx_v_finish + 1);
  }

  __pyx_r = Py_None; __Pyx_INCREF(Py_None);
  goto __pyx_L0;
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_1);
  __Pyx_XDECREF(__pyx_2);
  __Pyx_XDECREF(__pyx_t_1);
  __Pyx_XDECREF(__pyx_t_2);
  __Pyx_XDECREF(__pyx_t_3);
  __Pyx_AddTraceback("yt.lagos.chainHOP.chainHOP.RunChainHOP._densestNN");
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_DECREF((PyObject *)__pyx_v_chunk_NNtags);
  __Pyx_DECREF((PyObject *)__pyx_v_n_dens);
  __Pyx_DECREF((PyObject *)__pyx_v_max_loc);
  __Pyx_DECREF(__pyx_v_j);
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_FinishRefcountContext();
  return __pyx_r;
}

/* "/Users/sskory/Documents/yt-devel/yt/lagos/chainHOP/chainHOP.pyx":247
 *             start = finish + 1
 * 
 *     def _build_chains(object self):             # <<<<<<<<<<<<<<
 *         """
 *         Build the first round of particle chains. If the particle is too low in
 */

static PyObject *__pyx_pf_2yt_5lagos_8chainHOP_8chainHOP_11RunChainHOP__build_chains(PyObject *__pyx_self, PyObject *__pyx_v_self); /*proto*/
static char __pyx_doc_2yt_5lagos_8chainHOP_8chainHOP_11RunChainHOP__build_chains[] = "\n        Build the first round of particle chains. If the particle is too low in\n        density, move on.\n        ";
static PyMethodDef __pyx_mdef_2yt_5lagos_8chainHOP_8chainHOP_11RunChainHOP__build_chains = {__Pyx_NAMESTR("_build_chains"), (PyCFunction)__pyx_pf_2yt_5lagos_8chainHOP_8chainHOP_11RunChainHOP__build_chains, METH_O, __Pyx_DOCSTR(__pyx_doc_2yt_5lagos_8chainHOP_8chainHOP_11RunChainHOP__build_chains)};
static PyObject *__pyx_pf_2yt_5lagos_8chainHOP_8chainHOP_11RunChainHOP__build_chains(PyObject *__pyx_self, PyObject *__pyx_v_self) {
  long __pyx_v_chainIDmax;
  long __pyx_v_chainIDnew;
  long __pyx_v_i;
  PyObject *__pyx_r = NULL;
  PyObject *__pyx_1 = 0;
  PyObject *__pyx_t_1 = NULL;
  long __pyx_t_2;
  long __pyx_t_3;
  int __pyx_t_4;
  int __pyx_t_5;
  int __pyx_t_6;
  PyObject *__pyx_t_7 = NULL;
  int __pyx_t_8;
  PyObject *__pyx_t_9 = NULL;
  PyObject *__pyx_t_10 = NULL;
  long __pyx_t_11;
  __Pyx_SetupRefcountContext("_build_chains");
  __pyx_self = __pyx_self;

  /* "/Users/sskory/Documents/yt-devel/yt/lagos/chainHOP/chainHOP.pyx":253
 *         """
 *         cdef long chainIDmax, chainIDnew, i
 *         chainIDmax = 0             # <<<<<<<<<<<<<<
 *         self.densest_in_chain = {} # chainID->part ID, one to one
 *         for i in xrange(self.size):
 */
  __pyx_v_chainIDmax = 0;

  /* "/Users/sskory/Documents/yt-devel/yt/lagos/chainHOP/chainHOP.pyx":254
 *         cdef long chainIDmax, chainIDnew, i
 *         chainIDmax = 0
 *         self.densest_in_chain = {} # chainID->part ID, one to one             # <<<<<<<<<<<<<<
 *         for i in xrange(self.size):
 *             # If it's already in a group, move on, or if this particle is
 */
  __pyx_1 = PyDict_New(); if (unlikely(!__pyx_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 254; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(((PyObject *)__pyx_1));
  if (PyObject_SetAttr(__pyx_v_self, __pyx_kp_densest_in_chain, ((PyObject *)__pyx_1)) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 254; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_DECREF(((PyObject *)__pyx_1)); __pyx_1 = 0;

  /* "/Users/sskory/Documents/yt-devel/yt/lagos/chainHOP/chainHOP.pyx":255
 *         chainIDmax = 0
 *         self.densest_in_chain = {} # chainID->part ID, one to one
 *         for i in xrange(self.size):             # <<<<<<<<<<<<<<
 *             # If it's already in a group, move on, or if this particle is
 *             # in the padding, move on because chains can only terminate in
 */
  __pyx_t_1 = PyObject_GetAttr(__pyx_v_self, __pyx_kp_size); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 255; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_t_2 = __Pyx_PyInt_AsLong(__pyx_t_1); if (unlikely((__pyx_t_2 == (long)-1) && PyErr_Occurred())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 255; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  for (__pyx_t_3 = 0; __pyx_t_3 < __pyx_t_2; __pyx_t_3+=1) {
    __pyx_v_i = __pyx_t_3;

    /* "/Users/sskory/Documents/yt-devel/yt/lagos/chainHOP/chainHOP.pyx":260
 *             # the padding, not begin, or if this particle is too low in
 *             # density, move on.
 *             if self.chainID[i] > -1 or not self.is_inside[i] or \             # <<<<<<<<<<<<<<
 *                     self.density[i] < self.threshold:
 *                 continue
 */
    __pyx_t_1 = PyObject_GetAttr(__pyx_v_self, __pyx_kp_chainID); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 260; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_1);
    __pyx_1 = __Pyx_GetItemInt(__pyx_t_1, __pyx_v_i, sizeof(long), PyInt_FromLong); if (!__pyx_1) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 260; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_1);
    __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
    __pyx_t_1 = PyObject_RichCompare(__pyx_1, __pyx_int_neg_1, Py_GT); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 260; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_1);
    __Pyx_DECREF(__pyx_1); __pyx_1 = 0;
    __pyx_t_4 = __Pyx_PyObject_IsTrue(__pyx_t_1); if (unlikely(__pyx_t_4 < 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 260; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
    if (!__pyx_t_4) {
      __pyx_t_1 = PyObject_GetAttr(__pyx_v_self, __pyx_kp_is_inside); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 260; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_t_1);
      __pyx_1 = __Pyx_GetItemInt(__pyx_t_1, __pyx_v_i, sizeof(long), PyInt_FromLong); if (!__pyx_1) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 260; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_1);
      __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
      __pyx_t_5 = __Pyx_PyObject_IsTrue(__pyx_1); if (unlikely(__pyx_t_5 < 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 260; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_DECREF(__pyx_1); __pyx_1 = 0;
      __pyx_t_6 = (!__pyx_t_5);
      if (!__pyx_t_6) {

        /* "/Users/sskory/Documents/yt-devel/yt/lagos/chainHOP/chainHOP.pyx":261
 *             # density, move on.
 *             if self.chainID[i] > -1 or not self.is_inside[i] or \
 *                     self.density[i] < self.threshold:             # <<<<<<<<<<<<<<
 *                 continue
 *             chainIDnew = self._recurse_links(i, chainIDmax)
 */
        __pyx_t_1 = PyObject_GetAttr(__pyx_v_self, __pyx_kp_density); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 261; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        __Pyx_GOTREF(__pyx_t_1);
        __pyx_1 = __Pyx_GetItemInt(__pyx_t_1, __pyx_v_i, sizeof(long), PyInt_FromLong); if (!__pyx_1) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 261; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        __Pyx_GOTREF(__pyx_1);
        __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
        __pyx_t_1 = PyObject_GetAttr(__pyx_v_self, __pyx_kp_threshold); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 261; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        __Pyx_GOTREF(__pyx_t_1);
        __pyx_t_7 = PyObject_RichCompare(__pyx_1, __pyx_t_1, Py_LT); if (unlikely(!__pyx_t_7)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 261; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        __Pyx_GOTREF(__pyx_t_7);
        __Pyx_DECREF(__pyx_1); __pyx_1 = 0;
        __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
        __pyx_t_5 = __Pyx_PyObject_IsTrue(__pyx_t_7); if (unlikely(__pyx_t_5 < 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 261; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
        __pyx_t_8 = __pyx_t_5;
      } else {
        __pyx_t_8 = __pyx_t_6;
      }
      __pyx_t_6 = __pyx_t_8;
    } else {
      __pyx_t_6 = __pyx_t_4;
    }
    if (__pyx_t_6) {

      /* "/Users/sskory/Documents/yt-devel/yt/lagos/chainHOP/chainHOP.pyx":262
 *             if self.chainID[i] > -1 or not self.is_inside[i] or \
 *                     self.density[i] < self.threshold:
 *                 continue             # <<<<<<<<<<<<<<
 *             chainIDnew = self._recurse_links(i, chainIDmax)
 *             # If the new chainID returned is the same as we entered, the chain
 */
      goto __pyx_L5_continue;
      goto __pyx_L7;
    }
    __pyx_L7:;

    /* "/Users/sskory/Documents/yt-devel/yt/lagos/chainHOP/chainHOP.pyx":263
 *                     self.density[i] < self.threshold:
 *                 continue
 *             chainIDnew = self._recurse_links(i, chainIDmax)             # <<<<<<<<<<<<<<
 *             # If the new chainID returned is the same as we entered, the chain
 *             # has been named chainIDmax, so we need to start a new chain
 */
    __pyx_t_7 = PyObject_GetAttr(__pyx_v_self, __pyx_kp__recurse_links); if (unlikely(!__pyx_t_7)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 263; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_7);
    __pyx_t_1 = PyInt_FromLong(__pyx_v_i); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 263; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_1);
    __pyx_t_9 = PyInt_FromLong(__pyx_v_chainIDmax); if (unlikely(!__pyx_t_9)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 263; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_9);
    __pyx_t_10 = PyTuple_New(2); if (unlikely(!__pyx_t_10)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 263; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(((PyObject *)__pyx_t_10));
    PyTuple_SET_ITEM(__pyx_t_10, 0, __pyx_t_1);
    __Pyx_GIVEREF(__pyx_t_1);
    PyTuple_SET_ITEM(__pyx_t_10, 1, __pyx_t_9);
    __Pyx_GIVEREF(__pyx_t_9);
    __pyx_t_1 = 0;
    __pyx_t_9 = 0;
    __pyx_t_9 = PyObject_Call(__pyx_t_7, ((PyObject *)__pyx_t_10), NULL); if (unlikely(!__pyx_t_9)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 263; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_9);
    __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
    __Pyx_DECREF(((PyObject *)__pyx_t_10)); __pyx_t_10 = 0;
    __pyx_t_11 = __Pyx_PyInt_AsLong(__pyx_t_9); if (unlikely((__pyx_t_11 == (long)-1) && PyErr_Occurred())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 263; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_DECREF(__pyx_t_9); __pyx_t_9 = 0;
    __pyx_v_chainIDnew = __pyx_t_11;

    /* "/Users/sskory/Documents/yt-devel/yt/lagos/chainHOP/chainHOP.pyx":267
 *             # has been named chainIDmax, so we need to start a new chain
 *             # in the next loop.
 *             if chainIDnew == chainIDmax:             # <<<<<<<<<<<<<<
 *                 chainIDmax += 1
 *         self.padded_particles = na.array(self.padded_particles, dtype='int64')
 */
    __pyx_t_6 = (__pyx_v_chainIDnew == __pyx_v_chainIDmax);
    if (__pyx_t_6) {

      /* "/Users/sskory/Documents/yt-devel/yt/lagos/chainHOP/chainHOP.pyx":268
 *             # in the next loop.
 *             if chainIDnew == chainIDmax:
 *                 chainIDmax += 1             # <<<<<<<<<<<<<<
 *         self.padded_particles = na.array(self.padded_particles, dtype='int64')
 *         return chainIDmax
 */
      __pyx_v_chainIDmax += 1;
      goto __pyx_L8;
    }
    __pyx_L8:;
    __pyx_L5_continue:;
  }

  /* "/Users/sskory/Documents/yt-devel/yt/lagos/chainHOP/chainHOP.pyx":269
 *             if chainIDnew == chainIDmax:
 *                 chainIDmax += 1
 *         self.padded_particles = na.array(self.padded_particles, dtype='int64')             # <<<<<<<<<<<<<<
 *         return chainIDmax
 * 
 */
  __pyx_1 = __Pyx_GetName(__pyx_m, __pyx_kp_na); if (unlikely(!__pyx_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 269; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_1);
  __pyx_t_9 = PyObject_GetAttr(__pyx_1, __pyx_kp_array); if (unlikely(!__pyx_t_9)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 269; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_9);
  __Pyx_DECREF(__pyx_1); __pyx_1 = 0;
  __pyx_t_10 = PyObject_GetAttr(__pyx_v_self, __pyx_kp_padded_particles); if (unlikely(!__pyx_t_10)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 269; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_10);
  __pyx_t_7 = PyTuple_New(1); if (unlikely(!__pyx_t_7)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 269; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(((PyObject *)__pyx_t_7));
  PyTuple_SET_ITEM(__pyx_t_7, 0, __pyx_t_10);
  __Pyx_GIVEREF(__pyx_t_10);
  __pyx_t_10 = 0;
  __pyx_1 = PyDict_New(); if (unlikely(!__pyx_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 269; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(((PyObject *)__pyx_1));
  if (PyDict_SetItem(__pyx_1, __pyx_kp_dtype, __pyx_kp_62) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 269; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __pyx_t_10 = PyEval_CallObjectWithKeywords(__pyx_t_9, ((PyObject *)__pyx_t_7), ((PyObject *)__pyx_1)); if (unlikely(!__pyx_t_10)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 269; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_10);
  __Pyx_DECREF(__pyx_t_9); __pyx_t_9 = 0;
  __Pyx_DECREF(((PyObject *)__pyx_t_7)); __pyx_t_7 = 0;
  __Pyx_DECREF(((PyObject *)__pyx_1)); __pyx_1 = 0;
  if (PyObject_SetAttr(__pyx_v_self, __pyx_kp_padded_particles, __pyx_t_10) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 269; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_DECREF(__pyx_t_10); __pyx_t_10 = 0;

  /* "/Users/sskory/Documents/yt-devel/yt/lagos/chainHOP/chainHOP.pyx":270
 *                 chainIDmax += 1
 *         self.padded_particles = na.array(self.padded_particles, dtype='int64')
 *         return chainIDmax             # <<<<<<<<<<<<<<
 * 
 *     def _recurse_links(object self, long pi, int chainIDmax):
 */
  __Pyx_XDECREF(__pyx_r);
  __pyx_t_10 = PyInt_FromLong(__pyx_v_chainIDmax); if (unlikely(!__pyx_t_10)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 270; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_10);
  __pyx_r = __pyx_t_10;
  __pyx_t_10 = 0;
  goto __pyx_L0;

  __pyx_r = Py_None; __Pyx_INCREF(Py_None);
  goto __pyx_L0;
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_1);
  __Pyx_XDECREF(__pyx_t_1);
  __Pyx_XDECREF(__pyx_t_7);
  __Pyx_XDECREF(__pyx_t_9);
  __Pyx_XDECREF(__pyx_t_10);
  __Pyx_AddTraceback("yt.lagos.chainHOP.chainHOP.RunChainHOP._build_chains");
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_FinishRefcountContext();
  return __pyx_r;
}

/* "/Users/sskory/Documents/yt-devel/yt/lagos/chainHOP/chainHOP.pyx":272
 *         return chainIDmax
 * 
 *     def _recurse_links(object self, long pi, int chainIDmax):             # <<<<<<<<<<<<<<
 *         """
 *         Recurse up the chain to a) a self-highest density particle,
 */

static PyObject *__pyx_pf_2yt_5lagos_8chainHOP_8chainHOP_11RunChainHOP__recurse_links(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static char __pyx_doc_2yt_5lagos_8chainHOP_8chainHOP_11RunChainHOP__recurse_links[] = "\n        Recurse up the chain to a) a self-highest density particle,\n        b) a particle that already has a chainID, then turn it back around\n        assigning that chainID to where we came from. If c) which\n        is a particle in the padding, terminate the chain right then\n        and there, because chains only go one particle deep into the padding.\n        ";
static PyMethodDef __pyx_mdef_2yt_5lagos_8chainHOP_8chainHOP_11RunChainHOP__recurse_links = {__Pyx_NAMESTR("_recurse_links"), (PyCFunction)__pyx_pf_2yt_5lagos_8chainHOP_8chainHOP_11RunChainHOP__recurse_links, METH_VARARGS|METH_KEYWORDS, __Pyx_DOCSTR(__pyx_doc_2yt_5lagos_8chainHOP_8chainHOP_11RunChainHOP__recurse_links)};
static PyObject *__pyx_pf_2yt_5lagos_8chainHOP_8chainHOP_11RunChainHOP__recurse_links(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  PyObject *__pyx_v_self = 0;
  long __pyx_v_pi;
  int __pyx_v_chainIDmax;
  long __pyx_v_nn;
  long __pyx_v_chainIDnew;
  long __pyx_v_nn_chainID;
  PyObject *__pyx_v_inside;
  PyObject *__pyx_r = NULL;
  PyObject *__pyx_1 = 0;
  PyObject *__pyx_t_1 = NULL;
  long __pyx_t_2;
  int __pyx_t_3;
  int __pyx_t_4;
  int __pyx_t_5;
  PyObject *__pyx_t_6 = NULL;
  PyObject *__pyx_t_7 = NULL;
  PyObject *__pyx_t_8 = NULL;
  static PyObject **__pyx_pyargnames[] = {&__pyx_kp_self,&__pyx_kp_pi,&__pyx_kp_chainIDmax,0};
  __Pyx_SetupRefcountContext("_recurse_links");
  __pyx_self = __pyx_self;
  if (unlikely(__pyx_kwds)) {
    Py_ssize_t kw_args = PyDict_Size(__pyx_kwds);
    PyObject* values[3] = {0,0,0};
    switch (PyTuple_GET_SIZE(__pyx_args)) {
      case  3: values[2] = PyTuple_GET_ITEM(__pyx_args, 2);
      case  2: values[1] = PyTuple_GET_ITEM(__pyx_args, 1);
      case  1: values[0] = PyTuple_GET_ITEM(__pyx_args, 0);
      case  0: break;
      default: goto __pyx_L5_argtuple_error;
    }
    switch (PyTuple_GET_SIZE(__pyx_args)) {
      case  0:
      values[0] = PyDict_GetItem(__pyx_kwds, __pyx_kp_self);
      if (likely(values[0])) kw_args--;
      else goto __pyx_L5_argtuple_error;
      case  1:
      values[1] = PyDict_GetItem(__pyx_kwds, __pyx_kp_pi);
      if (likely(values[1])) kw_args--;
      else {
        __Pyx_RaiseArgtupleInvalid("_recurse_links", 1, 3, 3, 1); {__pyx_filename = __pyx_f[0]; __pyx_lineno = 272; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
      }
      case  2:
      values[2] = PyDict_GetItem(__pyx_kwds, __pyx_kp_chainIDmax);
      if (likely(values[2])) kw_args--;
      else {
        __Pyx_RaiseArgtupleInvalid("_recurse_links", 1, 3, 3, 2); {__pyx_filename = __pyx_f[0]; __pyx_lineno = 272; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
      }
    }
    if (unlikely(kw_args > 0)) {
      if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, PyTuple_GET_SIZE(__pyx_args), "_recurse_links") < 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 272; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
    }
    __pyx_v_self = values[0];
    __pyx_v_pi = __Pyx_PyInt_AsLong(values[1]); if (unlikely((__pyx_v_pi == (long)-1) && PyErr_Occurred())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 272; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
    __pyx_v_chainIDmax = __Pyx_PyInt_AsInt(values[2]); if (unlikely((__pyx_v_chainIDmax == (int)-1) && PyErr_Occurred())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 272; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
  } else if (PyTuple_GET_SIZE(__pyx_args) != 3) {
    goto __pyx_L5_argtuple_error;
  } else {
    __pyx_v_self = PyTuple_GET_ITEM(__pyx_args, 0);
    __pyx_v_pi = __Pyx_PyInt_AsLong(PyTuple_GET_ITEM(__pyx_args, 1)); if (unlikely((__pyx_v_pi == (long)-1) && PyErr_Occurred())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 272; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
    __pyx_v_chainIDmax = __Pyx_PyInt_AsInt(PyTuple_GET_ITEM(__pyx_args, 2)); if (unlikely((__pyx_v_chainIDmax == (int)-1) && PyErr_Occurred())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 272; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
  }
  goto __pyx_L4_argument_unpacking_done;
  __pyx_L5_argtuple_error:;
  __Pyx_RaiseArgtupleInvalid("_recurse_links", 1, 3, 3, PyTuple_GET_SIZE(__pyx_args)); {__pyx_filename = __pyx_f[0]; __pyx_lineno = 272; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
  __pyx_L3_error:;
  __Pyx_AddTraceback("yt.lagos.chainHOP.chainHOP.RunChainHOP._recurse_links");
  return NULL;
  __pyx_L4_argument_unpacking_done:;
  __pyx_v_inside = Py_None; __Pyx_INCREF(Py_None);

  /* "/Users/sskory/Documents/yt-devel/yt/lagos/chainHOP/chainHOP.pyx":282
 *         cdef long nn
 *         cdef long chainIDnew, nn_chainID
 *         nn = self.densestNN[pi]             # <<<<<<<<<<<<<<
 *         inside = self.is_inside[pi]
 *         nn_chainID = self.chainID[nn]
 */
  __pyx_t_1 = PyObject_GetAttr(__pyx_v_self, __pyx_kp_densestNN); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 282; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_1 = __Pyx_GetItemInt(__pyx_t_1, __pyx_v_pi, sizeof(long), PyInt_FromLong); if (!__pyx_1) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 282; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_1);
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_t_2 = __Pyx_PyInt_AsLong(__pyx_1); if (unlikely((__pyx_t_2 == (long)-1) && PyErr_Occurred())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 282; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_DECREF(__pyx_1); __pyx_1 = 0;
  __pyx_v_nn = __pyx_t_2;

  /* "/Users/sskory/Documents/yt-devel/yt/lagos/chainHOP/chainHOP.pyx":283
 *         cdef long chainIDnew, nn_chainID
 *         nn = self.densestNN[pi]
 *         inside = self.is_inside[pi]             # <<<<<<<<<<<<<<
 *         nn_chainID = self.chainID[nn]
 *         # Linking to an already chainID-ed particle (don't make links from
 */
  __pyx_t_1 = PyObject_GetAttr(__pyx_v_self, __pyx_kp_is_inside); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 283; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_1 = __Pyx_GetItemInt(__pyx_t_1, __pyx_v_pi, sizeof(long), PyInt_FromLong); if (!__pyx_1) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 283; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_1);
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  __Pyx_DECREF(__pyx_v_inside);
  __pyx_v_inside = __pyx_1;
  __pyx_1 = 0;

  /* "/Users/sskory/Documents/yt-devel/yt/lagos/chainHOP/chainHOP.pyx":284
 *         nn = self.densestNN[pi]
 *         inside = self.is_inside[pi]
 *         nn_chainID = self.chainID[nn]             # <<<<<<<<<<<<<<
 *         # Linking to an already chainID-ed particle (don't make links from
 *         # padded particles!)
 */
  __pyx_t_1 = PyObject_GetAttr(__pyx_v_self, __pyx_kp_chainID); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 284; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_1 = __Pyx_GetItemInt(__pyx_t_1, __pyx_v_nn, sizeof(long), PyInt_FromLong); if (!__pyx_1) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 284; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_1);
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_t_2 = __Pyx_PyInt_AsLong(__pyx_1); if (unlikely((__pyx_t_2 == (long)-1) && PyErr_Occurred())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 284; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_DECREF(__pyx_1); __pyx_1 = 0;
  __pyx_v_nn_chainID = __pyx_t_2;

  /* "/Users/sskory/Documents/yt-devel/yt/lagos/chainHOP/chainHOP.pyx":287
 *         # Linking to an already chainID-ed particle (don't make links from
 *         # padded particles!)
 *         if nn_chainID > -1 and inside:             # <<<<<<<<<<<<<<
 *             self.chainID[pi] = nn_chainID
 *             return nn_chainID
 */
  __pyx_t_3 = (__pyx_v_nn_chainID > -1);
  if (__pyx_t_3) {
    __pyx_t_4 = __Pyx_PyObject_IsTrue(__pyx_v_inside); if (unlikely(__pyx_t_4 < 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 287; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __pyx_t_5 = __pyx_t_4;
  } else {
    __pyx_t_5 = __pyx_t_3;
  }
  if (__pyx_t_5) {

    /* "/Users/sskory/Documents/yt-devel/yt/lagos/chainHOP/chainHOP.pyx":288
 *         # padded particles!)
 *         if nn_chainID > -1 and inside:
 *             self.chainID[pi] = nn_chainID             # <<<<<<<<<<<<<<
 *             return nn_chainID
 *         # If pi is a self-most dense particle or inside the padding, end/create
 */
    __pyx_t_1 = PyInt_FromLong(__pyx_v_nn_chainID); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 288; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_1);
    __pyx_t_6 = PyObject_GetAttr(__pyx_v_self, __pyx_kp_chainID); if (unlikely(!__pyx_t_6)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 288; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_6);
    if (__Pyx_SetItemInt(__pyx_t_6, __pyx_v_pi, __pyx_t_1, sizeof(long), PyInt_FromLong) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 288; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
    __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;

    /* "/Users/sskory/Documents/yt-devel/yt/lagos/chainHOP/chainHOP.pyx":289
 *         if nn_chainID > -1 and inside:
 *             self.chainID[pi] = nn_chainID
 *             return nn_chainID             # <<<<<<<<<<<<<<
 *         # If pi is a self-most dense particle or inside the padding, end/create
 *         # a new chain.
 */
    __Pyx_XDECREF(__pyx_r);
    __pyx_t_1 = PyInt_FromLong(__pyx_v_nn_chainID); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 289; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_1);
    __pyx_r = __pyx_t_1;
    __pyx_t_1 = 0;
    goto __pyx_L0;
    goto __pyx_L6;
  }

  /* "/Users/sskory/Documents/yt-devel/yt/lagos/chainHOP/chainHOP.pyx":292
 *         # If pi is a self-most dense particle or inside the padding, end/create
 *         # a new chain.
 *         elif nn == pi or not inside:             # <<<<<<<<<<<<<<
 *             self.chainID[pi] = chainIDmax
 *             self.densest_in_chain[chainIDmax] = self.density[pi]
 */
  if (!(__pyx_v_nn == __pyx_v_pi)) {
    __pyx_t_5 = __Pyx_PyObject_IsTrue(__pyx_v_inside); if (unlikely(__pyx_t_5 < 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 292; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __pyx_t_3 = (!__pyx_t_5);
  } else {
    __pyx_t_3 = (__pyx_v_nn == __pyx_v_pi);
  }
  if (__pyx_t_3) {

    /* "/Users/sskory/Documents/yt-devel/yt/lagos/chainHOP/chainHOP.pyx":293
 *         # a new chain.
 *         elif nn == pi or not inside:
 *             self.chainID[pi] = chainIDmax             # <<<<<<<<<<<<<<
 *             self.densest_in_chain[chainIDmax] = self.density[pi]
 *             # if this is a padded particle, record it for later
 */
    __pyx_t_1 = PyInt_FromLong(__pyx_v_chainIDmax); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 293; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_1);
    __pyx_t_6 = PyObject_GetAttr(__pyx_v_self, __pyx_kp_chainID); if (unlikely(!__pyx_t_6)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 293; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_6);
    if (__Pyx_SetItemInt(__pyx_t_6, __pyx_v_pi, __pyx_t_1, sizeof(long), PyInt_FromLong) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 293; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
    __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;

    /* "/Users/sskory/Documents/yt-devel/yt/lagos/chainHOP/chainHOP.pyx":294
 *         elif nn == pi or not inside:
 *             self.chainID[pi] = chainIDmax
 *             self.densest_in_chain[chainIDmax] = self.density[pi]             # <<<<<<<<<<<<<<
 *             # if this is a padded particle, record it for later
 *             if not inside:
 */
    __pyx_t_1 = PyObject_GetAttr(__pyx_v_self, __pyx_kp_density); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 294; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_1);
    __pyx_1 = __Pyx_GetItemInt(__pyx_t_1, __pyx_v_pi, sizeof(long), PyInt_FromLong); if (!__pyx_1) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 294; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_1);
    __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
    __pyx_t_1 = PyObject_GetAttr(__pyx_v_self, __pyx_kp_densest_in_chain); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 294; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_1);
    if (__Pyx_SetItemInt(__pyx_t_1, __pyx_v_chainIDmax, __pyx_1, sizeof(int), PyInt_FromLong) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 294; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
    __Pyx_DECREF(__pyx_1); __pyx_1 = 0;

    /* "/Users/sskory/Documents/yt-devel/yt/lagos/chainHOP/chainHOP.pyx":296
 *             self.densest_in_chain[chainIDmax] = self.density[pi]
 *             # if this is a padded particle, record it for later
 *             if not inside:             # <<<<<<<<<<<<<<
 *                 self.padded_particles.append(pi)
 *             return chainIDmax
 */
    __pyx_t_3 = __Pyx_PyObject_IsTrue(__pyx_v_inside); if (unlikely(__pyx_t_3 < 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 296; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __pyx_t_5 = (!__pyx_t_3);
    if (__pyx_t_5) {

      /* "/Users/sskory/Documents/yt-devel/yt/lagos/chainHOP/chainHOP.pyx":297
 *             # if this is a padded particle, record it for later
 *             if not inside:
 *                 self.padded_particles.append(pi)             # <<<<<<<<<<<<<<
 *             return chainIDmax
 *         # Otherwise, recursively link to nearest neighbors.
 */
      __pyx_t_1 = PyObject_GetAttr(__pyx_v_self, __pyx_kp_padded_particles); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 297; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_t_1);
      __pyx_t_6 = PyInt_FromLong(__pyx_v_pi); if (unlikely(!__pyx_t_6)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 297; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_t_6);
      __pyx_t_7 = __Pyx_PyObject_Append(__pyx_t_1, __pyx_t_6); if (unlikely(!__pyx_t_7)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 297; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_t_7);
      __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
      __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
      __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
      goto __pyx_L7;
    }
    __pyx_L7:;

    /* "/Users/sskory/Documents/yt-devel/yt/lagos/chainHOP/chainHOP.pyx":298
 *             if not inside:
 *                 self.padded_particles.append(pi)
 *             return chainIDmax             # <<<<<<<<<<<<<<
 *         # Otherwise, recursively link to nearest neighbors.
 *         else:
 */
    __Pyx_XDECREF(__pyx_r);
    __pyx_t_7 = PyInt_FromLong(__pyx_v_chainIDmax); if (unlikely(!__pyx_t_7)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 298; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_7);
    __pyx_r = __pyx_t_7;
    __pyx_t_7 = 0;
    goto __pyx_L0;
    goto __pyx_L6;
  }
  /*else*/ {

    /* "/Users/sskory/Documents/yt-devel/yt/lagos/chainHOP/chainHOP.pyx":301
 *         # Otherwise, recursively link to nearest neighbors.
 *         else:
 *             chainIDnew = self._recurse_links(nn, chainIDmax)             # <<<<<<<<<<<<<<
 *             self.chainID[pi] = chainIDnew
 *             return chainIDnew
 */
    __pyx_t_7 = PyObject_GetAttr(__pyx_v_self, __pyx_kp__recurse_links); if (unlikely(!__pyx_t_7)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 301; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_7);
    __pyx_t_6 = PyInt_FromLong(__pyx_v_nn); if (unlikely(!__pyx_t_6)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 301; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_6);
    __pyx_t_1 = PyInt_FromLong(__pyx_v_chainIDmax); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 301; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_1);
    __pyx_t_8 = PyTuple_New(2); if (unlikely(!__pyx_t_8)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 301; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(((PyObject *)__pyx_t_8));
    PyTuple_SET_ITEM(__pyx_t_8, 0, __pyx_t_6);
    __Pyx_GIVEREF(__pyx_t_6);
    PyTuple_SET_ITEM(__pyx_t_8, 1, __pyx_t_1);
    __Pyx_GIVEREF(__pyx_t_1);
    __pyx_t_6 = 0;
    __pyx_t_1 = 0;
    __pyx_t_1 = PyObject_Call(__pyx_t_7, ((PyObject *)__pyx_t_8), NULL); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 301; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_1);
    __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
    __Pyx_DECREF(((PyObject *)__pyx_t_8)); __pyx_t_8 = 0;
    __pyx_t_2 = __Pyx_PyInt_AsLong(__pyx_t_1); if (unlikely((__pyx_t_2 == (long)-1) && PyErr_Occurred())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 301; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
    __pyx_v_chainIDnew = __pyx_t_2;

    /* "/Users/sskory/Documents/yt-devel/yt/lagos/chainHOP/chainHOP.pyx":302
 *         else:
 *             chainIDnew = self._recurse_links(nn, chainIDmax)
 *             self.chainID[pi] = chainIDnew             # <<<<<<<<<<<<<<
 *             return chainIDnew
 * 
 */
    __pyx_t_1 = PyInt_FromLong(__pyx_v_chainIDnew); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 302; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_1);
    __pyx_t_8 = PyObject_GetAttr(__pyx_v_self, __pyx_kp_chainID); if (unlikely(!__pyx_t_8)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 302; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_8);
    if (__Pyx_SetItemInt(__pyx_t_8, __pyx_v_pi, __pyx_t_1, sizeof(long), PyInt_FromLong) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 302; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
    __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;

    /* "/Users/sskory/Documents/yt-devel/yt/lagos/chainHOP/chainHOP.pyx":303
 *             chainIDnew = self._recurse_links(nn, chainIDmax)
 *             self.chainID[pi] = chainIDnew
 *             return chainIDnew             # <<<<<<<<<<<<<<
 * 
 *     def _globally_assign_chainIDs(object self, int chain_count):
 */
    __Pyx_XDECREF(__pyx_r);
    __pyx_t_1 = PyInt_FromLong(__pyx_v_chainIDnew); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 303; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_1);
    __pyx_r = __pyx_t_1;
    __pyx_t_1 = 0;
    goto __pyx_L0;
  }
  __pyx_L6:;

  __pyx_r = Py_None; __Pyx_INCREF(Py_None);
  goto __pyx_L0;
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_1);
  __Pyx_XDECREF(__pyx_t_1);
  __Pyx_XDECREF(__pyx_t_6);
  __Pyx_XDECREF(__pyx_t_7);
  __Pyx_XDECREF(__pyx_t_8);
  __Pyx_AddTraceback("yt.lagos.chainHOP.chainHOP.RunChainHOP._recurse_links");
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_DECREF(__pyx_v_inside);
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_FinishRefcountContext();
  return __pyx_r;
}

/* "/Users/sskory/Documents/yt-devel/yt/lagos/chainHOP/chainHOP.pyx":305
 *             return chainIDnew
 * 
 *     def _globally_assign_chainIDs(object self, int chain_count):             # <<<<<<<<<<<<<<
 *         """
 *         Convert local chainIDs into globally unique chainIDs.
 */

static PyObject *__pyx_pf_2yt_5lagos_8chainHOP_8chainHOP_11RunChainHOP__globally_assign_chainIDs(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static char __pyx_doc_2yt_5lagos_8chainHOP_8chainHOP_11RunChainHOP__globally_assign_chainIDs[] = "\n        Convert local chainIDs into globally unique chainIDs.\n        ";
static PyMethodDef __pyx_mdef_2yt_5lagos_8chainHOP_8chainHOP_11RunChainHOP__globally_assign_chainIDs = {__Pyx_NAMESTR("_globally_assign_chainIDs"), (PyCFunction)__pyx_pf_2yt_5lagos_8chainHOP_8chainHOP_11RunChainHOP__globally_assign_chainIDs, METH_VARARGS|METH_KEYWORDS, __Pyx_DOCSTR(__pyx_doc_2yt_5lagos_8chainHOP_8chainHOP_11RunChainHOP__globally_assign_chainIDs)};
static PyObject *__pyx_pf_2yt_5lagos_8chainHOP_8chainHOP_11RunChainHOP__globally_assign_chainIDs(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  PyObject *__pyx_v_self = 0;
  int __pyx_v_chain_count;
  PyArrayObject *__pyx_v_select;
  PyObject *__pyx_v_chain_info;
  PyObject *__pyx_v_k;
  PyObject *__pyx_v_v;
  PyObject *__pyx_r = NULL;
  PyObject *__pyx_1 = 0;
  PyObject *__pyx_2 = 0;
  PyObject *__pyx_3 = 0;
  PyObject *__pyx_t_1 = NULL;
  PyObject *__pyx_t_2 = NULL;
  PyObject *__pyx_t_3 = NULL;
  Py_ssize_t __pyx_t_4;
  PyObject *__pyx_t_5 = NULL;
  int __pyx_t_6;
  int __pyx_t_7;
  static PyObject **__pyx_pyargnames[] = {&__pyx_kp_self,&__pyx_kp_chain_count,0};
  __Pyx_SetupRefcountContext("_globally_assign_chainIDs");
  __pyx_self = __pyx_self;
  if (unlikely(__pyx_kwds)) {
    Py_ssize_t kw_args = PyDict_Size(__pyx_kwds);
    PyObject* values[2] = {0,0};
    switch (PyTuple_GET_SIZE(__pyx_args)) {
      case  2: values[1] = PyTuple_GET_ITEM(__pyx_args, 1);
      case  1: values[0] = PyTuple_GET_ITEM(__pyx_args, 0);
      case  0: break;
      default: goto __pyx_L5_argtuple_error;
    }
    switch (PyTuple_GET_SIZE(__pyx_args)) {
      case  0:
      values[0] = PyDict_GetItem(__pyx_kwds, __pyx_kp_self);
      if (likely(values[0])) kw_args--;
      else goto __pyx_L5_argtuple_error;
      case  1:
      values[1] = PyDict_GetItem(__pyx_kwds, __pyx_kp_chain_count);
      if (likely(values[1])) kw_args--;
      else {
        __Pyx_RaiseArgtupleInvalid("_globally_assign_chainIDs", 1, 2, 2, 1); {__pyx_filename = __pyx_f[0]; __pyx_lineno = 305; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
      }
    }
    if (unlikely(kw_args > 0)) {
      if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, PyTuple_GET_SIZE(__pyx_args), "_globally_assign_chainIDs") < 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 305; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
    }
    __pyx_v_self = values[0];
    __pyx_v_chain_count = __Pyx_PyInt_AsInt(values[1]); if (unlikely((__pyx_v_chain_count == (int)-1) && PyErr_Occurred())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 305; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
  } else if (PyTuple_GET_SIZE(__pyx_args) != 2) {
    goto __pyx_L5_argtuple_error;
  } else {
    __pyx_v_self = PyTuple_GET_ITEM(__pyx_args, 0);
    __pyx_v_chain_count = __Pyx_PyInt_AsInt(PyTuple_GET_ITEM(__pyx_args, 1)); if (unlikely((__pyx_v_chain_count == (int)-1) && PyErr_Occurred())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 305; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
  }
  goto __pyx_L4_argument_unpacking_done;
  __pyx_L5_argtuple_error:;
  __Pyx_RaiseArgtupleInvalid("_globally_assign_chainIDs", 1, 2, 2, PyTuple_GET_SIZE(__pyx_args)); {__pyx_filename = __pyx_f[0]; __pyx_lineno = 305; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
  __pyx_L3_error:;
  __Pyx_AddTraceback("yt.lagos.chainHOP.chainHOP.RunChainHOP._globally_assign_chainIDs");
  return NULL;
  __pyx_L4_argument_unpacking_done:;
  __pyx_v_select = ((PyArrayObject *)Py_None); __Pyx_INCREF(Py_None);
  __pyx_v_chain_info = Py_None; __Pyx_INCREF(Py_None);
  __pyx_v_k = Py_None; __Pyx_INCREF(Py_None);
  __pyx_v_v = Py_None; __Pyx_INCREF(Py_None);

  /* "/Users/sskory/Documents/yt-devel/yt/lagos/chainHOP/chainHOP.pyx":311
 *         cdef na.ndarray select
 *         # First find out the number of chains on each processor.
 *         self.mine, chain_info = self._mpi_info_dict(chain_count)             # <<<<<<<<<<<<<<
 *         self.nchains = sum(chain_info.values())
 *         # Figure out our offset.
 */
  __pyx_t_1 = PyObject_GetAttr(__pyx_v_self, __pyx_kp__mpi_info_dict); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 311; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_t_2 = PyInt_FromLong(__pyx_v_chain_count); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 311; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_2);
  __pyx_t_3 = PyTuple_New(1); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 311; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(((PyObject *)__pyx_t_3));
  PyTuple_SET_ITEM(__pyx_t_3, 0, __pyx_t_2);
  __Pyx_GIVEREF(__pyx_t_2);
  __pyx_t_2 = 0;
  __pyx_t_2 = PyObject_Call(__pyx_t_1, ((PyObject *)__pyx_t_3), NULL); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 311; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_2);
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  __Pyx_DECREF(((PyObject *)__pyx_t_3)); __pyx_t_3 = 0;
  if (PyTuple_CheckExact(__pyx_t_2) && likely(PyTuple_GET_SIZE(__pyx_t_2) == 2)) {
    PyObject* tuple = __pyx_t_2;
    __pyx_2 = PyTuple_GET_ITEM(tuple, 0); __Pyx_INCREF(__pyx_2);
    __pyx_3 = PyTuple_GET_ITEM(tuple, 1); __Pyx_INCREF(__pyx_3);
    __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
    if (PyObject_SetAttr(__pyx_v_self, __pyx_kp_mine, __pyx_2) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 311; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_DECREF(__pyx_2); __pyx_2 = 0;
    __Pyx_DECREF(__pyx_v_chain_info);
    __pyx_v_chain_info = __pyx_3;
    __pyx_3 = 0;
  } else {
    __pyx_1 = PyObject_GetIter(__pyx_t_2); if (unlikely(!__pyx_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 311; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_1);
    __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
    __pyx_2 = __Pyx_UnpackItem(__pyx_1, 0); if (unlikely(!__pyx_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 311; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_2);
    __pyx_3 = __Pyx_UnpackItem(__pyx_1, 1); if (unlikely(!__pyx_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 311; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_3);
    if (__Pyx_EndUnpack(__pyx_1) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 311; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_DECREF(__pyx_1); __pyx_1 = 0;
    if (PyObject_SetAttr(__pyx_v_self, __pyx_kp_mine, __pyx_2) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 311; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_DECREF(__pyx_2); __pyx_2 = 0;
    __Pyx_DECREF(__pyx_v_chain_info);
    __pyx_v_chain_info = __pyx_3;
    __pyx_3 = 0;
  }

  /* "/Users/sskory/Documents/yt-devel/yt/lagos/chainHOP/chainHOP.pyx":312
 *         # First find out the number of chains on each processor.
 *         self.mine, chain_info = self._mpi_info_dict(chain_count)
 *         self.nchains = sum(chain_info.values())             # <<<<<<<<<<<<<<
 *         # Figure out our offset.
 *         self.my_first_id = sum([v for k,v in chain_info.items() if k < self.mine])
 */
  __pyx_t_2 = PyObject_GetAttr(__pyx_v_chain_info, __pyx_kp_values); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 312; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_2);
  __pyx_t_3 = PyObject_Call(__pyx_t_2, ((PyObject *)__pyx_empty_tuple), NULL); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 312; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_3);
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_t_2 = PyTuple_New(1); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 312; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(((PyObject *)__pyx_t_2));
  PyTuple_SET_ITEM(__pyx_t_2, 0, __pyx_t_3);
  __Pyx_GIVEREF(__pyx_t_3);
  __pyx_t_3 = 0;
  __pyx_t_3 = PyObject_Call(__pyx_builtin_sum, ((PyObject *)__pyx_t_2), NULL); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 312; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_3);
  __Pyx_DECREF(((PyObject *)__pyx_t_2)); __pyx_t_2 = 0;
  if (PyObject_SetAttr(__pyx_v_self, __pyx_kp_nchains, __pyx_t_3) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 312; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;

  /* "/Users/sskory/Documents/yt-devel/yt/lagos/chainHOP/chainHOP.pyx":314
 *         self.nchains = sum(chain_info.values())
 *         # Figure out our offset.
 *         self.my_first_id = sum([v for k,v in chain_info.items() if k < self.mine])             # <<<<<<<<<<<<<<
 *         # Change particle IDs, -1 always means no chain assignment.
 *         select = (self.chainID != -1)
 */
  __pyx_t_3 = PyList_New(0); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 314; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(((PyObject *)__pyx_t_3));
  __pyx_t_2 = PyObject_GetAttr(__pyx_v_chain_info, __pyx_kp_items); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 314; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_2);
  __pyx_t_1 = PyObject_Call(__pyx_t_2, ((PyObject *)__pyx_empty_tuple), NULL); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 314; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  if (PyList_CheckExact(__pyx_t_1) || PyTuple_CheckExact(__pyx_t_1)) {
    __pyx_t_4 = 0; __pyx_t_2 = __pyx_t_1; __Pyx_INCREF(__pyx_t_2);
  } else {
    __pyx_t_4 = -1; __pyx_t_2 = PyObject_GetIter(__pyx_t_1); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 314; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_2);
  }
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  for (;;) {
    if (likely(PyList_CheckExact(__pyx_t_2))) {
      if (__pyx_t_4 >= PyList_GET_SIZE(__pyx_t_2)) break;
      __pyx_t_1 = PyList_GET_ITEM(__pyx_t_2, __pyx_t_4); __Pyx_INCREF(__pyx_t_1); __pyx_t_4++;
    } else if (likely(PyTuple_CheckExact(__pyx_t_2))) {
      if (__pyx_t_4 >= PyTuple_GET_SIZE(__pyx_t_2)) break;
      __pyx_t_1 = PyTuple_GET_ITEM(__pyx_t_2, __pyx_t_4); __Pyx_INCREF(__pyx_t_1); __pyx_t_4++;
    } else {
      __pyx_t_1 = PyIter_Next(__pyx_t_2);
      if (!__pyx_t_1) {
        if (unlikely(PyErr_Occurred())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 314; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        break;
      }
      __Pyx_GOTREF(__pyx_t_1);
    }
    if (PyTuple_CheckExact(__pyx_t_1) && likely(PyTuple_GET_SIZE(__pyx_t_1) == 2)) {
      PyObject* tuple = __pyx_t_1;
      __pyx_2 = PyTuple_GET_ITEM(tuple, 0); __Pyx_INCREF(__pyx_2);
      __pyx_3 = PyTuple_GET_ITEM(tuple, 1); __Pyx_INCREF(__pyx_3);
      __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
      __Pyx_DECREF(__pyx_v_k);
      __pyx_v_k = __pyx_2;
      __pyx_2 = 0;
      __Pyx_DECREF(__pyx_v_v);
      __pyx_v_v = __pyx_3;
      __pyx_3 = 0;
    } else {
      __pyx_1 = PyObject_GetIter(__pyx_t_1); if (unlikely(!__pyx_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 314; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_1);
      __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
      __pyx_2 = __Pyx_UnpackItem(__pyx_1, 0); if (unlikely(!__pyx_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 314; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_2);
      __pyx_3 = __Pyx_UnpackItem(__pyx_1, 1); if (unlikely(!__pyx_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 314; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_3);
      if (__Pyx_EndUnpack(__pyx_1) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 314; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_DECREF(__pyx_1); __pyx_1 = 0;
      __Pyx_DECREF(__pyx_v_k);
      __pyx_v_k = __pyx_2;
      __pyx_2 = 0;
      __Pyx_DECREF(__pyx_v_v);
      __pyx_v_v = __pyx_3;
      __pyx_3 = 0;
    }
    __pyx_t_1 = PyObject_GetAttr(__pyx_v_self, __pyx_kp_mine); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 314; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_1);
    __pyx_t_5 = PyObject_RichCompare(__pyx_v_k, __pyx_t_1, Py_LT); if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 314; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_5);
    __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
    __pyx_t_6 = __Pyx_PyObject_IsTrue(__pyx_t_5); if (unlikely(__pyx_t_6 < 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 314; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
    if (__pyx_t_6) {
      __pyx_t_7 = PyList_Append(__pyx_t_3, (PyObject*)__pyx_v_v); if (unlikely(__pyx_t_7)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 314; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      goto __pyx_L8;
    }
    __pyx_L8:;
  }
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_t_2 = PyTuple_New(1); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 314; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(((PyObject *)__pyx_t_2));
  __Pyx_INCREF(((PyObject *)__pyx_t_3));
  PyTuple_SET_ITEM(__pyx_t_2, 0, ((PyObject *)__pyx_t_3));
  __Pyx_GIVEREF(((PyObject *)__pyx_t_3));
  __Pyx_DECREF(((PyObject *)__pyx_t_3)); __pyx_t_3 = 0;
  __pyx_t_3 = PyObject_Call(__pyx_builtin_sum, ((PyObject *)__pyx_t_2), NULL); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 314; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_3);
  __Pyx_DECREF(((PyObject *)__pyx_t_2)); __pyx_t_2 = 0;
  if (PyObject_SetAttr(__pyx_v_self, __pyx_kp_my_first_id, __pyx_t_3) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 314; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;

  /* "/Users/sskory/Documents/yt-devel/yt/lagos/chainHOP/chainHOP.pyx":316
 *         self.my_first_id = sum([v for k,v in chain_info.items() if k < self.mine])
 *         # Change particle IDs, -1 always means no chain assignment.
 *         select = (self.chainID != -1)             # <<<<<<<<<<<<<<
 *         select = select * self.my_first_id
 *         self.chainID += select
 */
  __pyx_t_3 = PyObject_GetAttr(__pyx_v_self, __pyx_kp_chainID); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 316; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_3);
  __pyx_t_2 = PyObject_RichCompare(__pyx_t_3, __pyx_int_neg_1, Py_NE); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 316; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_2);
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  if (!(__Pyx_TypeTest(__pyx_t_2, __pyx_ptype_5numpy_ndarray))) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 316; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_DECREF(((PyObject *)__pyx_v_select));
  __pyx_v_select = ((PyArrayObject *)__pyx_t_2);
  __pyx_t_2 = 0;

  /* "/Users/sskory/Documents/yt-devel/yt/lagos/chainHOP/chainHOP.pyx":317
 *         # Change particle IDs, -1 always means no chain assignment.
 *         select = (self.chainID != -1)
 *         select = select * self.my_first_id             # <<<<<<<<<<<<<<
 *         self.chainID += select
 * 
 */
  __pyx_t_2 = PyObject_GetAttr(__pyx_v_self, __pyx_kp_my_first_id); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 317; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_2);
  __pyx_t_3 = PyNumber_Multiply(((PyObject *)__pyx_v_select), __pyx_t_2); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 317; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_3);
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  if (!(__Pyx_TypeTest(__pyx_t_3, __pyx_ptype_5numpy_ndarray))) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 317; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_DECREF(((PyObject *)__pyx_v_select));
  __pyx_v_select = ((PyArrayObject *)__pyx_t_3);
  __pyx_t_3 = 0;

  /* "/Users/sskory/Documents/yt-devel/yt/lagos/chainHOP/chainHOP.pyx":318
 *         select = (self.chainID != -1)
 *         select = select * self.my_first_id
 *         self.chainID += select             # <<<<<<<<<<<<<<
 * 
 *     def _create_global_densest_in_chain(object self):
 */
  __pyx_t_3 = PyObject_GetAttr(__pyx_v_self, __pyx_kp_chainID); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 318; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_3);
  __pyx_1 = PyNumber_InPlaceAdd(__pyx_t_3, ((PyObject *)__pyx_v_select)); if (unlikely(!__pyx_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 318; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_1);
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  if (PyObject_SetAttr(__pyx_v_self, __pyx_kp_chainID, __pyx_1) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 318; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_DECREF(__pyx_1); __pyx_1 = 0;

  __pyx_r = Py_None; __Pyx_INCREF(Py_None);
  goto __pyx_L0;
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_1);
  __Pyx_XDECREF(__pyx_2);
  __Pyx_XDECREF(__pyx_3);
  __Pyx_XDECREF(__pyx_t_1);
  __Pyx_XDECREF(__pyx_t_2);
  __Pyx_XDECREF(__pyx_t_3);
  __Pyx_XDECREF(__pyx_t_5);
  __Pyx_AddTraceback("yt.lagos.chainHOP.chainHOP.RunChainHOP._globally_assign_chainIDs");
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_DECREF((PyObject *)__pyx_v_select);
  __Pyx_DECREF(__pyx_v_chain_info);
  __Pyx_DECREF(__pyx_v_k);
  __Pyx_DECREF(__pyx_v_v);
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_FinishRefcountContext();
  return __pyx_r;
}

/* "/Users/sskory/Documents/yt-devel/yt/lagos/chainHOP/chainHOP.pyx":320
 *         self.chainID += select
 * 
 *     def _create_global_densest_in_chain(object self):             # <<<<<<<<<<<<<<
 *         """
 *         With the globally unique chainIDs, update densest_in_chain.
 */

static PyObject *__pyx_pf_2yt_5lagos_8chainHOP_8chainHOP_11RunChainHOP__create_global_densest_in_chain(PyObject *__pyx_self, PyObject *__pyx_v_self); /*proto*/
static char __pyx_doc_2yt_5lagos_8chainHOP_8chainHOP_11RunChainHOP__create_global_densest_in_chain[] = "\n        With the globally unique chainIDs, update densest_in_chain.\n        ";
static PyMethodDef __pyx_mdef_2yt_5lagos_8chainHOP_8chainHOP_11RunChainHOP__create_global_densest_in_chain = {__Pyx_NAMESTR("_create_global_densest_in_chain"), (PyCFunction)__pyx_pf_2yt_5lagos_8chainHOP_8chainHOP_11RunChainHOP__create_global_densest_in_chain, METH_O, __Pyx_DOCSTR(__pyx_doc_2yt_5lagos_8chainHOP_8chainHOP_11RunChainHOP__create_global_densest_in_chain)};
static PyObject *__pyx_pf_2yt_5lagos_8chainHOP_8chainHOP_11RunChainHOP__create_global_densest_in_chain(PyObject *__pyx_self, PyObject *__pyx_v_self) {
  PyObject *__pyx_v_temp;
  PyObject *__pyx_v_dens;
  PyObject *__pyx_r = NULL;
  PyObject *__pyx_1 = 0;
  PyObject *__pyx_t_1 = NULL;
  PyObject *__pyx_t_2 = NULL;
  Py_ssize_t __pyx_t_3;
  PyObject *__pyx_t_4 = NULL;
  PyObject *__pyx_t_5 = NULL;
  __Pyx_SetupRefcountContext("_create_global_densest_in_chain");
  __pyx_self = __pyx_self;
  __pyx_v_temp = Py_None; __Pyx_INCREF(Py_None);
  __pyx_v_dens = Py_None; __Pyx_INCREF(Py_None);

  /* "/Users/sskory/Documents/yt-devel/yt/lagos/chainHOP/chainHOP.pyx":325
 *         """
 *         # Shift the values over.
 *         temp = self.densest_in_chain.copy()             # <<<<<<<<<<<<<<
 *         self.densest_in_chain = {}
 *         for dens in temp:
 */
  __pyx_t_1 = PyObject_GetAttr(__pyx_v_self, __pyx_kp_densest_in_chain); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 325; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_t_2 = PyObject_GetAttr(__pyx_t_1, __pyx_kp_copy); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 325; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_2);
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_t_1 = PyObject_Call(__pyx_t_2, ((PyObject *)__pyx_empty_tuple), NULL); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 325; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __Pyx_DECREF(__pyx_v_temp);
  __pyx_v_temp = __pyx_t_1;
  __pyx_t_1 = 0;

  /* "/Users/sskory/Documents/yt-devel/yt/lagos/chainHOP/chainHOP.pyx":326
 *         # Shift the values over.
 *         temp = self.densest_in_chain.copy()
 *         self.densest_in_chain = {}             # <<<<<<<<<<<<<<
 *         for dens in temp:
 *             self.densest_in_chain[dens + self.my_first_id] = temp[dens]
 */
  __pyx_1 = PyDict_New(); if (unlikely(!__pyx_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 326; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(((PyObject *)__pyx_1));
  if (PyObject_SetAttr(__pyx_v_self, __pyx_kp_densest_in_chain, ((PyObject *)__pyx_1)) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 326; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_DECREF(((PyObject *)__pyx_1)); __pyx_1 = 0;

  /* "/Users/sskory/Documents/yt-devel/yt/lagos/chainHOP/chainHOP.pyx":327
 *         temp = self.densest_in_chain.copy()
 *         self.densest_in_chain = {}
 *         for dens in temp:             # <<<<<<<<<<<<<<
 *             self.densest_in_chain[dens + self.my_first_id] = temp[dens]
 *         # Distribute this.
 */
  if (PyList_CheckExact(__pyx_v_temp) || PyTuple_CheckExact(__pyx_v_temp)) {
    __pyx_t_3 = 0; __pyx_t_1 = __pyx_v_temp; __Pyx_INCREF(__pyx_t_1);
  } else {
    __pyx_t_3 = -1; __pyx_t_1 = PyObject_GetIter(__pyx_v_temp); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 327; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_1);
  }
  for (;;) {
    if (likely(PyList_CheckExact(__pyx_t_1))) {
      if (__pyx_t_3 >= PyList_GET_SIZE(__pyx_t_1)) break;
      __pyx_t_2 = PyList_GET_ITEM(__pyx_t_1, __pyx_t_3); __Pyx_INCREF(__pyx_t_2); __pyx_t_3++;
    } else if (likely(PyTuple_CheckExact(__pyx_t_1))) {
      if (__pyx_t_3 >= PyTuple_GET_SIZE(__pyx_t_1)) break;
      __pyx_t_2 = PyTuple_GET_ITEM(__pyx_t_1, __pyx_t_3); __Pyx_INCREF(__pyx_t_2); __pyx_t_3++;
    } else {
      __pyx_t_2 = PyIter_Next(__pyx_t_1);
      if (!__pyx_t_2) {
        if (unlikely(PyErr_Occurred())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 327; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        break;
      }
      __Pyx_GOTREF(__pyx_t_2);
    }
    __Pyx_DECREF(__pyx_v_dens);
    __pyx_v_dens = __pyx_t_2;
    __pyx_t_2 = 0;

    /* "/Users/sskory/Documents/yt-devel/yt/lagos/chainHOP/chainHOP.pyx":328
 *         self.densest_in_chain = {}
 *         for dens in temp:
 *             self.densest_in_chain[dens + self.my_first_id] = temp[dens]             # <<<<<<<<<<<<<<
 *         # Distribute this.
 *         self.densest_in_chain = self._mpi_joindict(self.densest_in_chain)
 */
    __pyx_1 = PyObject_GetItem(__pyx_v_temp, __pyx_v_dens); if (!__pyx_1) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 328; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_1);
    __pyx_t_2 = PyObject_GetAttr(__pyx_v_self, __pyx_kp_densest_in_chain); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 328; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_2);
    __pyx_t_4 = PyObject_GetAttr(__pyx_v_self, __pyx_kp_my_first_id); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 328; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_4);
    __pyx_t_5 = PyNumber_Add(__pyx_v_dens, __pyx_t_4); if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 328; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_5);
    __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
    if (PyObject_SetItem(__pyx_t_2, __pyx_t_5, __pyx_1) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 328; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
    __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
    __Pyx_DECREF(__pyx_1); __pyx_1 = 0;
  }
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;

  /* "/Users/sskory/Documents/yt-devel/yt/lagos/chainHOP/chainHOP.pyx":330
 *             self.densest_in_chain[dens + self.my_first_id] = temp[dens]
 *         # Distribute this.
 *         self.densest_in_chain = self._mpi_joindict(self.densest_in_chain)             # <<<<<<<<<<<<<<
 * 
 *     def _communicate_uphill_info(object self):
 */
  __pyx_t_1 = PyObject_GetAttr(__pyx_v_self, __pyx_kp__mpi_joindict); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 330; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_t_5 = PyObject_GetAttr(__pyx_v_self, __pyx_kp_densest_in_chain); if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 330; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_5);
  __pyx_t_2 = PyTuple_New(1); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 330; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(((PyObject *)__pyx_t_2));
  PyTuple_SET_ITEM(__pyx_t_2, 0, __pyx_t_5);
  __Pyx_GIVEREF(__pyx_t_5);
  __pyx_t_5 = 0;
  __pyx_t_5 = PyObject_Call(__pyx_t_1, ((PyObject *)__pyx_t_2), NULL); if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 330; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_5);
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  __Pyx_DECREF(((PyObject *)__pyx_t_2)); __pyx_t_2 = 0;
  if (PyObject_SetAttr(__pyx_v_self, __pyx_kp_densest_in_chain, __pyx_t_5) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 330; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;

  __pyx_r = Py_None; __Pyx_INCREF(Py_None);
  goto __pyx_L0;
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_1);
  __Pyx_XDECREF(__pyx_t_1);
  __Pyx_XDECREF(__pyx_t_2);
  __Pyx_XDECREF(__pyx_t_4);
  __Pyx_XDECREF(__pyx_t_5);
  __Pyx_AddTraceback("yt.lagos.chainHOP.chainHOP.RunChainHOP._create_global_densest_in_chain");
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_DECREF(__pyx_v_temp);
  __Pyx_DECREF(__pyx_v_dens);
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_FinishRefcountContext();
  return __pyx_r;
}

/* "/Users/sskory/Documents/yt-devel/yt/lagos/chainHOP/chainHOP.pyx":332
 *         self.densest_in_chain = self._mpi_joindict(self.densest_in_chain)
 * 
 *     def _communicate_uphill_info(object self):             # <<<<<<<<<<<<<<
 *         """
 *         Communicate the links to the correct neighbors from uphill_info.
 */

static PyObject *__pyx_pf_2yt_5lagos_8chainHOP_8chainHOP_11RunChainHOP__communicate_uphill_info(PyObject *__pyx_self, PyObject *__pyx_v_self); /*proto*/
static char __pyx_doc_2yt_5lagos_8chainHOP_8chainHOP_11RunChainHOP__communicate_uphill_info[] = "\n        Communicate the links to the correct neighbors from uphill_info.\n        ";
static PyMethodDef __pyx_mdef_2yt_5lagos_8chainHOP_8chainHOP_11RunChainHOP__communicate_uphill_info = {__Pyx_NAMESTR("_communicate_uphill_info"), (PyCFunction)__pyx_pf_2yt_5lagos_8chainHOP_8chainHOP_11RunChainHOP__communicate_uphill_info, METH_O, __Pyx_DOCSTR(__pyx_doc_2yt_5lagos_8chainHOP_8chainHOP_11RunChainHOP__communicate_uphill_info)};
static PyObject *__pyx_pf_2yt_5lagos_8chainHOP_8chainHOP_11RunChainHOP__communicate_uphill_info(PyObject *__pyx_self, PyObject *__pyx_v_self) {
  long __pyx_v_to_recv_count;
  long __pyx_v_size_max;
  long __pyx_v_shift_index;
  long __pyx_v_neighbor;
  long __pyx_v_opp_neighbor;
  long __pyx_v_so_far;
  long __pyx_v_opp_size;
  PyArrayObject *__pyx_v_temp_indices;
  PyArrayObject *__pyx_v_temp_chainIDs;
  PyObject *__pyx_v_shift;
  PyObject *__pyx_v_opp_shift;
  PyObject *__pyx_r = NULL;
  PyObject *__pyx_1 = 0;
  long __pyx_t_1;
  int __pyx_t_2;
  PyObject *__pyx_t_3 = NULL;
  PyObject *__pyx_t_4 = NULL;
  PyObject *__pyx_t_5 = NULL;
  long __pyx_t_6;
  PyObject *__pyx_t_7 = NULL;
  PyObject *__pyx_t_8 = NULL;
  PyObject *__pyx_t_9 = NULL;
  __Pyx_SetupRefcountContext("_communicate_uphill_info");
  __pyx_self = __pyx_self;
  __pyx_v_temp_indices = ((PyArrayObject *)Py_None); __Pyx_INCREF(Py_None);
  __pyx_v_temp_chainIDs = ((PyArrayObject *)Py_None); __Pyx_INCREF(Py_None);
  __pyx_v_shift = Py_None; __Pyx_INCREF(Py_None);
  __pyx_v_opp_shift = Py_None; __Pyx_INCREF(Py_None);

  /* "/Users/sskory/Documents/yt-devel/yt/lagos/chainHOP/chainHOP.pyx":341
 *         # Find out how many particles we're going to receive, and make arrays
 *         # of the right size and type to store them.
 *         to_recv_count = 0             # <<<<<<<<<<<<<<
 *         size_max = 0
 *         for shift_index in xrange(27):
 */
  __pyx_v_to_recv_count = 0;

  /* "/Users/sskory/Documents/yt-devel/yt/lagos/chainHOP/chainHOP.pyx":342
 *         # of the right size and type to store them.
 *         to_recv_count = 0
 *         size_max = 0             # <<<<<<<<<<<<<<
 *         for shift_index in xrange(27):
 *             # Skip ourselves, [0,0,0]
 */
  __pyx_v_size_max = 0;

  /* "/Users/sskory/Documents/yt-devel/yt/lagos/chainHOP/chainHOP.pyx":343
 *         to_recv_count = 0
 *         size_max = 0
 *         for shift_index in xrange(27):             # <<<<<<<<<<<<<<
 *             # Skip ourselves, [0,0,0]
 *             if shift_index==13: continue
 */
  for (__pyx_t_1 = 0; __pyx_t_1 < 27; __pyx_t_1+=1) {
    __pyx_v_shift_index = __pyx_t_1;

    /* "/Users/sskory/Documents/yt-devel/yt/lagos/chainHOP/chainHOP.pyx":345
 *         for shift_index in xrange(27):
 *             # Skip ourselves, [0,0,0]
 *             if shift_index==13: continue             # <<<<<<<<<<<<<<
 *             shift = self._translate_shift(i=shift_index)
 *             neighbor = self._mpi_find_neighbor_3d(shift)
 */
    __pyx_t_2 = (__pyx_v_shift_index == 13);
    if (__pyx_t_2) {
      goto __pyx_L5_continue;
      goto __pyx_L7;
    }
    __pyx_L7:;

    /* "/Users/sskory/Documents/yt-devel/yt/lagos/chainHOP/chainHOP.pyx":346
 *             # Skip ourselves, [0,0,0]
 *             if shift_index==13: continue
 *             shift = self._translate_shift(i=shift_index)             # <<<<<<<<<<<<<<
 *             neighbor = self._mpi_find_neighbor_3d(shift)
 *             # Skip ourselves
 */
    __pyx_t_3 = PyObject_GetAttr(__pyx_v_self, __pyx_kp__translate_shift); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 346; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_3);
    __pyx_1 = PyDict_New(); if (unlikely(!__pyx_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 346; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(((PyObject *)__pyx_1));
    __pyx_t_4 = PyInt_FromLong(__pyx_v_shift_index); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 346; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_4);
    if (PyDict_SetItem(__pyx_1, __pyx_kp_i, __pyx_t_4) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 346; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
    __pyx_t_4 = PyEval_CallObjectWithKeywords(__pyx_t_3, ((PyObject *)__pyx_empty_tuple), ((PyObject *)__pyx_1)); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 346; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_4);
    __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
    __Pyx_DECREF(((PyObject *)__pyx_1)); __pyx_1 = 0;
    __Pyx_DECREF(__pyx_v_shift);
    __pyx_v_shift = __pyx_t_4;
    __pyx_t_4 = 0;

    /* "/Users/sskory/Documents/yt-devel/yt/lagos/chainHOP/chainHOP.pyx":347
 *             if shift_index==13: continue
 *             shift = self._translate_shift(i=shift_index)
 *             neighbor = self._mpi_find_neighbor_3d(shift)             # <<<<<<<<<<<<<<
 *             # Skip ourselves
 *             if neighbor == self.mine: continue
 */
    __pyx_t_4 = PyObject_GetAttr(__pyx_v_self, __pyx_kp_63); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 347; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_4);
    __pyx_t_3 = PyTuple_New(1); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 347; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(((PyObject *)__pyx_t_3));
    __Pyx_INCREF(__pyx_v_shift);
    PyTuple_SET_ITEM(__pyx_t_3, 0, __pyx_v_shift);
    __Pyx_GIVEREF(__pyx_v_shift);
    __pyx_t_5 = PyObject_Call(__pyx_t_4, ((PyObject *)__pyx_t_3), NULL); if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 347; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_5);
    __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
    __Pyx_DECREF(((PyObject *)__pyx_t_3)); __pyx_t_3 = 0;
    __pyx_t_6 = __Pyx_PyInt_AsLong(__pyx_t_5); if (unlikely((__pyx_t_6 == (long)-1) && PyErr_Occurred())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 347; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
    __pyx_v_neighbor = __pyx_t_6;

    /* "/Users/sskory/Documents/yt-devel/yt/lagos/chainHOP/chainHOP.pyx":349
 *             neighbor = self._mpi_find_neighbor_3d(shift)
 *             # Skip ourselves
 *             if neighbor == self.mine: continue             # <<<<<<<<<<<<<<
 *             opp_shift = -1 * shift
 *             opp_neighbor = self._mpi_find_neighbor_3d(opp_shift)
 */
    __pyx_t_5 = PyInt_FromLong(__pyx_v_neighbor); if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 349; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_5);
    __pyx_t_3 = PyObject_GetAttr(__pyx_v_self, __pyx_kp_mine); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 349; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_3);
    __pyx_t_4 = PyObject_RichCompare(__pyx_t_5, __pyx_t_3, Py_EQ); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 349; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_4);
    __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
    __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
    __pyx_t_2 = __Pyx_PyObject_IsTrue(__pyx_t_4); if (unlikely(__pyx_t_2 < 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 349; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
    if (__pyx_t_2) {
      goto __pyx_L5_continue;
      goto __pyx_L8;
    }
    __pyx_L8:;

    /* "/Users/sskory/Documents/yt-devel/yt/lagos/chainHOP/chainHOP.pyx":350
 *             # Skip ourselves
 *             if neighbor == self.mine: continue
 *             opp_shift = -1 * shift             # <<<<<<<<<<<<<<
 *             opp_neighbor = self._mpi_find_neighbor_3d(opp_shift)
 *             to_recv_count += self.global_padded_count[opp_neighbor]
 */
    __pyx_t_4 = PyNumber_Multiply(__pyx_int_neg_1, __pyx_v_shift); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 350; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_4);
    __Pyx_DECREF(__pyx_v_opp_shift);
    __pyx_v_opp_shift = __pyx_t_4;
    __pyx_t_4 = 0;

    /* "/Users/sskory/Documents/yt-devel/yt/lagos/chainHOP/chainHOP.pyx":351
 *             if neighbor == self.mine: continue
 *             opp_shift = -1 * shift
 *             opp_neighbor = self._mpi_find_neighbor_3d(opp_shift)             # <<<<<<<<<<<<<<
 *             to_recv_count += self.global_padded_count[opp_neighbor]
 *             if size_max < self.global_padded_count[opp_neighbor]:
 */
    __pyx_t_4 = PyObject_GetAttr(__pyx_v_self, __pyx_kp_63); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 351; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_4);
    __pyx_t_3 = PyTuple_New(1); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 351; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(((PyObject *)__pyx_t_3));
    __Pyx_INCREF(__pyx_v_opp_shift);
    PyTuple_SET_ITEM(__pyx_t_3, 0, __pyx_v_opp_shift);
    __Pyx_GIVEREF(__pyx_v_opp_shift);
    __pyx_t_5 = PyObject_Call(__pyx_t_4, ((PyObject *)__pyx_t_3), NULL); if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 351; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_5);
    __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
    __Pyx_DECREF(((PyObject *)__pyx_t_3)); __pyx_t_3 = 0;
    __pyx_t_6 = __Pyx_PyInt_AsLong(__pyx_t_5); if (unlikely((__pyx_t_6 == (long)-1) && PyErr_Occurred())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 351; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
    __pyx_v_opp_neighbor = __pyx_t_6;

    /* "/Users/sskory/Documents/yt-devel/yt/lagos/chainHOP/chainHOP.pyx":352
 *             opp_shift = -1 * shift
 *             opp_neighbor = self._mpi_find_neighbor_3d(opp_shift)
 *             to_recv_count += self.global_padded_count[opp_neighbor]             # <<<<<<<<<<<<<<
 *             if size_max < self.global_padded_count[opp_neighbor]:
 *                 size_max = self.global_padded_count[opp_neighbor]
 */
    __pyx_t_5 = PyObject_GetAttr(__pyx_v_self, __pyx_kp_global_padded_count); if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 352; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_5);
    __pyx_1 = __Pyx_GetItemInt(__pyx_t_5, __pyx_v_opp_neighbor, sizeof(long), PyInt_FromLong); if (!__pyx_1) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 352; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_1);
    __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
    __pyx_t_6 = __Pyx_PyInt_AsLong(__pyx_1); if (unlikely((__pyx_t_6 == (long)-1) && PyErr_Occurred())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 352; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_DECREF(__pyx_1); __pyx_1 = 0;
    __pyx_v_to_recv_count += __pyx_t_6;

    /* "/Users/sskory/Documents/yt-devel/yt/lagos/chainHOP/chainHOP.pyx":353
 *             opp_neighbor = self._mpi_find_neighbor_3d(opp_shift)
 *             to_recv_count += self.global_padded_count[opp_neighbor]
 *             if size_max < self.global_padded_count[opp_neighbor]:             # <<<<<<<<<<<<<<
 *                 size_max = self.global_padded_count[opp_neighbor]
 *         self.recv_real_indices = na.empty(to_recv_count, dtype='int64')
 */
    __pyx_t_5 = PyInt_FromLong(__pyx_v_size_max); if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 353; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_5);
    __pyx_t_3 = PyObject_GetAttr(__pyx_v_self, __pyx_kp_global_padded_count); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 353; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_3);
    __pyx_1 = __Pyx_GetItemInt(__pyx_t_3, __pyx_v_opp_neighbor, sizeof(long), PyInt_FromLong); if (!__pyx_1) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 353; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_1);
    __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
    __pyx_t_3 = PyObject_RichCompare(__pyx_t_5, __pyx_1, Py_LT); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 353; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_3);
    __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
    __Pyx_DECREF(__pyx_1); __pyx_1 = 0;
    __pyx_t_2 = __Pyx_PyObject_IsTrue(__pyx_t_3); if (unlikely(__pyx_t_2 < 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 353; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
    if (__pyx_t_2) {

      /* "/Users/sskory/Documents/yt-devel/yt/lagos/chainHOP/chainHOP.pyx":354
 *             to_recv_count += self.global_padded_count[opp_neighbor]
 *             if size_max < self.global_padded_count[opp_neighbor]:
 *                 size_max = self.global_padded_count[opp_neighbor]             # <<<<<<<<<<<<<<
 *         self.recv_real_indices = na.empty(to_recv_count, dtype='int64')
 *         self.recv_chainIDs = na.empty(to_recv_count, dtype='int64')
 */
      __pyx_t_3 = PyObject_GetAttr(__pyx_v_self, __pyx_kp_global_padded_count); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 354; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_t_3);
      __pyx_1 = __Pyx_GetItemInt(__pyx_t_3, __pyx_v_opp_neighbor, sizeof(long), PyInt_FromLong); if (!__pyx_1) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 354; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_1);
      __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
      __pyx_t_6 = __Pyx_PyInt_AsLong(__pyx_1); if (unlikely((__pyx_t_6 == (long)-1) && PyErr_Occurred())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 354; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_DECREF(__pyx_1); __pyx_1 = 0;
      __pyx_v_size_max = __pyx_t_6;
      goto __pyx_L9;
    }
    __pyx_L9:;
    __pyx_L5_continue:;
  }

  /* "/Users/sskory/Documents/yt-devel/yt/lagos/chainHOP/chainHOP.pyx":355
 *             if size_max < self.global_padded_count[opp_neighbor]:
 *                 size_max = self.global_padded_count[opp_neighbor]
 *         self.recv_real_indices = na.empty(to_recv_count, dtype='int64')             # <<<<<<<<<<<<<<
 *         self.recv_chainIDs = na.empty(to_recv_count, dtype='int64')
 *         # It appears that MPI doesn't like it when I slice the buffer, so I
 */
  __pyx_1 = __Pyx_GetName(__pyx_m, __pyx_kp_na); if (unlikely(!__pyx_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 355; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_1);
  __pyx_t_3 = PyObject_GetAttr(__pyx_1, __pyx_kp_empty); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 355; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_3);
  __Pyx_DECREF(__pyx_1); __pyx_1 = 0;
  __pyx_t_5 = PyInt_FromLong(__pyx_v_to_recv_count); if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 355; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_5);
  __pyx_t_4 = PyTuple_New(1); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 355; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(((PyObject *)__pyx_t_4));
  PyTuple_SET_ITEM(__pyx_t_4, 0, __pyx_t_5);
  __Pyx_GIVEREF(__pyx_t_5);
  __pyx_t_5 = 0;
  __pyx_1 = PyDict_New(); if (unlikely(!__pyx_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 355; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(((PyObject *)__pyx_1));
  if (PyDict_SetItem(__pyx_1, __pyx_kp_dtype, __pyx_kp_64) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 355; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __pyx_t_5 = PyEval_CallObjectWithKeywords(__pyx_t_3, ((PyObject *)__pyx_t_4), ((PyObject *)__pyx_1)); if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 355; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_5);
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  __Pyx_DECREF(((PyObject *)__pyx_t_4)); __pyx_t_4 = 0;
  __Pyx_DECREF(((PyObject *)__pyx_1)); __pyx_1 = 0;
  if (PyObject_SetAttr(__pyx_v_self, __pyx_kp_recv_real_indices, __pyx_t_5) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 355; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;

  /* "/Users/sskory/Documents/yt-devel/yt/lagos/chainHOP/chainHOP.pyx":356
 *                 size_max = self.global_padded_count[opp_neighbor]
 *         self.recv_real_indices = na.empty(to_recv_count, dtype='int64')
 *         self.recv_chainIDs = na.empty(to_recv_count, dtype='int64')             # <<<<<<<<<<<<<<
 *         # It appears that MPI doesn't like it when I slice the buffer, so I
 *         # still need temporary arrays, but they don't need to be so large, but
 */
  __pyx_1 = __Pyx_GetName(__pyx_m, __pyx_kp_na); if (unlikely(!__pyx_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 356; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_1);
  __pyx_t_5 = PyObject_GetAttr(__pyx_1, __pyx_kp_empty); if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 356; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_5);
  __Pyx_DECREF(__pyx_1); __pyx_1 = 0;
  __pyx_t_4 = PyInt_FromLong(__pyx_v_to_recv_count); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 356; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_4);
  __pyx_t_3 = PyTuple_New(1); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 356; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(((PyObject *)__pyx_t_3));
  PyTuple_SET_ITEM(__pyx_t_3, 0, __pyx_t_4);
  __Pyx_GIVEREF(__pyx_t_4);
  __pyx_t_4 = 0;
  __pyx_1 = PyDict_New(); if (unlikely(!__pyx_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 356; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(((PyObject *)__pyx_1));
  if (PyDict_SetItem(__pyx_1, __pyx_kp_dtype, __pyx_kp_65) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 356; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __pyx_t_4 = PyEval_CallObjectWithKeywords(__pyx_t_5, ((PyObject *)__pyx_t_3), ((PyObject *)__pyx_1)); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 356; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_4);
  __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
  __Pyx_DECREF(((PyObject *)__pyx_t_3)); __pyx_t_3 = 0;
  __Pyx_DECREF(((PyObject *)__pyx_1)); __pyx_1 = 0;
  if (PyObject_SetAttr(__pyx_v_self, __pyx_kp_recv_chainIDs, __pyx_t_4) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 356; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;

  /* "/Users/sskory/Documents/yt-devel/yt/lagos/chainHOP/chainHOP.pyx":361
 *         # still as large as the largest single thing I might receive. This size
 *         # was calculated above.
 *         temp_indices = na.empty(size_max, dtype='int64')             # <<<<<<<<<<<<<<
 *         temp_chainIDs = na.empty(size_max, dtype='int64')
 *         # Send/receive padded particles to our 26 neighbors.
 */
  __pyx_1 = __Pyx_GetName(__pyx_m, __pyx_kp_na); if (unlikely(!__pyx_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 361; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_1);
  __pyx_t_4 = PyObject_GetAttr(__pyx_1, __pyx_kp_empty); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 361; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_4);
  __Pyx_DECREF(__pyx_1); __pyx_1 = 0;
  __pyx_t_3 = PyInt_FromLong(__pyx_v_size_max); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 361; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_3);
  __pyx_t_5 = PyTuple_New(1); if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 361; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(((PyObject *)__pyx_t_5));
  PyTuple_SET_ITEM(__pyx_t_5, 0, __pyx_t_3);
  __Pyx_GIVEREF(__pyx_t_3);
  __pyx_t_3 = 0;
  __pyx_1 = PyDict_New(); if (unlikely(!__pyx_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 361; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(((PyObject *)__pyx_1));
  if (PyDict_SetItem(__pyx_1, __pyx_kp_dtype, __pyx_kp_66) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 361; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __pyx_t_3 = PyEval_CallObjectWithKeywords(__pyx_t_4, ((PyObject *)__pyx_t_5), ((PyObject *)__pyx_1)); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 361; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_3);
  __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
  __Pyx_DECREF(((PyObject *)__pyx_t_5)); __pyx_t_5 = 0;
  __Pyx_DECREF(((PyObject *)__pyx_1)); __pyx_1 = 0;
  if (!(__Pyx_TypeTest(__pyx_t_3, __pyx_ptype_5numpy_ndarray))) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 361; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_DECREF(((PyObject *)__pyx_v_temp_indices));
  __pyx_v_temp_indices = ((PyArrayObject *)__pyx_t_3);
  __pyx_t_3 = 0;

  /* "/Users/sskory/Documents/yt-devel/yt/lagos/chainHOP/chainHOP.pyx":362
 *         # was calculated above.
 *         temp_indices = na.empty(size_max, dtype='int64')
 *         temp_chainIDs = na.empty(size_max, dtype='int64')             # <<<<<<<<<<<<<<
 *         # Send/receive padded particles to our 26 neighbors.
 *         so_far = 0
 */
  __pyx_1 = __Pyx_GetName(__pyx_m, __pyx_kp_na); if (unlikely(!__pyx_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 362; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_1);
  __pyx_t_3 = PyObject_GetAttr(__pyx_1, __pyx_kp_empty); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 362; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_3);
  __Pyx_DECREF(__pyx_1); __pyx_1 = 0;
  __pyx_t_5 = PyInt_FromLong(__pyx_v_size_max); if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 362; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_5);
  __pyx_t_4 = PyTuple_New(1); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 362; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(((PyObject *)__pyx_t_4));
  PyTuple_SET_ITEM(__pyx_t_4, 0, __pyx_t_5);
  __Pyx_GIVEREF(__pyx_t_5);
  __pyx_t_5 = 0;
  __pyx_1 = PyDict_New(); if (unlikely(!__pyx_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 362; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(((PyObject *)__pyx_1));
  if (PyDict_SetItem(__pyx_1, __pyx_kp_dtype, __pyx_kp_67) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 362; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __pyx_t_5 = PyEval_CallObjectWithKeywords(__pyx_t_3, ((PyObject *)__pyx_t_4), ((PyObject *)__pyx_1)); if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 362; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_5);
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  __Pyx_DECREF(((PyObject *)__pyx_t_4)); __pyx_t_4 = 0;
  __Pyx_DECREF(((PyObject *)__pyx_1)); __pyx_1 = 0;
  if (!(__Pyx_TypeTest(__pyx_t_5, __pyx_ptype_5numpy_ndarray))) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 362; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_DECREF(((PyObject *)__pyx_v_temp_chainIDs));
  __pyx_v_temp_chainIDs = ((PyArrayObject *)__pyx_t_5);
  __pyx_t_5 = 0;

  /* "/Users/sskory/Documents/yt-devel/yt/lagos/chainHOP/chainHOP.pyx":364
 *         temp_chainIDs = na.empty(size_max, dtype='int64')
 *         # Send/receive padded particles to our 26 neighbors.
 *         so_far = 0             # <<<<<<<<<<<<<<
 *         for shift_index in xrange(27):
 *             # Skip ourselves, [0,0,0]
 */
  __pyx_v_so_far = 0;

  /* "/Users/sskory/Documents/yt-devel/yt/lagos/chainHOP/chainHOP.pyx":365
 *         # Send/receive padded particles to our 26 neighbors.
 *         so_far = 0
 *         for shift_index in xrange(27):             # <<<<<<<<<<<<<<
 *             # Skip ourselves, [0,0,0]
 *             if shift_index==13: continue
 */
  for (__pyx_t_1 = 0; __pyx_t_1 < 27; __pyx_t_1+=1) {
    __pyx_v_shift_index = __pyx_t_1;

    /* "/Users/sskory/Documents/yt-devel/yt/lagos/chainHOP/chainHOP.pyx":367
 *         for shift_index in xrange(27):
 *             # Skip ourselves, [0,0,0]
 *             if shift_index==13: continue             # <<<<<<<<<<<<<<
 *             shift = self._translate_shift(i=shift_index)
 *             neighbor = self._mpi_find_neighbor_3d(shift)
 */
    __pyx_t_2 = (__pyx_v_shift_index == 13);
    if (__pyx_t_2) {
      goto __pyx_L10_continue;
      goto __pyx_L12;
    }
    __pyx_L12:;

    /* "/Users/sskory/Documents/yt-devel/yt/lagos/chainHOP/chainHOP.pyx":368
 *             # Skip ourselves, [0,0,0]
 *             if shift_index==13: continue
 *             shift = self._translate_shift(i=shift_index)             # <<<<<<<<<<<<<<
 *             neighbor = self._mpi_find_neighbor_3d(shift)
 *             # Skip ourselves
 */
    __pyx_t_5 = PyObject_GetAttr(__pyx_v_self, __pyx_kp__translate_shift); if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 368; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_5);
    __pyx_1 = PyDict_New(); if (unlikely(!__pyx_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 368; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(((PyObject *)__pyx_1));
    __pyx_t_4 = PyInt_FromLong(__pyx_v_shift_index); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 368; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_4);
    if (PyDict_SetItem(__pyx_1, __pyx_kp_i, __pyx_t_4) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 368; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
    __pyx_t_4 = PyEval_CallObjectWithKeywords(__pyx_t_5, ((PyObject *)__pyx_empty_tuple), ((PyObject *)__pyx_1)); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 368; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_4);
    __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
    __Pyx_DECREF(((PyObject *)__pyx_1)); __pyx_1 = 0;
    __Pyx_DECREF(__pyx_v_shift);
    __pyx_v_shift = __pyx_t_4;
    __pyx_t_4 = 0;

    /* "/Users/sskory/Documents/yt-devel/yt/lagos/chainHOP/chainHOP.pyx":369
 *             if shift_index==13: continue
 *             shift = self._translate_shift(i=shift_index)
 *             neighbor = self._mpi_find_neighbor_3d(shift)             # <<<<<<<<<<<<<<
 *             # Skip ourselves
 *             if neighbor == self.mine: continue
 */
    __pyx_t_4 = PyObject_GetAttr(__pyx_v_self, __pyx_kp_63); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 369; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_4);
    __pyx_t_5 = PyTuple_New(1); if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 369; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(((PyObject *)__pyx_t_5));
    __Pyx_INCREF(__pyx_v_shift);
    PyTuple_SET_ITEM(__pyx_t_5, 0, __pyx_v_shift);
    __Pyx_GIVEREF(__pyx_v_shift);
    __pyx_t_3 = PyObject_Call(__pyx_t_4, ((PyObject *)__pyx_t_5), NULL); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 369; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_3);
    __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
    __Pyx_DECREF(((PyObject *)__pyx_t_5)); __pyx_t_5 = 0;
    __pyx_t_6 = __Pyx_PyInt_AsLong(__pyx_t_3); if (unlikely((__pyx_t_6 == (long)-1) && PyErr_Occurred())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 369; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
    __pyx_v_neighbor = __pyx_t_6;

    /* "/Users/sskory/Documents/yt-devel/yt/lagos/chainHOP/chainHOP.pyx":371
 *             neighbor = self._mpi_find_neighbor_3d(shift)
 *             # Skip ourselves
 *             if neighbor == self.mine: continue             # <<<<<<<<<<<<<<
 *             opp_shift = -1 * shift
 *             opp_neighbor = self._mpi_find_neighbor_3d(opp_shift)
 */
    __pyx_t_3 = PyInt_FromLong(__pyx_v_neighbor); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 371; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_3);
    __pyx_t_5 = PyObject_GetAttr(__pyx_v_self, __pyx_kp_mine); if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 371; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_5);
    __pyx_t_4 = PyObject_RichCompare(__pyx_t_3, __pyx_t_5, Py_EQ); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 371; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_4);
    __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
    __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
    __pyx_t_2 = __Pyx_PyObject_IsTrue(__pyx_t_4); if (unlikely(__pyx_t_2 < 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 371; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
    if (__pyx_t_2) {
      goto __pyx_L10_continue;
      goto __pyx_L13;
    }
    __pyx_L13:;

    /* "/Users/sskory/Documents/yt-devel/yt/lagos/chainHOP/chainHOP.pyx":372
 *             # Skip ourselves
 *             if neighbor == self.mine: continue
 *             opp_shift = -1 * shift             # <<<<<<<<<<<<<<
 *             opp_neighbor = self._mpi_find_neighbor_3d(opp_shift)
 *             opp_size = self.global_padded_count[opp_neighbor]
 */
    __pyx_t_4 = PyNumber_Multiply(__pyx_int_neg_1, __pyx_v_shift); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 372; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_4);
    __Pyx_DECREF(__pyx_v_opp_shift);
    __pyx_v_opp_shift = __pyx_t_4;
    __pyx_t_4 = 0;

    /* "/Users/sskory/Documents/yt-devel/yt/lagos/chainHOP/chainHOP.pyx":373
 *             if neighbor == self.mine: continue
 *             opp_shift = -1 * shift
 *             opp_neighbor = self._mpi_find_neighbor_3d(opp_shift)             # <<<<<<<<<<<<<<
 *             opp_size = self.global_padded_count[opp_neighbor]
 *             MPI.COMM_WORLD.Sendrecv(
 */
    __pyx_t_4 = PyObject_GetAttr(__pyx_v_self, __pyx_kp_63); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 373; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_4);
    __pyx_t_5 = PyTuple_New(1); if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 373; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(((PyObject *)__pyx_t_5));
    __Pyx_INCREF(__pyx_v_opp_shift);
    PyTuple_SET_ITEM(__pyx_t_5, 0, __pyx_v_opp_shift);
    __Pyx_GIVEREF(__pyx_v_opp_shift);
    __pyx_t_3 = PyObject_Call(__pyx_t_4, ((PyObject *)__pyx_t_5), NULL); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 373; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_3);
    __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
    __Pyx_DECREF(((PyObject *)__pyx_t_5)); __pyx_t_5 = 0;
    __pyx_t_6 = __Pyx_PyInt_AsLong(__pyx_t_3); if (unlikely((__pyx_t_6 == (long)-1) && PyErr_Occurred())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 373; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
    __pyx_v_opp_neighbor = __pyx_t_6;

    /* "/Users/sskory/Documents/yt-devel/yt/lagos/chainHOP/chainHOP.pyx":374
 *             opp_shift = -1 * shift
 *             opp_neighbor = self._mpi_find_neighbor_3d(opp_shift)
 *             opp_size = self.global_padded_count[opp_neighbor]             # <<<<<<<<<<<<<<
 *             MPI.COMM_WORLD.Sendrecv(
 *                 [self.uphill_real_indices, MPI.INT], neighbor, 0,
 */
    __pyx_t_3 = PyObject_GetAttr(__pyx_v_self, __pyx_kp_global_padded_count); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 374; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_3);
    __pyx_1 = __Pyx_GetItemInt(__pyx_t_3, __pyx_v_opp_neighbor, sizeof(long), PyInt_FromLong); if (!__pyx_1) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 374; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_1);
    __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
    __pyx_t_6 = __Pyx_PyInt_AsLong(__pyx_1); if (unlikely((__pyx_t_6 == (long)-1) && PyErr_Occurred())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 374; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_DECREF(__pyx_1); __pyx_1 = 0;
    __pyx_v_opp_size = __pyx_t_6;

    /* "/Users/sskory/Documents/yt-devel/yt/lagos/chainHOP/chainHOP.pyx":375
 *             opp_neighbor = self._mpi_find_neighbor_3d(opp_shift)
 *             opp_size = self.global_padded_count[opp_neighbor]
 *             MPI.COMM_WORLD.Sendrecv(             # <<<<<<<<<<<<<<
 *                 [self.uphill_real_indices, MPI.INT], neighbor, 0,
 *                 [temp_indices, MPI.INT], opp_neighbor, 0)
 */
    __pyx_1 = __Pyx_GetName(__pyx_m, __pyx_kp_MPI); if (unlikely(!__pyx_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 375; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_1);
    __pyx_t_3 = PyObject_GetAttr(__pyx_1, __pyx_kp_COMM_WORLD); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 375; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_3);
    __Pyx_DECREF(__pyx_1); __pyx_1 = 0;
    __pyx_t_5 = PyObject_GetAttr(__pyx_t_3, __pyx_kp_Sendrecv); if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 375; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_5);
    __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;

    /* "/Users/sskory/Documents/yt-devel/yt/lagos/chainHOP/chainHOP.pyx":376
 *             opp_size = self.global_padded_count[opp_neighbor]
 *             MPI.COMM_WORLD.Sendrecv(
 *                 [self.uphill_real_indices, MPI.INT], neighbor, 0,             # <<<<<<<<<<<<<<
 *                 [temp_indices, MPI.INT], opp_neighbor, 0)
 *             MPI.COMM_WORLD.Sendrecv(
 */
    __pyx_t_3 = PyObject_GetAttr(__pyx_v_self, __pyx_kp_uphill_real_indices); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 376; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_3);
    __pyx_1 = __Pyx_GetName(__pyx_m, __pyx_kp_MPI); if (unlikely(!__pyx_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 376; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_1);
    __pyx_t_4 = PyObject_GetAttr(__pyx_1, __pyx_kp_INT); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 376; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_4);
    __Pyx_DECREF(__pyx_1); __pyx_1 = 0;
    __pyx_t_7 = PyList_New(2); if (unlikely(!__pyx_t_7)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 376; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(((PyObject *)__pyx_t_7));
    PyList_SET_ITEM(__pyx_t_7, 0, __pyx_t_3);
    __Pyx_GIVEREF(__pyx_t_3);
    PyList_SET_ITEM(__pyx_t_7, 1, __pyx_t_4);
    __Pyx_GIVEREF(__pyx_t_4);
    __pyx_t_3 = 0;
    __pyx_t_4 = 0;
    __pyx_t_4 = PyInt_FromLong(__pyx_v_neighbor); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 376; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_4);

    /* "/Users/sskory/Documents/yt-devel/yt/lagos/chainHOP/chainHOP.pyx":377
 *             MPI.COMM_WORLD.Sendrecv(
 *                 [self.uphill_real_indices, MPI.INT], neighbor, 0,
 *                 [temp_indices, MPI.INT], opp_neighbor, 0)             # <<<<<<<<<<<<<<
 *             MPI.COMM_WORLD.Sendrecv(
 *                 [self.uphill_chainIDs, MPI.INT], neighbor, 0,
 */
    __pyx_1 = __Pyx_GetName(__pyx_m, __pyx_kp_MPI); if (unlikely(!__pyx_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 377; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_1);
    __pyx_t_3 = PyObject_GetAttr(__pyx_1, __pyx_kp_INT); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 377; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_3);
    __Pyx_DECREF(__pyx_1); __pyx_1 = 0;
    __pyx_t_8 = PyList_New(2); if (unlikely(!__pyx_t_8)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 377; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(((PyObject *)__pyx_t_8));
    __Pyx_INCREF(((PyObject *)__pyx_v_temp_indices));
    PyList_SET_ITEM(__pyx_t_8, 0, ((PyObject *)__pyx_v_temp_indices));
    __Pyx_GIVEREF(((PyObject *)__pyx_v_temp_indices));
    PyList_SET_ITEM(__pyx_t_8, 1, __pyx_t_3);
    __Pyx_GIVEREF(__pyx_t_3);
    __pyx_t_3 = 0;
    __pyx_t_3 = PyInt_FromLong(__pyx_v_opp_neighbor); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 377; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_3);
    __pyx_t_9 = PyTuple_New(6); if (unlikely(!__pyx_t_9)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 375; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(((PyObject *)__pyx_t_9));
    PyTuple_SET_ITEM(__pyx_t_9, 0, ((PyObject *)__pyx_t_7));
    __Pyx_GIVEREF(((PyObject *)__pyx_t_7));
    PyTuple_SET_ITEM(__pyx_t_9, 1, __pyx_t_4);
    __Pyx_GIVEREF(__pyx_t_4);
    __Pyx_INCREF(__pyx_int_0);
    PyTuple_SET_ITEM(__pyx_t_9, 2, __pyx_int_0);
    __Pyx_GIVEREF(__pyx_int_0);
    PyTuple_SET_ITEM(__pyx_t_9, 3, ((PyObject *)__pyx_t_8));
    __Pyx_GIVEREF(((PyObject *)__pyx_t_8));
    PyTuple_SET_ITEM(__pyx_t_9, 4, __pyx_t_3);
    __Pyx_GIVEREF(__pyx_t_3);
    __Pyx_INCREF(__pyx_int_0);
    PyTuple_SET_ITEM(__pyx_t_9, 5, __pyx_int_0);
    __Pyx_GIVEREF(__pyx_int_0);
    __pyx_t_7 = 0;
    __pyx_t_4 = 0;
    __pyx_t_8 = 0;
    __pyx_t_3 = 0;
    __pyx_t_3 = PyObject_Call(__pyx_t_5, ((PyObject *)__pyx_t_9), NULL); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 375; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_3);
    __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
    __Pyx_DECREF(((PyObject *)__pyx_t_9)); __pyx_t_9 = 0;
    __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;

    /* "/Users/sskory/Documents/yt-devel/yt/lagos/chainHOP/chainHOP.pyx":378
 *                 [self.uphill_real_indices, MPI.INT], neighbor, 0,
 *                 [temp_indices, MPI.INT], opp_neighbor, 0)
 *             MPI.COMM_WORLD.Sendrecv(             # <<<<<<<<<<<<<<
 *                 [self.uphill_chainIDs, MPI.INT], neighbor, 0,
 *                 [temp_chainIDs, MPI.INT], opp_neighbor, 0)
 */
    __pyx_1 = __Pyx_GetName(__pyx_m, __pyx_kp_MPI); if (unlikely(!__pyx_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 378; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_1);
    __pyx_t_3 = PyObject_GetAttr(__pyx_1, __pyx_kp_COMM_WORLD); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 378; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_3);
    __Pyx_DECREF(__pyx_1); __pyx_1 = 0;
    __pyx_t_9 = PyObject_GetAttr(__pyx_t_3, __pyx_kp_Sendrecv); if (unlikely(!__pyx_t_9)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 378; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_9);
    __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;

    /* "/Users/sskory/Documents/yt-devel/yt/lagos/chainHOP/chainHOP.pyx":379
 *                 [temp_indices, MPI.INT], opp_neighbor, 0)
 *             MPI.COMM_WORLD.Sendrecv(
 *                 [self.uphill_chainIDs, MPI.INT], neighbor, 0,             # <<<<<<<<<<<<<<
 *                 [temp_chainIDs, MPI.INT], opp_neighbor, 0)
 *             # Only save the part of the buffer that we want to the right places
 */
    __pyx_t_3 = PyObject_GetAttr(__pyx_v_self, __pyx_kp_uphill_chainIDs); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 379; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_3);
    __pyx_1 = __Pyx_GetName(__pyx_m, __pyx_kp_MPI); if (unlikely(!__pyx_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 379; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_1);
    __pyx_t_5 = PyObject_GetAttr(__pyx_1, __pyx_kp_INT); if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 379; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_5);
    __Pyx_DECREF(__pyx_1); __pyx_1 = 0;
    __pyx_t_8 = PyList_New(2); if (unlikely(!__pyx_t_8)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 379; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(((PyObject *)__pyx_t_8));
    PyList_SET_ITEM(__pyx_t_8, 0, __pyx_t_3);
    __Pyx_GIVEREF(__pyx_t_3);
    PyList_SET_ITEM(__pyx_t_8, 1, __pyx_t_5);
    __Pyx_GIVEREF(__pyx_t_5);
    __pyx_t_3 = 0;
    __pyx_t_5 = 0;
    __pyx_t_5 = PyInt_FromLong(__pyx_v_neighbor); if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 379; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_5);

    /* "/Users/sskory/Documents/yt-devel/yt/lagos/chainHOP/chainHOP.pyx":380
 *             MPI.COMM_WORLD.Sendrecv(
 *                 [self.uphill_chainIDs, MPI.INT], neighbor, 0,
 *                 [temp_chainIDs, MPI.INT], opp_neighbor, 0)             # <<<<<<<<<<<<<<
 *             # Only save the part of the buffer that we want to the right places
 *             # in the full listing.
 */
    __pyx_1 = __Pyx_GetName(__pyx_m, __pyx_kp_MPI); if (unlikely(!__pyx_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 380; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_1);
    __pyx_t_3 = PyObject_GetAttr(__pyx_1, __pyx_kp_INT); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 380; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_3);
    __Pyx_DECREF(__pyx_1); __pyx_1 = 0;
    __pyx_t_4 = PyList_New(2); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 380; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(((PyObject *)__pyx_t_4));
    __Pyx_INCREF(((PyObject *)__pyx_v_temp_chainIDs));
    PyList_SET_ITEM(__pyx_t_4, 0, ((PyObject *)__pyx_v_temp_chainIDs));
    __Pyx_GIVEREF(((PyObject *)__pyx_v_temp_chainIDs));
    PyList_SET_ITEM(__pyx_t_4, 1, __pyx_t_3);
    __Pyx_GIVEREF(__pyx_t_3);
    __pyx_t_3 = 0;
    __pyx_t_3 = PyInt_FromLong(__pyx_v_opp_neighbor); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 380; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_3);
    __pyx_t_7 = PyTuple_New(6); if (unlikely(!__pyx_t_7)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 378; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(((PyObject *)__pyx_t_7));
    PyTuple_SET_ITEM(__pyx_t_7, 0, ((PyObject *)__pyx_t_8));
    __Pyx_GIVEREF(((PyObject *)__pyx_t_8));
    PyTuple_SET_ITEM(__pyx_t_7, 1, __pyx_t_5);
    __Pyx_GIVEREF(__pyx_t_5);
    __Pyx_INCREF(__pyx_int_0);
    PyTuple_SET_ITEM(__pyx_t_7, 2, __pyx_int_0);
    __Pyx_GIVEREF(__pyx_int_0);
    PyTuple_SET_ITEM(__pyx_t_7, 3, ((PyObject *)__pyx_t_4));
    __Pyx_GIVEREF(((PyObject *)__pyx_t_4));
    PyTuple_SET_ITEM(__pyx_t_7, 4, __pyx_t_3);
    __Pyx_GIVEREF(__pyx_t_3);
    __Pyx_INCREF(__pyx_int_0);
    PyTuple_SET_ITEM(__pyx_t_7, 5, __pyx_int_0);
    __Pyx_GIVEREF(__pyx_int_0);
    __pyx_t_8 = 0;
    __pyx_t_5 = 0;
    __pyx_t_4 = 0;
    __pyx_t_3 = 0;
    __pyx_t_3 = PyObject_Call(__pyx_t_9, ((PyObject *)__pyx_t_7), NULL); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 378; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_3);
    __Pyx_DECREF(__pyx_t_9); __pyx_t_9 = 0;
    __Pyx_DECREF(((PyObject *)__pyx_t_7)); __pyx_t_7 = 0;
    __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;

    /* "/Users/sskory/Documents/yt-devel/yt/lagos/chainHOP/chainHOP.pyx":384
 *             # in the full listing.
 *             self.recv_real_indices[so_far:(so_far + opp_size)] = \
 *                 temp_indices[0:opp_size]             # <<<<<<<<<<<<<<
 *             self.recv_chainIDs[so_far:(so_far + opp_size)] = \
 *                 temp_chainIDs[0:opp_size]
 */
    __pyx_1 = PySequence_GetSlice(((PyObject *)__pyx_v_temp_indices), 0, __pyx_v_opp_size); if (unlikely(!__pyx_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 384; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_1);

    /* "/Users/sskory/Documents/yt-devel/yt/lagos/chainHOP/chainHOP.pyx":383
 *             # Only save the part of the buffer that we want to the right places
 *             # in the full listing.
 *             self.recv_real_indices[so_far:(so_far + opp_size)] = \             # <<<<<<<<<<<<<<
 *                 temp_indices[0:opp_size]
 *             self.recv_chainIDs[so_far:(so_far + opp_size)] = \
 */
    __pyx_t_3 = PyObject_GetAttr(__pyx_v_self, __pyx_kp_recv_real_indices); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 383; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_3);
    if (PySequence_SetSlice(__pyx_t_3, __pyx_v_so_far, (__pyx_v_so_far + __pyx_v_opp_size), __pyx_1) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 383; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
    __Pyx_DECREF(__pyx_1); __pyx_1 = 0;

    /* "/Users/sskory/Documents/yt-devel/yt/lagos/chainHOP/chainHOP.pyx":386
 *                 temp_indices[0:opp_size]
 *             self.recv_chainIDs[so_far:(so_far + opp_size)] = \
 *                 temp_chainIDs[0:opp_size]             # <<<<<<<<<<<<<<
 *             so_far += opp_size
 * 
 */
    __pyx_1 = PySequence_GetSlice(((PyObject *)__pyx_v_temp_chainIDs), 0, __pyx_v_opp_size); if (unlikely(!__pyx_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 386; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_1);

    /* "/Users/sskory/Documents/yt-devel/yt/lagos/chainHOP/chainHOP.pyx":385
 *             self.recv_real_indices[so_far:(so_far + opp_size)] = \
 *                 temp_indices[0:opp_size]
 *             self.recv_chainIDs[so_far:(so_far + opp_size)] = \             # <<<<<<<<<<<<<<
 *                 temp_chainIDs[0:opp_size]
 *             so_far += opp_size
 */
    __pyx_t_3 = PyObject_GetAttr(__pyx_v_self, __pyx_kp_recv_chainIDs); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 385; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_3);
    if (PySequence_SetSlice(__pyx_t_3, __pyx_v_so_far, (__pyx_v_so_far + __pyx_v_opp_size), __pyx_1) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 385; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
    __Pyx_DECREF(__pyx_1); __pyx_1 = 0;

    /* "/Users/sskory/Documents/yt-devel/yt/lagos/chainHOP/chainHOP.pyx":387
 *             self.recv_chainIDs[so_far:(so_far + opp_size)] = \
 *                 temp_chainIDs[0:opp_size]
 *             so_far += opp_size             # <<<<<<<<<<<<<<
 * 
 *     def _recurse_global_chain_links(object self, chainID_translate_map_global, int chainID):
 */
    __pyx_v_so_far += __pyx_v_opp_size;
    __pyx_L10_continue:;
  }

  __pyx_r = Py_None; __Pyx_INCREF(Py_None);
  goto __pyx_L0;
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_1);
  __Pyx_XDECREF(__pyx_t_3);
  __Pyx_XDECREF(__pyx_t_4);
  __Pyx_XDECREF(__pyx_t_5);
  __Pyx_XDECREF(__pyx_t_7);
  __Pyx_XDECREF(__pyx_t_8);
  __Pyx_XDECREF(__pyx_t_9);
  __Pyx_AddTraceback("yt.lagos.chainHOP.chainHOP.RunChainHOP._communicate_uphill_info");
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_DECREF((PyObject *)__pyx_v_temp_indices);
  __Pyx_DECREF((PyObject *)__pyx_v_temp_chainIDs);
  __Pyx_DECREF(__pyx_v_shift);
  __Pyx_DECREF(__pyx_v_opp_shift);
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_FinishRefcountContext();
  return __pyx_r;
}

/* "/Users/sskory/Documents/yt-devel/yt/lagos/chainHOP/chainHOP.pyx":389
 *             so_far += opp_size
 * 
 *     def _recurse_global_chain_links(object self, chainID_translate_map_global, int chainID):             # <<<<<<<<<<<<<<
 *         """
 *         Step up the global chain links until we reach the self-densest chain,
 */

static PyObject *__pyx_pf_2yt_5lagos_8chainHOP_8chainHOP_11RunChainHOP__recurse_global_chain_links(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static char __pyx_doc_2yt_5lagos_8chainHOP_8chainHOP_11RunChainHOP__recurse_global_chain_links[] = "\n        Step up the global chain links until we reach the self-densest chain,\n        very similarly to the recursion of particles to densest nearest\n        neighbors.\n        ";
static PyMethodDef __pyx_mdef_2yt_5lagos_8chainHOP_8chainHOP_11RunChainHOP__recurse_global_chain_links = {__Pyx_NAMESTR("_recurse_global_chain_links"), (PyCFunction)__pyx_pf_2yt_5lagos_8chainHOP_8chainHOP_11RunChainHOP__recurse_global_chain_links, METH_VARARGS|METH_KEYWORDS, __Pyx_DOCSTR(__pyx_doc_2yt_5lagos_8chainHOP_8chainHOP_11RunChainHOP__recurse_global_chain_links)};
static PyObject *__pyx_pf_2yt_5lagos_8chainHOP_8chainHOP_11RunChainHOP__recurse_global_chain_links(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  PyObject *__pyx_v_self = 0;
  PyObject *__pyx_v_chainID_translate_map_global = 0;
  int __pyx_v_chainID;
  long __pyx_v_new_chainID;
  PyObject *__pyx_r = NULL;
  PyObject *__pyx_1 = 0;
  long __pyx_t_1;
  int __pyx_t_2;
  PyObject *__pyx_t_3 = NULL;
  PyObject *__pyx_t_4 = NULL;
  PyObject *__pyx_t_5 = NULL;
  static PyObject **__pyx_pyargnames[] = {&__pyx_kp_self,&__pyx_kp_31,&__pyx_kp_chainID,0};
  __Pyx_SetupRefcountContext("_recurse_global_chain_links");
  __pyx_self = __pyx_self;
  if (unlikely(__pyx_kwds)) {
    Py_ssize_t kw_args = PyDict_Size(__pyx_kwds);
    PyObject* values[3] = {0,0,0};
    switch (PyTuple_GET_SIZE(__pyx_args)) {
      case  3: values[2] = PyTuple_GET_ITEM(__pyx_args, 2);
      case  2: values[1] = PyTuple_GET_ITEM(__pyx_args, 1);
      case  1: values[0] = PyTuple_GET_ITEM(__pyx_args, 0);
      case  0: break;
      default: goto __pyx_L5_argtuple_error;
    }
    switch (PyTuple_GET_SIZE(__pyx_args)) {
      case  0:
      values[0] = PyDict_GetItem(__pyx_kwds, __pyx_kp_self);
      if (likely(values[0])) kw_args--;
      else goto __pyx_L5_argtuple_error;
      case  1:
      values[1] = PyDict_GetItem(__pyx_kwds, __pyx_kp_31);
      if (likely(values[1])) kw_args--;
      else {
        __Pyx_RaiseArgtupleInvalid("_recurse_global_chain_links", 1, 3, 3, 1); {__pyx_filename = __pyx_f[0]; __pyx_lineno = 389; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
      }
      case  2:
      values[2] = PyDict_GetItem(__pyx_kwds, __pyx_kp_chainID);
      if (likely(values[2])) kw_args--;
      else {
        __Pyx_RaiseArgtupleInvalid("_recurse_global_chain_links", 1, 3, 3, 2); {__pyx_filename = __pyx_f[0]; __pyx_lineno = 389; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
      }
    }
    if (unlikely(kw_args > 0)) {
      if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, PyTuple_GET_SIZE(__pyx_args), "_recurse_global_chain_links") < 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 389; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
    }
    __pyx_v_self = values[0];
    __pyx_v_chainID_translate_map_global = values[1];
    __pyx_v_chainID = __Pyx_PyInt_AsInt(values[2]); if (unlikely((__pyx_v_chainID == (int)-1) && PyErr_Occurred())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 389; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
  } else if (PyTuple_GET_SIZE(__pyx_args) != 3) {
    goto __pyx_L5_argtuple_error;
  } else {
    __pyx_v_self = PyTuple_GET_ITEM(__pyx_args, 0);
    __pyx_v_chainID_translate_map_global = PyTuple_GET_ITEM(__pyx_args, 1);
    __pyx_v_chainID = __Pyx_PyInt_AsInt(PyTuple_GET_ITEM(__pyx_args, 2)); if (unlikely((__pyx_v_chainID == (int)-1) && PyErr_Occurred())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 389; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
  }
  goto __pyx_L4_argument_unpacking_done;
  __pyx_L5_argtuple_error:;
  __Pyx_RaiseArgtupleInvalid("_recurse_global_chain_links", 1, 3, 3, PyTuple_GET_SIZE(__pyx_args)); {__pyx_filename = __pyx_f[0]; __pyx_lineno = 389; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
  __pyx_L3_error:;
  __Pyx_AddTraceback("yt.lagos.chainHOP.chainHOP.RunChainHOP._recurse_global_chain_links");
  return NULL;
  __pyx_L4_argument_unpacking_done:;

  /* "/Users/sskory/Documents/yt-devel/yt/lagos/chainHOP/chainHOP.pyx":396
 *         """
 *         cdef long new_chainID
 *         new_chainID = chainID_translate_map_global[chainID]             # <<<<<<<<<<<<<<
 *         if  new_chainID== chainID:
 *             return int(chainID)
 */
  __pyx_1 = __Pyx_GetItemInt(__pyx_v_chainID_translate_map_global, __pyx_v_chainID, sizeof(int), PyInt_FromLong); if (!__pyx_1) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 396; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_1);
  __pyx_t_1 = __Pyx_PyInt_AsLong(__pyx_1); if (unlikely((__pyx_t_1 == (long)-1) && PyErr_Occurred())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 396; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_DECREF(__pyx_1); __pyx_1 = 0;
  __pyx_v_new_chainID = __pyx_t_1;

  /* "/Users/sskory/Documents/yt-devel/yt/lagos/chainHOP/chainHOP.pyx":397
 *         cdef long new_chainID
 *         new_chainID = chainID_translate_map_global[chainID]
 *         if  new_chainID== chainID:             # <<<<<<<<<<<<<<
 *             return int(chainID)
 *         else:
 */
  __pyx_t_2 = (__pyx_v_new_chainID == __pyx_v_chainID);
  if (__pyx_t_2) {

    /* "/Users/sskory/Documents/yt-devel/yt/lagos/chainHOP/chainHOP.pyx":398
 *         new_chainID = chainID_translate_map_global[chainID]
 *         if  new_chainID== chainID:
 *             return int(chainID)             # <<<<<<<<<<<<<<
 *         else:
 *             return self._recurse_global_chain_links(chainID_translate_map_global, new_chainID)
 */
    __Pyx_XDECREF(__pyx_r);
    __pyx_t_3 = PyInt_FromLong(__pyx_v_chainID); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 398; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_3);
    __pyx_t_4 = PyTuple_New(1); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 398; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(((PyObject *)__pyx_t_4));
    PyTuple_SET_ITEM(__pyx_t_4, 0, __pyx_t_3);
    __Pyx_GIVEREF(__pyx_t_3);
    __pyx_t_3 = 0;
    __pyx_t_3 = PyObject_Call(((PyObject *)((PyObject*)&PyInt_Type)), ((PyObject *)__pyx_t_4), NULL); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 398; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_3);
    __Pyx_DECREF(((PyObject *)__pyx_t_4)); __pyx_t_4 = 0;
    __pyx_r = __pyx_t_3;
    __pyx_t_3 = 0;
    goto __pyx_L0;
    goto __pyx_L6;
  }
  /*else*/ {

    /* "/Users/sskory/Documents/yt-devel/yt/lagos/chainHOP/chainHOP.pyx":400
 *             return int(chainID)
 *         else:
 *             return self._recurse_global_chain_links(chainID_translate_map_global, new_chainID)             # <<<<<<<<<<<<<<
 * 
 * 
 */
    __Pyx_XDECREF(__pyx_r);
    __pyx_t_3 = PyObject_GetAttr(__pyx_v_self, __pyx_kp_41); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 400; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_3);
    __pyx_t_4 = PyInt_FromLong(__pyx_v_new_chainID); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 400; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_4);
    __pyx_t_5 = PyTuple_New(2); if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 400; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(((PyObject *)__pyx_t_5));
    __Pyx_INCREF(__pyx_v_chainID_translate_map_global);
    PyTuple_SET_ITEM(__pyx_t_5, 0, __pyx_v_chainID_translate_map_global);
    __Pyx_GIVEREF(__pyx_v_chainID_translate_map_global);
    PyTuple_SET_ITEM(__pyx_t_5, 1, __pyx_t_4);
    __Pyx_GIVEREF(__pyx_t_4);
    __pyx_t_4 = 0;
    __pyx_t_4 = PyObject_Call(__pyx_t_3, ((PyObject *)__pyx_t_5), NULL); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 400; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_4);
    __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
    __Pyx_DECREF(((PyObject *)__pyx_t_5)); __pyx_t_5 = 0;
    __pyx_r = __pyx_t_4;
    __pyx_t_4 = 0;
    goto __pyx_L0;
  }
  __pyx_L6:;

  __pyx_r = Py_None; __Pyx_INCREF(Py_None);
  goto __pyx_L0;
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_1);
  __Pyx_XDECREF(__pyx_t_3);
  __Pyx_XDECREF(__pyx_t_4);
  __Pyx_XDECREF(__pyx_t_5);
  __Pyx_AddTraceback("yt.lagos.chainHOP.chainHOP.RunChainHOP._recurse_global_chain_links");
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_FinishRefcountContext();
  return __pyx_r;
}

/* "/Users/sskory/Documents/yt-devel/yt/lagos/chainHOP/chainHOP.pyx":403
 * 
 * 
 *     def _connect_chains_across_tasks(object self):             # <<<<<<<<<<<<<<
 *         """
 *         Using the uphill links of chains, chains are linked across boundaries.
 */

static PyObject *__pyx_pf_2yt_5lagos_8chainHOP_8chainHOP_11RunChainHOP__connect_chains_across_tasks(PyObject *__pyx_self, PyObject *__pyx_v_self); /*proto*/
static char __pyx_doc_2yt_5lagos_8chainHOP_8chainHOP_11RunChainHOP__connect_chains_across_tasks[] = "\n        Using the uphill links of chains, chains are linked across boundaries.\n        Chains that link to a remote chain are recorded, and a complete dict\n        of chain connections is created, globally. Then chainIDs are\n        reassigned recursively, assigning the ID of the most dense chainID\n        to every chain that links to it.\n        ";
static PyMethodDef __pyx_mdef_2yt_5lagos_8chainHOP_8chainHOP_11RunChainHOP__connect_chains_across_tasks = {__Pyx_NAMESTR("_connect_chains_across_tasks"), (PyCFunction)__pyx_pf_2yt_5lagos_8chainHOP_8chainHOP_11RunChainHOP__connect_chains_across_tasks, METH_O, __Pyx_DOCSTR(__pyx_doc_2yt_5lagos_8chainHOP_8chainHOP_11RunChainHOP__connect_chains_across_tasks)};
static PyObject *__pyx_pf_2yt_5lagos_8chainHOP_8chainHOP_11RunChainHOP__connect_chains_across_tasks(PyObject *__pyx_self, PyObject *__pyx_v_self) {
  long __pyx_v_i;
  long __pyx_v_localID;
  long __pyx_v_target;
  long __pyx_v_new_chainID;
  long __pyx_v_old_chainID;
  long __pyx_v_real_index;
  PyObject *__pyx_v_chainID_translate_map_local;
  PyObject *__pyx_v_chainID_translate_map_global;
  PyObject *__pyx_v_dens_temp;
  PyObject *__pyx_v_key;
  PyObject *__pyx_v_item;
  PyObject *__pyx_v_chain;
  PyObject *__pyx_r = NULL;
  PyObject *__pyx_1 = 0;
  PyObject *__pyx_2 = 0;
  int __pyx_3;
  PyObject *__pyx_t_1 = NULL;
  PyObject *__pyx_t_2 = NULL;
  PyObject *__pyx_t_3 = NULL;
  Py_ssize_t __pyx_t_4;
  long __pyx_t_5;
  long __pyx_t_6;
  int __pyx_t_7;
  int __pyx_t_8;
  PyObject *__pyx_t_9 = NULL;
  PyObject *__pyx_t_10 = NULL;
  long __pyx_t_11;
  __Pyx_SetupRefcountContext("_connect_chains_across_tasks");
  __pyx_self = __pyx_self;
  __pyx_v_chainID_translate_map_local = Py_None; __Pyx_INCREF(Py_None);
  __pyx_v_chainID_translate_map_global = Py_None; __Pyx_INCREF(Py_None);
  __pyx_v_dens_temp = Py_None; __Pyx_INCREF(Py_None);
  __pyx_v_key = Py_None; __Pyx_INCREF(Py_None);
  __pyx_v_item = Py_None; __Pyx_INCREF(Py_None);
  __pyx_v_chain = Py_None; __Pyx_INCREF(Py_None);

  /* "/Users/sskory/Documents/yt-devel/yt/lagos/chainHOP/chainHOP.pyx":414
 *         cdef long real_index
 *         # Remote (lower dens) chain -> local (higher) chain.
 *         chainID_translate_map_local = {}             # <<<<<<<<<<<<<<
 *         # Build the stuff to send.
 *         self.uphill_real_indices = self.index[self.padded_particles]
 */
  __pyx_1 = PyDict_New(); if (unlikely(!__pyx_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 414; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(((PyObject *)__pyx_1));
  __Pyx_DECREF(__pyx_v_chainID_translate_map_local);
  __pyx_v_chainID_translate_map_local = ((PyObject *)__pyx_1);
  __pyx_1 = 0;

  /* "/Users/sskory/Documents/yt-devel/yt/lagos/chainHOP/chainHOP.pyx":416
 *         chainID_translate_map_local = {}
 *         # Build the stuff to send.
 *         self.uphill_real_indices = self.index[self.padded_particles]             # <<<<<<<<<<<<<<
 *         self.uphill_chainIDs = self.chainID[self.padded_particles]
 *         # Now we make a global dict of how many particles each task is
 */
  __pyx_t_1 = PyObject_GetAttr(__pyx_v_self, __pyx_kp_index); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 416; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_t_2 = PyObject_GetAttr(__pyx_v_self, __pyx_kp_padded_particles); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 416; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_2);
  __pyx_1 = PyObject_GetItem(__pyx_t_1, __pyx_t_2); if (!__pyx_1) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 416; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_1);
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  if (PyObject_SetAttr(__pyx_v_self, __pyx_kp_uphill_real_indices, __pyx_1) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 416; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_DECREF(__pyx_1); __pyx_1 = 0;

  /* "/Users/sskory/Documents/yt-devel/yt/lagos/chainHOP/chainHOP.pyx":417
 *         # Build the stuff to send.
 *         self.uphill_real_indices = self.index[self.padded_particles]
 *         self.uphill_chainIDs = self.chainID[self.padded_particles]             # <<<<<<<<<<<<<<
 *         # Now we make a global dict of how many particles each task is
 *         # sending.
 */
  __pyx_t_2 = PyObject_GetAttr(__pyx_v_self, __pyx_kp_chainID); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 417; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_2);
  __pyx_t_1 = PyObject_GetAttr(__pyx_v_self, __pyx_kp_padded_particles); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 417; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_1 = PyObject_GetItem(__pyx_t_2, __pyx_t_1); if (!__pyx_1) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 417; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_1);
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  if (PyObject_SetAttr(__pyx_v_self, __pyx_kp_uphill_chainIDs, __pyx_1) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 417; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_DECREF(__pyx_1); __pyx_1 = 0;

  /* "/Users/sskory/Documents/yt-devel/yt/lagos/chainHOP/chainHOP.pyx":420
 *         # Now we make a global dict of how many particles each task is
 *         # sending.
 *         self.global_padded_count = {self.mine:self.uphill_chainIDs.size}             # <<<<<<<<<<<<<<
 *         self.global_padded_count = self._mpi_joindict(self.global_padded_count)
 *         # Send/receive 'em.
 */
  __pyx_1 = PyDict_New(); if (unlikely(!__pyx_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 420; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(((PyObject *)__pyx_1));
  __pyx_t_1 = PyObject_GetAttr(__pyx_v_self, __pyx_kp_mine); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 420; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_t_2 = PyObject_GetAttr(__pyx_v_self, __pyx_kp_uphill_chainIDs); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 420; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_2);
  __pyx_t_3 = PyObject_GetAttr(__pyx_t_2, __pyx_kp_size); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 420; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_3);
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  if (PyDict_SetItem(__pyx_1, __pyx_t_1, __pyx_t_3) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 420; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  if (PyObject_SetAttr(__pyx_v_self, __pyx_kp_global_padded_count, ((PyObject *)__pyx_1)) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 420; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_DECREF(((PyObject *)__pyx_1)); __pyx_1 = 0;

  /* "/Users/sskory/Documents/yt-devel/yt/lagos/chainHOP/chainHOP.pyx":421
 *         # sending.
 *         self.global_padded_count = {self.mine:self.uphill_chainIDs.size}
 *         self.global_padded_count = self._mpi_joindict(self.global_padded_count)             # <<<<<<<<<<<<<<
 *         # Send/receive 'em.
 *         self._communicate_uphill_info()
 */
  __pyx_t_3 = PyObject_GetAttr(__pyx_v_self, __pyx_kp__mpi_joindict); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 421; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_3);
  __pyx_t_1 = PyObject_GetAttr(__pyx_v_self, __pyx_kp_global_padded_count); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 421; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_t_2 = PyTuple_New(1); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 421; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(((PyObject *)__pyx_t_2));
  PyTuple_SET_ITEM(__pyx_t_2, 0, __pyx_t_1);
  __Pyx_GIVEREF(__pyx_t_1);
  __pyx_t_1 = 0;
  __pyx_t_1 = PyObject_Call(__pyx_t_3, ((PyObject *)__pyx_t_2), NULL); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 421; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  __Pyx_DECREF(((PyObject *)__pyx_t_2)); __pyx_t_2 = 0;
  if (PyObject_SetAttr(__pyx_v_self, __pyx_kp_global_padded_count, __pyx_t_1) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 421; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;

  /* "/Users/sskory/Documents/yt-devel/yt/lagos/chainHOP/chainHOP.pyx":423
 *         self.global_padded_count = self._mpi_joindict(self.global_padded_count)
 *         # Send/receive 'em.
 *         self._communicate_uphill_info()             # <<<<<<<<<<<<<<
 *         # Fix the IDs to localIDs.
 *         for i,real_index in enumerate(self.recv_real_indices):
 */
  __pyx_t_1 = PyObject_GetAttr(__pyx_v_self, __pyx_kp_40); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 423; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_t_2 = PyObject_Call(__pyx_t_1, ((PyObject *)__pyx_empty_tuple), NULL); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 423; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_2);
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;

  /* "/Users/sskory/Documents/yt-devel/yt/lagos/chainHOP/chainHOP.pyx":425
 *         self._communicate_uphill_info()
 *         # Fix the IDs to localIDs.
 *         for i,real_index in enumerate(self.recv_real_indices):             # <<<<<<<<<<<<<<
 *             try:
 *                 localID = self.rev_index[real_index]
 */
  __pyx_t_2 = PyObject_GetAttr(__pyx_v_self, __pyx_kp_recv_real_indices); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 425; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_2);
  __pyx_t_1 = PyTuple_New(1); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 425; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(((PyObject *)__pyx_t_1));
  PyTuple_SET_ITEM(__pyx_t_1, 0, __pyx_t_2);
  __Pyx_GIVEREF(__pyx_t_2);
  __pyx_t_2 = 0;
  __pyx_t_2 = PyObject_Call(__pyx_builtin_enumerate, ((PyObject *)__pyx_t_1), NULL); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 425; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_2);
  __Pyx_DECREF(((PyObject *)__pyx_t_1)); __pyx_t_1 = 0;
  if (PyList_CheckExact(__pyx_t_2) || PyTuple_CheckExact(__pyx_t_2)) {
    __pyx_t_4 = 0; __pyx_t_1 = __pyx_t_2; __Pyx_INCREF(__pyx_t_1);
  } else {
    __pyx_t_4 = -1; __pyx_t_1 = PyObject_GetIter(__pyx_t_2); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 425; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_1);
  }
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  for (;;) {
    if (likely(PyList_CheckExact(__pyx_t_1))) {
      if (__pyx_t_4 >= PyList_GET_SIZE(__pyx_t_1)) break;
      __pyx_t_2 = PyList_GET_ITEM(__pyx_t_1, __pyx_t_4); __Pyx_INCREF(__pyx_t_2); __pyx_t_4++;
    } else if (likely(PyTuple_CheckExact(__pyx_t_1))) {
      if (__pyx_t_4 >= PyTuple_GET_SIZE(__pyx_t_1)) break;
      __pyx_t_2 = PyTuple_GET_ITEM(__pyx_t_1, __pyx_t_4); __Pyx_INCREF(__pyx_t_2); __pyx_t_4++;
    } else {
      __pyx_t_2 = PyIter_Next(__pyx_t_1);
      if (!__pyx_t_2) {
        if (unlikely(PyErr_Occurred())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 425; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        break;
      }
      __Pyx_GOTREF(__pyx_t_2);
    }
    if (PyTuple_CheckExact(__pyx_t_2) && likely(PyTuple_GET_SIZE(__pyx_t_2) == 2)) {
      PyObject* tuple = __pyx_t_2;
      __pyx_2 = PyTuple_GET_ITEM(tuple, 0); __Pyx_INCREF(__pyx_2);
      __pyx_t_5 = __Pyx_PyInt_AsLong(__pyx_2); if (unlikely((__pyx_t_5 == (long)-1) && PyErr_Occurred())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 425; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_DECREF(__pyx_2); __pyx_2 = 0;
      __pyx_2 = PyTuple_GET_ITEM(tuple, 1); __Pyx_INCREF(__pyx_2);
      __pyx_t_6 = __Pyx_PyInt_AsLong(__pyx_2); if (unlikely((__pyx_t_6 == (long)-1) && PyErr_Occurred())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 425; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_DECREF(__pyx_2); __pyx_2 = 0;
      __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
      __pyx_v_i = __pyx_t_5;
      __pyx_v_real_index = __pyx_t_6;
    } else {
      __pyx_1 = PyObject_GetIter(__pyx_t_2); if (unlikely(!__pyx_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 425; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_1);
      __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
      __pyx_2 = __Pyx_UnpackItem(__pyx_1, 0); if (unlikely(!__pyx_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 425; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_2);
      __pyx_t_6 = __Pyx_PyInt_AsLong(__pyx_2); if (unlikely((__pyx_t_6 == (long)-1) && PyErr_Occurred())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 425; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_DECREF(__pyx_2); __pyx_2 = 0;
      __pyx_2 = __Pyx_UnpackItem(__pyx_1, 1); if (unlikely(!__pyx_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 425; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_2);
      __pyx_t_5 = __Pyx_PyInt_AsLong(__pyx_2); if (unlikely((__pyx_t_5 == (long)-1) && PyErr_Occurred())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 425; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_DECREF(__pyx_2); __pyx_2 = 0;
      if (__Pyx_EndUnpack(__pyx_1) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 425; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_DECREF(__pyx_1); __pyx_1 = 0;
      __pyx_v_i = __pyx_t_6;
      __pyx_v_real_index = __pyx_t_5;
    }

    /* "/Users/sskory/Documents/yt-devel/yt/lagos/chainHOP/chainHOP.pyx":426
 *         # Fix the IDs to localIDs.
 *         for i,real_index in enumerate(self.recv_real_indices):
 *             try:             # <<<<<<<<<<<<<<
 *                 localID = self.rev_index[real_index]
 *                 # We don't want to update the chainIDs of my padded particles.
 */
    {
      PyObject *__pyx_save_exc_type, *__pyx_save_exc_value, *__pyx_save_exc_tb;
      __Pyx_ExceptionSave(&__pyx_save_exc_type, &__pyx_save_exc_value, &__pyx_save_exc_tb);
      __Pyx_XGOTREF(__pyx_save_exc_type);
      __Pyx_XGOTREF(__pyx_save_exc_value);
      __Pyx_XGOTREF(__pyx_save_exc_tb);
      /*try:*/ {

        /* "/Users/sskory/Documents/yt-devel/yt/lagos/chainHOP/chainHOP.pyx":427
 *         for i,real_index in enumerate(self.recv_real_indices):
 *             try:
 *                 localID = self.rev_index[real_index]             # <<<<<<<<<<<<<<
 *                 # We don't want to update the chainIDs of my padded particles.
 *                 # Remember we are supposed to be only considering particles
 */
        __pyx_t_2 = PyObject_GetAttr(__pyx_v_self, __pyx_kp_rev_index); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 427; __pyx_clineno = __LINE__; goto __pyx_L7_error;}
        __Pyx_GOTREF(__pyx_t_2);
        __pyx_2 = __Pyx_GetItemInt(__pyx_t_2, __pyx_v_real_index, sizeof(long), PyInt_FromLong); if (!__pyx_2) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 427; __pyx_clineno = __LINE__; goto __pyx_L7_error;}
        __Pyx_GOTREF(__pyx_2);
        __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
        __pyx_t_5 = __Pyx_PyInt_AsLong(__pyx_2); if (unlikely((__pyx_t_5 == (long)-1) && PyErr_Occurred())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 427; __pyx_clineno = __LINE__; goto __pyx_L7_error;}
        __Pyx_DECREF(__pyx_2); __pyx_2 = 0;
        __pyx_v_localID = __pyx_t_5;

        /* "/Users/sskory/Documents/yt-devel/yt/lagos/chainHOP/chainHOP.pyx":431
 *                 # Remember we are supposed to be only considering particles
 *                 # in my *real* region, that are padded in my neighbor.
 *                 if not self.is_inside[localID]:             # <<<<<<<<<<<<<<
 *                     # Make it negative so we can skip it below.
 *                     self.recv_real_indices[i] = -1
 */
        __pyx_t_2 = PyObject_GetAttr(__pyx_v_self, __pyx_kp_is_inside); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 431; __pyx_clineno = __LINE__; goto __pyx_L7_error;}
        __Pyx_GOTREF(__pyx_t_2);
        __pyx_1 = __Pyx_GetItemInt(__pyx_t_2, __pyx_v_localID, sizeof(long), PyInt_FromLong); if (!__pyx_1) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 431; __pyx_clineno = __LINE__; goto __pyx_L7_error;}
        __Pyx_GOTREF(__pyx_1);
        __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
        __pyx_t_7 = __Pyx_PyObject_IsTrue(__pyx_1); if (unlikely(__pyx_t_7 < 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 431; __pyx_clineno = __LINE__; goto __pyx_L7_error;}
        __Pyx_DECREF(__pyx_1); __pyx_1 = 0;
        __pyx_t_8 = (!__pyx_t_7);
        if (__pyx_t_8) {

          /* "/Users/sskory/Documents/yt-devel/yt/lagos/chainHOP/chainHOP.pyx":433
 *                 if not self.is_inside[localID]:
 *                     # Make it negative so we can skip it below.
 *                     self.recv_real_indices[i] = -1             # <<<<<<<<<<<<<<
 *                     continue
 *                 self.recv_real_indices[i] = localID
 */
          __pyx_t_2 = PyObject_GetAttr(__pyx_v_self, __pyx_kp_recv_real_indices); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 433; __pyx_clineno = __LINE__; goto __pyx_L7_error;}
          __Pyx_GOTREF(__pyx_t_2);
          if (__Pyx_SetItemInt(__pyx_t_2, __pyx_v_i, __pyx_int_neg_1, sizeof(long), PyInt_FromLong) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 433; __pyx_clineno = __LINE__; goto __pyx_L7_error;}
          __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;

          /* "/Users/sskory/Documents/yt-devel/yt/lagos/chainHOP/chainHOP.pyx":434
 *                     # Make it negative so we can skip it below.
 *                     self.recv_real_indices[i] = -1
 *                     continue             # <<<<<<<<<<<<<<
 *                 self.recv_real_indices[i] = localID
 *             except KeyError:
 */
          goto __pyx_L13_try_continue;
          goto __pyx_L15;
        }
        __pyx_L15:;

        /* "/Users/sskory/Documents/yt-devel/yt/lagos/chainHOP/chainHOP.pyx":435
 *                     self.recv_real_indices[i] = -1
 *                     continue
 *                 self.recv_real_indices[i] = localID             # <<<<<<<<<<<<<<
 *             except KeyError:
 *                 # This is probably a particle we don't even own, so we want
 */
        __pyx_t_2 = PyInt_FromLong(__pyx_v_localID); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 435; __pyx_clineno = __LINE__; goto __pyx_L7_error;}
        __Pyx_GOTREF(__pyx_t_2);
        __pyx_t_3 = PyObject_GetAttr(__pyx_v_self, __pyx_kp_recv_real_indices); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 435; __pyx_clineno = __LINE__; goto __pyx_L7_error;}
        __Pyx_GOTREF(__pyx_t_3);
        if (__Pyx_SetItemInt(__pyx_t_3, __pyx_v_i, __pyx_t_2, sizeof(long), PyInt_FromLong) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 435; __pyx_clineno = __LINE__; goto __pyx_L7_error;}
        __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
        __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
      }
      __Pyx_XDECREF(__pyx_save_exc_type); __pyx_save_exc_type = 0;
      __Pyx_XDECREF(__pyx_save_exc_value); __pyx_save_exc_value = 0;
      __Pyx_XDECREF(__pyx_save_exc_tb); __pyx_save_exc_tb = 0;
      goto __pyx_L14_try_end;
      __pyx_L7_error:;
      __Pyx_XDECREF(__pyx_2); __pyx_2 = 0;
      __Pyx_XDECREF(__pyx_1); __pyx_1 = 0;
      __Pyx_XDECREF(__pyx_t_3); __pyx_t_3 = 0;
      __Pyx_XDECREF(__pyx_t_2); __pyx_t_2 = 0;

      /* "/Users/sskory/Documents/yt-devel/yt/lagos/chainHOP/chainHOP.pyx":436
 *                     continue
 *                 self.recv_real_indices[i] = localID
 *             except KeyError:             # <<<<<<<<<<<<<<
 *                 # This is probably a particle we don't even own, so we want
 *                 # to ignore it.
 */
      __pyx_3 = PyErr_ExceptionMatches(__pyx_builtin_KeyError);
      if (__pyx_3) {
        __Pyx_AddTraceback("yt.lagos.chainHOP.chainHOP._connect_chains_across_tasks");
        if (__Pyx_GetException(&__pyx_t_2, &__pyx_t_3, &__pyx_t_9) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 436; __pyx_clineno = __LINE__; goto __pyx_L9_except_error;}
        __Pyx_GOTREF(__pyx_t_2);
        __Pyx_GOTREF(__pyx_t_3);
        __Pyx_GOTREF(__pyx_t_9);

        /* "/Users/sskory/Documents/yt-devel/yt/lagos/chainHOP/chainHOP.pyx":439
 *                 # This is probably a particle we don't even own, so we want
 *                 # to ignore it.
 *                 self.recv_real_indices[i] = -1             # <<<<<<<<<<<<<<
 *                 continue
 *         # Now relate the local chainIDs to the received chainIDs
 */
        __pyx_t_10 = PyObject_GetAttr(__pyx_v_self, __pyx_kp_recv_real_indices); if (unlikely(!__pyx_t_10)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 439; __pyx_clineno = __LINE__; goto __pyx_L9_except_error;}
        __Pyx_GOTREF(__pyx_t_10);
        if (__Pyx_SetItemInt(__pyx_t_10, __pyx_v_i, __pyx_int_neg_1, sizeof(long), PyInt_FromLong) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 439; __pyx_clineno = __LINE__; goto __pyx_L9_except_error;}
        __Pyx_DECREF(__pyx_t_10); __pyx_t_10 = 0;

        /* "/Users/sskory/Documents/yt-devel/yt/lagos/chainHOP/chainHOP.pyx":440
 *                 # to ignore it.
 *                 self.recv_real_indices[i] = -1
 *                 continue             # <<<<<<<<<<<<<<
 *         # Now relate the local chainIDs to the received chainIDs
 *         for i,localID in enumerate(self.recv_real_indices):
 */
        goto __pyx_L17_except_continue;
        __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
        __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
        __Pyx_DECREF(__pyx_t_9); __pyx_t_9 = 0;
        goto __pyx_L8_exception_handled;
        __pyx_L17_except_continue:;
        __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
        __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
        __Pyx_DECREF(__pyx_t_9); __pyx_t_9 = 0;
        goto __pyx_L13_try_continue;
      }
      __pyx_L9_except_error:;
      __Pyx_XDECREF(__pyx_save_exc_type);
      __Pyx_XDECREF(__pyx_save_exc_value);
      __Pyx_XDECREF(__pyx_save_exc_tb);
      goto __pyx_L1_error;
      __pyx_L13_try_continue:;
      __Pyx_XGIVEREF(__pyx_save_exc_type);
      __Pyx_XGIVEREF(__pyx_save_exc_value);
      __Pyx_XGIVEREF(__pyx_save_exc_tb);
      __Pyx_ExceptionReset(__pyx_save_exc_type, __pyx_save_exc_value, __pyx_save_exc_tb);
      goto __pyx_L5_continue;
      __pyx_L8_exception_handled:;
      __Pyx_XGIVEREF(__pyx_save_exc_type);
      __Pyx_XGIVEREF(__pyx_save_exc_value);
      __Pyx_XGIVEREF(__pyx_save_exc_tb);
      __Pyx_ExceptionReset(__pyx_save_exc_type, __pyx_save_exc_value, __pyx_save_exc_tb);
      __pyx_L14_try_end:;
    }
    __pyx_L5_continue:;
  }
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;

  /* "/Users/sskory/Documents/yt-devel/yt/lagos/chainHOP/chainHOP.pyx":442
 *                 continue
 *         # Now relate the local chainIDs to the received chainIDs
 *         for i,localID in enumerate(self.recv_real_indices):             # <<<<<<<<<<<<<<
 *             # If the 'new' chainID is different that what we already have,
 *             # we need to record it, but we skip particles that were assigned
 */
  __pyx_t_1 = PyObject_GetAttr(__pyx_v_self, __pyx_kp_recv_real_indices); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 442; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_t_9 = PyTuple_New(1); if (unlikely(!__pyx_t_9)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 442; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(((PyObject *)__pyx_t_9));
  PyTuple_SET_ITEM(__pyx_t_9, 0, __pyx_t_1);
  __Pyx_GIVEREF(__pyx_t_1);
  __pyx_t_1 = 0;
  __pyx_t_1 = PyObject_Call(__pyx_builtin_enumerate, ((PyObject *)__pyx_t_9), NULL); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 442; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_DECREF(((PyObject *)__pyx_t_9)); __pyx_t_9 = 0;
  if (PyList_CheckExact(__pyx_t_1) || PyTuple_CheckExact(__pyx_t_1)) {
    __pyx_t_4 = 0; __pyx_t_9 = __pyx_t_1; __Pyx_INCREF(__pyx_t_9);
  } else {
    __pyx_t_4 = -1; __pyx_t_9 = PyObject_GetIter(__pyx_t_1); if (unlikely(!__pyx_t_9)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 442; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_9);
  }
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  for (;;) {
    if (likely(PyList_CheckExact(__pyx_t_9))) {
      if (__pyx_t_4 >= PyList_GET_SIZE(__pyx_t_9)) break;
      __pyx_t_1 = PyList_GET_ITEM(__pyx_t_9, __pyx_t_4); __Pyx_INCREF(__pyx_t_1); __pyx_t_4++;
    } else if (likely(PyTuple_CheckExact(__pyx_t_9))) {
      if (__pyx_t_4 >= PyTuple_GET_SIZE(__pyx_t_9)) break;
      __pyx_t_1 = PyTuple_GET_ITEM(__pyx_t_9, __pyx_t_4); __Pyx_INCREF(__pyx_t_1); __pyx_t_4++;
    } else {
      __pyx_t_1 = PyIter_Next(__pyx_t_9);
      if (!__pyx_t_1) {
        if (unlikely(PyErr_Occurred())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 442; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        break;
      }
      __Pyx_GOTREF(__pyx_t_1);
    }
    if (PyTuple_CheckExact(__pyx_t_1) && likely(PyTuple_GET_SIZE(__pyx_t_1) == 2)) {
      PyObject* tuple = __pyx_t_1;
      __pyx_1 = PyTuple_GET_ITEM(tuple, 0); __Pyx_INCREF(__pyx_1);
      __pyx_t_5 = __Pyx_PyInt_AsLong(__pyx_1); if (unlikely((__pyx_t_5 == (long)-1) && PyErr_Occurred())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 442; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_DECREF(__pyx_1); __pyx_1 = 0;
      __pyx_1 = PyTuple_GET_ITEM(tuple, 1); __Pyx_INCREF(__pyx_1);
      __pyx_t_6 = __Pyx_PyInt_AsLong(__pyx_1); if (unlikely((__pyx_t_6 == (long)-1) && PyErr_Occurred())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 442; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_DECREF(__pyx_1); __pyx_1 = 0;
      __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
      __pyx_v_i = __pyx_t_5;
      __pyx_v_localID = __pyx_t_6;
    } else {
      __pyx_2 = PyObject_GetIter(__pyx_t_1); if (unlikely(!__pyx_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 442; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_2);
      __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
      __pyx_1 = __Pyx_UnpackItem(__pyx_2, 0); if (unlikely(!__pyx_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 442; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_1);
      __pyx_t_6 = __Pyx_PyInt_AsLong(__pyx_1); if (unlikely((__pyx_t_6 == (long)-1) && PyErr_Occurred())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 442; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_DECREF(__pyx_1); __pyx_1 = 0;
      __pyx_1 = __Pyx_UnpackItem(__pyx_2, 1); if (unlikely(!__pyx_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 442; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_1);
      __pyx_t_5 = __Pyx_PyInt_AsLong(__pyx_1); if (unlikely((__pyx_t_5 == (long)-1) && PyErr_Occurred())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 442; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_DECREF(__pyx_1); __pyx_1 = 0;
      if (__Pyx_EndUnpack(__pyx_2) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 442; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_DECREF(__pyx_2); __pyx_2 = 0;
      __pyx_v_i = __pyx_t_6;
      __pyx_v_localID = __pyx_t_5;
    }

    /* "/Users/sskory/Documents/yt-devel/yt/lagos/chainHOP/chainHOP.pyx":446
 *             # we need to record it, but we skip particles that were assigned
 *             # -1 above.
 *             if localID != -1:             # <<<<<<<<<<<<<<
 *                 if self.recv_chainIDs[i] != self.chainID[localID]:
 *                     chainID_translate_map_local[self.recv_chainIDs[i]] = \
 */
    __pyx_t_8 = (__pyx_v_localID != -1);
    if (__pyx_t_8) {

      /* "/Users/sskory/Documents/yt-devel/yt/lagos/chainHOP/chainHOP.pyx":447
 *             # -1 above.
 *             if localID != -1:
 *                 if self.recv_chainIDs[i] != self.chainID[localID]:             # <<<<<<<<<<<<<<
 *                     chainID_translate_map_local[self.recv_chainIDs[i]] = \
 *                         self.chainID[localID]
 */
      __pyx_t_1 = PyObject_GetAttr(__pyx_v_self, __pyx_kp_recv_chainIDs); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 447; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_t_1);
      __pyx_1 = __Pyx_GetItemInt(__pyx_t_1, __pyx_v_i, sizeof(long), PyInt_FromLong); if (!__pyx_1) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 447; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_1);
      __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
      __pyx_t_1 = PyObject_GetAttr(__pyx_v_self, __pyx_kp_chainID); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 447; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_t_1);
      __pyx_2 = __Pyx_GetItemInt(__pyx_t_1, __pyx_v_localID, sizeof(long), PyInt_FromLong); if (!__pyx_2) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 447; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_2);
      __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
      __pyx_t_1 = PyObject_RichCompare(__pyx_1, __pyx_2, Py_NE); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 447; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_t_1);
      __Pyx_DECREF(__pyx_1); __pyx_1 = 0;
      __Pyx_DECREF(__pyx_2); __pyx_2 = 0;
      __pyx_t_8 = __Pyx_PyObject_IsTrue(__pyx_t_1); if (unlikely(__pyx_t_8 < 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 447; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
      if (__pyx_t_8) {

        /* "/Users/sskory/Documents/yt-devel/yt/lagos/chainHOP/chainHOP.pyx":449
 *                 if self.recv_chainIDs[i] != self.chainID[localID]:
 *                     chainID_translate_map_local[self.recv_chainIDs[i]] = \
 *                         self.chainID[localID]             # <<<<<<<<<<<<<<
 *         # In chainID_translate_map_local, chains may
 *         # 'point' to only one chain, but a chain may have many that point to
 */
        __pyx_t_1 = PyObject_GetAttr(__pyx_v_self, __pyx_kp_chainID); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 449; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        __Pyx_GOTREF(__pyx_t_1);
        __pyx_1 = __Pyx_GetItemInt(__pyx_t_1, __pyx_v_localID, sizeof(long), PyInt_FromLong); if (!__pyx_1) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 449; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        __Pyx_GOTREF(__pyx_1);
        __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;

        /* "/Users/sskory/Documents/yt-devel/yt/lagos/chainHOP/chainHOP.pyx":448
 *             if localID != -1:
 *                 if self.recv_chainIDs[i] != self.chainID[localID]:
 *                     chainID_translate_map_local[self.recv_chainIDs[i]] = \             # <<<<<<<<<<<<<<
 *                         self.chainID[localID]
 *         # In chainID_translate_map_local, chains may
 */
        __pyx_t_1 = PyObject_GetAttr(__pyx_v_self, __pyx_kp_recv_chainIDs); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 448; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        __Pyx_GOTREF(__pyx_t_1);
        __pyx_2 = __Pyx_GetItemInt(__pyx_t_1, __pyx_v_i, sizeof(long), PyInt_FromLong); if (!__pyx_2) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 448; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        __Pyx_GOTREF(__pyx_2);
        __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
        if (PyObject_SetItem(__pyx_v_chainID_translate_map_local, __pyx_2, __pyx_1) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 448; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        __Pyx_DECREF(__pyx_2); __pyx_2 = 0;
        __Pyx_DECREF(__pyx_1); __pyx_1 = 0;
        goto __pyx_L21;
      }
      __pyx_L21:;
      goto __pyx_L20;
    }
    __pyx_L20:;
  }
  __Pyx_DECREF(__pyx_t_9); __pyx_t_9 = 0;

  /* "/Users/sskory/Documents/yt-devel/yt/lagos/chainHOP/chainHOP.pyx":457
 *         # communication step.
 *         chainID_translate_map_global = \
 *             self._mpi_joindict(chainID_translate_map_local)             # <<<<<<<<<<<<<<
 *         for i in xrange(self.nchains):
 *             try:
 */
  __pyx_t_9 = PyObject_GetAttr(__pyx_v_self, __pyx_kp__mpi_joindict); if (unlikely(!__pyx_t_9)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 457; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_9);
  __pyx_t_1 = PyTuple_New(1); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 457; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(((PyObject *)__pyx_t_1));
  __Pyx_INCREF(__pyx_v_chainID_translate_map_local);
  PyTuple_SET_ITEM(__pyx_t_1, 0, __pyx_v_chainID_translate_map_local);
  __Pyx_GIVEREF(__pyx_v_chainID_translate_map_local);
  __pyx_t_3 = PyObject_Call(__pyx_t_9, ((PyObject *)__pyx_t_1), NULL); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 457; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_3);
  __Pyx_DECREF(__pyx_t_9); __pyx_t_9 = 0;
  __Pyx_DECREF(((PyObject *)__pyx_t_1)); __pyx_t_1 = 0;
  __Pyx_DECREF(__pyx_v_chainID_translate_map_global);
  __pyx_v_chainID_translate_map_global = __pyx_t_3;
  __pyx_t_3 = 0;

  /* "/Users/sskory/Documents/yt-devel/yt/lagos/chainHOP/chainHOP.pyx":458
 *         chainID_translate_map_global = \
 *             self._mpi_joindict(chainID_translate_map_local)
 *         for i in xrange(self.nchains):             # <<<<<<<<<<<<<<
 *             try:
 *                 target = chainID_translate_map_global[i]
 */
  __pyx_t_3 = PyObject_GetAttr(__pyx_v_self, __pyx_kp_nchains); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 458; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_3);
  __pyx_t_5 = __Pyx_PyInt_AsLong(__pyx_t_3); if (unlikely((__pyx_t_5 == (long)-1) && PyErr_Occurred())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 458; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  for (__pyx_t_6 = 0; __pyx_t_6 < __pyx_t_5; __pyx_t_6+=1) {
    __pyx_v_i = __pyx_t_6;

    /* "/Users/sskory/Documents/yt-devel/yt/lagos/chainHOP/chainHOP.pyx":459
 *             self._mpi_joindict(chainID_translate_map_local)
 *         for i in xrange(self.nchains):
 *             try:             # <<<<<<<<<<<<<<
 *                 target = chainID_translate_map_global[i]
 *             except KeyError:
 */
    {
      PyObject *__pyx_save_exc_type, *__pyx_save_exc_value, *__pyx_save_exc_tb;
      __Pyx_ExceptionSave(&__pyx_save_exc_type, &__pyx_save_exc_value, &__pyx_save_exc_tb);
      __Pyx_XGOTREF(__pyx_save_exc_type);
      __Pyx_XGOTREF(__pyx_save_exc_value);
      __Pyx_XGOTREF(__pyx_save_exc_tb);
      /*try:*/ {

        /* "/Users/sskory/Documents/yt-devel/yt/lagos/chainHOP/chainHOP.pyx":460
 *         for i in xrange(self.nchains):
 *             try:
 *                 target = chainID_translate_map_global[i]             # <<<<<<<<<<<<<<
 *             except KeyError:
 *                 # The the chain is either self most-dense, or a singleton.
 */
        __pyx_1 = __Pyx_GetItemInt(__pyx_v_chainID_translate_map_global, __pyx_v_i, sizeof(long), PyInt_FromLong); if (!__pyx_1) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 460; __pyx_clineno = __LINE__; goto __pyx_L24_error;}
        __Pyx_GOTREF(__pyx_1);
        __pyx_t_11 = __Pyx_PyInt_AsLong(__pyx_1); if (unlikely((__pyx_t_11 == (long)-1) && PyErr_Occurred())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 460; __pyx_clineno = __LINE__; goto __pyx_L24_error;}
        __Pyx_DECREF(__pyx_1); __pyx_1 = 0;
        __pyx_v_target = __pyx_t_11;
      }
      __Pyx_XDECREF(__pyx_save_exc_type); __pyx_save_exc_type = 0;
      __Pyx_XDECREF(__pyx_save_exc_value); __pyx_save_exc_value = 0;
      __Pyx_XDECREF(__pyx_save_exc_tb); __pyx_save_exc_tb = 0;
      goto __pyx_L31_try_end;
      __pyx_L24_error:;
      __Pyx_XDECREF(__pyx_2); __pyx_2 = 0;
      __Pyx_XDECREF(__pyx_1); __pyx_1 = 0;
      __Pyx_XDECREF(__pyx_t_10); __pyx_t_10 = 0;
      __Pyx_XDECREF(__pyx_t_2); __pyx_t_2 = 0;
      __Pyx_XDECREF(__pyx_t_9); __pyx_t_9 = 0;
      __Pyx_XDECREF(__pyx_t_1); __pyx_t_1 = 0;
      __Pyx_XDECREF(__pyx_t_3); __pyx_t_3 = 0;

      /* "/Users/sskory/Documents/yt-devel/yt/lagos/chainHOP/chainHOP.pyx":461
 *             try:
 *                 target = chainID_translate_map_global[i]
 *             except KeyError:             # <<<<<<<<<<<<<<
 *                 # The the chain is either self most-dense, or a singleton.
 *                 chainID_translate_map_global[i] = int(i)
 */
      __pyx_3 = PyErr_ExceptionMatches(__pyx_builtin_KeyError);
      if (__pyx_3) {
        __Pyx_AddTraceback("yt.lagos.chainHOP.chainHOP._connect_chains_across_tasks");
        if (__Pyx_GetException(&__pyx_t_3, &__pyx_t_1, &__pyx_t_9) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 461; __pyx_clineno = __LINE__; goto __pyx_L26_except_error;}
        __Pyx_GOTREF(__pyx_t_3);
        __Pyx_GOTREF(__pyx_t_1);
        __Pyx_GOTREF(__pyx_t_9);

        /* "/Users/sskory/Documents/yt-devel/yt/lagos/chainHOP/chainHOP.pyx":463
 *             except KeyError:
 *                 # The the chain is either self most-dense, or a singleton.
 *                 chainID_translate_map_global[i] = int(i)             # <<<<<<<<<<<<<<
 *         # Build a list of chain densities, sorted smallest to largest.
 *         dens_temp = []
 */
        __pyx_t_2 = PyInt_FromLong(__pyx_v_i); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 463; __pyx_clineno = __LINE__; goto __pyx_L26_except_error;}
        __Pyx_GOTREF(__pyx_t_2);
        __pyx_t_10 = PyTuple_New(1); if (unlikely(!__pyx_t_10)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 463; __pyx_clineno = __LINE__; goto __pyx_L26_except_error;}
        __Pyx_GOTREF(((PyObject *)__pyx_t_10));
        PyTuple_SET_ITEM(__pyx_t_10, 0, __pyx_t_2);
        __Pyx_GIVEREF(__pyx_t_2);
        __pyx_t_2 = 0;
        __pyx_t_2 = PyObject_Call(((PyObject *)((PyObject*)&PyInt_Type)), ((PyObject *)__pyx_t_10), NULL); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 463; __pyx_clineno = __LINE__; goto __pyx_L26_except_error;}
        __Pyx_GOTREF(__pyx_t_2);
        __Pyx_DECREF(((PyObject *)__pyx_t_10)); __pyx_t_10 = 0;
        if (__Pyx_SetItemInt(__pyx_v_chainID_translate_map_global, __pyx_v_i, __pyx_t_2, sizeof(long), PyInt_FromLong) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 463; __pyx_clineno = __LINE__; goto __pyx_L26_except_error;}
        __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
        __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
        __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
        __Pyx_DECREF(__pyx_t_9); __pyx_t_9 = 0;
        goto __pyx_L25_exception_handled;
      }
      __pyx_L26_except_error:;
      __Pyx_XDECREF(__pyx_save_exc_type);
      __Pyx_XDECREF(__pyx_save_exc_value);
      __Pyx_XDECREF(__pyx_save_exc_tb);
      goto __pyx_L1_error;
      __pyx_L25_exception_handled:;
      __Pyx_XGIVEREF(__pyx_save_exc_type);
      __Pyx_XGIVEREF(__pyx_save_exc_value);
      __Pyx_XGIVEREF(__pyx_save_exc_tb);
      __Pyx_ExceptionReset(__pyx_save_exc_type, __pyx_save_exc_value, __pyx_save_exc_tb);
      __pyx_L31_try_end:;
    }
  }

  /* "/Users/sskory/Documents/yt-devel/yt/lagos/chainHOP/chainHOP.pyx":465
 *                 chainID_translate_map_global[i] = int(i)
 *         # Build a list of chain densities, sorted smallest to largest.
 *         dens_temp = []             # <<<<<<<<<<<<<<
 *         for key in self.densest_in_chain:
 *             item = [self.densest_in_chain[key], key]
 */
  __pyx_t_9 = PyList_New(0); if (unlikely(!__pyx_t_9)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 465; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(((PyObject *)__pyx_t_9));
  __Pyx_DECREF(__pyx_v_dens_temp);
  __pyx_v_dens_temp = ((PyObject *)__pyx_t_9);
  __pyx_t_9 = 0;

  /* "/Users/sskory/Documents/yt-devel/yt/lagos/chainHOP/chainHOP.pyx":466
 *         # Build a list of chain densities, sorted smallest to largest.
 *         dens_temp = []
 *         for key in self.densest_in_chain:             # <<<<<<<<<<<<<<
 *             item = [self.densest_in_chain[key], key]
 *             insort(dens_temp, item)
 */
  __pyx_t_9 = PyObject_GetAttr(__pyx_v_self, __pyx_kp_densest_in_chain); if (unlikely(!__pyx_t_9)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 466; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_9);
  if (PyList_CheckExact(__pyx_t_9) || PyTuple_CheckExact(__pyx_t_9)) {
    __pyx_t_4 = 0; __pyx_t_1 = __pyx_t_9; __Pyx_INCREF(__pyx_t_1);
  } else {
    __pyx_t_4 = -1; __pyx_t_1 = PyObject_GetIter(__pyx_t_9); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 466; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_1);
  }
  __Pyx_DECREF(__pyx_t_9); __pyx_t_9 = 0;
  for (;;) {
    if (likely(PyList_CheckExact(__pyx_t_1))) {
      if (__pyx_t_4 >= PyList_GET_SIZE(__pyx_t_1)) break;
      __pyx_t_9 = PyList_GET_ITEM(__pyx_t_1, __pyx_t_4); __Pyx_INCREF(__pyx_t_9); __pyx_t_4++;
    } else if (likely(PyTuple_CheckExact(__pyx_t_1))) {
      if (__pyx_t_4 >= PyTuple_GET_SIZE(__pyx_t_1)) break;
      __pyx_t_9 = PyTuple_GET_ITEM(__pyx_t_1, __pyx_t_4); __Pyx_INCREF(__pyx_t_9); __pyx_t_4++;
    } else {
      __pyx_t_9 = PyIter_Next(__pyx_t_1);
      if (!__pyx_t_9) {
        if (unlikely(PyErr_Occurred())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 466; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        break;
      }
      __Pyx_GOTREF(__pyx_t_9);
    }
    __Pyx_DECREF(__pyx_v_key);
    __pyx_v_key = __pyx_t_9;
    __pyx_t_9 = 0;

    /* "/Users/sskory/Documents/yt-devel/yt/lagos/chainHOP/chainHOP.pyx":467
 *         dens_temp = []
 *         for key in self.densest_in_chain:
 *             item = [self.densest_in_chain[key], key]             # <<<<<<<<<<<<<<
 *             insort(dens_temp, item)
 *         # Loop over chains, smallest to largest density, recursively until
 */
    __pyx_t_9 = PyObject_GetAttr(__pyx_v_self, __pyx_kp_densest_in_chain); if (unlikely(!__pyx_t_9)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 467; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_9);
    __pyx_2 = PyObject_GetItem(__pyx_t_9, __pyx_v_key); if (!__pyx_2) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 467; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_2);
    __Pyx_DECREF(__pyx_t_9); __pyx_t_9 = 0;
    __pyx_t_9 = PyList_New(2); if (unlikely(!__pyx_t_9)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 467; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(((PyObject *)__pyx_t_9));
    PyList_SET_ITEM(__pyx_t_9, 0, __pyx_2);
    __Pyx_GIVEREF(__pyx_2);
    __Pyx_INCREF(__pyx_v_key);
    PyList_SET_ITEM(__pyx_t_9, 1, __pyx_v_key);
    __Pyx_GIVEREF(__pyx_v_key);
    __pyx_2 = 0;
    __Pyx_DECREF(__pyx_v_item);
    __pyx_v_item = ((PyObject *)__pyx_t_9);
    __pyx_t_9 = 0;

    /* "/Users/sskory/Documents/yt-devel/yt/lagos/chainHOP/chainHOP.pyx":468
 *         for key in self.densest_in_chain:
 *             item = [self.densest_in_chain[key], key]
 *             insort(dens_temp, item)             # <<<<<<<<<<<<<<
 *         # Loop over chains, smallest to largest density, recursively until
 *         # we reach a self-assigned chain. Then we assign that final chainID to
 */
    __pyx_1 = __Pyx_GetName(__pyx_m, __pyx_kp_insort); if (unlikely(!__pyx_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 468; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_1);
    __pyx_t_9 = PyTuple_New(2); if (unlikely(!__pyx_t_9)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 468; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(((PyObject *)__pyx_t_9));
    __Pyx_INCREF(__pyx_v_dens_temp);
    PyTuple_SET_ITEM(__pyx_t_9, 0, __pyx_v_dens_temp);
    __Pyx_GIVEREF(__pyx_v_dens_temp);
    __Pyx_INCREF(__pyx_v_item);
    PyTuple_SET_ITEM(__pyx_t_9, 1, __pyx_v_item);
    __Pyx_GIVEREF(__pyx_v_item);
    __pyx_t_3 = PyObject_Call(__pyx_1, ((PyObject *)__pyx_t_9), NULL); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 468; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_3);
    __Pyx_DECREF(__pyx_1); __pyx_1 = 0;
    __Pyx_DECREF(((PyObject *)__pyx_t_9)); __pyx_t_9 = 0;
    __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  }
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;

  /* "/Users/sskory/Documents/yt-devel/yt/lagos/chainHOP/chainHOP.pyx":472
 *         # we reach a self-assigned chain. Then we assign that final chainID to
 *         # the *current* one only.
 *         for chain in dens_temp:             # <<<<<<<<<<<<<<
 *             new_chainID = \
 *                 self._recurse_global_chain_links(chainID_translate_map_global, chain[1])
 */
  if (PyList_CheckExact(__pyx_v_dens_temp) || PyTuple_CheckExact(__pyx_v_dens_temp)) {
    __pyx_t_4 = 0; __pyx_t_1 = __pyx_v_dens_temp; __Pyx_INCREF(__pyx_t_1);
  } else {
    __pyx_t_4 = -1; __pyx_t_1 = PyObject_GetIter(__pyx_v_dens_temp); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 472; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_1);
  }
  for (;;) {
    if (likely(PyList_CheckExact(__pyx_t_1))) {
      if (__pyx_t_4 >= PyList_GET_SIZE(__pyx_t_1)) break;
      __pyx_t_3 = PyList_GET_ITEM(__pyx_t_1, __pyx_t_4); __Pyx_INCREF(__pyx_t_3); __pyx_t_4++;
    } else if (likely(PyTuple_CheckExact(__pyx_t_1))) {
      if (__pyx_t_4 >= PyTuple_GET_SIZE(__pyx_t_1)) break;
      __pyx_t_3 = PyTuple_GET_ITEM(__pyx_t_1, __pyx_t_4); __Pyx_INCREF(__pyx_t_3); __pyx_t_4++;
    } else {
      __pyx_t_3 = PyIter_Next(__pyx_t_1);
      if (!__pyx_t_3) {
        if (unlikely(PyErr_Occurred())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 472; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        break;
      }
      __Pyx_GOTREF(__pyx_t_3);
    }
    __Pyx_DECREF(__pyx_v_chain);
    __pyx_v_chain = __pyx_t_3;
    __pyx_t_3 = 0;

    /* "/Users/sskory/Documents/yt-devel/yt/lagos/chainHOP/chainHOP.pyx":474
 *         for chain in dens_temp:
 *             new_chainID = \
 *                 self._recurse_global_chain_links(chainID_translate_map_global, chain[1])             # <<<<<<<<<<<<<<
 *             chainID_translate_map_global[chain[1]] = new_chainID
 *             # At the same time, remove chains from densest_in_chain that have
 */
    __pyx_t_3 = PyObject_GetAttr(__pyx_v_self, __pyx_kp_41); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 474; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_3);
    __pyx_2 = __Pyx_GetItemInt(__pyx_v_chain, 1, sizeof(long), PyInt_FromLong); if (!__pyx_2) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 474; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_2);
    __pyx_t_9 = PyTuple_New(2); if (unlikely(!__pyx_t_9)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 474; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(((PyObject *)__pyx_t_9));
    __Pyx_INCREF(__pyx_v_chainID_translate_map_global);
    PyTuple_SET_ITEM(__pyx_t_9, 0, __pyx_v_chainID_translate_map_global);
    __Pyx_GIVEREF(__pyx_v_chainID_translate_map_global);
    PyTuple_SET_ITEM(__pyx_t_9, 1, __pyx_2);
    __Pyx_GIVEREF(__pyx_2);
    __pyx_2 = 0;
    __pyx_t_2 = PyObject_Call(__pyx_t_3, ((PyObject *)__pyx_t_9), NULL); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 474; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_2);
    __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
    __Pyx_DECREF(((PyObject *)__pyx_t_9)); __pyx_t_9 = 0;
    __pyx_t_6 = __Pyx_PyInt_AsLong(__pyx_t_2); if (unlikely((__pyx_t_6 == (long)-1) && PyErr_Occurred())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 474; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
    __pyx_v_new_chainID = __pyx_t_6;

    /* "/Users/sskory/Documents/yt-devel/yt/lagos/chainHOP/chainHOP.pyx":475
 *             new_chainID = \
 *                 self._recurse_global_chain_links(chainID_translate_map_global, chain[1])
 *             chainID_translate_map_global[chain[1]] = new_chainID             # <<<<<<<<<<<<<<
 *             # At the same time, remove chains from densest_in_chain that have
 *             # been reassigned.
 */
    __pyx_t_2 = PyInt_FromLong(__pyx_v_new_chainID); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 475; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_2);
    __pyx_1 = __Pyx_GetItemInt(__pyx_v_chain, 1, sizeof(long), PyInt_FromLong); if (!__pyx_1) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 475; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_1);
    if (PyObject_SetItem(__pyx_v_chainID_translate_map_global, __pyx_1, __pyx_t_2) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 475; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_DECREF(__pyx_1); __pyx_1 = 0;
    __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;

    /* "/Users/sskory/Documents/yt-devel/yt/lagos/chainHOP/chainHOP.pyx":478
 *             # At the same time, remove chains from densest_in_chain that have
 *             # been reassigned.
 *             if chain[1] != new_chainID:             # <<<<<<<<<<<<<<
 *                 del self.densest_in_chain[chain[1]]
 *                 # Also fix nchains to keep up.
 */
    __pyx_2 = __Pyx_GetItemInt(__pyx_v_chain, 1, sizeof(long), PyInt_FromLong); if (!__pyx_2) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 478; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_2);
    __pyx_t_2 = PyInt_FromLong(__pyx_v_new_chainID); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 478; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_2);
    __pyx_t_9 = PyObject_RichCompare(__pyx_2, __pyx_t_2, Py_NE); if (unlikely(!__pyx_t_9)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 478; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_9);
    __Pyx_DECREF(__pyx_2); __pyx_2 = 0;
    __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
    __pyx_t_8 = __Pyx_PyObject_IsTrue(__pyx_t_9); if (unlikely(__pyx_t_8 < 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 478; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_DECREF(__pyx_t_9); __pyx_t_9 = 0;
    if (__pyx_t_8) {

      /* "/Users/sskory/Documents/yt-devel/yt/lagos/chainHOP/chainHOP.pyx":479
 *             # been reassigned.
 *             if chain[1] != new_chainID:
 *                 del self.densest_in_chain[chain[1]]             # <<<<<<<<<<<<<<
 *                 # Also fix nchains to keep up.
 *                 self.nchains -= 1
 */
      __pyx_t_9 = PyObject_GetAttr(__pyx_v_self, __pyx_kp_densest_in_chain); if (unlikely(!__pyx_t_9)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 479; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_t_9);
      __pyx_1 = __Pyx_GetItemInt(__pyx_v_chain, 1, sizeof(long), PyInt_FromLong); if (!__pyx_1) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 479; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_1);
      if (PyObject_DelItem(__pyx_t_9, __pyx_1) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 479; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_DECREF(__pyx_t_9); __pyx_t_9 = 0;
      __Pyx_DECREF(__pyx_1); __pyx_1 = 0;

      /* "/Users/sskory/Documents/yt-devel/yt/lagos/chainHOP/chainHOP.pyx":481
 *                 del self.densest_in_chain[chain[1]]
 *                 # Also fix nchains to keep up.
 *                 self.nchains -= 1             # <<<<<<<<<<<<<<
 *         # Convert local particles to their new chainID
 *         for i in xrange(self.size):
 */
      __pyx_t_9 = PyObject_GetAttr(__pyx_v_self, __pyx_kp_nchains); if (unlikely(!__pyx_t_9)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 481; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_t_9);
      __pyx_2 = PyNumber_InPlaceSubtract(__pyx_t_9, __pyx_int_1); if (unlikely(!__pyx_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 481; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_2);
      __Pyx_DECREF(__pyx_t_9); __pyx_t_9 = 0;
      if (PyObject_SetAttr(__pyx_v_self, __pyx_kp_nchains, __pyx_2) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 481; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_DECREF(__pyx_2); __pyx_2 = 0;
      goto __pyx_L38;
    }
    __pyx_L38:;
  }
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;

  /* "/Users/sskory/Documents/yt-devel/yt/lagos/chainHOP/chainHOP.pyx":483
 *                 self.nchains -= 1
 *         # Convert local particles to their new chainID
 *         for i in xrange(self.size):             # <<<<<<<<<<<<<<
 *             old_chainID = self.chainID[i]
 *             if old_chainID == -1: continue
 */
  __pyx_t_1 = PyObject_GetAttr(__pyx_v_self, __pyx_kp_size); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 483; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_t_6 = __Pyx_PyInt_AsLong(__pyx_t_1); if (unlikely((__pyx_t_6 == (long)-1) && PyErr_Occurred())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 483; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  for (__pyx_t_5 = 0; __pyx_t_5 < __pyx_t_6; __pyx_t_5+=1) {
    __pyx_v_i = __pyx_t_5;

    /* "/Users/sskory/Documents/yt-devel/yt/lagos/chainHOP/chainHOP.pyx":484
 *         # Convert local particles to their new chainID
 *         for i in xrange(self.size):
 *             old_chainID = self.chainID[i]             # <<<<<<<<<<<<<<
 *             if old_chainID == -1: continue
 *             new_chainID = chainID_translate_map_global[old_chainID]
 */
    __pyx_t_1 = PyObject_GetAttr(__pyx_v_self, __pyx_kp_chainID); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 484; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_1);
    __pyx_1 = __Pyx_GetItemInt(__pyx_t_1, __pyx_v_i, sizeof(long), PyInt_FromLong); if (!__pyx_1) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 484; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_1);
    __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
    __pyx_t_11 = __Pyx_PyInt_AsLong(__pyx_1); if (unlikely((__pyx_t_11 == (long)-1) && PyErr_Occurred())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 484; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_DECREF(__pyx_1); __pyx_1 = 0;
    __pyx_v_old_chainID = __pyx_t_11;

    /* "/Users/sskory/Documents/yt-devel/yt/lagos/chainHOP/chainHOP.pyx":485
 *         for i in xrange(self.size):
 *             old_chainID = self.chainID[i]
 *             if old_chainID == -1: continue             # <<<<<<<<<<<<<<
 *             new_chainID = chainID_translate_map_global[old_chainID]
 *             self.chainID[i] = new_chainID
 */
    __pyx_t_8 = (__pyx_v_old_chainID == -1);
    if (__pyx_t_8) {
      goto __pyx_L39_continue;
      goto __pyx_L41;
    }
    __pyx_L41:;

    /* "/Users/sskory/Documents/yt-devel/yt/lagos/chainHOP/chainHOP.pyx":486
 *             old_chainID = self.chainID[i]
 *             if old_chainID == -1: continue
 *             new_chainID = chainID_translate_map_global[old_chainID]             # <<<<<<<<<<<<<<
 *             self.chainID[i] = new_chainID
 * 
 */
    __pyx_2 = __Pyx_GetItemInt(__pyx_v_chainID_translate_map_global, __pyx_v_old_chainID, sizeof(long), PyInt_FromLong); if (!__pyx_2) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 486; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_2);
    __pyx_t_11 = __Pyx_PyInt_AsLong(__pyx_2); if (unlikely((__pyx_t_11 == (long)-1) && PyErr_Occurred())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 486; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_DECREF(__pyx_2); __pyx_2 = 0;
    __pyx_v_new_chainID = __pyx_t_11;

    /* "/Users/sskory/Documents/yt-devel/yt/lagos/chainHOP/chainHOP.pyx":487
 *             if old_chainID == -1: continue
 *             new_chainID = chainID_translate_map_global[old_chainID]
 *             self.chainID[i] = new_chainID             # <<<<<<<<<<<<<<
 * 
 *     def _communicate_annulus_chainIDs(object self):
 */
    __pyx_t_1 = PyInt_FromLong(__pyx_v_new_chainID); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 487; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_1);
    __pyx_t_9 = PyObject_GetAttr(__pyx_v_self, __pyx_kp_chainID); if (unlikely(!__pyx_t_9)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 487; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_9);
    if (__Pyx_SetItemInt(__pyx_t_9, __pyx_v_i, __pyx_t_1, sizeof(long), PyInt_FromLong) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 487; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_DECREF(__pyx_t_9); __pyx_t_9 = 0;
    __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
    __pyx_L39_continue:;
  }

  __pyx_r = Py_None; __Pyx_INCREF(Py_None);
  goto __pyx_L0;
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_1);
  __Pyx_XDECREF(__pyx_2);
  __Pyx_XDECREF(__pyx_t_1);
  __Pyx_XDECREF(__pyx_t_2);
  __Pyx_XDECREF(__pyx_t_3);
  __Pyx_XDECREF(__pyx_t_9);
  __Pyx_XDECREF(__pyx_t_10);
  __Pyx_AddTraceback("yt.lagos.chainHOP.chainHOP.RunChainHOP._connect_chains_across_tasks");
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_DECREF(__pyx_v_chainID_translate_map_local);
  __Pyx_DECREF(__pyx_v_chainID_translate_map_global);
  __Pyx_DECREF(__pyx_v_dens_temp);
  __Pyx_DECREF(__pyx_v_key);
  __Pyx_DECREF(__pyx_v_item);
  __Pyx_DECREF(__pyx_v_chain);
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_FinishRefcountContext();
  return __pyx_r;
}

/* "/Users/sskory/Documents/yt-devel/yt/lagos/chainHOP/chainHOP.pyx":489
 *             self.chainID[i] = new_chainID
 * 
 *     def _communicate_annulus_chainIDs(object self):             # <<<<<<<<<<<<<<
 *         """
 *         Transmit all of our chainID-ed particles that are within self.padding
 */

static PyObject *__pyx_pf_2yt_5lagos_8chainHOP_8chainHOP_11RunChainHOP__communicate_annulus_chainIDs(PyObject *__pyx_self, PyObject *__pyx_v_self); /*proto*/
static char __pyx_doc_2yt_5lagos_8chainHOP_8chainHOP_11RunChainHOP__communicate_annulus_chainIDs[] = "\n        Transmit all of our chainID-ed particles that are within self.padding\n        of the boundaries to all of our neighbors. Tests show that this is\n        faster than trying to figure out which of the neighbors to send the data\n        to.\n        ";
static PyMethodDef __pyx_mdef_2yt_5lagos_8chainHOP_8chainHOP_11RunChainHOP__communicate_annulus_chainIDs = {__Pyx_NAMESTR("_communicate_annulus_chainIDs"), (PyCFunction)__pyx_pf_2yt_5lagos_8chainHOP_8chainHOP_11RunChainHOP__communicate_annulus_chainIDs, METH_O, __Pyx_DOCSTR(__pyx_doc_2yt_5lagos_8chainHOP_8chainHOP_11RunChainHOP__communicate_annulus_chainIDs)};
static PyObject *__pyx_pf_2yt_5lagos_8chainHOP_8chainHOP_11RunChainHOP__communicate_annulus_chainIDs(PyObject *__pyx_self, PyObject *__pyx_v_self) {
  long __pyx_v_shift_index;
  long __pyx_v_opp_neighbor;
  long __pyx_v_neighbor;
  long __pyx_v_i;
  long __pyx_v_send_count;
  long __pyx_v_real_index;
  long __pyx_v_localID;
  PyArrayObject *__pyx_v_recv_real_indices;
  PyArrayObject *__pyx_v_recv_chainIDs;
  PyArrayObject *__pyx_v_select;
  PyArrayObject *__pyx_v_real_indices;
  PyArrayObject *__pyx_v_chainIDs;
  PyObject *__pyx_v_global_annulus_count;
  PyObject *__pyx_v_size_max;
  PyObject *__pyx_v_shift;
  PyObject *__pyx_v_opp_shift;
  PyObject *__pyx_v_opp_size;
  PyObject *__pyx_v_status;
  PyObject *__pyx_r = NULL;
  PyObject *__pyx_1 = 0;
  PyObject *__pyx_2 = 0;
  int __pyx_3;
  PyObject *__pyx_t_1 = NULL;
  PyObject *__pyx_t_2 = NULL;
  long __pyx_t_3;
  PyObject *__pyx_t_4 = NULL;
  int __pyx_t_5;
  long __pyx_t_6;
  PyObject *__pyx_t_7 = NULL;
  PyObject *__pyx_t_8 = NULL;
  PyObject *__pyx_t_9 = NULL;
  Py_ssize_t __pyx_t_10;
  Py_ssize_t __pyx_t_11;
  long __pyx_t_12;
  __Pyx_SetupRefcountContext("_communicate_annulus_chainIDs");
  __pyx_self = __pyx_self;
  __pyx_v_recv_real_indices = ((PyArrayObject *)Py_None); __Pyx_INCREF(Py_None);
  __pyx_v_recv_chainIDs = ((PyArrayObject *)Py_None); __Pyx_INCREF(Py_None);
  __pyx_v_select = ((PyArrayObject *)Py_None); __Pyx_INCREF(Py_None);
  __pyx_v_real_indices = ((PyArrayObject *)Py_None); __Pyx_INCREF(Py_None);
  __pyx_v_chainIDs = ((PyArrayObject *)Py_None); __Pyx_INCREF(Py_None);
  __pyx_v_global_annulus_count = Py_None; __Pyx_INCREF(Py_None);
  __pyx_v_size_max = Py_None; __Pyx_INCREF(Py_None);
  __pyx_v_shift = Py_None; __Pyx_INCREF(Py_None);
  __pyx_v_opp_shift = Py_None; __Pyx_INCREF(Py_None);
  __pyx_v_opp_size = Py_None; __Pyx_INCREF(Py_None);
  __pyx_v_status = Py_None; __Pyx_INCREF(Py_None);

  /* "/Users/sskory/Documents/yt-devel/yt/lagos/chainHOP/chainHOP.pyx":501
 *         cdef na.ndarray chainIDs
 *         # Pick the particles in the annulus.
 *         real_indices = self.index[self.is_inside_annulus]             # <<<<<<<<<<<<<<
 *         chainIDs = self.chainID[self.is_inside_annulus]
 *         # Eliminate un-assigned particles.
 */
  __pyx_t_1 = PyObject_GetAttr(__pyx_v_self, __pyx_kp_index); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 501; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_t_2 = PyObject_GetAttr(__pyx_v_self, __pyx_kp_is_inside_annulus); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 501; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_2);
  __pyx_1 = PyObject_GetItem(__pyx_t_1, __pyx_t_2); if (!__pyx_1) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 501; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_1);
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  if (!(__Pyx_TypeTest(__pyx_1, __pyx_ptype_5numpy_ndarray))) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 501; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_DECREF(((PyObject *)__pyx_v_real_indices));
  __pyx_v_real_indices = ((PyArrayObject *)__pyx_1);
  __pyx_1 = 0;

  /* "/Users/sskory/Documents/yt-devel/yt/lagos/chainHOP/chainHOP.pyx":502
 *         # Pick the particles in the annulus.
 *         real_indices = self.index[self.is_inside_annulus]
 *         chainIDs = self.chainID[self.is_inside_annulus]             # <<<<<<<<<<<<<<
 *         # Eliminate un-assigned particles.
 *         select = (chainIDs != -1)
 */
  __pyx_t_2 = PyObject_GetAttr(__pyx_v_self, __pyx_kp_chainID); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 502; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_2);
  __pyx_t_1 = PyObject_GetAttr(__pyx_v_self, __pyx_kp_is_inside_annulus); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 502; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_1 = PyObject_GetItem(__pyx_t_2, __pyx_t_1); if (!__pyx_1) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 502; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_1);
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  if (!(__Pyx_TypeTest(__pyx_1, __pyx_ptype_5numpy_ndarray))) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 502; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_DECREF(((PyObject *)__pyx_v_chainIDs));
  __pyx_v_chainIDs = ((PyArrayObject *)__pyx_1);
  __pyx_1 = 0;

  /* "/Users/sskory/Documents/yt-devel/yt/lagos/chainHOP/chainHOP.pyx":504
 *         chainIDs = self.chainID[self.is_inside_annulus]
 *         # Eliminate un-assigned particles.
 *         select = (chainIDs != -1)             # <<<<<<<<<<<<<<
 *         real_indices = real_indices[select]
 *         chainIDs = chainIDs[select]
 */
  __pyx_t_1 = PyObject_RichCompare(((PyObject *)__pyx_v_chainIDs), __pyx_int_neg_1, Py_NE); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 504; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_1);
  if (!(__Pyx_TypeTest(__pyx_t_1, __pyx_ptype_5numpy_ndarray))) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 504; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_DECREF(((PyObject *)__pyx_v_select));
  __pyx_v_select = ((PyArrayObject *)__pyx_t_1);
  __pyx_t_1 = 0;

  /* "/Users/sskory/Documents/yt-devel/yt/lagos/chainHOP/chainHOP.pyx":505
 *         # Eliminate un-assigned particles.
 *         select = (chainIDs != -1)
 *         real_indices = real_indices[select]             # <<<<<<<<<<<<<<
 *         chainIDs = chainIDs[select]
 *         send_count = real_indices.size
 */
  __pyx_1 = PyObject_GetItem(((PyObject *)__pyx_v_real_indices), ((PyObject *)__pyx_v_select)); if (!__pyx_1) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 505; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_1);
  if (!(__Pyx_TypeTest(__pyx_1, __pyx_ptype_5numpy_ndarray))) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 505; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_DECREF(((PyObject *)__pyx_v_real_indices));
  __pyx_v_real_indices = ((PyArrayObject *)__pyx_1);
  __pyx_1 = 0;

  /* "/Users/sskory/Documents/yt-devel/yt/lagos/chainHOP/chainHOP.pyx":506
 *         select = (chainIDs != -1)
 *         real_indices = real_indices[select]
 *         chainIDs = chainIDs[select]             # <<<<<<<<<<<<<<
 *         send_count = real_indices.size
 *         # Here distribute the counts globally. Unfortunately, it's a barrier(),
 */
  __pyx_1 = PyObject_GetItem(((PyObject *)__pyx_v_chainIDs), ((PyObject *)__pyx_v_select)); if (!__pyx_1) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 506; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_1);
  if (!(__Pyx_TypeTest(__pyx_1, __pyx_ptype_5numpy_ndarray))) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 506; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_DECREF(((PyObject *)__pyx_v_chainIDs));
  __pyx_v_chainIDs = ((PyArrayObject *)__pyx_1);
  __pyx_1 = 0;

  /* "/Users/sskory/Documents/yt-devel/yt/lagos/chainHOP/chainHOP.pyx":507
 *         real_indices = real_indices[select]
 *         chainIDs = chainIDs[select]
 *         send_count = real_indices.size             # <<<<<<<<<<<<<<
 *         # Here distribute the counts globally. Unfortunately, it's a barrier(),
 *         # but there's so many places in this that need to be globally synched
 */
  __pyx_t_1 = PyObject_GetAttr(((PyObject *)__pyx_v_real_indices), __pyx_kp_size); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 507; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_t_3 = __Pyx_PyInt_AsLong(__pyx_t_1); if (unlikely((__pyx_t_3 == (long)-1) && PyErr_Occurred())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 507; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_v_send_count = __pyx_t_3;

  /* "/Users/sskory/Documents/yt-devel/yt/lagos/chainHOP/chainHOP.pyx":511
 *         # but there's so many places in this that need to be globally synched
 *         # that it's not worth the effort right now to make this one spot better.
 *         global_annulus_count = {self.mine:send_count}             # <<<<<<<<<<<<<<
 *         global_annulus_count = self._mpi_joindict(global_annulus_count)
 * 
 */
  __pyx_1 = PyDict_New(); if (unlikely(!__pyx_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 511; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(((PyObject *)__pyx_1));
  __pyx_t_1 = PyObject_GetAttr(__pyx_v_self, __pyx_kp_mine); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 511; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_t_2 = PyInt_FromLong(__pyx_v_send_count); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 511; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_2);
  if (PyDict_SetItem(__pyx_1, __pyx_t_1, __pyx_t_2) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 511; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __Pyx_DECREF(__pyx_v_global_annulus_count);
  __pyx_v_global_annulus_count = ((PyObject *)__pyx_1);
  __pyx_1 = 0;

  /* "/Users/sskory/Documents/yt-devel/yt/lagos/chainHOP/chainHOP.pyx":512
 *         # that it's not worth the effort right now to make this one spot better.
 *         global_annulus_count = {self.mine:send_count}
 *         global_annulus_count = self._mpi_joindict(global_annulus_count)             # <<<<<<<<<<<<<<
 * 
 *         size_max = max(global_annulus_count.values())
 */
  __pyx_t_2 = PyObject_GetAttr(__pyx_v_self, __pyx_kp__mpi_joindict); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 512; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_2);
  __pyx_t_1 = PyTuple_New(1); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 512; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(((PyObject *)__pyx_t_1));
  __Pyx_INCREF(__pyx_v_global_annulus_count);
  PyTuple_SET_ITEM(__pyx_t_1, 0, __pyx_v_global_annulus_count);
  __Pyx_GIVEREF(__pyx_v_global_annulus_count);
  __pyx_t_4 = PyObject_Call(__pyx_t_2, ((PyObject *)__pyx_t_1), NULL); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 512; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_4);
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __Pyx_DECREF(((PyObject *)__pyx_t_1)); __pyx_t_1 = 0;
  __Pyx_DECREF(__pyx_v_global_annulus_count);
  __pyx_v_global_annulus_count = __pyx_t_4;
  __pyx_t_4 = 0;

  /* "/Users/sskory/Documents/yt-devel/yt/lagos/chainHOP/chainHOP.pyx":514
 *         global_annulus_count = self._mpi_joindict(global_annulus_count)
 * 
 *         size_max = max(global_annulus_count.values())             # <<<<<<<<<<<<<<
 *         recv_real_indices = na.empty(size_max, dtype='int64')
 *         recv_chainIDs = na.empty(size_max, dtype='int64')
 */
  __pyx_t_4 = PyObject_GetAttr(__pyx_v_global_annulus_count, __pyx_kp_values); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 514; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_4);
  __pyx_t_1 = PyObject_Call(__pyx_t_4, ((PyObject *)__pyx_empty_tuple), NULL); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 514; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
  __pyx_t_4 = PyTuple_New(1); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 514; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(((PyObject *)__pyx_t_4));
  PyTuple_SET_ITEM(__pyx_t_4, 0, __pyx_t_1);
  __Pyx_GIVEREF(__pyx_t_1);
  __pyx_t_1 = 0;
  __pyx_t_1 = PyObject_Call(__pyx_builtin_max, ((PyObject *)__pyx_t_4), NULL); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 514; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_DECREF(((PyObject *)__pyx_t_4)); __pyx_t_4 = 0;
  __Pyx_DECREF(__pyx_v_size_max);
  __pyx_v_size_max = __pyx_t_1;
  __pyx_t_1 = 0;

  /* "/Users/sskory/Documents/yt-devel/yt/lagos/chainHOP/chainHOP.pyx":515
 * 
 *         size_max = max(global_annulus_count.values())
 *         recv_real_indices = na.empty(size_max, dtype='int64')             # <<<<<<<<<<<<<<
 *         recv_chainIDs = na.empty(size_max, dtype='int64')
 * 
 */
  __pyx_1 = __Pyx_GetName(__pyx_m, __pyx_kp_na); if (unlikely(!__pyx_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 515; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_1);
  __pyx_t_1 = PyObject_GetAttr(__pyx_1, __pyx_kp_empty); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 515; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_DECREF(__pyx_1); __pyx_1 = 0;
  __pyx_t_4 = PyTuple_New(1); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 515; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(((PyObject *)__pyx_t_4));
  __Pyx_INCREF(__pyx_v_size_max);
  PyTuple_SET_ITEM(__pyx_t_4, 0, __pyx_v_size_max);
  __Pyx_GIVEREF(__pyx_v_size_max);
  __pyx_1 = PyDict_New(); if (unlikely(!__pyx_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 515; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(((PyObject *)__pyx_1));
  if (PyDict_SetItem(__pyx_1, __pyx_kp_dtype, __pyx_kp_68) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 515; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __pyx_t_2 = PyEval_CallObjectWithKeywords(__pyx_t_1, ((PyObject *)__pyx_t_4), ((PyObject *)__pyx_1)); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 515; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_2);
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  __Pyx_DECREF(((PyObject *)__pyx_t_4)); __pyx_t_4 = 0;
  __Pyx_DECREF(((PyObject *)__pyx_1)); __pyx_1 = 0;
  if (!(__Pyx_TypeTest(__pyx_t_2, __pyx_ptype_5numpy_ndarray))) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 515; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_DECREF(((PyObject *)__pyx_v_recv_real_indices));
  __pyx_v_recv_real_indices = ((PyArrayObject *)__pyx_t_2);
  __pyx_t_2 = 0;

  /* "/Users/sskory/Documents/yt-devel/yt/lagos/chainHOP/chainHOP.pyx":516
 *         size_max = max(global_annulus_count.values())
 *         recv_real_indices = na.empty(size_max, dtype='int64')
 *         recv_chainIDs = na.empty(size_max, dtype='int64')             # <<<<<<<<<<<<<<
 * 
 *         for shift_index in xrange(27):
 */
  __pyx_1 = __Pyx_GetName(__pyx_m, __pyx_kp_na); if (unlikely(!__pyx_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 516; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_1);
  __pyx_t_2 = PyObject_GetAttr(__pyx_1, __pyx_kp_empty); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 516; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_2);
  __Pyx_DECREF(__pyx_1); __pyx_1 = 0;
  __pyx_t_4 = PyTuple_New(1); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 516; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(((PyObject *)__pyx_t_4));
  __Pyx_INCREF(__pyx_v_size_max);
  PyTuple_SET_ITEM(__pyx_t_4, 0, __pyx_v_size_max);
  __Pyx_GIVEREF(__pyx_v_size_max);
  __pyx_1 = PyDict_New(); if (unlikely(!__pyx_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 516; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(((PyObject *)__pyx_1));
  if (PyDict_SetItem(__pyx_1, __pyx_kp_dtype, __pyx_kp_69) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 516; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __pyx_t_1 = PyEval_CallObjectWithKeywords(__pyx_t_2, ((PyObject *)__pyx_t_4), ((PyObject *)__pyx_1)); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 516; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __Pyx_DECREF(((PyObject *)__pyx_t_4)); __pyx_t_4 = 0;
  __Pyx_DECREF(((PyObject *)__pyx_1)); __pyx_1 = 0;
  if (!(__Pyx_TypeTest(__pyx_t_1, __pyx_ptype_5numpy_ndarray))) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 516; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_DECREF(((PyObject *)__pyx_v_recv_chainIDs));
  __pyx_v_recv_chainIDs = ((PyArrayObject *)__pyx_t_1);
  __pyx_t_1 = 0;

  /* "/Users/sskory/Documents/yt-devel/yt/lagos/chainHOP/chainHOP.pyx":518
 *         recv_chainIDs = na.empty(size_max, dtype='int64')
 * 
 *         for shift_index in xrange(27):             # <<<<<<<<<<<<<<
 *             if shift_index==13: continue
 *             shift = self._translate_shift(i=shift_index)
 */
  for (__pyx_t_3 = 0; __pyx_t_3 < 27; __pyx_t_3+=1) {
    __pyx_v_shift_index = __pyx_t_3;

    /* "/Users/sskory/Documents/yt-devel/yt/lagos/chainHOP/chainHOP.pyx":519
 * 
 *         for shift_index in xrange(27):
 *             if shift_index==13: continue             # <<<<<<<<<<<<<<
 *             shift = self._translate_shift(i=shift_index)
 *             neighbor = self._mpi_find_neighbor_3d(shift)
 */
    __pyx_t_5 = (__pyx_v_shift_index == 13);
    if (__pyx_t_5) {
      goto __pyx_L5_continue;
      goto __pyx_L7;
    }
    __pyx_L7:;

    /* "/Users/sskory/Documents/yt-devel/yt/lagos/chainHOP/chainHOP.pyx":520
 *         for shift_index in xrange(27):
 *             if shift_index==13: continue
 *             shift = self._translate_shift(i=shift_index)             # <<<<<<<<<<<<<<
 *             neighbor = self._mpi_find_neighbor_3d(shift)
 *             if neighbor == self.mine: continue
 */
    __pyx_t_1 = PyObject_GetAttr(__pyx_v_self, __pyx_kp__translate_shift); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 520; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_1);
    __pyx_1 = PyDict_New(); if (unlikely(!__pyx_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 520; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(((PyObject *)__pyx_1));
    __pyx_t_4 = PyInt_FromLong(__pyx_v_shift_index); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 520; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_4);
    if (PyDict_SetItem(__pyx_1, __pyx_kp_i, __pyx_t_4) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 520; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
    __pyx_t_4 = PyEval_CallObjectWithKeywords(__pyx_t_1, ((PyObject *)__pyx_empty_tuple), ((PyObject *)__pyx_1)); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 520; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_4);
    __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
    __Pyx_DECREF(((PyObject *)__pyx_1)); __pyx_1 = 0;
    __Pyx_DECREF(__pyx_v_shift);
    __pyx_v_shift = __pyx_t_4;
    __pyx_t_4 = 0;

    /* "/Users/sskory/Documents/yt-devel/yt/lagos/chainHOP/chainHOP.pyx":521
 *             if shift_index==13: continue
 *             shift = self._translate_shift(i=shift_index)
 *             neighbor = self._mpi_find_neighbor_3d(shift)             # <<<<<<<<<<<<<<
 *             if neighbor == self.mine: continue
 *             opp_shift = -1 * shift
 */
    __pyx_t_4 = PyObject_GetAttr(__pyx_v_self, __pyx_kp_63); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 521; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_4);
    __pyx_t_1 = PyTuple_New(1); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 521; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(((PyObject *)__pyx_t_1));
    __Pyx_INCREF(__pyx_v_shift);
    PyTuple_SET_ITEM(__pyx_t_1, 0, __pyx_v_shift);
    __Pyx_GIVEREF(__pyx_v_shift);
    __pyx_t_2 = PyObject_Call(__pyx_t_4, ((PyObject *)__pyx_t_1), NULL); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 521; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_2);
    __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
    __Pyx_DECREF(((PyObject *)__pyx_t_1)); __pyx_t_1 = 0;
    __pyx_t_6 = __Pyx_PyInt_AsLong(__pyx_t_2); if (unlikely((__pyx_t_6 == (long)-1) && PyErr_Occurred())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 521; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
    __pyx_v_neighbor = __pyx_t_6;

    /* "/Users/sskory/Documents/yt-devel/yt/lagos/chainHOP/chainHOP.pyx":522
 *             shift = self._translate_shift(i=shift_index)
 *             neighbor = self._mpi_find_neighbor_3d(shift)
 *             if neighbor == self.mine: continue             # <<<<<<<<<<<<<<
 *             opp_shift = -1 * shift
 *             opp_neighbor = self._mpi_find_neighbor_3d(opp_shift)
 */
    __pyx_t_2 = PyInt_FromLong(__pyx_v_neighbor); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 522; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_2);
    __pyx_t_1 = PyObject_GetAttr(__pyx_v_self, __pyx_kp_mine); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 522; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_1);
    __pyx_t_4 = PyObject_RichCompare(__pyx_t_2, __pyx_t_1, Py_EQ); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 522; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_4);
    __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
    __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
    __pyx_t_5 = __Pyx_PyObject_IsTrue(__pyx_t_4); if (unlikely(__pyx_t_5 < 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 522; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
    if (__pyx_t_5) {
      goto __pyx_L5_continue;
      goto __pyx_L8;
    }
    __pyx_L8:;

    /* "/Users/sskory/Documents/yt-devel/yt/lagos/chainHOP/chainHOP.pyx":523
 *             neighbor = self._mpi_find_neighbor_3d(shift)
 *             if neighbor == self.mine: continue
 *             opp_shift = -1 * shift             # <<<<<<<<<<<<<<
 *             opp_neighbor = self._mpi_find_neighbor_3d(opp_shift)
 *             opp_size = global_annulus_count[opp_neighbor]
 */
    __pyx_t_4 = PyNumber_Multiply(__pyx_int_neg_1, __pyx_v_shift); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 523; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_4);
    __Pyx_DECREF(__pyx_v_opp_shift);
    __pyx_v_opp_shift = __pyx_t_4;
    __pyx_t_4 = 0;

    /* "/Users/sskory/Documents/yt-devel/yt/lagos/chainHOP/chainHOP.pyx":524
 *             if neighbor == self.mine: continue
 *             opp_shift = -1 * shift
 *             opp_neighbor = self._mpi_find_neighbor_3d(opp_shift)             # <<<<<<<<<<<<<<
 *             opp_size = global_annulus_count[opp_neighbor]
 *             # Send/receive the data.
 */
    __pyx_t_4 = PyObject_GetAttr(__pyx_v_self, __pyx_kp_63); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 524; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_4);
    __pyx_t_1 = PyTuple_New(1); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 524; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(((PyObject *)__pyx_t_1));
    __Pyx_INCREF(__pyx_v_opp_shift);
    PyTuple_SET_ITEM(__pyx_t_1, 0, __pyx_v_opp_shift);
    __Pyx_GIVEREF(__pyx_v_opp_shift);
    __pyx_t_2 = PyObject_Call(__pyx_t_4, ((PyObject *)__pyx_t_1), NULL); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 524; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_2);
    __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
    __Pyx_DECREF(((PyObject *)__pyx_t_1)); __pyx_t_1 = 0;
    __pyx_t_6 = __Pyx_PyInt_AsLong(__pyx_t_2); if (unlikely((__pyx_t_6 == (long)-1) && PyErr_Occurred())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 524; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
    __pyx_v_opp_neighbor = __pyx_t_6;

    /* "/Users/sskory/Documents/yt-devel/yt/lagos/chainHOP/chainHOP.pyx":525
 *             opp_shift = -1 * shift
 *             opp_neighbor = self._mpi_find_neighbor_3d(opp_shift)
 *             opp_size = global_annulus_count[opp_neighbor]             # <<<<<<<<<<<<<<
 *             # Send/receive the data.
 *             status = MPI.COMM_WORLD.Sendrecv(
 */
    __pyx_1 = __Pyx_GetItemInt(__pyx_v_global_annulus_count, __pyx_v_opp_neighbor, sizeof(long), PyInt_FromLong); if (!__pyx_1) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 525; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_1);
    __Pyx_DECREF(__pyx_v_opp_size);
    __pyx_v_opp_size = __pyx_1;
    __pyx_1 = 0;

    /* "/Users/sskory/Documents/yt-devel/yt/lagos/chainHOP/chainHOP.pyx":527
 *             opp_size = global_annulus_count[opp_neighbor]
 *             # Send/receive the data.
 *             status = MPI.COMM_WORLD.Sendrecv(             # <<<<<<<<<<<<<<
 *                 [real_indices, MPI.INT], neighbor, 0,
 *                 [recv_real_indices, MPI.INT], opp_neighbor, 0)
 */
    __pyx_1 = __Pyx_GetName(__pyx_m, __pyx_kp_MPI); if (unlikely(!__pyx_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 527; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_1);
    __pyx_t_2 = PyObject_GetAttr(__pyx_1, __pyx_kp_COMM_WORLD); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 527; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_2);
    __Pyx_DECREF(__pyx_1); __pyx_1 = 0;
    __pyx_t_1 = PyObject_GetAttr(__pyx_t_2, __pyx_kp_Sendrecv); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 527; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_1);
    __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;

    /* "/Users/sskory/Documents/yt-devel/yt/lagos/chainHOP/chainHOP.pyx":528
 *             # Send/receive the data.
 *             status = MPI.COMM_WORLD.Sendrecv(
 *                 [real_indices, MPI.INT], neighbor, 0,             # <<<<<<<<<<<<<<
 *                 [recv_real_indices, MPI.INT], opp_neighbor, 0)
 *             status = MPI.COMM_WORLD.Sendrecv(
 */
    __pyx_1 = __Pyx_GetName(__pyx_m, __pyx_kp_MPI); if (unlikely(!__pyx_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 528; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_1);
    __pyx_t_2 = PyObject_GetAttr(__pyx_1, __pyx_kp_INT); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 528; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_2);
    __Pyx_DECREF(__pyx_1); __pyx_1 = 0;
    __pyx_t_4 = PyList_New(2); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 528; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(((PyObject *)__pyx_t_4));
    __Pyx_INCREF(((PyObject *)__pyx_v_real_indices));
    PyList_SET_ITEM(__pyx_t_4, 0, ((PyObject *)__pyx_v_real_indices));
    __Pyx_GIVEREF(((PyObject *)__pyx_v_real_indices));
    PyList_SET_ITEM(__pyx_t_4, 1, __pyx_t_2);
    __Pyx_GIVEREF(__pyx_t_2);
    __pyx_t_2 = 0;
    __pyx_t_2 = PyInt_FromLong(__pyx_v_neighbor); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 528; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_2);

    /* "/Users/sskory/Documents/yt-devel/yt/lagos/chainHOP/chainHOP.pyx":529
 *             status = MPI.COMM_WORLD.Sendrecv(
 *                 [real_indices, MPI.INT], neighbor, 0,
 *                 [recv_real_indices, MPI.INT], opp_neighbor, 0)             # <<<<<<<<<<<<<<
 *             status = MPI.COMM_WORLD.Sendrecv(
 *                 [chainIDs, MPI.INT], neighbor, 0,
 */
    __pyx_1 = __Pyx_GetName(__pyx_m, __pyx_kp_MPI); if (unlikely(!__pyx_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 529; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_1);
    __pyx_t_7 = PyObject_GetAttr(__pyx_1, __pyx_kp_INT); if (unlikely(!__pyx_t_7)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 529; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_7);
    __Pyx_DECREF(__pyx_1); __pyx_1 = 0;
    __pyx_t_8 = PyList_New(2); if (unlikely(!__pyx_t_8)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 529; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(((PyObject *)__pyx_t_8));
    __Pyx_INCREF(((PyObject *)__pyx_v_recv_real_indices));
    PyList_SET_ITEM(__pyx_t_8, 0, ((PyObject *)__pyx_v_recv_real_indices));
    __Pyx_GIVEREF(((PyObject *)__pyx_v_recv_real_indices));
    PyList_SET_ITEM(__pyx_t_8, 1, __pyx_t_7);
    __Pyx_GIVEREF(__pyx_t_7);
    __pyx_t_7 = 0;
    __pyx_t_7 = PyInt_FromLong(__pyx_v_opp_neighbor); if (unlikely(!__pyx_t_7)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 529; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_7);
    __pyx_t_9 = PyTuple_New(6); if (unlikely(!__pyx_t_9)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 527; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(((PyObject *)__pyx_t_9));
    PyTuple_SET_ITEM(__pyx_t_9, 0, ((PyObject *)__pyx_t_4));
    __Pyx_GIVEREF(((PyObject *)__pyx_t_4));
    PyTuple_SET_ITEM(__pyx_t_9, 1, __pyx_t_2);
    __Pyx_GIVEREF(__pyx_t_2);
    __Pyx_INCREF(__pyx_int_0);
    PyTuple_SET_ITEM(__pyx_t_9, 2, __pyx_int_0);
    __Pyx_GIVEREF(__pyx_int_0);
    PyTuple_SET_ITEM(__pyx_t_9, 3, ((PyObject *)__pyx_t_8));
    __Pyx_GIVEREF(((PyObject *)__pyx_t_8));
    PyTuple_SET_ITEM(__pyx_t_9, 4, __pyx_t_7);
    __Pyx_GIVEREF(__pyx_t_7);
    __Pyx_INCREF(__pyx_int_0);
    PyTuple_SET_ITEM(__pyx_t_9, 5, __pyx_int_0);
    __Pyx_GIVEREF(__pyx_int_0);
    __pyx_t_4 = 0;
    __pyx_t_2 = 0;
    __pyx_t_8 = 0;
    __pyx_t_7 = 0;
    __pyx_t_7 = PyObject_Call(__pyx_t_1, ((PyObject *)__pyx_t_9), NULL); if (unlikely(!__pyx_t_7)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 527; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_7);
    __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
    __Pyx_DECREF(((PyObject *)__pyx_t_9)); __pyx_t_9 = 0;
    __Pyx_DECREF(__pyx_v_status);
    __pyx_v_status = __pyx_t_7;
    __pyx_t_7 = 0;

    /* "/Users/sskory/Documents/yt-devel/yt/lagos/chainHOP/chainHOP.pyx":530
 *                 [real_indices, MPI.INT], neighbor, 0,
 *                 [recv_real_indices, MPI.INT], opp_neighbor, 0)
 *             status = MPI.COMM_WORLD.Sendrecv(             # <<<<<<<<<<<<<<
 *                 [chainIDs, MPI.INT], neighbor, 0,
 *                 [recv_chainIDs, MPI.INT], opp_neighbor, 0)
 */
    __pyx_1 = __Pyx_GetName(__pyx_m, __pyx_kp_MPI); if (unlikely(!__pyx_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 530; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_1);
    __pyx_t_7 = PyObject_GetAttr(__pyx_1, __pyx_kp_COMM_WORLD); if (unlikely(!__pyx_t_7)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 530; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_7);
    __Pyx_DECREF(__pyx_1); __pyx_1 = 0;
    __pyx_t_9 = PyObject_GetAttr(__pyx_t_7, __pyx_kp_Sendrecv); if (unlikely(!__pyx_t_9)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 530; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_9);
    __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;

    /* "/Users/sskory/Documents/yt-devel/yt/lagos/chainHOP/chainHOP.pyx":531
 *                 [recv_real_indices, MPI.INT], opp_neighbor, 0)
 *             status = MPI.COMM_WORLD.Sendrecv(
 *                 [chainIDs, MPI.INT], neighbor, 0,             # <<<<<<<<<<<<<<
 *                 [recv_chainIDs, MPI.INT], opp_neighbor, 0)
 *             # Use the data immediately.
 */
    __pyx_1 = __Pyx_GetName(__pyx_m, __pyx_kp_MPI); if (unlikely(!__pyx_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 531; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_1);
    __pyx_t_7 = PyObject_GetAttr(__pyx_1, __pyx_kp_INT); if (unlikely(!__pyx_t_7)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 531; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_7);
    __Pyx_DECREF(__pyx_1); __pyx_1 = 0;
    __pyx_t_1 = PyList_New(2); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 531; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(((PyObject *)__pyx_t_1));
    __Pyx_INCREF(((PyObject *)__pyx_v_chainIDs));
    PyList_SET_ITEM(__pyx_t_1, 0, ((PyObject *)__pyx_v_chainIDs));
    __Pyx_GIVEREF(((PyObject *)__pyx_v_chainIDs));
    PyList_SET_ITEM(__pyx_t_1, 1, __pyx_t_7);
    __Pyx_GIVEREF(__pyx_t_7);
    __pyx_t_7 = 0;
    __pyx_t_7 = PyInt_FromLong(__pyx_v_neighbor); if (unlikely(!__pyx_t_7)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 531; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_7);

    /* "/Users/sskory/Documents/yt-devel/yt/lagos/chainHOP/chainHOP.pyx":532
 *             status = MPI.COMM_WORLD.Sendrecv(
 *                 [chainIDs, MPI.INT], neighbor, 0,
 *                 [recv_chainIDs, MPI.INT], opp_neighbor, 0)             # <<<<<<<<<<<<<<
 *             # Use the data immediately.
 *             for i,real_index in enumerate(recv_real_indices[0:opp_size]):
 */
    __pyx_1 = __Pyx_GetName(__pyx_m, __pyx_kp_MPI); if (unlikely(!__pyx_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 532; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_1);
    __pyx_t_8 = PyObject_GetAttr(__pyx_1, __pyx_kp_INT); if (unlikely(!__pyx_t_8)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 532; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_8);
    __Pyx_DECREF(__pyx_1); __pyx_1 = 0;
    __pyx_t_2 = PyList_New(2); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 532; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(((PyObject *)__pyx_t_2));
    __Pyx_INCREF(((PyObject *)__pyx_v_recv_chainIDs));
    PyList_SET_ITEM(__pyx_t_2, 0, ((PyObject *)__pyx_v_recv_chainIDs));
    __Pyx_GIVEREF(((PyObject *)__pyx_v_recv_chainIDs));
    PyList_SET_ITEM(__pyx_t_2, 1, __pyx_t_8);
    __Pyx_GIVEREF(__pyx_t_8);
    __pyx_t_8 = 0;
    __pyx_t_8 = PyInt_FromLong(__pyx_v_opp_neighbor); if (unlikely(!__pyx_t_8)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 532; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_8);
    __pyx_t_4 = PyTuple_New(6); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 530; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(((PyObject *)__pyx_t_4));
    PyTuple_SET_ITEM(__pyx_t_4, 0, ((PyObject *)__pyx_t_1));
    __Pyx_GIVEREF(((PyObject *)__pyx_t_1));
    PyTuple_SET_ITEM(__pyx_t_4, 1, __pyx_t_7);
    __Pyx_GIVEREF(__pyx_t_7);
    __Pyx_INCREF(__pyx_int_0);
    PyTuple_SET_ITEM(__pyx_t_4, 2, __pyx_int_0);
    __Pyx_GIVEREF(__pyx_int_0);
    PyTuple_SET_ITEM(__pyx_t_4, 3, ((PyObject *)__pyx_t_2));
    __Pyx_GIVEREF(((PyObject *)__pyx_t_2));
    PyTuple_SET_ITEM(__pyx_t_4, 4, __pyx_t_8);
    __Pyx_GIVEREF(__pyx_t_8);
    __Pyx_INCREF(__pyx_int_0);
    PyTuple_SET_ITEM(__pyx_t_4, 5, __pyx_int_0);
    __Pyx_GIVEREF(__pyx_int_0);
    __pyx_t_1 = 0;
    __pyx_t_7 = 0;
    __pyx_t_2 = 0;
    __pyx_t_8 = 0;
    __pyx_t_8 = PyObject_Call(__pyx_t_9, ((PyObject *)__pyx_t_4), NULL); if (unlikely(!__pyx_t_8)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 530; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_8);
    __Pyx_DECREF(__pyx_t_9); __pyx_t_9 = 0;
    __Pyx_DECREF(((PyObject *)__pyx_t_4)); __pyx_t_4 = 0;
    __Pyx_DECREF(__pyx_v_status);
    __pyx_v_status = __pyx_t_8;
    __pyx_t_8 = 0;

    /* "/Users/sskory/Documents/yt-devel/yt/lagos/chainHOP/chainHOP.pyx":534
 *                 [recv_chainIDs, MPI.INT], opp_neighbor, 0)
 *             # Use the data immediately.
 *             for i,real_index in enumerate(recv_real_indices[0:opp_size]):             # <<<<<<<<<<<<<<
 *                 try:
 *                     localID = self.rev_index[real_index]
 */
    __pyx_t_11 = __Pyx_PyIndex_AsSsize_t(__pyx_v_opp_size); if (unlikely((__pyx_t_11 == (Py_ssize_t)-1) && PyErr_Occurred())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 534; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __pyx_1 = PySequence_GetSlice(((PyObject *)__pyx_v_recv_real_indices), 0, __pyx_t_11); if (unlikely(!__pyx_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 534; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_1);
    __pyx_t_8 = PyTuple_New(1); if (unlikely(!__pyx_t_8)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 534; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(((PyObject *)__pyx_t_8));
    PyTuple_SET_ITEM(__pyx_t_8, 0, __pyx_1);
    __Pyx_GIVEREF(__pyx_1);
    __pyx_1 = 0;
    __pyx_t_4 = PyObject_Call(__pyx_builtin_enumerate, ((PyObject *)__pyx_t_8), NULL); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 534; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_4);
    __Pyx_DECREF(((PyObject *)__pyx_t_8)); __pyx_t_8 = 0;
    if (PyList_CheckExact(__pyx_t_4) || PyTuple_CheckExact(__pyx_t_4)) {
      __pyx_t_10 = 0; __pyx_t_8 = __pyx_t_4; __Pyx_INCREF(__pyx_t_8);
    } else {
      __pyx_t_10 = -1; __pyx_t_8 = PyObject_GetIter(__pyx_t_4); if (unlikely(!__pyx_t_8)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 534; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_t_8);
    }
    __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
    for (;;) {
      if (likely(PyList_CheckExact(__pyx_t_8))) {
        if (__pyx_t_10 >= PyList_GET_SIZE(__pyx_t_8)) break;
        __pyx_t_4 = PyList_GET_ITEM(__pyx_t_8, __pyx_t_10); __Pyx_INCREF(__pyx_t_4); __pyx_t_10++;
      } else if (likely(PyTuple_CheckExact(__pyx_t_8))) {
        if (__pyx_t_10 >= PyTuple_GET_SIZE(__pyx_t_8)) break;
        __pyx_t_4 = PyTuple_GET_ITEM(__pyx_t_8, __pyx_t_10); __Pyx_INCREF(__pyx_t_4); __pyx_t_10++;
      } else {
        __pyx_t_4 = PyIter_Next(__pyx_t_8);
        if (!__pyx_t_4) {
          if (unlikely(PyErr_Occurred())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 534; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
          break;
        }
        __Pyx_GOTREF(__pyx_t_4);
      }
      if (PyTuple_CheckExact(__pyx_t_4) && likely(PyTuple_GET_SIZE(__pyx_t_4) == 2)) {
        PyObject* tuple = __pyx_t_4;
        __pyx_2 = PyTuple_GET_ITEM(tuple, 0); __Pyx_INCREF(__pyx_2);
        __pyx_t_6 = __Pyx_PyInt_AsLong(__pyx_2); if (unlikely((__pyx_t_6 == (long)-1) && PyErr_Occurred())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 534; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        __Pyx_DECREF(__pyx_2); __pyx_2 = 0;
        __pyx_2 = PyTuple_GET_ITEM(tuple, 1); __Pyx_INCREF(__pyx_2);
        __pyx_t_12 = __Pyx_PyInt_AsLong(__pyx_2); if (unlikely((__pyx_t_12 == (long)-1) && PyErr_Occurred())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 534; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        __Pyx_DECREF(__pyx_2); __pyx_2 = 0;
        __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
        __pyx_v_i = __pyx_t_6;
        __pyx_v_real_index = __pyx_t_12;
      } else {
        __pyx_1 = PyObject_GetIter(__pyx_t_4); if (unlikely(!__pyx_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 534; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        __Pyx_GOTREF(__pyx_1);
        __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
        __pyx_2 = __Pyx_UnpackItem(__pyx_1, 0); if (unlikely(!__pyx_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 534; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        __Pyx_GOTREF(__pyx_2);
        __pyx_t_12 = __Pyx_PyInt_AsLong(__pyx_2); if (unlikely((__pyx_t_12 == (long)-1) && PyErr_Occurred())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 534; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        __Pyx_DECREF(__pyx_2); __pyx_2 = 0;
        __pyx_2 = __Pyx_UnpackItem(__pyx_1, 1); if (unlikely(!__pyx_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 534; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        __Pyx_GOTREF(__pyx_2);
        __pyx_t_6 = __Pyx_PyInt_AsLong(__pyx_2); if (unlikely((__pyx_t_6 == (long)-1) && PyErr_Occurred())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 534; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        __Pyx_DECREF(__pyx_2); __pyx_2 = 0;
        if (__Pyx_EndUnpack(__pyx_1) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 534; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        __Pyx_DECREF(__pyx_1); __pyx_1 = 0;
        __pyx_v_i = __pyx_t_12;
        __pyx_v_real_index = __pyx_t_6;
      }

      /* "/Users/sskory/Documents/yt-devel/yt/lagos/chainHOP/chainHOP.pyx":535
 *             # Use the data immediately.
 *             for i,real_index in enumerate(recv_real_indices[0:opp_size]):
 *                 try:             # <<<<<<<<<<<<<<
 *                     localID = self.rev_index[real_index]
 *                     # We are only updating our particles that are in our
 */
      {
        PyObject *__pyx_save_exc_type, *__pyx_save_exc_value, *__pyx_save_exc_tb;
        __Pyx_ExceptionSave(&__pyx_save_exc_type, &__pyx_save_exc_value, &__pyx_save_exc_tb);
        __Pyx_XGOTREF(__pyx_save_exc_type);
        __Pyx_XGOTREF(__pyx_save_exc_value);
        __Pyx_XGOTREF(__pyx_save_exc_tb);
        /*try:*/ {

          /* "/Users/sskory/Documents/yt-devel/yt/lagos/chainHOP/chainHOP.pyx":536
 *             for i,real_index in enumerate(recv_real_indices[0:opp_size]):
 *                 try:
 *                     localID = self.rev_index[real_index]             # <<<<<<<<<<<<<<
 *                     # We are only updating our particles that are in our
 *                     # padding, so to be rigorous we will skip particles
 */
          __pyx_t_4 = PyObject_GetAttr(__pyx_v_self, __pyx_kp_rev_index); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 536; __pyx_clineno = __LINE__; goto __pyx_L11_error;}
          __Pyx_GOTREF(__pyx_t_4);
          __pyx_2 = __Pyx_GetItemInt(__pyx_t_4, __pyx_v_real_index, sizeof(long), PyInt_FromLong); if (!__pyx_2) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 536; __pyx_clineno = __LINE__; goto __pyx_L11_error;}
          __Pyx_GOTREF(__pyx_2);
          __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
          __pyx_t_6 = __Pyx_PyInt_AsLong(__pyx_2); if (unlikely((__pyx_t_6 == (long)-1) && PyErr_Occurred())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 536; __pyx_clineno = __LINE__; goto __pyx_L11_error;}
          __Pyx_DECREF(__pyx_2); __pyx_2 = 0;
          __pyx_v_localID = __pyx_t_6;

          /* "/Users/sskory/Documents/yt-devel/yt/lagos/chainHOP/chainHOP.pyx":540
 *                     # padding, so to be rigorous we will skip particles
 *                     # that are in our real region.
 *                     if self.is_inside[localID]:             # <<<<<<<<<<<<<<
 *                         continue
 *                     self.chainID[localID] = recv_chainIDs[i]
 */
          __pyx_t_4 = PyObject_GetAttr(__pyx_v_self, __pyx_kp_is_inside); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 540; __pyx_clineno = __LINE__; goto __pyx_L11_error;}
          __Pyx_GOTREF(__pyx_t_4);
          __pyx_1 = __Pyx_GetItemInt(__pyx_t_4, __pyx_v_localID, sizeof(long), PyInt_FromLong); if (!__pyx_1) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 540; __pyx_clineno = __LINE__; goto __pyx_L11_error;}
          __Pyx_GOTREF(__pyx_1);
          __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
          __pyx_t_5 = __Pyx_PyObject_IsTrue(__pyx_1); if (unlikely(__pyx_t_5 < 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 540; __pyx_clineno = __LINE__; goto __pyx_L11_error;}
          __Pyx_DECREF(__pyx_1); __pyx_1 = 0;
          if (__pyx_t_5) {

            /* "/Users/sskory/Documents/yt-devel/yt/lagos/chainHOP/chainHOP.pyx":541
 *                     # that are in our real region.
 *                     if self.is_inside[localID]:
 *                         continue             # <<<<<<<<<<<<<<
 *                     self.chainID[localID] = recv_chainIDs[i]
 *                 except KeyError:
 */
            goto __pyx_L17_try_continue;
            goto __pyx_L19;
          }
          __pyx_L19:;

          /* "/Users/sskory/Documents/yt-devel/yt/lagos/chainHOP/chainHOP.pyx":542
 *                     if self.is_inside[localID]:
 *                         continue
 *                     self.chainID[localID] = recv_chainIDs[i]             # <<<<<<<<<<<<<<
 *                 except KeyError:
 *                     # We ignore data that's not for us.
 */
          __pyx_2 = __Pyx_GetItemInt(((PyObject *)__pyx_v_recv_chainIDs), __pyx_v_i, sizeof(long), PyInt_FromLong); if (!__pyx_2) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 542; __pyx_clineno = __LINE__; goto __pyx_L11_error;}
          __Pyx_GOTREF(__pyx_2);
          __pyx_t_4 = PyObject_GetAttr(__pyx_v_self, __pyx_kp_chainID); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 542; __pyx_clineno = __LINE__; goto __pyx_L11_error;}
          __Pyx_GOTREF(__pyx_t_4);
          if (__Pyx_SetItemInt(__pyx_t_4, __pyx_v_localID, __pyx_2, sizeof(long), PyInt_FromLong) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 542; __pyx_clineno = __LINE__; goto __pyx_L11_error;}
          __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
          __Pyx_DECREF(__pyx_2); __pyx_2 = 0;
        }
        __Pyx_XDECREF(__pyx_save_exc_type); __pyx_save_exc_type = 0;
        __Pyx_XDECREF(__pyx_save_exc_value); __pyx_save_exc_value = 0;
        __Pyx_XDECREF(__pyx_save_exc_tb); __pyx_save_exc_tb = 0;
        goto __pyx_L18_try_end;
        __pyx_L11_error:;
        __Pyx_XDECREF(__pyx_1); __pyx_1 = 0;
        __Pyx_XDECREF(__pyx_2); __pyx_2 = 0;
        __Pyx_XDECREF(__pyx_t_1); __pyx_t_1 = 0;
        __Pyx_XDECREF(__pyx_t_7); __pyx_t_7 = 0;
        __Pyx_XDECREF(__pyx_t_2); __pyx_t_2 = 0;
        __Pyx_XDECREF(__pyx_t_9); __pyx_t_9 = 0;
        __Pyx_XDECREF(__pyx_t_4); __pyx_t_4 = 0;

        /* "/Users/sskory/Documents/yt-devel/yt/lagos/chainHOP/chainHOP.pyx":543
 *                         continue
 *                     self.chainID[localID] = recv_chainIDs[i]
 *                 except KeyError:             # <<<<<<<<<<<<<<
 *                     # We ignore data that's not for us.
 *                     continue
 */
        __pyx_3 = PyErr_ExceptionMatches(__pyx_builtin_KeyError);
        if (__pyx_3) {
          __Pyx_AddTraceback("yt.lagos.chainHOP.chainHOP._communicate_annulus_chainIDs");
          if (__Pyx_GetException(&__pyx_t_4, &__pyx_t_9, &__pyx_t_2) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 543; __pyx_clineno = __LINE__; goto __pyx_L13_except_error;}
          __Pyx_GOTREF(__pyx_t_4);
          __Pyx_GOTREF(__pyx_t_9);
          __Pyx_GOTREF(__pyx_t_2);

          /* "/Users/sskory/Documents/yt-devel/yt/lagos/chainHOP/chainHOP.pyx":545
 *                 except KeyError:
 *                     # We ignore data that's not for us.
 *                     continue             # <<<<<<<<<<<<<<
 * 
 *     def _connect_chains(object self):
 */
          goto __pyx_L21_except_continue;
          __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
          __Pyx_DECREF(__pyx_t_9); __pyx_t_9 = 0;
          __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
          goto __pyx_L12_exception_handled;
          __pyx_L21_except_continue:;
          __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
          __Pyx_DECREF(__pyx_t_9); __pyx_t_9 = 0;
          __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
          goto __pyx_L17_try_continue;
        }
        __pyx_L13_except_error:;
        __Pyx_XDECREF(__pyx_save_exc_type);
        __Pyx_XDECREF(__pyx_save_exc_value);
        __Pyx_XDECREF(__pyx_save_exc_tb);
        goto __pyx_L1_error;
        __pyx_L17_try_continue:;
        __Pyx_XGIVEREF(__pyx_save_exc_type);
        __Pyx_XGIVEREF(__pyx_save_exc_value);
        __Pyx_XGIVEREF(__pyx_save_exc_tb);
        __Pyx_ExceptionReset(__pyx_save_exc_type, __pyx_save_exc_value, __pyx_save_exc_tb);
        goto __pyx_L9_continue;
        __pyx_L12_exception_handled:;
        __Pyx_XGIVEREF(__pyx_save_exc_type);
        __Pyx_XGIVEREF(__pyx_save_exc_value);
        __Pyx_XGIVEREF(__pyx_save_exc_tb);
        __Pyx_ExceptionReset(__pyx_save_exc_type, __pyx_save_exc_value, __pyx_save_exc_tb);
        __pyx_L18_try_end:;
      }
      __pyx_L9_continue:;
    }
    __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
    __pyx_L5_continue:;
  }

  __pyx_r = Py_None; __Pyx_INCREF(Py_None);
  goto __pyx_L0;
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_1);
  __Pyx_XDECREF(__pyx_2);
  __Pyx_XDECREF(__pyx_t_1);
  __Pyx_XDECREF(__pyx_t_2);
  __Pyx_XDECREF(__pyx_t_4);
  __Pyx_XDECREF(__pyx_t_7);
  __Pyx_XDECREF(__pyx_t_8);
  __Pyx_XDECREF(__pyx_t_9);
  __Pyx_AddTraceback("yt.lagos.chainHOP.chainHOP.RunChainHOP._communicate_annulus_chainIDs");
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_DECREF((PyObject *)__pyx_v_recv_real_indices);
  __Pyx_DECREF((PyObject *)__pyx_v_recv_chainIDs);
  __Pyx_DECREF((PyObject *)__pyx_v_select);
  __Pyx_DECREF((PyObject *)__pyx_v_real_indices);
  __Pyx_DECREF((PyObject *)__pyx_v_chainIDs);
  __Pyx_DECREF(__pyx_v_global_annulus_count);
  __Pyx_DECREF(__pyx_v_size_max);
  __Pyx_DECREF(__pyx_v_shift);
  __Pyx_DECREF(__pyx_v_opp_shift);
  __Pyx_DECREF(__pyx_v_opp_size);
  __Pyx_DECREF(__pyx_v_status);
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_FinishRefcountContext();
  return __pyx_r;
}

/* "/Users/sskory/Documents/yt-devel/yt/lagos/chainHOP/chainHOP.pyx":547
 *                     continue
 * 
 *     def _connect_chains(object self):             # <<<<<<<<<<<<<<
 *         """
 *         With the set of particle chains, build a mapping of connected chainIDs
 */

static PyObject *__pyx_pf_2yt_5lagos_8chainHOP_8chainHOP_11RunChainHOP__connect_chains(PyObject *__pyx_self, PyObject *__pyx_v_self); /*proto*/
static char __pyx_doc_2yt_5lagos_8chainHOP_8chainHOP_11RunChainHOP__connect_chains[] = "\n        With the set of particle chains, build a mapping of connected chainIDs\n        by finding the highest boundary density neighbor for each chain. Some\n        chains will have no neighbors!\n        ";
static PyMethodDef __pyx_mdef_2yt_5lagos_8chainHOP_8chainHOP_11RunChainHOP__connect_chains = {__Pyx_NAMESTR("_connect_chains"), (PyCFunction)__pyx_pf_2yt_5lagos_8chainHOP_8chainHOP_11RunChainHOP__connect_chains, METH_O, __Pyx_DOCSTR(__pyx_doc_2yt_5lagos_8chainHOP_8chainHOP_11RunChainHOP__connect_chains)};
static PyObject *__pyx_pf_2yt_5lagos_8chainHOP_8chainHOP_11RunChainHOP__connect_chains(PyObject *__pyx_self, PyObject *__pyx_v_self) {
  long __pyx_v_i;
  long __pyx_v_j;
  long __pyx_v_thisNN;
  long __pyx_v_thisNN_chainID;
  long __pyx_v_higher_chain;
  long __pyx_v_lower_chain;
  double __pyx_v_part_max_dens;
  double __pyx_v_thisNN_max_dens;
  double __pyx_v_boundary_density;
  double __pyx_v_old;
  PyObject *__pyx_v_chainID;
  PyObject *__pyx_r = NULL;
  PyObject *__pyx_1 = 0;
  PyObject *__pyx_2 = 0;
  int __pyx_3;
  Py_ssize_t __pyx_t_1;
  PyObject *__pyx_t_2 = NULL;
  PyObject *__pyx_t_3 = NULL;
  PyObject *__pyx_t_4 = NULL;
  PyObject *__pyx_t_5 = NULL;
  long __pyx_t_6;
  long __pyx_t_7;
  int __pyx_t_8;
  int __pyx_t_9;
  double __pyx_t_10;
  long __pyx_t_11;
  long __pyx_t_12;
  long __pyx_t_13;
  int __pyx_t_14;
  PyObject *__pyx_t_15 = NULL;
  __Pyx_SetupRefcountContext("_connect_chains");
  __pyx_self = __pyx_self;
  __pyx_v_chainID = Py_None; __Pyx_INCREF(Py_None);

  /* "/Users/sskory/Documents/yt-devel/yt/lagos/chainHOP/chainHOP.pyx":555
 *         cdef long i, j, thisNN, thisNN_chainID, higher_chain, lower_chain
 *         cdef double part_max_dens, thisNN_max_dens, boundary_density, old
 *         self.chain_densest_n = {} # chainID -> {chainIDs->boundary dens}             # <<<<<<<<<<<<<<
 *         self.reverse_map = {} # chainID -> groupID, one to one
 *         for chainID in self.densest_in_chain:
 */
  __pyx_1 = PyDict_New(); if (unlikely(!__pyx_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 555; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(((PyObject *)__pyx_1));
  if (PyObject_SetAttr(__pyx_v_self, __pyx_kp_chain_densest_n, ((PyObject *)__pyx_1)) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 555; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_DECREF(((PyObject *)__pyx_1)); __pyx_1 = 0;

  /* "/Users/sskory/Documents/yt-devel/yt/lagos/chainHOP/chainHOP.pyx":556
 *         cdef double part_max_dens, thisNN_max_dens, boundary_density, old
 *         self.chain_densest_n = {} # chainID -> {chainIDs->boundary dens}
 *         self.reverse_map = {} # chainID -> groupID, one to one             # <<<<<<<<<<<<<<
 *         for chainID in self.densest_in_chain:
 *             self.chain_densest_n[int(chainID)] = {}
 */
  __pyx_1 = PyDict_New(); if (unlikely(!__pyx_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 556; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(((PyObject *)__pyx_1));
  if (PyObject_SetAttr(__pyx_v_self, __pyx_kp_reverse_map, ((PyObject *)__pyx_1)) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 556; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_DECREF(((PyObject *)__pyx_1)); __pyx_1 = 0;

  /* "/Users/sskory/Documents/yt-devel/yt/lagos/chainHOP/chainHOP.pyx":557
 *         self.chain_densest_n = {} # chainID -> {chainIDs->boundary dens}
 *         self.reverse_map = {} # chainID -> groupID, one to one
 *         for chainID in self.densest_in_chain:             # <<<<<<<<<<<<<<
 *             self.chain_densest_n[int(chainID)] = {}
 *             self.reverse_map[int(chainID)] = -1
 */
  __pyx_t_2 = PyObject_GetAttr(__pyx_v_self, __pyx_kp_densest_in_chain); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 557; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_2);
  if (PyList_CheckExact(__pyx_t_2) || PyTuple_CheckExact(__pyx_t_2)) {
    __pyx_t_1 = 0; __pyx_t_3 = __pyx_t_2; __Pyx_INCREF(__pyx_t_3);
  } else {
    __pyx_t_1 = -1; __pyx_t_3 = PyObject_GetIter(__pyx_t_2); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 557; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_3);
  }
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  for (;;) {
    if (likely(PyList_CheckExact(__pyx_t_3))) {
      if (__pyx_t_1 >= PyList_GET_SIZE(__pyx_t_3)) break;
      __pyx_t_2 = PyList_GET_ITEM(__pyx_t_3, __pyx_t_1); __Pyx_INCREF(__pyx_t_2); __pyx_t_1++;
    } else if (likely(PyTuple_CheckExact(__pyx_t_3))) {
      if (__pyx_t_1 >= PyTuple_GET_SIZE(__pyx_t_3)) break;
      __pyx_t_2 = PyTuple_GET_ITEM(__pyx_t_3, __pyx_t_1); __Pyx_INCREF(__pyx_t_2); __pyx_t_1++;
    } else {
      __pyx_t_2 = PyIter_Next(__pyx_t_3);
      if (!__pyx_t_2) {
        if (unlikely(PyErr_Occurred())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 557; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        break;
      }
      __Pyx_GOTREF(__pyx_t_2);
    }
    __Pyx_DECREF(__pyx_v_chainID);
    __pyx_v_chainID = __pyx_t_2;
    __pyx_t_2 = 0;

    /* "/Users/sskory/Documents/yt-devel/yt/lagos/chainHOP/chainHOP.pyx":558
 *         self.reverse_map = {} # chainID -> groupID, one to one
 *         for chainID in self.densest_in_chain:
 *             self.chain_densest_n[int(chainID)] = {}             # <<<<<<<<<<<<<<
 *             self.reverse_map[int(chainID)] = -1
 *         for i in xrange(self.size):
 */
    __pyx_1 = PyDict_New(); if (unlikely(!__pyx_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 558; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(((PyObject *)__pyx_1));
    __pyx_t_2 = PyObject_GetAttr(__pyx_v_self, __pyx_kp_chain_densest_n); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 558; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_2);
    __pyx_t_4 = PyTuple_New(1); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 558; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(((PyObject *)__pyx_t_4));
    __Pyx_INCREF(__pyx_v_chainID);
    PyTuple_SET_ITEM(__pyx_t_4, 0, __pyx_v_chainID);
    __Pyx_GIVEREF(__pyx_v_chainID);
    __pyx_t_5 = PyObject_Call(((PyObject *)((PyObject*)&PyInt_Type)), ((PyObject *)__pyx_t_4), NULL); if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 558; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_5);
    __Pyx_DECREF(((PyObject *)__pyx_t_4)); __pyx_t_4 = 0;
    if (PyObject_SetItem(__pyx_t_2, __pyx_t_5, ((PyObject *)__pyx_1)) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 558; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
    __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
    __Pyx_DECREF(((PyObject *)__pyx_1)); __pyx_1 = 0;

    /* "/Users/sskory/Documents/yt-devel/yt/lagos/chainHOP/chainHOP.pyx":559
 *         for chainID in self.densest_in_chain:
 *             self.chain_densest_n[int(chainID)] = {}
 *             self.reverse_map[int(chainID)] = -1             # <<<<<<<<<<<<<<
 *         for i in xrange(self.size):
 *             # Don't consider this particle if it's not part of a chain.
 */
    __pyx_t_5 = PyObject_GetAttr(__pyx_v_self, __pyx_kp_reverse_map); if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 559; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_5);
    __pyx_t_2 = PyTuple_New(1); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 559; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(((PyObject *)__pyx_t_2));
    __Pyx_INCREF(__pyx_v_chainID);
    PyTuple_SET_ITEM(__pyx_t_2, 0, __pyx_v_chainID);
    __Pyx_GIVEREF(__pyx_v_chainID);
    __pyx_t_4 = PyObject_Call(((PyObject *)((PyObject*)&PyInt_Type)), ((PyObject *)__pyx_t_2), NULL); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 559; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_4);
    __Pyx_DECREF(((PyObject *)__pyx_t_2)); __pyx_t_2 = 0;
    if (PyObject_SetItem(__pyx_t_5, __pyx_t_4, __pyx_int_neg_1) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 559; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
    __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
  }
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;

  /* "/Users/sskory/Documents/yt-devel/yt/lagos/chainHOP/chainHOP.pyx":560
 *             self.chain_densest_n[int(chainID)] = {}
 *             self.reverse_map[int(chainID)] = -1
 *         for i in xrange(self.size):             # <<<<<<<<<<<<<<
 *             # Don't consider this particle if it's not part of a chain.
 *             if self.chainID[i] < 0: continue
 */
  __pyx_t_3 = PyObject_GetAttr(__pyx_v_self, __pyx_kp_size); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 560; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_3);
  __pyx_t_6 = __Pyx_PyInt_AsLong(__pyx_t_3); if (unlikely((__pyx_t_6 == (long)-1) && PyErr_Occurred())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 560; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  for (__pyx_t_7 = 0; __pyx_t_7 < __pyx_t_6; __pyx_t_7+=1) {
    __pyx_v_i = __pyx_t_7;

    /* "/Users/sskory/Documents/yt-devel/yt/lagos/chainHOP/chainHOP.pyx":562
 *         for i in xrange(self.size):
 *             # Don't consider this particle if it's not part of a chain.
 *             if self.chainID[i] < 0: continue             # <<<<<<<<<<<<<<
 *             # If this particle is in the padding, don't make a connection.
 *             if not self.is_inside[i]: continue
 */
    __pyx_t_3 = PyObject_GetAttr(__pyx_v_self, __pyx_kp_chainID); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 562; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_3);
    __pyx_1 = __Pyx_GetItemInt(__pyx_t_3, __pyx_v_i, sizeof(long), PyInt_FromLong); if (!__pyx_1) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 562; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_1);
    __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
    __pyx_t_3 = PyObject_RichCompare(__pyx_1, __pyx_int_0, Py_LT); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 562; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_3);
    __Pyx_DECREF(__pyx_1); __pyx_1 = 0;
    __pyx_t_8 = __Pyx_PyObject_IsTrue(__pyx_t_3); if (unlikely(__pyx_t_8 < 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 562; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
    if (__pyx_t_8) {
      goto __pyx_L7_continue;
      goto __pyx_L9;
    }
    __pyx_L9:;

    /* "/Users/sskory/Documents/yt-devel/yt/lagos/chainHOP/chainHOP.pyx":564
 *             if self.chainID[i] < 0: continue
 *             # If this particle is in the padding, don't make a connection.
 *             if not self.is_inside[i]: continue             # <<<<<<<<<<<<<<
 *             # Find this particle's chain max_dens.
 *             part_max_dens = self.densest_in_chain[self.chainID[i]]
 */
    __pyx_t_3 = PyObject_GetAttr(__pyx_v_self, __pyx_kp_is_inside); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 564; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_3);
    __pyx_1 = __Pyx_GetItemInt(__pyx_t_3, __pyx_v_i, sizeof(long), PyInt_FromLong); if (!__pyx_1) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 564; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_1);
    __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
    __pyx_t_8 = __Pyx_PyObject_IsTrue(__pyx_1); if (unlikely(__pyx_t_8 < 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 564; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_DECREF(__pyx_1); __pyx_1 = 0;
    __pyx_t_9 = (!__pyx_t_8);
    if (__pyx_t_9) {
      goto __pyx_L7_continue;
      goto __pyx_L10;
    }
    __pyx_L10:;

    /* "/Users/sskory/Documents/yt-devel/yt/lagos/chainHOP/chainHOP.pyx":566
 *             if not self.is_inside[i]: continue
 *             # Find this particle's chain max_dens.
 *             part_max_dens = self.densest_in_chain[self.chainID[i]]             # <<<<<<<<<<<<<<
 *             # Loop over nMerge closest nearest neighbors.
 *             for j in xrange(self.nMerge+2):
 */
    __pyx_t_3 = PyObject_GetAttr(__pyx_v_self, __pyx_kp_densest_in_chain); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 566; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_3);
    __pyx_t_4 = PyObject_GetAttr(__pyx_v_self, __pyx_kp_chainID); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 566; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_4);
    __pyx_1 = __Pyx_GetItemInt(__pyx_t_4, __pyx_v_i, sizeof(long), PyInt_FromLong); if (!__pyx_1) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 566; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_1);
    __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
    __pyx_2 = PyObject_GetItem(__pyx_t_3, __pyx_1); if (!__pyx_2) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 566; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_2);
    __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
    __Pyx_DECREF(__pyx_1); __pyx_1 = 0;
    __pyx_t_10 = __pyx_PyFloat_AsDouble(__pyx_2); if (unlikely(PyErr_Occurred())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 566; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_DECREF(__pyx_2); __pyx_2 = 0;
    __pyx_v_part_max_dens = __pyx_t_10;

    /* "/Users/sskory/Documents/yt-devel/yt/lagos/chainHOP/chainHOP.pyx":568
 *             part_max_dens = self.densest_in_chain[self.chainID[i]]
 *             # Loop over nMerge closest nearest neighbors.
 *             for j in xrange(self.nMerge+2):             # <<<<<<<<<<<<<<
 *                 thisNN = self.NNtags[i,j]
 *                 thisNN_chainID = self.chainID[thisNN]
 */
    __pyx_t_3 = PyObject_GetAttr(__pyx_v_self, __pyx_kp_nMerge); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 568; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_3);
    __pyx_t_4 = PyNumber_Add(__pyx_t_3, __pyx_int_2); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 568; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_4);
    __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
    __pyx_t_11 = __Pyx_PyInt_AsLong(__pyx_t_4); if (unlikely((__pyx_t_11 == (long)-1) && PyErr_Occurred())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 568; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
    for (__pyx_t_12 = 0; __pyx_t_12 < __pyx_t_11; __pyx_t_12+=1) {
      __pyx_v_j = __pyx_t_12;

      /* "/Users/sskory/Documents/yt-devel/yt/lagos/chainHOP/chainHOP.pyx":569
 *             # Loop over nMerge closest nearest neighbors.
 *             for j in xrange(self.nMerge+2):
 *                 thisNN = self.NNtags[i,j]             # <<<<<<<<<<<<<<
 *                 thisNN_chainID = self.chainID[thisNN]
 *                 # If our neighbor is in the same chain, move on.
 */
      __pyx_t_4 = PyObject_GetAttr(__pyx_v_self, __pyx_kp_NNtags); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 569; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_t_4);
      __pyx_t_3 = PyInt_FromLong(__pyx_v_i); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 569; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_t_3);
      __pyx_t_5 = PyInt_FromLong(__pyx_v_j); if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 569; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_t_5);
      __pyx_t_2 = PyTuple_New(2); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 569; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(((PyObject *)__pyx_t_2));
      PyTuple_SET_ITEM(__pyx_t_2, 0, __pyx_t_3);
      __Pyx_GIVEREF(__pyx_t_3);
      PyTuple_SET_ITEM(__pyx_t_2, 1, __pyx_t_5);
      __Pyx_GIVEREF(__pyx_t_5);
      __pyx_t_3 = 0;
      __pyx_t_5 = 0;
      __pyx_1 = PyObject_GetItem(__pyx_t_4, ((PyObject *)__pyx_t_2)); if (!__pyx_1) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 569; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_1);
      __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
      __Pyx_DECREF(((PyObject *)__pyx_t_2)); __pyx_t_2 = 0;
      __pyx_t_13 = __Pyx_PyInt_AsLong(__pyx_1); if (unlikely((__pyx_t_13 == (long)-1) && PyErr_Occurred())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 569; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_DECREF(__pyx_1); __pyx_1 = 0;
      __pyx_v_thisNN = __pyx_t_13;

      /* "/Users/sskory/Documents/yt-devel/yt/lagos/chainHOP/chainHOP.pyx":570
 *             for j in xrange(self.nMerge+2):
 *                 thisNN = self.NNtags[i,j]
 *                 thisNN_chainID = self.chainID[thisNN]             # <<<<<<<<<<<<<<
 *                 # If our neighbor is in the same chain, move on.
 *                 if self.chainID[i] == thisNN_chainID: continue
 */
      __pyx_t_2 = PyObject_GetAttr(__pyx_v_self, __pyx_kp_chainID); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 570; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_t_2);
      __pyx_2 = __Pyx_GetItemInt(__pyx_t_2, __pyx_v_thisNN, sizeof(long), PyInt_FromLong); if (!__pyx_2) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 570; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_2);
      __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
      __pyx_t_13 = __Pyx_PyInt_AsLong(__pyx_2); if (unlikely((__pyx_t_13 == (long)-1) && PyErr_Occurred())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 570; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_DECREF(__pyx_2); __pyx_2 = 0;
      __pyx_v_thisNN_chainID = __pyx_t_13;

      /* "/Users/sskory/Documents/yt-devel/yt/lagos/chainHOP/chainHOP.pyx":572
 *                 thisNN_chainID = self.chainID[thisNN]
 *                 # If our neighbor is in the same chain, move on.
 *                 if self.chainID[i] == thisNN_chainID: continue             # <<<<<<<<<<<<<<
 *                 # No introspection, nor our connected NN.
 *                 # This is probably the same as above, but it's OK.
 */
      __pyx_t_2 = PyObject_GetAttr(__pyx_v_self, __pyx_kp_chainID); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 572; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_t_2);
      __pyx_1 = __Pyx_GetItemInt(__pyx_t_2, __pyx_v_i, sizeof(long), PyInt_FromLong); if (!__pyx_1) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 572; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_1);
      __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
      __pyx_t_2 = PyInt_FromLong(__pyx_v_thisNN_chainID); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 572; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_t_2);
      __pyx_t_4 = PyObject_RichCompare(__pyx_1, __pyx_t_2, Py_EQ); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 572; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_t_4);
      __Pyx_DECREF(__pyx_1); __pyx_1 = 0;
      __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
      __pyx_t_9 = __Pyx_PyObject_IsTrue(__pyx_t_4); if (unlikely(__pyx_t_9 < 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 572; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
      if (__pyx_t_9) {
        goto __pyx_L11_continue;
        goto __pyx_L13;
      }
      __pyx_L13:;

      /* "/Users/sskory/Documents/yt-devel/yt/lagos/chainHOP/chainHOP.pyx":576
 *                 # This is probably the same as above, but it's OK.
 *                 # It can be removed later.
 *                 if thisNN==i or thisNN==self.densestNN[i]: continue             # <<<<<<<<<<<<<<
 *                 # Everything immediately below is for
 *                 # neighboring particles with a chainID.
 */
      __pyx_t_9 = (__pyx_v_thisNN == __pyx_v_i);
      if (!__pyx_t_9) {
        __pyx_t_4 = PyInt_FromLong(__pyx_v_thisNN); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 576; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        __Pyx_GOTREF(__pyx_t_4);
        __pyx_t_2 = PyObject_GetAttr(__pyx_v_self, __pyx_kp_densestNN); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 576; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        __Pyx_GOTREF(__pyx_t_2);
        __pyx_2 = __Pyx_GetItemInt(__pyx_t_2, __pyx_v_i, sizeof(long), PyInt_FromLong); if (!__pyx_2) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 576; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        __Pyx_GOTREF(__pyx_2);
        __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
        __pyx_t_2 = PyObject_RichCompare(__pyx_t_4, __pyx_2, Py_EQ); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 576; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        __Pyx_GOTREF(__pyx_t_2);
        __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
        __Pyx_DECREF(__pyx_2); __pyx_2 = 0;
        __pyx_t_8 = __Pyx_PyObject_IsTrue(__pyx_t_2); if (unlikely(__pyx_t_8 < 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 576; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
        __pyx_t_14 = __pyx_t_8;
      } else {
        __pyx_t_14 = __pyx_t_9;
      }
      if (__pyx_t_14) {
        goto __pyx_L11_continue;
        goto __pyx_L14;
      }
      __pyx_L14:;

      /* "/Users/sskory/Documents/yt-devel/yt/lagos/chainHOP/chainHOP.pyx":579
 *                 # Everything immediately below is for
 *                 # neighboring particles with a chainID.
 *                 if thisNN_chainID >= 0:             # <<<<<<<<<<<<<<
 *                     # Find thisNN's chain's max_dens.
 *                     thisNN_max_dens = self.densest_in_chain[thisNN_chainID]
 */
      __pyx_t_14 = (__pyx_v_thisNN_chainID >= 0);
      if (__pyx_t_14) {

        /* "/Users/sskory/Documents/yt-devel/yt/lagos/chainHOP/chainHOP.pyx":581
 *                 if thisNN_chainID >= 0:
 *                     # Find thisNN's chain's max_dens.
 *                     thisNN_max_dens = self.densest_in_chain[thisNN_chainID]             # <<<<<<<<<<<<<<
 *                     # Calculate the two groups boundary density.
 *                     boundary_density = (self.density[thisNN] + self.density[i]) / 2.
 */
        __pyx_t_2 = PyObject_GetAttr(__pyx_v_self, __pyx_kp_densest_in_chain); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 581; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        __Pyx_GOTREF(__pyx_t_2);
        __pyx_1 = __Pyx_GetItemInt(__pyx_t_2, __pyx_v_thisNN_chainID, sizeof(long), PyInt_FromLong); if (!__pyx_1) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 581; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        __Pyx_GOTREF(__pyx_1);
        __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
        __pyx_t_10 = __pyx_PyFloat_AsDouble(__pyx_1); if (unlikely(PyErr_Occurred())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 581; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        __Pyx_DECREF(__pyx_1); __pyx_1 = 0;
        __pyx_v_thisNN_max_dens = __pyx_t_10;

        /* "/Users/sskory/Documents/yt-devel/yt/lagos/chainHOP/chainHOP.pyx":583
 *                     thisNN_max_dens = self.densest_in_chain[thisNN_chainID]
 *                     # Calculate the two groups boundary density.
 *                     boundary_density = (self.density[thisNN] + self.density[i]) / 2.             # <<<<<<<<<<<<<<
 *                     # Find out who's denser.
 *                     if thisNN_max_dens >= part_max_dens:
 */
        __pyx_t_2 = PyObject_GetAttr(__pyx_v_self, __pyx_kp_density); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 583; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        __Pyx_GOTREF(__pyx_t_2);
        __pyx_2 = __Pyx_GetItemInt(__pyx_t_2, __pyx_v_thisNN, sizeof(long), PyInt_FromLong); if (!__pyx_2) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 583; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        __Pyx_GOTREF(__pyx_2);
        __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
        __pyx_t_2 = PyObject_GetAttr(__pyx_v_self, __pyx_kp_density); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 583; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        __Pyx_GOTREF(__pyx_t_2);
        __pyx_1 = __Pyx_GetItemInt(__pyx_t_2, __pyx_v_i, sizeof(long), PyInt_FromLong); if (!__pyx_1) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 583; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        __Pyx_GOTREF(__pyx_1);
        __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
        __pyx_t_2 = PyNumber_Add(__pyx_2, __pyx_1); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 583; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        __Pyx_GOTREF(__pyx_t_2);
        __Pyx_DECREF(__pyx_2); __pyx_2 = 0;
        __Pyx_DECREF(__pyx_1); __pyx_1 = 0;
        __pyx_t_4 = PyFloat_FromDouble(2.0); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 583; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        __Pyx_GOTREF(__pyx_t_4);
        __pyx_t_5 = __Pyx_PyNumber_Divide(__pyx_t_2, __pyx_t_4); if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 583; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        __Pyx_GOTREF(__pyx_t_5);
        __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
        __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
        __pyx_t_10 = __pyx_PyFloat_AsDouble(__pyx_t_5); if (unlikely(PyErr_Occurred())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 583; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
        __pyx_v_boundary_density = __pyx_t_10;

        /* "/Users/sskory/Documents/yt-devel/yt/lagos/chainHOP/chainHOP.pyx":585
 *                     boundary_density = (self.density[thisNN] + self.density[i]) / 2.
 *                     # Find out who's denser.
 *                     if thisNN_max_dens >= part_max_dens:             # <<<<<<<<<<<<<<
 *                         higher_chain = thisNN_chainID
 *                         lower_chain = self.chainID[i]
 */
        __pyx_t_14 = (__pyx_v_thisNN_max_dens >= __pyx_v_part_max_dens);
        if (__pyx_t_14) {

          /* "/Users/sskory/Documents/yt-devel/yt/lagos/chainHOP/chainHOP.pyx":586
 *                     # Find out who's denser.
 *                     if thisNN_max_dens >= part_max_dens:
 *                         higher_chain = thisNN_chainID             # <<<<<<<<<<<<<<
 *                         lower_chain = self.chainID[i]
 *                     else:
 */
          __pyx_v_higher_chain = __pyx_v_thisNN_chainID;

          /* "/Users/sskory/Documents/yt-devel/yt/lagos/chainHOP/chainHOP.pyx":587
 *                     if thisNN_max_dens >= part_max_dens:
 *                         higher_chain = thisNN_chainID
 *                         lower_chain = self.chainID[i]             # <<<<<<<<<<<<<<
 *                     else:
 *                         higher_chain = self.chainID[i]
 */
          __pyx_t_5 = PyObject_GetAttr(__pyx_v_self, __pyx_kp_chainID); if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 587; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
          __Pyx_GOTREF(__pyx_t_5);
          __pyx_2 = __Pyx_GetItemInt(__pyx_t_5, __pyx_v_i, sizeof(long), PyInt_FromLong); if (!__pyx_2) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 587; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
          __Pyx_GOTREF(__pyx_2);
          __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
          __pyx_t_13 = __Pyx_PyInt_AsLong(__pyx_2); if (unlikely((__pyx_t_13 == (long)-1) && PyErr_Occurred())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 587; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
          __Pyx_DECREF(__pyx_2); __pyx_2 = 0;
          __pyx_v_lower_chain = __pyx_t_13;
          goto __pyx_L16;
        }
        /*else*/ {

          /* "/Users/sskory/Documents/yt-devel/yt/lagos/chainHOP/chainHOP.pyx":589
 *                         lower_chain = self.chainID[i]
 *                     else:
 *                         higher_chain = self.chainID[i]             # <<<<<<<<<<<<<<
 *                         lower_chain = thisNN_chainID
 *                     # See if this boundary density is higher than
 */
          __pyx_t_5 = PyObject_GetAttr(__pyx_v_self, __pyx_kp_chainID); if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 589; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
          __Pyx_GOTREF(__pyx_t_5);
          __pyx_1 = __Pyx_GetItemInt(__pyx_t_5, __pyx_v_i, sizeof(long), PyInt_FromLong); if (!__pyx_1) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 589; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
          __Pyx_GOTREF(__pyx_1);
          __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
          __pyx_t_13 = __Pyx_PyInt_AsLong(__pyx_1); if (unlikely((__pyx_t_13 == (long)-1) && PyErr_Occurred())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 589; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
          __Pyx_DECREF(__pyx_1); __pyx_1 = 0;
          __pyx_v_higher_chain = __pyx_t_13;

          /* "/Users/sskory/Documents/yt-devel/yt/lagos/chainHOP/chainHOP.pyx":590
 *                     else:
 *                         higher_chain = self.chainID[i]
 *                         lower_chain = thisNN_chainID             # <<<<<<<<<<<<<<
 *                     # See if this boundary density is higher than
 *                     # previously recorded for this pair of chains.
 */
          __pyx_v_lower_chain = __pyx_v_thisNN_chainID;
        }
        __pyx_L16:;

        /* "/Users/sskory/Documents/yt-devel/yt/lagos/chainHOP/chainHOP.pyx":594
 *                     # previously recorded for this pair of chains.
 *                     # Links only go 'downhill'.
 *                     try:             # <<<<<<<<<<<<<<
 *                         old = self.chain_densest_n[higher_chain][lower_chain]
 *                         if old < boundary_density:
 */
        {
          PyObject *__pyx_save_exc_type, *__pyx_save_exc_value, *__pyx_save_exc_tb;
          __Pyx_ExceptionSave(&__pyx_save_exc_type, &__pyx_save_exc_value, &__pyx_save_exc_tb);
          __Pyx_XGOTREF(__pyx_save_exc_type);
          __Pyx_XGOTREF(__pyx_save_exc_value);
          __Pyx_XGOTREF(__pyx_save_exc_tb);
          /*try:*/ {

            /* "/Users/sskory/Documents/yt-devel/yt/lagos/chainHOP/chainHOP.pyx":595
 *                     # Links only go 'downhill'.
 *                     try:
 *                         old = self.chain_densest_n[higher_chain][lower_chain]             # <<<<<<<<<<<<<<
 *                         if old < boundary_density:
 *                             # make this the new densest boundary between this pair
 */
            __pyx_t_5 = PyObject_GetAttr(__pyx_v_self, __pyx_kp_chain_densest_n); if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 595; __pyx_clineno = __LINE__; goto __pyx_L17_error;}
            __Pyx_GOTREF(__pyx_t_5);
            __pyx_2 = __Pyx_GetItemInt(__pyx_t_5, __pyx_v_higher_chain, sizeof(long), PyInt_FromLong); if (!__pyx_2) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 595; __pyx_clineno = __LINE__; goto __pyx_L17_error;}
            __Pyx_GOTREF(__pyx_2);
            __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
            __pyx_1 = __Pyx_GetItemInt(__pyx_2, __pyx_v_lower_chain, sizeof(long), PyInt_FromLong); if (!__pyx_1) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 595; __pyx_clineno = __LINE__; goto __pyx_L17_error;}
            __Pyx_GOTREF(__pyx_1);
            __Pyx_DECREF(__pyx_2); __pyx_2 = 0;
            __pyx_t_10 = __pyx_PyFloat_AsDouble(__pyx_1); if (unlikely(PyErr_Occurred())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 595; __pyx_clineno = __LINE__; goto __pyx_L17_error;}
            __Pyx_DECREF(__pyx_1); __pyx_1 = 0;
            __pyx_v_old = __pyx_t_10;

            /* "/Users/sskory/Documents/yt-devel/yt/lagos/chainHOP/chainHOP.pyx":596
 *                     try:
 *                         old = self.chain_densest_n[higher_chain][lower_chain]
 *                         if old < boundary_density:             # <<<<<<<<<<<<<<
 *                             # make this the new densest boundary between this pair
 *                             self.chain_densest_n[higher_chain][lower_chain] = \
 */
            __pyx_t_14 = (__pyx_v_old < __pyx_v_boundary_density);
            if (__pyx_t_14) {

              /* "/Users/sskory/Documents/yt-devel/yt/lagos/chainHOP/chainHOP.pyx":599
 *                             # make this the new densest boundary between this pair
 *                             self.chain_densest_n[higher_chain][lower_chain] = \
 *                                 boundary_density             # <<<<<<<<<<<<<<
 *                     except KeyError:
 *                         # we haven't seen this pairing before, record this as the
 */
              __pyx_t_5 = PyFloat_FromDouble(__pyx_v_boundary_density); if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 599; __pyx_clineno = __LINE__; goto __pyx_L17_error;}
              __Pyx_GOTREF(__pyx_t_5);

              /* "/Users/sskory/Documents/yt-devel/yt/lagos/chainHOP/chainHOP.pyx":598
 *                         if old < boundary_density:
 *                             # make this the new densest boundary between this pair
 *                             self.chain_densest_n[higher_chain][lower_chain] = \             # <<<<<<<<<<<<<<
 *                                 boundary_density
 *                     except KeyError:
 */
              __pyx_t_4 = PyObject_GetAttr(__pyx_v_self, __pyx_kp_chain_densest_n); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 598; __pyx_clineno = __LINE__; goto __pyx_L17_error;}
              __Pyx_GOTREF(__pyx_t_4);
              __pyx_2 = __Pyx_GetItemInt(__pyx_t_4, __pyx_v_higher_chain, sizeof(long), PyInt_FromLong); if (!__pyx_2) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 598; __pyx_clineno = __LINE__; goto __pyx_L17_error;}
              __Pyx_GOTREF(__pyx_2);
              __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
              if (__Pyx_SetItemInt(__pyx_2, __pyx_v_lower_chain, __pyx_t_5, sizeof(long), PyInt_FromLong) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 598; __pyx_clineno = __LINE__; goto __pyx_L17_error;}
              __Pyx_DECREF(__pyx_2); __pyx_2 = 0;
              __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
              goto __pyx_L25;
            }
            __pyx_L25:;
          }
          __Pyx_XDECREF(__pyx_save_exc_type); __pyx_save_exc_type = 0;
          __Pyx_XDECREF(__pyx_save_exc_value); __pyx_save_exc_value = 0;
          __Pyx_XDECREF(__pyx_save_exc_tb); __pyx_save_exc_tb = 0;
          goto __pyx_L24_try_end;
          __pyx_L17_error:;
          __Pyx_XDECREF(__pyx_1); __pyx_1 = 0;
          __Pyx_XDECREF(__pyx_2); __pyx_2 = 0;
          __Pyx_XDECREF(__pyx_t_3); __pyx_t_3 = 0;
          __Pyx_XDECREF(__pyx_t_2); __pyx_t_2 = 0;
          __Pyx_XDECREF(__pyx_t_4); __pyx_t_4 = 0;
          __Pyx_XDECREF(__pyx_t_5); __pyx_t_5 = 0;

          /* "/Users/sskory/Documents/yt-devel/yt/lagos/chainHOP/chainHOP.pyx":600
 *                             self.chain_densest_n[higher_chain][lower_chain] = \
 *                                 boundary_density
 *                     except KeyError:             # <<<<<<<<<<<<<<
 *                         # we haven't seen this pairing before, record this as the
 *                         # new densest boundary between chains
 */
          __pyx_3 = PyErr_ExceptionMatches(__pyx_builtin_KeyError);
          if (__pyx_3) {
            __Pyx_AddTraceback("yt.lagos.chainHOP.chainHOP._connect_chains");
            if (__Pyx_GetException(&__pyx_t_5, &__pyx_t_4, &__pyx_t_2) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 600; __pyx_clineno = __LINE__; goto __pyx_L19_except_error;}
            __Pyx_GOTREF(__pyx_t_5);
            __Pyx_GOTREF(__pyx_t_4);
            __Pyx_GOTREF(__pyx_t_2);

            /* "/Users/sskory/Documents/yt-devel/yt/lagos/chainHOP/chainHOP.pyx":604
 *                         # new densest boundary between chains
 *                         self.chain_densest_n[higher_chain][lower_chain] = \
 *                             boundary_density             # <<<<<<<<<<<<<<
 *                 else:
 *                     continue
 */
            __pyx_t_3 = PyFloat_FromDouble(__pyx_v_boundary_density); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 604; __pyx_clineno = __LINE__; goto __pyx_L19_except_error;}
            __Pyx_GOTREF(__pyx_t_3);

            /* "/Users/sskory/Documents/yt-devel/yt/lagos/chainHOP/chainHOP.pyx":603
 *                         # we haven't seen this pairing before, record this as the
 *                         # new densest boundary between chains
 *                         self.chain_densest_n[higher_chain][lower_chain] = \             # <<<<<<<<<<<<<<
 *                             boundary_density
 *                 else:
 */
            __pyx_t_15 = PyObject_GetAttr(__pyx_v_self, __pyx_kp_chain_densest_n); if (unlikely(!__pyx_t_15)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 603; __pyx_clineno = __LINE__; goto __pyx_L19_except_error;}
            __Pyx_GOTREF(__pyx_t_15);
            __pyx_1 = __Pyx_GetItemInt(__pyx_t_15, __pyx_v_higher_chain, sizeof(long), PyInt_FromLong); if (!__pyx_1) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 603; __pyx_clineno = __LINE__; goto __pyx_L19_except_error;}
            __Pyx_GOTREF(__pyx_1);
            __Pyx_DECREF(__pyx_t_15); __pyx_t_15 = 0;
            if (__Pyx_SetItemInt(__pyx_1, __pyx_v_lower_chain, __pyx_t_3, sizeof(long), PyInt_FromLong) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 603; __pyx_clineno = __LINE__; goto __pyx_L19_except_error;}
            __Pyx_DECREF(__pyx_1); __pyx_1 = 0;
            __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
            __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
            __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
            __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
            goto __pyx_L18_exception_handled;
          }
          __pyx_L19_except_error:;
          __Pyx_XDECREF(__pyx_save_exc_type);
          __Pyx_XDECREF(__pyx_save_exc_value);
          __Pyx_XDECREF(__pyx_save_exc_tb);
          goto __pyx_L1_error;
          __pyx_L18_exception_handled:;
          __Pyx_XGIVEREF(__pyx_save_exc_type);
          __Pyx_XGIVEREF(__pyx_save_exc_value);
          __Pyx_XGIVEREF(__pyx_save_exc_tb);
          __Pyx_ExceptionReset(__pyx_save_exc_type, __pyx_save_exc_value, __pyx_save_exc_tb);
          __pyx_L24_try_end:;
        }
        goto __pyx_L15;
      }
      /*else*/ {

        /* "/Users/sskory/Documents/yt-devel/yt/lagos/chainHOP/chainHOP.pyx":606
 *                             boundary_density
 *                 else:
 *                     continue             # <<<<<<<<<<<<<<
 * 
 *     def _make_global_chain_densest_n(object self):
 */
        goto __pyx_L11_continue;
      }
      __pyx_L15:;
      __pyx_L11_continue:;
    }
    __pyx_L7_continue:;
  }

  __pyx_r = Py_None; __Pyx_INCREF(Py_None);
  goto __pyx_L0;
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_1);
  __Pyx_XDECREF(__pyx_2);
  __Pyx_XDECREF(__pyx_t_2);
  __Pyx_XDECREF(__pyx_t_3);
  __Pyx_XDECREF(__pyx_t_4);
  __Pyx_XDECREF(__pyx_t_5);
  __Pyx_XDECREF(__pyx_t_15);
  __Pyx_AddTraceback("yt.lagos.chainHOP.chainHOP.RunChainHOP._connect_chains");
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_DECREF(__pyx_v_chainID);
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_FinishRefcountContext();
  return __pyx_r;
}

/* "/Users/sskory/Documents/yt-devel/yt/lagos/chainHOP/chainHOP.pyx":608
 *                     continue
 * 
 *     def _make_global_chain_densest_n(object self):             # <<<<<<<<<<<<<<
 *         """
 *         We want to record the maximum boundary density between all chains on
 */

static PyObject *__pyx_pf_2yt_5lagos_8chainHOP_8chainHOP_11RunChainHOP__make_global_chain_densest_n(PyObject *__pyx_self, PyObject *__pyx_v_self); /*proto*/
static char __pyx_doc_2yt_5lagos_8chainHOP_8chainHOP_11RunChainHOP__make_global_chain_densest_n[] = "\n        We want to record the maximum boundary density between all chains on\n        all tasks.\n        ";
static PyMethodDef __pyx_mdef_2yt_5lagos_8chainHOP_8chainHOP_11RunChainHOP__make_global_chain_densest_n = {__Pyx_NAMESTR("_make_global_chain_densest_n"), (PyCFunction)__pyx_pf_2yt_5lagos_8chainHOP_8chainHOP_11RunChainHOP__make_global_chain_densest_n, METH_O, __Pyx_DOCSTR(__pyx_doc_2yt_5lagos_8chainHOP_8chainHOP_11RunChainHOP__make_global_chain_densest_n)};
static PyObject *__pyx_pf_2yt_5lagos_8chainHOP_8chainHOP_11RunChainHOP__make_global_chain_densest_n(PyObject *__pyx_self, PyObject *__pyx_v_self) {
  PyObject *__pyx_v_higher_chain;
  PyObject *__pyx_r = NULL;
  PyObject *__pyx_1 = 0;
  Py_ssize_t __pyx_t_1;
  PyObject *__pyx_t_2 = NULL;
  PyObject *__pyx_t_3 = NULL;
  PyObject *__pyx_t_4 = NULL;
  PyObject *__pyx_t_5 = NULL;
  __Pyx_SetupRefcountContext("_make_global_chain_densest_n");
  __pyx_self = __pyx_self;
  __pyx_v_higher_chain = Py_None; __Pyx_INCREF(Py_None);

  /* "/Users/sskory/Documents/yt-devel/yt/lagos/chainHOP/chainHOP.pyx":616
 *         # chain_densest_n (see the beginning of _connect_chains())
 *         # Uses barrier(), but that's needed.
 *         for higher_chain in self.chain_densest_n:             # <<<<<<<<<<<<<<
 *             self.chain_densest_n[higher_chain] = \
 *                 self._mpi_maxdict(self.chain_densest_n[higher_chain])
 */
  __pyx_t_2 = PyObject_GetAttr(__pyx_v_self, __pyx_kp_chain_densest_n); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 616; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_2);
  if (PyList_CheckExact(__pyx_t_2) || PyTuple_CheckExact(__pyx_t_2)) {
    __pyx_t_1 = 0; __pyx_t_3 = __pyx_t_2; __Pyx_INCREF(__pyx_t_3);
  } else {
    __pyx_t_1 = -1; __pyx_t_3 = PyObject_GetIter(__pyx_t_2); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 616; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_3);
  }
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  for (;;) {
    if (likely(PyList_CheckExact(__pyx_t_3))) {
      if (__pyx_t_1 >= PyList_GET_SIZE(__pyx_t_3)) break;
      __pyx_t_2 = PyList_GET_ITEM(__pyx_t_3, __pyx_t_1); __Pyx_INCREF(__pyx_t_2); __pyx_t_1++;
    } else if (likely(PyTuple_CheckExact(__pyx_t_3))) {
      if (__pyx_t_1 >= PyTuple_GET_SIZE(__pyx_t_3)) break;
      __pyx_t_2 = PyTuple_GET_ITEM(__pyx_t_3, __pyx_t_1); __Pyx_INCREF(__pyx_t_2); __pyx_t_1++;
    } else {
      __pyx_t_2 = PyIter_Next(__pyx_t_3);
      if (!__pyx_t_2) {
        if (unlikely(PyErr_Occurred())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 616; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        break;
      }
      __Pyx_GOTREF(__pyx_t_2);
    }
    __Pyx_DECREF(__pyx_v_higher_chain);
    __pyx_v_higher_chain = __pyx_t_2;
    __pyx_t_2 = 0;

    /* "/Users/sskory/Documents/yt-devel/yt/lagos/chainHOP/chainHOP.pyx":618
 *         for higher_chain in self.chain_densest_n:
 *             self.chain_densest_n[higher_chain] = \
 *                 self._mpi_maxdict(self.chain_densest_n[higher_chain])             # <<<<<<<<<<<<<<
 * 
 *     def _build_groups(object self):
 */
    __pyx_t_2 = PyObject_GetAttr(__pyx_v_self, __pyx_kp__mpi_maxdict); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 618; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_2);
    __pyx_t_4 = PyObject_GetAttr(__pyx_v_self, __pyx_kp_chain_densest_n); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 618; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_4);
    __pyx_1 = PyObject_GetItem(__pyx_t_4, __pyx_v_higher_chain); if (!__pyx_1) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 618; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_1);
    __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
    __pyx_t_4 = PyTuple_New(1); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 618; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(((PyObject *)__pyx_t_4));
    PyTuple_SET_ITEM(__pyx_t_4, 0, __pyx_1);
    __Pyx_GIVEREF(__pyx_1);
    __pyx_1 = 0;
    __pyx_t_5 = PyObject_Call(__pyx_t_2, ((PyObject *)__pyx_t_4), NULL); if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 618; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_5);
    __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
    __Pyx_DECREF(((PyObject *)__pyx_t_4)); __pyx_t_4 = 0;

    /* "/Users/sskory/Documents/yt-devel/yt/lagos/chainHOP/chainHOP.pyx":617
 *         # Uses barrier(), but that's needed.
 *         for higher_chain in self.chain_densest_n:
 *             self.chain_densest_n[higher_chain] = \             # <<<<<<<<<<<<<<
 *                 self._mpi_maxdict(self.chain_densest_n[higher_chain])
 * 
 */
    __pyx_t_4 = PyObject_GetAttr(__pyx_v_self, __pyx_kp_chain_densest_n); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 617; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_4);
    if (PyObject_SetItem(__pyx_t_4, __pyx_v_higher_chain, __pyx_t_5) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 617; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
    __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
  }
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;

  __pyx_r = Py_None; __Pyx_INCREF(Py_None);
  goto __pyx_L0;
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_1);
  __Pyx_XDECREF(__pyx_t_2);
  __Pyx_XDECREF(__pyx_t_3);
  __Pyx_XDECREF(__pyx_t_4);
  __Pyx_XDECREF(__pyx_t_5);
  __Pyx_AddTraceback("yt.lagos.chainHOP.chainHOP.RunChainHOP._make_global_chain_densest_n");
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_DECREF(__pyx_v_higher_chain);
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_FinishRefcountContext();
  return __pyx_r;
}

/* "/Users/sskory/Documents/yt-devel/yt/lagos/chainHOP/chainHOP.pyx":620
 *                 self._mpi_maxdict(self.chain_densest_n[higher_chain])
 * 
 *     def _build_groups(object self):             # <<<<<<<<<<<<<<
 *         """
 *         With the collection of possible chain links, build groups.
 */

static PyObject *__pyx_pf_2yt_5lagos_8chainHOP_8chainHOP_11RunChainHOP__build_groups(PyObject *__pyx_self, PyObject *__pyx_v_self); /*proto*/
static char __pyx_doc_2yt_5lagos_8chainHOP_8chainHOP_11RunChainHOP__build_groups[] = "\n        With the collection of possible chain links, build groups.\n        ";
static PyMethodDef __pyx_mdef_2yt_5lagos_8chainHOP_8chainHOP_11RunChainHOP__build_groups = {__Pyx_NAMESTR("_build_groups"), (PyCFunction)__pyx_pf_2yt_5lagos_8chainHOP_8chainHOP_11RunChainHOP__build_groups, METH_O, __Pyx_DOCSTR(__pyx_doc_2yt_5lagos_8chainHOP_8chainHOP_11RunChainHOP__build_groups)};
static PyObject *__pyx_pf_2yt_5lagos_8chainHOP_8chainHOP_11RunChainHOP__build_groups(PyObject *__pyx_self, PyObject *__pyx_v_self) {
  long __pyx_v_groupID;
  long __pyx_v_changes;
  long __pyx_v_group_count;
  double __pyx_v_max_dens_high;
  double __pyx_v_dens;
  double __pyx_v_max_dens_low;
  PyObject *__pyx_v_g_high;
  PyObject *__pyx_v_g_low;
  PyObject *__pyx_v_g_dens;
  PyObject *__pyx_v_densestbound;
  PyObject *__pyx_v_chainID;
  PyObject *__pyx_v_chain_high;
  PyObject *__pyx_v_chain_low;
  PyObject *__pyx_v_group_high;
  PyObject *__pyx_v_group_low;
  PyObject *__pyx_v_chID;
  PyObject *__pyx_v_j;
  PyObject *__pyx_v_temp;
  PyObject *__pyx_v_chain;
  PyObject *__pyx_v_secondary_map;
  PyObject *__pyx_v_i;
  PyObject *__pyx_v_ID;
  PyObject *__pyx_r = NULL;
  PyObject *__pyx_1 = 0;
  PyObject *__pyx_2 = 0;
  PyObject *__pyx_3 = 0;
  PyObject *__pyx_t_1 = NULL;
  Py_ssize_t __pyx_t_2;
  PyObject *__pyx_t_3 = NULL;
  PyObject *__pyx_t_4 = NULL;
  int __pyx_t_5;
  Py_ssize_t __pyx_t_6;
  double __pyx_t_7;
  PyObject *__pyx_t_8 = NULL;
  PyObject *__pyx_t_9 = NULL;
  int __pyx_t_10;
  int __pyx_t_11;
  Py_ssize_t __pyx_t_12;
  long __pyx_t_13;
  __Pyx_SetupRefcountContext("_build_groups");
  __pyx_self = __pyx_self;
  __pyx_v_g_high = Py_None; __Pyx_INCREF(Py_None);
  __pyx_v_g_low = Py_None; __Pyx_INCREF(Py_None);
  __pyx_v_g_dens = Py_None; __Pyx_INCREF(Py_None);
  __pyx_v_densestbound = Py_None; __Pyx_INCREF(Py_None);
  __pyx_v_chainID = Py_None; __Pyx_INCREF(Py_None);
  __pyx_v_chain_high = Py_None; __Pyx_INCREF(Py_None);
  __pyx_v_chain_low = Py_None; __Pyx_INCREF(Py_None);
  __pyx_v_group_high = Py_None; __Pyx_INCREF(Py_None);
  __pyx_v_group_low = Py_None; __Pyx_INCREF(Py_None);
  __pyx_v_chID = Py_None; __Pyx_INCREF(Py_None);
  __pyx_v_j = Py_None; __Pyx_INCREF(Py_None);
  __pyx_v_temp = Py_None; __Pyx_INCREF(Py_None);
  __pyx_v_chain = Py_None; __Pyx_INCREF(Py_None);
  __pyx_v_secondary_map = Py_None; __Pyx_INCREF(Py_None);
  __pyx_v_i = Py_None; __Pyx_INCREF(Py_None);
  __pyx_v_ID = Py_None; __Pyx_INCREF(Py_None);

  /* "/Users/sskory/Documents/yt-devel/yt/lagos/chainHOP/chainHOP.pyx":627
 *         cdef double max_dens_high, dens
 *         cdef double max_dens_low
 *         g_high = []             # <<<<<<<<<<<<<<
 *         g_low = []
 *         g_dens = []
 */
  __pyx_t_1 = PyList_New(0); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 627; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(((PyObject *)__pyx_t_1));
  __Pyx_DECREF(__pyx_v_g_high);
  __pyx_v_g_high = ((PyObject *)__pyx_t_1);
  __pyx_t_1 = 0;

  /* "/Users/sskory/Documents/yt-devel/yt/lagos/chainHOP/chainHOP.pyx":628
 *         cdef double max_dens_low
 *         g_high = []
 *         g_low = []             # <<<<<<<<<<<<<<
 *         g_dens = []
 *         densestbound = {} # chainID -> boundary density
 */
  __pyx_t_1 = PyList_New(0); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 628; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(((PyObject *)__pyx_t_1));
  __Pyx_DECREF(__pyx_v_g_low);
  __pyx_v_g_low = ((PyObject *)__pyx_t_1);
  __pyx_t_1 = 0;

  /* "/Users/sskory/Documents/yt-devel/yt/lagos/chainHOP/chainHOP.pyx":629
 *         g_high = []
 *         g_low = []
 *         g_dens = []             # <<<<<<<<<<<<<<
 *         densestbound = {} # chainID -> boundary density
 *         for chainID in self.densest_in_chain:
 */
  __pyx_t_1 = PyList_New(0); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 629; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(((PyObject *)__pyx_t_1));
  __Pyx_DECREF(__pyx_v_g_dens);
  __pyx_v_g_dens = ((PyObject *)__pyx_t_1);
  __pyx_t_1 = 0;

  /* "/Users/sskory/Documents/yt-devel/yt/lagos/chainHOP/chainHOP.pyx":630
 *         g_low = []
 *         g_dens = []
 *         densestbound = {} # chainID -> boundary density             # <<<<<<<<<<<<<<
 *         for chainID in self.densest_in_chain:
 *             densestbound[chainID] = -1.0
 */
  __pyx_1 = PyDict_New(); if (unlikely(!__pyx_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 630; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(((PyObject *)__pyx_1));
  __Pyx_DECREF(__pyx_v_densestbound);
  __pyx_v_densestbound = ((PyObject *)__pyx_1);
  __pyx_1 = 0;

  /* "/Users/sskory/Documents/yt-devel/yt/lagos/chainHOP/chainHOP.pyx":631
 *         g_dens = []
 *         densestbound = {} # chainID -> boundary density
 *         for chainID in self.densest_in_chain:             # <<<<<<<<<<<<<<
 *             densestbound[chainID] = -1.0
 *         groupID = 0
 */
  __pyx_t_1 = PyObject_GetAttr(__pyx_v_self, __pyx_kp_densest_in_chain); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 631; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_1);
  if (PyList_CheckExact(__pyx_t_1) || PyTuple_CheckExact(__pyx_t_1)) {
    __pyx_t_2 = 0; __pyx_t_3 = __pyx_t_1; __Pyx_INCREF(__pyx_t_3);
  } else {
    __pyx_t_2 = -1; __pyx_t_3 = PyObject_GetIter(__pyx_t_1); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 631; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_3);
  }
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  for (;;) {
    if (likely(PyList_CheckExact(__pyx_t_3))) {
      if (__pyx_t_2 >= PyList_GET_SIZE(__pyx_t_3)) break;
      __pyx_t_1 = PyList_GET_ITEM(__pyx_t_3, __pyx_t_2); __Pyx_INCREF(__pyx_t_1); __pyx_t_2++;
    } else if (likely(PyTuple_CheckExact(__pyx_t_3))) {
      if (__pyx_t_2 >= PyTuple_GET_SIZE(__pyx_t_3)) break;
      __pyx_t_1 = PyTuple_GET_ITEM(__pyx_t_3, __pyx_t_2); __Pyx_INCREF(__pyx_t_1); __pyx_t_2++;
    } else {
      __pyx_t_1 = PyIter_Next(__pyx_t_3);
      if (!__pyx_t_1) {
        if (unlikely(PyErr_Occurred())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 631; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        break;
      }
      __Pyx_GOTREF(__pyx_t_1);
    }
    __Pyx_DECREF(__pyx_v_chainID);
    __pyx_v_chainID = __pyx_t_1;
    __pyx_t_1 = 0;

    /* "/Users/sskory/Documents/yt-devel/yt/lagos/chainHOP/chainHOP.pyx":632
 *         densestbound = {} # chainID -> boundary density
 *         for chainID in self.densest_in_chain:
 *             densestbound[chainID] = -1.0             # <<<<<<<<<<<<<<
 *         groupID = 0
 *         # First assign a group to all chains with max_dens above peakthresh.
 */
    __pyx_t_1 = PyFloat_FromDouble((-1.0)); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 632; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_1);
    if (PyObject_SetItem(__pyx_v_densestbound, __pyx_v_chainID, __pyx_t_1) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 632; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  }
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;

  /* "/Users/sskory/Documents/yt-devel/yt/lagos/chainHOP/chainHOP.pyx":633
 *         for chainID in self.densest_in_chain:
 *             densestbound[chainID] = -1.0
 *         groupID = 0             # <<<<<<<<<<<<<<
 *         # First assign a group to all chains with max_dens above peakthresh.
 *         for chainID in self.densest_in_chain:
 */
  __pyx_v_groupID = 0;

  /* "/Users/sskory/Documents/yt-devel/yt/lagos/chainHOP/chainHOP.pyx":635
 *         groupID = 0
 *         # First assign a group to all chains with max_dens above peakthresh.
 *         for chainID in self.densest_in_chain:             # <<<<<<<<<<<<<<
 *             if self.densest_in_chain[chainID] >= self.peakthresh:
 *                 self.reverse_map[chainID] = groupID
 */
  __pyx_t_3 = PyObject_GetAttr(__pyx_v_self, __pyx_kp_densest_in_chain); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 635; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_3);
  if (PyList_CheckExact(__pyx_t_3) || PyTuple_CheckExact(__pyx_t_3)) {
    __pyx_t_2 = 0; __pyx_t_1 = __pyx_t_3; __Pyx_INCREF(__pyx_t_1);
  } else {
    __pyx_t_2 = -1; __pyx_t_1 = PyObject_GetIter(__pyx_t_3); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 635; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_1);
  }
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  for (;;) {
    if (likely(PyList_CheckExact(__pyx_t_1))) {
      if (__pyx_t_2 >= PyList_GET_SIZE(__pyx_t_1)) break;
      __pyx_t_3 = PyList_GET_ITEM(__pyx_t_1, __pyx_t_2); __Pyx_INCREF(__pyx_t_3); __pyx_t_2++;
    } else if (likely(PyTuple_CheckExact(__pyx_t_1))) {
      if (__pyx_t_2 >= PyTuple_GET_SIZE(__pyx_t_1)) break;
      __pyx_t_3 = PyTuple_GET_ITEM(__pyx_t_1, __pyx_t_2); __Pyx_INCREF(__pyx_t_3); __pyx_t_2++;
    } else {
      __pyx_t_3 = PyIter_Next(__pyx_t_1);
      if (!__pyx_t_3) {
        if (unlikely(PyErr_Occurred())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 635; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        break;
      }
      __Pyx_GOTREF(__pyx_t_3);
    }
    __Pyx_DECREF(__pyx_v_chainID);
    __pyx_v_chainID = __pyx_t_3;
    __pyx_t_3 = 0;

    /* "/Users/sskory/Documents/yt-devel/yt/lagos/chainHOP/chainHOP.pyx":636
 *         # First assign a group to all chains with max_dens above peakthresh.
 *         for chainID in self.densest_in_chain:
 *             if self.densest_in_chain[chainID] >= self.peakthresh:             # <<<<<<<<<<<<<<
 *                 self.reverse_map[chainID] = groupID
 *                 groupID += 1
 */
    __pyx_t_3 = PyObject_GetAttr(__pyx_v_self, __pyx_kp_densest_in_chain); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 636; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_3);
    __pyx_1 = PyObject_GetItem(__pyx_t_3, __pyx_v_chainID); if (!__pyx_1) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 636; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_1);
    __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
    __pyx_t_3 = PyObject_GetAttr(__pyx_v_self, __pyx_kp_peakthresh); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 636; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_3);
    __pyx_t_4 = PyObject_RichCompare(__pyx_1, __pyx_t_3, Py_GE); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 636; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_4);
    __Pyx_DECREF(__pyx_1); __pyx_1 = 0;
    __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
    __pyx_t_5 = __Pyx_PyObject_IsTrue(__pyx_t_4); if (unlikely(__pyx_t_5 < 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 636; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
    if (__pyx_t_5) {

      /* "/Users/sskory/Documents/yt-devel/yt/lagos/chainHOP/chainHOP.pyx":637
 *         for chainID in self.densest_in_chain:
 *             if self.densest_in_chain[chainID] >= self.peakthresh:
 *                 self.reverse_map[chainID] = groupID             # <<<<<<<<<<<<<<
 *                 groupID += 1
 *         # Loop over all of the chain linkages.
 */
      __pyx_t_4 = PyInt_FromLong(__pyx_v_groupID); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 637; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_t_4);
      __pyx_t_3 = PyObject_GetAttr(__pyx_v_self, __pyx_kp_reverse_map); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 637; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_t_3);
      if (PyObject_SetItem(__pyx_t_3, __pyx_v_chainID, __pyx_t_4) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 637; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
      __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;

      /* "/Users/sskory/Documents/yt-devel/yt/lagos/chainHOP/chainHOP.pyx":638
 *             if self.densest_in_chain[chainID] >= self.peakthresh:
 *                 self.reverse_map[chainID] = groupID
 *                 groupID += 1             # <<<<<<<<<<<<<<
 *         # Loop over all of the chain linkages.
 *         for chain_high in self.chain_densest_n:
 */
      __pyx_v_groupID += 1;
      goto __pyx_L9;
    }
    __pyx_L9:;
  }
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;

  /* "/Users/sskory/Documents/yt-devel/yt/lagos/chainHOP/chainHOP.pyx":640
 *                 groupID += 1
 *         # Loop over all of the chain linkages.
 *         for chain_high in self.chain_densest_n:             # <<<<<<<<<<<<<<
 *             for chain_low in self.chain_densest_n[chain_high]:
 *                 dens = self.chain_densest_n[chain_high][chain_low]
 */
  __pyx_t_1 = PyObject_GetAttr(__pyx_v_self, __pyx_kp_chain_densest_n); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 640; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_1);
  if (PyList_CheckExact(__pyx_t_1) || PyTuple_CheckExact(__pyx_t_1)) {
    __pyx_t_2 = 0; __pyx_t_4 = __pyx_t_1; __Pyx_INCREF(__pyx_t_4);
  } else {
    __pyx_t_2 = -1; __pyx_t_4 = PyObject_GetIter(__pyx_t_1); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 640; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_4);
  }
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  for (;;) {
    if (likely(PyList_CheckExact(__pyx_t_4))) {
      if (__pyx_t_2 >= PyList_GET_SIZE(__pyx_t_4)) break;
      __pyx_t_1 = PyList_GET_ITEM(__pyx_t_4, __pyx_t_2); __Pyx_INCREF(__pyx_t_1); __pyx_t_2++;
    } else if (likely(PyTuple_CheckExact(__pyx_t_4))) {
      if (__pyx_t_2 >= PyTuple_GET_SIZE(__pyx_t_4)) break;
      __pyx_t_1 = PyTuple_GET_ITEM(__pyx_t_4, __pyx_t_2); __Pyx_INCREF(__pyx_t_1); __pyx_t_2++;
    } else {
      __pyx_t_1 = PyIter_Next(__pyx_t_4);
      if (!__pyx_t_1) {
        if (unlikely(PyErr_Occurred())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 640; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        break;
      }
      __Pyx_GOTREF(__pyx_t_1);
    }
    __Pyx_DECREF(__pyx_v_chain_high);
    __pyx_v_chain_high = __pyx_t_1;
    __pyx_t_1 = 0;

    /* "/Users/sskory/Documents/yt-devel/yt/lagos/chainHOP/chainHOP.pyx":641
 *         # Loop over all of the chain linkages.
 *         for chain_high in self.chain_densest_n:
 *             for chain_low in self.chain_densest_n[chain_high]:             # <<<<<<<<<<<<<<
 *                 dens = self.chain_densest_n[chain_high][chain_low]
 *                 max_dens_high = self.densest_in_chain[chain_high]
 */
    __pyx_t_1 = PyObject_GetAttr(__pyx_v_self, __pyx_kp_chain_densest_n); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 641; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_1);
    __pyx_1 = PyObject_GetItem(__pyx_t_1, __pyx_v_chain_high); if (!__pyx_1) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 641; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_1);
    __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
    if (PyList_CheckExact(__pyx_1) || PyTuple_CheckExact(__pyx_1)) {
      __pyx_t_6 = 0; __pyx_t_1 = __pyx_1; __Pyx_INCREF(__pyx_t_1);
    } else {
      __pyx_t_6 = -1; __pyx_t_1 = PyObject_GetIter(__pyx_1); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 641; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_t_1);
    }
    __Pyx_DECREF(__pyx_1); __pyx_1 = 0;
    for (;;) {
      if (likely(PyList_CheckExact(__pyx_t_1))) {
        if (__pyx_t_6 >= PyList_GET_SIZE(__pyx_t_1)) break;
        __pyx_t_3 = PyList_GET_ITEM(__pyx_t_1, __pyx_t_6); __Pyx_INCREF(__pyx_t_3); __pyx_t_6++;
      } else if (likely(PyTuple_CheckExact(__pyx_t_1))) {
        if (__pyx_t_6 >= PyTuple_GET_SIZE(__pyx_t_1)) break;
        __pyx_t_3 = PyTuple_GET_ITEM(__pyx_t_1, __pyx_t_6); __Pyx_INCREF(__pyx_t_3); __pyx_t_6++;
      } else {
        __pyx_t_3 = PyIter_Next(__pyx_t_1);
        if (!__pyx_t_3) {
          if (unlikely(PyErr_Occurred())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 641; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
          break;
        }
        __Pyx_GOTREF(__pyx_t_3);
      }
      __Pyx_DECREF(__pyx_v_chain_low);
      __pyx_v_chain_low = __pyx_t_3;
      __pyx_t_3 = 0;

      /* "/Users/sskory/Documents/yt-devel/yt/lagos/chainHOP/chainHOP.pyx":642
 *         for chain_high in self.chain_densest_n:
 *             for chain_low in self.chain_densest_n[chain_high]:
 *                 dens = self.chain_densest_n[chain_high][chain_low]             # <<<<<<<<<<<<<<
 *                 max_dens_high = self.densest_in_chain[chain_high]
 *                 max_dens_low = self.densest_in_chain[chain_low]
 */
      __pyx_t_3 = PyObject_GetAttr(__pyx_v_self, __pyx_kp_chain_densest_n); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 642; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_t_3);
      __pyx_1 = PyObject_GetItem(__pyx_t_3, __pyx_v_chain_high); if (!__pyx_1) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 642; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_1);
      __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
      __pyx_2 = PyObject_GetItem(__pyx_1, __pyx_v_chain_low); if (!__pyx_2) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 642; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_2);
      __Pyx_DECREF(__pyx_1); __pyx_1 = 0;
      __pyx_t_7 = __pyx_PyFloat_AsDouble(__pyx_2); if (unlikely(PyErr_Occurred())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 642; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_DECREF(__pyx_2); __pyx_2 = 0;
      __pyx_v_dens = __pyx_t_7;

      /* "/Users/sskory/Documents/yt-devel/yt/lagos/chainHOP/chainHOP.pyx":643
 *             for chain_low in self.chain_densest_n[chain_high]:
 *                 dens = self.chain_densest_n[chain_high][chain_low]
 *                 max_dens_high = self.densest_in_chain[chain_high]             # <<<<<<<<<<<<<<
 *                 max_dens_low = self.densest_in_chain[chain_low]
 *                 # If neither are peak density groups, mark them for later
 */
      __pyx_t_3 = PyObject_GetAttr(__pyx_v_self, __pyx_kp_densest_in_chain); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 643; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_t_3);
      __pyx_1 = PyObject_GetItem(__pyx_t_3, __pyx_v_chain_high); if (!__pyx_1) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 643; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_1);
      __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
      __pyx_t_7 = __pyx_PyFloat_AsDouble(__pyx_1); if (unlikely(PyErr_Occurred())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 643; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_DECREF(__pyx_1); __pyx_1 = 0;
      __pyx_v_max_dens_high = __pyx_t_7;

      /* "/Users/sskory/Documents/yt-devel/yt/lagos/chainHOP/chainHOP.pyx":644
 *                 dens = self.chain_densest_n[chain_high][chain_low]
 *                 max_dens_high = self.densest_in_chain[chain_high]
 *                 max_dens_low = self.densest_in_chain[chain_low]             # <<<<<<<<<<<<<<
 *                 # If neither are peak density groups, mark them for later
 *                 # consideration.
 */
      __pyx_t_3 = PyObject_GetAttr(__pyx_v_self, __pyx_kp_densest_in_chain); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 644; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_t_3);
      __pyx_2 = PyObject_GetItem(__pyx_t_3, __pyx_v_chain_low); if (!__pyx_2) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 644; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_2);
      __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
      __pyx_t_7 = __pyx_PyFloat_AsDouble(__pyx_2); if (unlikely(PyErr_Occurred())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 644; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_DECREF(__pyx_2); __pyx_2 = 0;
      __pyx_v_max_dens_low = __pyx_t_7;

      /* "/Users/sskory/Documents/yt-devel/yt/lagos/chainHOP/chainHOP.pyx":647
 *                 # If neither are peak density groups, mark them for later
 *                 # consideration.
 *                 if max_dens_high < self.peakthresh and \             # <<<<<<<<<<<<<<
 *                     max_dens_low < self.peakthresh:
 *                         g_high.append(chain_high)
 */
      __pyx_t_3 = PyFloat_FromDouble(__pyx_v_max_dens_high); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 647; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_t_3);
      __pyx_t_8 = PyObject_GetAttr(__pyx_v_self, __pyx_kp_peakthresh); if (unlikely(!__pyx_t_8)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 647; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_t_8);
      __pyx_t_9 = PyObject_RichCompare(__pyx_t_3, __pyx_t_8, Py_LT); if (unlikely(!__pyx_t_9)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 647; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_t_9);
      __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
      __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
      __pyx_t_5 = __Pyx_PyObject_IsTrue(__pyx_t_9); if (unlikely(__pyx_t_5 < 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 647; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_DECREF(__pyx_t_9); __pyx_t_9 = 0;
      if (__pyx_t_5) {

        /* "/Users/sskory/Documents/yt-devel/yt/lagos/chainHOP/chainHOP.pyx":648
 *                 # consideration.
 *                 if max_dens_high < self.peakthresh and \
 *                     max_dens_low < self.peakthresh:             # <<<<<<<<<<<<<<
 *                         g_high.append(chain_high)
 *                         g_low.append(chain_low)
 */
        __pyx_t_9 = PyFloat_FromDouble(__pyx_v_max_dens_low); if (unlikely(!__pyx_t_9)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 648; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        __Pyx_GOTREF(__pyx_t_9);
        __pyx_t_8 = PyObject_GetAttr(__pyx_v_self, __pyx_kp_peakthresh); if (unlikely(!__pyx_t_8)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 648; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        __Pyx_GOTREF(__pyx_t_8);
        __pyx_t_3 = PyObject_RichCompare(__pyx_t_9, __pyx_t_8, Py_LT); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 648; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        __Pyx_GOTREF(__pyx_t_3);
        __Pyx_DECREF(__pyx_t_9); __pyx_t_9 = 0;
        __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
        __pyx_t_10 = __Pyx_PyObject_IsTrue(__pyx_t_3); if (unlikely(__pyx_t_10 < 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 648; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
        __pyx_t_11 = __pyx_t_10;
      } else {
        __pyx_t_11 = __pyx_t_5;
      }
      if (__pyx_t_11) {

        /* "/Users/sskory/Documents/yt-devel/yt/lagos/chainHOP/chainHOP.pyx":649
 *                 if max_dens_high < self.peakthresh and \
 *                     max_dens_low < self.peakthresh:
 *                         g_high.append(chain_high)             # <<<<<<<<<<<<<<
 *                         g_low.append(chain_low)
 *                         g_dens.append(dens)
 */
        __pyx_t_3 = __Pyx_PyObject_Append(__pyx_v_g_high, __pyx_v_chain_high); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 649; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        __Pyx_GOTREF(__pyx_t_3);
        __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;

        /* "/Users/sskory/Documents/yt-devel/yt/lagos/chainHOP/chainHOP.pyx":650
 *                     max_dens_low < self.peakthresh:
 *                         g_high.append(chain_high)
 *                         g_low.append(chain_low)             # <<<<<<<<<<<<<<
 *                         g_dens.append(dens)
 *                         continue
 */
        __pyx_t_3 = __Pyx_PyObject_Append(__pyx_v_g_low, __pyx_v_chain_low); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 650; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        __Pyx_GOTREF(__pyx_t_3);
        __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;

        /* "/Users/sskory/Documents/yt-devel/yt/lagos/chainHOP/chainHOP.pyx":651
 *                         g_high.append(chain_high)
 *                         g_low.append(chain_low)
 *                         g_dens.append(dens)             # <<<<<<<<<<<<<<
 *                         continue
 *                 # If both are peak density groups, and have a boundary density
 */
        __pyx_t_3 = PyFloat_FromDouble(__pyx_v_dens); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 651; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        __Pyx_GOTREF(__pyx_t_3);
        __pyx_t_8 = __Pyx_PyObject_Append(__pyx_v_g_dens, __pyx_t_3); if (unlikely(!__pyx_t_8)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 651; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        __Pyx_GOTREF(__pyx_t_8);
        __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
        __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;

        /* "/Users/sskory/Documents/yt-devel/yt/lagos/chainHOP/chainHOP.pyx":652
 *                         g_low.append(chain_low)
 *                         g_dens.append(dens)
 *                         continue             # <<<<<<<<<<<<<<
 *                 # If both are peak density groups, and have a boundary density
 *                 # that is high enough, make them into a group, otherwise
 */
        goto __pyx_L12_continue;
        goto __pyx_L14;
      }
      __pyx_L14:;

      /* "/Users/sskory/Documents/yt-devel/yt/lagos/chainHOP/chainHOP.pyx":656
 *                 # that is high enough, make them into a group, otherwise
 *                 # move onto another linkage.
 *                 if max_dens_high >= self.peakthresh and \             # <<<<<<<<<<<<<<
 *                         max_dens_low >= self.peakthresh:
 *                     if dens < self.saddlethresh:
 */
      __pyx_t_8 = PyFloat_FromDouble(__pyx_v_max_dens_high); if (unlikely(!__pyx_t_8)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 656; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_t_8);
      __pyx_t_3 = PyObject_GetAttr(__pyx_v_self, __pyx_kp_peakthresh); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 656; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_t_3);
      __pyx_t_9 = PyObject_RichCompare(__pyx_t_8, __pyx_t_3, Py_GE); if (unlikely(!__pyx_t_9)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 656; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_t_9);
      __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
      __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
      __pyx_t_11 = __Pyx_PyObject_IsTrue(__pyx_t_9); if (unlikely(__pyx_t_11 < 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 656; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_DECREF(__pyx_t_9); __pyx_t_9 = 0;
      if (__pyx_t_11) {

        /* "/Users/sskory/Documents/yt-devel/yt/lagos/chainHOP/chainHOP.pyx":657
 *                 # move onto another linkage.
 *                 if max_dens_high >= self.peakthresh and \
 *                         max_dens_low >= self.peakthresh:             # <<<<<<<<<<<<<<
 *                     if dens < self.saddlethresh:
 *                         continue
 */
        __pyx_t_9 = PyFloat_FromDouble(__pyx_v_max_dens_low); if (unlikely(!__pyx_t_9)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 657; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        __Pyx_GOTREF(__pyx_t_9);
        __pyx_t_3 = PyObject_GetAttr(__pyx_v_self, __pyx_kp_peakthresh); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 657; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        __Pyx_GOTREF(__pyx_t_3);
        __pyx_t_8 = PyObject_RichCompare(__pyx_t_9, __pyx_t_3, Py_GE); if (unlikely(!__pyx_t_8)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 657; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        __Pyx_GOTREF(__pyx_t_8);
        __Pyx_DECREF(__pyx_t_9); __pyx_t_9 = 0;
        __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
        __pyx_t_5 = __Pyx_PyObject_IsTrue(__pyx_t_8); if (unlikely(__pyx_t_5 < 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 657; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
        __pyx_t_10 = __pyx_t_5;
      } else {
        __pyx_t_10 = __pyx_t_11;
      }
      if (__pyx_t_10) {

        /* "/Users/sskory/Documents/yt-devel/yt/lagos/chainHOP/chainHOP.pyx":658
 *                 if max_dens_high >= self.peakthresh and \
 *                         max_dens_low >= self.peakthresh:
 *                     if dens < self.saddlethresh:             # <<<<<<<<<<<<<<
 *                         continue
 *                     else:
 */
        __pyx_t_8 = PyFloat_FromDouble(__pyx_v_dens); if (unlikely(!__pyx_t_8)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 658; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        __Pyx_GOTREF(__pyx_t_8);
        __pyx_t_3 = PyObject_GetAttr(__pyx_v_self, __pyx_kp_saddlethresh); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 658; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        __Pyx_GOTREF(__pyx_t_3);
        __pyx_t_9 = PyObject_RichCompare(__pyx_t_8, __pyx_t_3, Py_LT); if (unlikely(!__pyx_t_9)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 658; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        __Pyx_GOTREF(__pyx_t_9);
        __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
        __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
        __pyx_t_10 = __Pyx_PyObject_IsTrue(__pyx_t_9); if (unlikely(__pyx_t_10 < 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 658; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        __Pyx_DECREF(__pyx_t_9); __pyx_t_9 = 0;
        if (__pyx_t_10) {

          /* "/Users/sskory/Documents/yt-devel/yt/lagos/chainHOP/chainHOP.pyx":659
 *                         max_dens_low >= self.peakthresh:
 *                     if dens < self.saddlethresh:
 *                         continue             # <<<<<<<<<<<<<<
 *                     else:
 *                         group_high = self.reverse_map[chain_high]
 */
          goto __pyx_L12_continue;
          goto __pyx_L16;
        }
        /*else*/ {

          /* "/Users/sskory/Documents/yt-devel/yt/lagos/chainHOP/chainHOP.pyx":661
 *                         continue
 *                     else:
 *                         group_high = self.reverse_map[chain_high]             # <<<<<<<<<<<<<<
 *                         group_low = self.reverse_map[chain_low]
 *                         # Both are already identified as groups, so we need
 */
          __pyx_t_9 = PyObject_GetAttr(__pyx_v_self, __pyx_kp_reverse_map); if (unlikely(!__pyx_t_9)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 661; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
          __Pyx_GOTREF(__pyx_t_9);
          __pyx_1 = PyObject_GetItem(__pyx_t_9, __pyx_v_chain_high); if (!__pyx_1) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 661; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
          __Pyx_GOTREF(__pyx_1);
          __Pyx_DECREF(__pyx_t_9); __pyx_t_9 = 0;
          __Pyx_DECREF(__pyx_v_group_high);
          __pyx_v_group_high = __pyx_1;
          __pyx_1 = 0;

          /* "/Users/sskory/Documents/yt-devel/yt/lagos/chainHOP/chainHOP.pyx":662
 *                     else:
 *                         group_high = self.reverse_map[chain_high]
 *                         group_low = self.reverse_map[chain_low]             # <<<<<<<<<<<<<<
 *                         # Both are already identified as groups, so we need
 *                         # to re-assign the less dense group to the denser
 */
          __pyx_t_9 = PyObject_GetAttr(__pyx_v_self, __pyx_kp_reverse_map); if (unlikely(!__pyx_t_9)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 662; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
          __Pyx_GOTREF(__pyx_t_9);
          __pyx_2 = PyObject_GetItem(__pyx_t_9, __pyx_v_chain_low); if (!__pyx_2) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 662; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
          __Pyx_GOTREF(__pyx_2);
          __Pyx_DECREF(__pyx_t_9); __pyx_t_9 = 0;
          __Pyx_DECREF(__pyx_v_group_low);
          __pyx_v_group_low = __pyx_2;
          __pyx_2 = 0;

          /* "/Users/sskory/Documents/yt-devel/yt/lagos/chainHOP/chainHOP.pyx":666
 *                         # to re-assign the less dense group to the denser
 *                         # groupID.
 *                         for chID in self.reverse_map:             # <<<<<<<<<<<<<<
 *                             if self.reverse_map[chID] == group_low:
 *                                 self.reverse_map[chID] = group_high
 */
          __pyx_t_9 = PyObject_GetAttr(__pyx_v_self, __pyx_kp_reverse_map); if (unlikely(!__pyx_t_9)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 666; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
          __Pyx_GOTREF(__pyx_t_9);
          if (PyList_CheckExact(__pyx_t_9) || PyTuple_CheckExact(__pyx_t_9)) {
            __pyx_t_12 = 0; __pyx_t_3 = __pyx_t_9; __Pyx_INCREF(__pyx_t_3);
          } else {
            __pyx_t_12 = -1; __pyx_t_3 = PyObject_GetIter(__pyx_t_9); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 666; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
            __Pyx_GOTREF(__pyx_t_3);
          }
          __Pyx_DECREF(__pyx_t_9); __pyx_t_9 = 0;
          for (;;) {
            if (likely(PyList_CheckExact(__pyx_t_3))) {
              if (__pyx_t_12 >= PyList_GET_SIZE(__pyx_t_3)) break;
              __pyx_t_9 = PyList_GET_ITEM(__pyx_t_3, __pyx_t_12); __Pyx_INCREF(__pyx_t_9); __pyx_t_12++;
            } else if (likely(PyTuple_CheckExact(__pyx_t_3))) {
              if (__pyx_t_12 >= PyTuple_GET_SIZE(__pyx_t_3)) break;
              __pyx_t_9 = PyTuple_GET_ITEM(__pyx_t_3, __pyx_t_12); __Pyx_INCREF(__pyx_t_9); __pyx_t_12++;
            } else {
              __pyx_t_9 = PyIter_Next(__pyx_t_3);
              if (!__pyx_t_9) {
                if (unlikely(PyErr_Occurred())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 666; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
                break;
              }
              __Pyx_GOTREF(__pyx_t_9);
            }
            __Pyx_DECREF(__pyx_v_chID);
            __pyx_v_chID = __pyx_t_9;
            __pyx_t_9 = 0;

            /* "/Users/sskory/Documents/yt-devel/yt/lagos/chainHOP/chainHOP.pyx":667
 *                         # groupID.
 *                         for chID in self.reverse_map:
 *                             if self.reverse_map[chID] == group_low:             # <<<<<<<<<<<<<<
 *                                 self.reverse_map[chID] = group_high
 *                         continue
 */
            __pyx_t_9 = PyObject_GetAttr(__pyx_v_self, __pyx_kp_reverse_map); if (unlikely(!__pyx_t_9)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 667; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
            __Pyx_GOTREF(__pyx_t_9);
            __pyx_1 = PyObject_GetItem(__pyx_t_9, __pyx_v_chID); if (!__pyx_1) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 667; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
            __Pyx_GOTREF(__pyx_1);
            __Pyx_DECREF(__pyx_t_9); __pyx_t_9 = 0;
            __pyx_t_9 = PyObject_RichCompare(__pyx_1, __pyx_v_group_low, Py_EQ); if (unlikely(!__pyx_t_9)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 667; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
            __Pyx_GOTREF(__pyx_t_9);
            __Pyx_DECREF(__pyx_1); __pyx_1 = 0;
            __pyx_t_10 = __Pyx_PyObject_IsTrue(__pyx_t_9); if (unlikely(__pyx_t_10 < 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 667; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
            __Pyx_DECREF(__pyx_t_9); __pyx_t_9 = 0;
            if (__pyx_t_10) {

              /* "/Users/sskory/Documents/yt-devel/yt/lagos/chainHOP/chainHOP.pyx":668
 *                         for chID in self.reverse_map:
 *                             if self.reverse_map[chID] == group_low:
 *                                 self.reverse_map[chID] = group_high             # <<<<<<<<<<<<<<
 *                         continue
 *                 # Else, one is above peakthresh, the other below
 */
              __pyx_t_9 = PyObject_GetAttr(__pyx_v_self, __pyx_kp_reverse_map); if (unlikely(!__pyx_t_9)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 668; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
              __Pyx_GOTREF(__pyx_t_9);
              if (PyObject_SetItem(__pyx_t_9, __pyx_v_chID, __pyx_v_group_high) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 668; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
              __Pyx_DECREF(__pyx_t_9); __pyx_t_9 = 0;
              goto __pyx_L19;
            }
            __pyx_L19:;
          }
          __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;

          /* "/Users/sskory/Documents/yt-devel/yt/lagos/chainHOP/chainHOP.pyx":669
 *                             if self.reverse_map[chID] == group_low:
 *                                 self.reverse_map[chID] = group_high
 *                         continue             # <<<<<<<<<<<<<<
 *                 # Else, one is above peakthresh, the other below
 *                 # find out if this is the densest boundary seen so far for
 */
          goto __pyx_L12_continue;
        }
        __pyx_L16:;
        goto __pyx_L15;
      }
      __pyx_L15:;

      /* "/Users/sskory/Documents/yt-devel/yt/lagos/chainHOP/chainHOP.pyx":673
 *                 # find out if this is the densest boundary seen so far for
 *                 # the lower chain.
 *                 group_high = self.reverse_map[chain_high]             # <<<<<<<<<<<<<<
 *                 if dens > densestbound[chain_low]:
 *                     densestbound[chain_low] = dens
 */
      __pyx_t_3 = PyObject_GetAttr(__pyx_v_self, __pyx_kp_reverse_map); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 673; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_t_3);
      __pyx_2 = PyObject_GetItem(__pyx_t_3, __pyx_v_chain_high); if (!__pyx_2) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 673; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_2);
      __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
      __Pyx_DECREF(__pyx_v_group_high);
      __pyx_v_group_high = __pyx_2;
      __pyx_2 = 0;

      /* "/Users/sskory/Documents/yt-devel/yt/lagos/chainHOP/chainHOP.pyx":674
 *                 # the lower chain.
 *                 group_high = self.reverse_map[chain_high]
 *                 if dens > densestbound[chain_low]:             # <<<<<<<<<<<<<<
 *                     densestbound[chain_low] = dens
 *                     self.reverse_map[chain_low] = group_high
 */
      __pyx_t_3 = PyFloat_FromDouble(__pyx_v_dens); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 674; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_t_3);
      __pyx_1 = PyObject_GetItem(__pyx_v_densestbound, __pyx_v_chain_low); if (!__pyx_1) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 674; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_1);
      __pyx_t_9 = PyObject_RichCompare(__pyx_t_3, __pyx_1, Py_GT); if (unlikely(!__pyx_t_9)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 674; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_t_9);
      __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
      __Pyx_DECREF(__pyx_1); __pyx_1 = 0;
      __pyx_t_10 = __Pyx_PyObject_IsTrue(__pyx_t_9); if (unlikely(__pyx_t_10 < 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 674; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_DECREF(__pyx_t_9); __pyx_t_9 = 0;
      if (__pyx_t_10) {

        /* "/Users/sskory/Documents/yt-devel/yt/lagos/chainHOP/chainHOP.pyx":675
 *                 group_high = self.reverse_map[chain_high]
 *                 if dens > densestbound[chain_low]:
 *                     densestbound[chain_low] = dens             # <<<<<<<<<<<<<<
 *                     self.reverse_map[chain_low] = group_high
 *                 # Done double loop over links.
 */
        __pyx_t_9 = PyFloat_FromDouble(__pyx_v_dens); if (unlikely(!__pyx_t_9)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 675; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        __Pyx_GOTREF(__pyx_t_9);
        if (PyObject_SetItem(__pyx_v_densestbound, __pyx_v_chain_low, __pyx_t_9) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 675; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        __Pyx_DECREF(__pyx_t_9); __pyx_t_9 = 0;

        /* "/Users/sskory/Documents/yt-devel/yt/lagos/chainHOP/chainHOP.pyx":676
 *                 if dens > densestbound[chain_low]:
 *                     densestbound[chain_low] = dens
 *                     self.reverse_map[chain_low] = group_high             # <<<<<<<<<<<<<<
 *                 # Done double loop over links.
 *         """
 */
        __pyx_t_9 = PyObject_GetAttr(__pyx_v_self, __pyx_kp_reverse_map); if (unlikely(!__pyx_t_9)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 676; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        __Pyx_GOTREF(__pyx_t_9);
        if (PyObject_SetItem(__pyx_t_9, __pyx_v_chain_low, __pyx_v_group_high) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 676; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        __Pyx_DECREF(__pyx_t_9); __pyx_t_9 = 0;
        goto __pyx_L20;
      }
      __pyx_L20:;
      __pyx_L12_continue:;
    }
    __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  }
  __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;

  /* "/Users/sskory/Documents/yt-devel/yt/lagos/chainHOP/chainHOP.pyx":684
 *         along.  Connections are only as good as their smallest boundary
 *         """
 *         changes = 1             # <<<<<<<<<<<<<<
 *         while changes:
 *             changes = 0
 */
  __pyx_v_changes = 1;

  /* "/Users/sskory/Documents/yt-devel/yt/lagos/chainHOP/chainHOP.pyx":685
 *         """
 *         changes = 1
 *         while changes:             # <<<<<<<<<<<<<<
 *             changes = 0
 *             for j,dens in enumerate(g_dens):
 */
  while (1) {
    __pyx_t_13 = __pyx_v_changes;
    if (!__pyx_t_13) break;

    /* "/Users/sskory/Documents/yt-devel/yt/lagos/chainHOP/chainHOP.pyx":686
 *         changes = 1
 *         while changes:
 *             changes = 0             # <<<<<<<<<<<<<<
 *             for j,dens in enumerate(g_dens):
 *                 chain_high = g_high[j]
 */
    __pyx_v_changes = 0;

    /* "/Users/sskory/Documents/yt-devel/yt/lagos/chainHOP/chainHOP.pyx":687
 *         while changes:
 *             changes = 0
 *             for j,dens in enumerate(g_dens):             # <<<<<<<<<<<<<<
 *                 chain_high = g_high[j]
 *                 chain_low = g_low[j]
 */
    __pyx_t_4 = PyTuple_New(1); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 687; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(((PyObject *)__pyx_t_4));
    __Pyx_INCREF(__pyx_v_g_dens);
    PyTuple_SET_ITEM(__pyx_t_4, 0, __pyx_v_g_dens);
    __Pyx_GIVEREF(__pyx_v_g_dens);
    __pyx_t_1 = PyObject_Call(__pyx_builtin_enumerate, ((PyObject *)__pyx_t_4), NULL); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 687; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_1);
    __Pyx_DECREF(((PyObject *)__pyx_t_4)); __pyx_t_4 = 0;
    if (PyList_CheckExact(__pyx_t_1) || PyTuple_CheckExact(__pyx_t_1)) {
      __pyx_t_2 = 0; __pyx_t_4 = __pyx_t_1; __Pyx_INCREF(__pyx_t_4);
    } else {
      __pyx_t_2 = -1; __pyx_t_4 = PyObject_GetIter(__pyx_t_1); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 687; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_t_4);
    }
    __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
    for (;;) {
      if (likely(PyList_CheckExact(__pyx_t_4))) {
        if (__pyx_t_2 >= PyList_GET_SIZE(__pyx_t_4)) break;
        __pyx_t_1 = PyList_GET_ITEM(__pyx_t_4, __pyx_t_2); __Pyx_INCREF(__pyx_t_1); __pyx_t_2++;
      } else if (likely(PyTuple_CheckExact(__pyx_t_4))) {
        if (__pyx_t_2 >= PyTuple_GET_SIZE(__pyx_t_4)) break;
        __pyx_t_1 = PyTuple_GET_ITEM(__pyx_t_4, __pyx_t_2); __Pyx_INCREF(__pyx_t_1); __pyx_t_2++;
      } else {
        __pyx_t_1 = PyIter_Next(__pyx_t_4);
        if (!__pyx_t_1) {
          if (unlikely(PyErr_Occurred())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 687; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
          break;
        }
        __Pyx_GOTREF(__pyx_t_1);
      }
      if (PyTuple_CheckExact(__pyx_t_1) && likely(PyTuple_GET_SIZE(__pyx_t_1) == 2)) {
        PyObject* tuple = __pyx_t_1;
        __pyx_1 = PyTuple_GET_ITEM(tuple, 0); __Pyx_INCREF(__pyx_1);
        __pyx_3 = PyTuple_GET_ITEM(tuple, 1); __Pyx_INCREF(__pyx_3);
        __pyx_t_7 = __pyx_PyFloat_AsDouble(__pyx_3); if (unlikely(PyErr_Occurred())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 687; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        __Pyx_DECREF(__pyx_3); __pyx_3 = 0;
        __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
        __Pyx_DECREF(__pyx_v_j);
        __pyx_v_j = __pyx_1;
        __pyx_1 = 0;
        __pyx_v_dens = __pyx_t_7;
      } else {
        __pyx_2 = PyObject_GetIter(__pyx_t_1); if (unlikely(!__pyx_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 687; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        __Pyx_GOTREF(__pyx_2);
        __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
        __pyx_1 = __Pyx_UnpackItem(__pyx_2, 0); if (unlikely(!__pyx_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 687; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        __Pyx_GOTREF(__pyx_1);
        __pyx_3 = __Pyx_UnpackItem(__pyx_2, 1); if (unlikely(!__pyx_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 687; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        __Pyx_GOTREF(__pyx_3);
        __pyx_t_7 = __pyx_PyFloat_AsDouble(__pyx_3); if (unlikely(PyErr_Occurred())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 687; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        __Pyx_DECREF(__pyx_3); __pyx_3 = 0;
        if (__Pyx_EndUnpack(__pyx_2) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 687; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        __Pyx_DECREF(__pyx_2); __pyx_2 = 0;
        __Pyx_DECREF(__pyx_v_j);
        __pyx_v_j = __pyx_1;
        __pyx_1 = 0;
        __pyx_v_dens = __pyx_t_7;
      }

      /* "/Users/sskory/Documents/yt-devel/yt/lagos/chainHOP/chainHOP.pyx":688
 *             changes = 0
 *             for j,dens in enumerate(g_dens):
 *                 chain_high = g_high[j]             # <<<<<<<<<<<<<<
 *                 chain_low = g_low[j]
 *                 # If the density of this boundary and the densestbound of
 */
      __pyx_3 = PyObject_GetItem(__pyx_v_g_high, __pyx_v_j); if (!__pyx_3) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 688; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_3);
      __Pyx_DECREF(__pyx_v_chain_high);
      __pyx_v_chain_high = __pyx_3;
      __pyx_3 = 0;

      /* "/Users/sskory/Documents/yt-devel/yt/lagos/chainHOP/chainHOP.pyx":689
 *             for j,dens in enumerate(g_dens):
 *                 chain_high = g_high[j]
 *                 chain_low = g_low[j]             # <<<<<<<<<<<<<<
 *                 # If the density of this boundary and the densestbound of
 *                 # the other chain is higher than a chain's densestbound, then
 */
      __pyx_2 = PyObject_GetItem(__pyx_v_g_low, __pyx_v_j); if (!__pyx_2) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 689; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_2);
      __Pyx_DECREF(__pyx_v_chain_low);
      __pyx_v_chain_low = __pyx_2;
      __pyx_2 = 0;

      /* "/Users/sskory/Documents/yt-devel/yt/lagos/chainHOP/chainHOP.pyx":693
 *                 # the other chain is higher than a chain's densestbound, then
 *                 # replace it.
 *                 if dens > densestbound[chain_low] and \             # <<<<<<<<<<<<<<
 *                         densestbound[chain_high] > densestbound[chain_low]:
 *                     changes += 1
 */
      __pyx_t_1 = PyFloat_FromDouble(__pyx_v_dens); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 693; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_t_1);
      __pyx_1 = PyObject_GetItem(__pyx_v_densestbound, __pyx_v_chain_low); if (!__pyx_1) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 693; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_1);
      __pyx_t_9 = PyObject_RichCompare(__pyx_t_1, __pyx_1, Py_GT); if (unlikely(!__pyx_t_9)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 693; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_t_9);
      __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
      __Pyx_DECREF(__pyx_1); __pyx_1 = 0;
      __pyx_t_10 = __Pyx_PyObject_IsTrue(__pyx_t_9); if (unlikely(__pyx_t_10 < 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 693; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_DECREF(__pyx_t_9); __pyx_t_9 = 0;
      if (__pyx_t_10) {

        /* "/Users/sskory/Documents/yt-devel/yt/lagos/chainHOP/chainHOP.pyx":694
 *                 # replace it.
 *                 if dens > densestbound[chain_low] and \
 *                         densestbound[chain_high] > densestbound[chain_low]:             # <<<<<<<<<<<<<<
 *                     changes += 1
 *                     if dens < densestbound[chain_high]:
 */
        __pyx_3 = PyObject_GetItem(__pyx_v_densestbound, __pyx_v_chain_high); if (!__pyx_3) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 694; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        __Pyx_GOTREF(__pyx_3);
        __pyx_2 = PyObject_GetItem(__pyx_v_densestbound, __pyx_v_chain_low); if (!__pyx_2) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 694; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        __Pyx_GOTREF(__pyx_2);
        __pyx_t_9 = PyObject_RichCompare(__pyx_3, __pyx_2, Py_GT); if (unlikely(!__pyx_t_9)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 694; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        __Pyx_GOTREF(__pyx_t_9);
        __Pyx_DECREF(__pyx_3); __pyx_3 = 0;
        __Pyx_DECREF(__pyx_2); __pyx_2 = 0;
        __pyx_t_11 = __Pyx_PyObject_IsTrue(__pyx_t_9); if (unlikely(__pyx_t_11 < 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 694; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        __Pyx_DECREF(__pyx_t_9); __pyx_t_9 = 0;
        __pyx_t_5 = __pyx_t_11;
      } else {
        __pyx_t_5 = __pyx_t_10;
      }
      if (__pyx_t_5) {

        /* "/Users/sskory/Documents/yt-devel/yt/lagos/chainHOP/chainHOP.pyx":695
 *                 if dens > densestbound[chain_low] and \
 *                         densestbound[chain_high] > densestbound[chain_low]:
 *                     changes += 1             # <<<<<<<<<<<<<<
 *                     if dens < densestbound[chain_high]:
 *                         densestbound[chain_low] = dens
 */
        __pyx_v_changes += 1;

        /* "/Users/sskory/Documents/yt-devel/yt/lagos/chainHOP/chainHOP.pyx":696
 *                         densestbound[chain_high] > densestbound[chain_low]:
 *                     changes += 1
 *                     if dens < densestbound[chain_high]:             # <<<<<<<<<<<<<<
 *                         densestbound[chain_low] = dens
 *                     else:
 */
        __pyx_t_9 = PyFloat_FromDouble(__pyx_v_dens); if (unlikely(!__pyx_t_9)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 696; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        __Pyx_GOTREF(__pyx_t_9);
        __pyx_1 = PyObject_GetItem(__pyx_v_densestbound, __pyx_v_chain_high); if (!__pyx_1) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 696; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        __Pyx_GOTREF(__pyx_1);
        __pyx_t_1 = PyObject_RichCompare(__pyx_t_9, __pyx_1, Py_LT); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 696; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        __Pyx_GOTREF(__pyx_t_1);
        __Pyx_DECREF(__pyx_t_9); __pyx_t_9 = 0;
        __Pyx_DECREF(__pyx_1); __pyx_1 = 0;
        __pyx_t_5 = __Pyx_PyObject_IsTrue(__pyx_t_1); if (unlikely(__pyx_t_5 < 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 696; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
        if (__pyx_t_5) {

          /* "/Users/sskory/Documents/yt-devel/yt/lagos/chainHOP/chainHOP.pyx":697
 *                     changes += 1
 *                     if dens < densestbound[chain_high]:
 *                         densestbound[chain_low] = dens             # <<<<<<<<<<<<<<
 *                     else:
 *                         densestbound[chain_low] = densestbound[chain_high]
 */
          __pyx_t_1 = PyFloat_FromDouble(__pyx_v_dens); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 697; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
          __Pyx_GOTREF(__pyx_t_1);
          if (PyObject_SetItem(__pyx_v_densestbound, __pyx_v_chain_low, __pyx_t_1) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 697; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
          __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
          goto __pyx_L26;
        }
        /*else*/ {

          /* "/Users/sskory/Documents/yt-devel/yt/lagos/chainHOP/chainHOP.pyx":699
 *                         densestbound[chain_low] = dens
 *                     else:
 *                         densestbound[chain_low] = densestbound[chain_high]             # <<<<<<<<<<<<<<
 *                     self.reverse_map[chain_low] = self.reverse_map[chain_high]
 *         # Now we have to find the unique groupIDs, since they may have been
 */
          __pyx_3 = PyObject_GetItem(__pyx_v_densestbound, __pyx_v_chain_high); if (!__pyx_3) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 699; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
          __Pyx_GOTREF(__pyx_3);
          if (PyObject_SetItem(__pyx_v_densestbound, __pyx_v_chain_low, __pyx_3) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 699; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
          __Pyx_DECREF(__pyx_3); __pyx_3 = 0;
        }
        __pyx_L26:;

        /* "/Users/sskory/Documents/yt-devel/yt/lagos/chainHOP/chainHOP.pyx":700
 *                     else:
 *                         densestbound[chain_low] = densestbound[chain_high]
 *                     self.reverse_map[chain_low] = self.reverse_map[chain_high]             # <<<<<<<<<<<<<<
 *         # Now we have to find the unique groupIDs, since they may have been
 *         # merged.
 */
        __pyx_t_1 = PyObject_GetAttr(__pyx_v_self, __pyx_kp_reverse_map); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 700; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        __Pyx_GOTREF(__pyx_t_1);
        __pyx_2 = PyObject_GetItem(__pyx_t_1, __pyx_v_chain_high); if (!__pyx_2) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 700; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        __Pyx_GOTREF(__pyx_2);
        __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
        __pyx_t_1 = PyObject_GetAttr(__pyx_v_self, __pyx_kp_reverse_map); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 700; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        __Pyx_GOTREF(__pyx_t_1);
        if (PyObject_SetItem(__pyx_t_1, __pyx_v_chain_low, __pyx_2) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 700; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
        __Pyx_DECREF(__pyx_2); __pyx_2 = 0;
        goto __pyx_L25;
      }
      __pyx_L25:;
    }
    __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
  }

  /* "/Users/sskory/Documents/yt-devel/yt/lagos/chainHOP/chainHOP.pyx":703
 *         # Now we have to find the unique groupIDs, since they may have been
 *         # merged.
 *         temp = []             # <<<<<<<<<<<<<<
 *         for chain in self.reverse_map:
 *             temp.append(self.reverse_map[chain])
 */
  __pyx_t_4 = PyList_New(0); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 703; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(((PyObject *)__pyx_t_4));
  __Pyx_DECREF(__pyx_v_temp);
  __pyx_v_temp = ((PyObject *)__pyx_t_4);
  __pyx_t_4 = 0;

  /* "/Users/sskory/Documents/yt-devel/yt/lagos/chainHOP/chainHOP.pyx":704
 *         # merged.
 *         temp = []
 *         for chain in self.reverse_map:             # <<<<<<<<<<<<<<
 *             temp.append(self.reverse_map[chain])
 *         # Uniquify the list.
 */
  __pyx_t_4 = PyObject_GetAttr(__pyx_v_self, __pyx_kp_reverse_map); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 704; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_4);
  if (PyList_CheckExact(__pyx_t_4) || PyTuple_CheckExact(__pyx_t_4)) {
    __pyx_t_2 = 0; __pyx_t_1 = __pyx_t_4; __Pyx_INCREF(__pyx_t_1);
  } else {
    __pyx_t_2 = -1; __pyx_t_1 = PyObject_GetIter(__pyx_t_4); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 704; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_1);
  }
  __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
  for (;;) {
    if (likely(PyList_CheckExact(__pyx_t_1))) {
      if (__pyx_t_2 >= PyList_GET_SIZE(__pyx_t_1)) break;
      __pyx_t_4 = PyList_GET_ITEM(__pyx_t_1, __pyx_t_2); __Pyx_INCREF(__pyx_t_4); __pyx_t_2++;
    } else if (likely(PyTuple_CheckExact(__pyx_t_1))) {
      if (__pyx_t_2 >= PyTuple_GET_SIZE(__pyx_t_1)) break;
      __pyx_t_4 = PyTuple_GET_ITEM(__pyx_t_1, __pyx_t_2); __Pyx_INCREF(__pyx_t_4); __pyx_t_2++;
    } else {
      __pyx_t_4 = PyIter_Next(__pyx_t_1);
      if (!__pyx_t_4) {
        if (unlikely(PyErr_Occurred())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 704; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        break;
      }
      __Pyx_GOTREF(__pyx_t_4);
    }
    __Pyx_DECREF(__pyx_v_chain);
    __pyx_v_chain = __pyx_t_4;
    __pyx_t_4 = 0;

    /* "/Users/sskory/Documents/yt-devel/yt/lagos/chainHOP/chainHOP.pyx":705
 *         temp = []
 *         for chain in self.reverse_map:
 *             temp.append(self.reverse_map[chain])             # <<<<<<<<<<<<<<
 *         # Uniquify the list.
 *         temp = list(Set(temp))
 */
    __pyx_t_4 = PyObject_GetAttr(__pyx_v_self, __pyx_kp_reverse_map); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 705; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_4);
    __pyx_1 = PyObject_GetItem(__pyx_t_4, __pyx_v_chain); if (!__pyx_1) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 705; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_1);
    __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
    __pyx_t_4 = __Pyx_PyObject_Append(__pyx_v_temp, __pyx_1); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 705; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_4);
    __Pyx_DECREF(__pyx_1); __pyx_1 = 0;
    __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
  }
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;

  /* "/Users/sskory/Documents/yt-devel/yt/lagos/chainHOP/chainHOP.pyx":707
 *             temp.append(self.reverse_map[chain])
 *         # Uniquify the list.
 *         temp = list(Set(temp))             # <<<<<<<<<<<<<<
 *         # Remove -1 from the list.
 *         temp.pop(temp.index(-1))
 */
  __pyx_3 = __Pyx_GetName(__pyx_m, __pyx_kp_Set); if (unlikely(!__pyx_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 707; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_3);
  __pyx_t_1 = PyTuple_New(1); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 707; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(((PyObject *)__pyx_t_1));
  __Pyx_INCREF(__pyx_v_temp);
  PyTuple_SET_ITEM(__pyx_t_1, 0, __pyx_v_temp);
  __Pyx_GIVEREF(__pyx_v_temp);
  __pyx_t_4 = PyObject_Call(__pyx_3, ((PyObject *)__pyx_t_1), NULL); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 707; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_4);
  __Pyx_DECREF(__pyx_3); __pyx_3 = 0;
  __Pyx_DECREF(((PyObject *)__pyx_t_1)); __pyx_t_1 = 0;
  __pyx_t_1 = PyTuple_New(1); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 707; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(((PyObject *)__pyx_t_1));
  PyTuple_SET_ITEM(__pyx_t_1, 0, __pyx_t_4);
  __Pyx_GIVEREF(__pyx_t_4);
  __pyx_t_4 = 0;
  __pyx_t_4 = PyObject_Call(((PyObject *)((PyObject*)&PyList_Type)), ((PyObject *)__pyx_t_1), NULL); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 707; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_4);
  __Pyx_DECREF(((PyObject *)__pyx_t_1)); __pyx_t_1 = 0;
  __Pyx_DECREF(__pyx_v_temp);
  __pyx_v_temp = __pyx_t_4;
  __pyx_t_4 = 0;

  /* "/Users/sskory/Documents/yt-devel/yt/lagos/chainHOP/chainHOP.pyx":709
 *         temp = list(Set(temp))
 *         # Remove -1 from the list.
 *         temp.pop(temp.index(-1))             # <<<<<<<<<<<<<<
 *         # Make a secondary map to make the IDs consecutive.
 *         secondary_map = {}
 */
  __pyx_t_4 = PyObject_GetAttr(__pyx_v_temp, __pyx_kp_pop); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 709; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_4);
  __pyx_t_1 = PyObject_GetAttr(__pyx_v_temp, __pyx_kp_index); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 709; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_t_9 = PyTuple_New(1); if (unlikely(!__pyx_t_9)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 709; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(((PyObject *)__pyx_t_9));
  __Pyx_INCREF(__pyx_int_neg_1);
  PyTuple_SET_ITEM(__pyx_t_9, 0, __pyx_int_neg_1);
  __Pyx_GIVEREF(__pyx_int_neg_1);
  __pyx_t_3 = PyObject_Call(__pyx_t_1, ((PyObject *)__pyx_t_9), NULL); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 709; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_3);
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  __Pyx_DECREF(((PyObject *)__pyx_t_9)); __pyx_t_9 = 0;
  __pyx_t_9 = PyTuple_New(1); if (unlikely(!__pyx_t_9)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 709; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(((PyObject *)__pyx_t_9));
  PyTuple_SET_ITEM(__pyx_t_9, 0, __pyx_t_3);
  __Pyx_GIVEREF(__pyx_t_3);
  __pyx_t_3 = 0;
  __pyx_t_3 = PyObject_Call(__pyx_t_4, ((PyObject *)__pyx_t_9), NULL); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 709; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_3);
  __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
  __Pyx_DECREF(((PyObject *)__pyx_t_9)); __pyx_t_9 = 0;
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;

  /* "/Users/sskory/Documents/yt-devel/yt/lagos/chainHOP/chainHOP.pyx":711
 *         temp.pop(temp.index(-1))
 *         # Make a secondary map to make the IDs consecutive.
 *         secondary_map = {}             # <<<<<<<<<<<<<<
 *         for i,ID in enumerate(temp):
 *             secondary_map[ID] = i
 */
  __pyx_2 = PyDict_New(); if (unlikely(!__pyx_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 711; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(((PyObject *)__pyx_2));
  __Pyx_DECREF(__pyx_v_secondary_map);
  __pyx_v_secondary_map = ((PyObject *)__pyx_2);
  __pyx_2 = 0;

  /* "/Users/sskory/Documents/yt-devel/yt/lagos/chainHOP/chainHOP.pyx":712
 *         # Make a secondary map to make the IDs consecutive.
 *         secondary_map = {}
 *         for i,ID in enumerate(temp):             # <<<<<<<<<<<<<<
 *             secondary_map[ID] = i
 *         # Update reverse_map
 */
  __pyx_t_3 = PyTuple_New(1); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 712; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(((PyObject *)__pyx_t_3));
  __Pyx_INCREF(__pyx_v_temp);
  PyTuple_SET_ITEM(__pyx_t_3, 0, __pyx_v_temp);
  __Pyx_GIVEREF(__pyx_v_temp);
  __pyx_t_9 = PyObject_Call(__pyx_builtin_enumerate, ((PyObject *)__pyx_t_3), NULL); if (unlikely(!__pyx_t_9)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 712; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_9);
  __Pyx_DECREF(((PyObject *)__pyx_t_3)); __pyx_t_3 = 0;
  if (PyList_CheckExact(__pyx_t_9) || PyTuple_CheckExact(__pyx_t_9)) {
    __pyx_t_2 = 0; __pyx_t_3 = __pyx_t_9; __Pyx_INCREF(__pyx_t_3);
  } else {
    __pyx_t_2 = -1; __pyx_t_3 = PyObject_GetIter(__pyx_t_9); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 712; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_3);
  }
  __Pyx_DECREF(__pyx_t_9); __pyx_t_9 = 0;
  for (;;) {
    if (likely(PyList_CheckExact(__pyx_t_3))) {
      if (__pyx_t_2 >= PyList_GET_SIZE(__pyx_t_3)) break;
      __pyx_t_9 = PyList_GET_ITEM(__pyx_t_3, __pyx_t_2); __Pyx_INCREF(__pyx_t_9); __pyx_t_2++;
    } else if (likely(PyTuple_CheckExact(__pyx_t_3))) {
      if (__pyx_t_2 >= PyTuple_GET_SIZE(__pyx_t_3)) break;
      __pyx_t_9 = PyTuple_GET_ITEM(__pyx_t_3, __pyx_t_2); __Pyx_INCREF(__pyx_t_9); __pyx_t_2++;
    } else {
      __pyx_t_9 = PyIter_Next(__pyx_t_3);
      if (!__pyx_t_9) {
        if (unlikely(PyErr_Occurred())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 712; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        break;
      }
      __Pyx_GOTREF(__pyx_t_9);
    }
    if (PyTuple_CheckExact(__pyx_t_9) && likely(PyTuple_GET_SIZE(__pyx_t_9) == 2)) {
      PyObject* tuple = __pyx_t_9;
      __pyx_3 = PyTuple_GET_ITEM(tuple, 0); __Pyx_INCREF(__pyx_3);
      __pyx_2 = PyTuple_GET_ITEM(tuple, 1); __Pyx_INCREF(__pyx_2);
      __Pyx_DECREF(__pyx_t_9); __pyx_t_9 = 0;
      __Pyx_DECREF(__pyx_v_i);
      __pyx_v_i = __pyx_3;
      __pyx_3 = 0;
      __Pyx_DECREF(__pyx_v_ID);
      __pyx_v_ID = __pyx_2;
      __pyx_2 = 0;
    } else {
      __pyx_1 = PyObject_GetIter(__pyx_t_9); if (unlikely(!__pyx_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 712; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_1);
      __Pyx_DECREF(__pyx_t_9); __pyx_t_9 = 0;
      __pyx_3 = __Pyx_UnpackItem(__pyx_1, 0); if (unlikely(!__pyx_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 712; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_3);
      __pyx_2 = __Pyx_UnpackItem(__pyx_1, 1); if (unlikely(!__pyx_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 712; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_2);
      if (__Pyx_EndUnpack(__pyx_1) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 712; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_DECREF(__pyx_1); __pyx_1 = 0;
      __Pyx_DECREF(__pyx_v_i);
      __pyx_v_i = __pyx_3;
      __pyx_3 = 0;
      __Pyx_DECREF(__pyx_v_ID);
      __pyx_v_ID = __pyx_2;
      __pyx_2 = 0;
    }

    /* "/Users/sskory/Documents/yt-devel/yt/lagos/chainHOP/chainHOP.pyx":713
 *         secondary_map = {}
 *         for i,ID in enumerate(temp):
 *             secondary_map[ID] = i             # <<<<<<<<<<<<<<
 *         # Update reverse_map
 *         for chain in self.reverse_map:
 */
    if (PyObject_SetItem(__pyx_v_secondary_map, __pyx_v_ID, __pyx_v_i) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 713; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  }
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;

  /* "/Users/sskory/Documents/yt-devel/yt/lagos/chainHOP/chainHOP.pyx":715
 *             secondary_map[ID] = i
 *         # Update reverse_map
 *         for chain in self.reverse_map:             # <<<<<<<<<<<<<<
 *             # Don't attempt to fix non-assigned chains.
 *             if self.reverse_map[chain] == -1: continue
 */
  __pyx_t_3 = PyObject_GetAttr(__pyx_v_self, __pyx_kp_reverse_map); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 715; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_3);
  if (PyList_CheckExact(__pyx_t_3) || PyTuple_CheckExact(__pyx_t_3)) {
    __pyx_t_2 = 0; __pyx_t_9 = __pyx_t_3; __Pyx_INCREF(__pyx_t_9);
  } else {
    __pyx_t_2 = -1; __pyx_t_9 = PyObject_GetIter(__pyx_t_3); if (unlikely(!__pyx_t_9)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 715; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_9);
  }
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  for (;;) {
    if (likely(PyList_CheckExact(__pyx_t_9))) {
      if (__pyx_t_2 >= PyList_GET_SIZE(__pyx_t_9)) break;
      __pyx_t_3 = PyList_GET_ITEM(__pyx_t_9, __pyx_t_2); __Pyx_INCREF(__pyx_t_3); __pyx_t_2++;
    } else if (likely(PyTuple_CheckExact(__pyx_t_9))) {
      if (__pyx_t_2 >= PyTuple_GET_SIZE(__pyx_t_9)) break;
      __pyx_t_3 = PyTuple_GET_ITEM(__pyx_t_9, __pyx_t_2); __Pyx_INCREF(__pyx_t_3); __pyx_t_2++;
    } else {
      __pyx_t_3 = PyIter_Next(__pyx_t_9);
      if (!__pyx_t_3) {
        if (unlikely(PyErr_Occurred())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 715; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        break;
      }
      __Pyx_GOTREF(__pyx_t_3);
    }
    __Pyx_DECREF(__pyx_v_chain);
    __pyx_v_chain = __pyx_t_3;
    __pyx_t_3 = 0;

    /* "/Users/sskory/Documents/yt-devel/yt/lagos/chainHOP/chainHOP.pyx":717
 *         for chain in self.reverse_map:
 *             # Don't attempt to fix non-assigned chains.
 *             if self.reverse_map[chain] == -1: continue             # <<<<<<<<<<<<<<
 *             self.reverse_map[chain] = secondary_map[self.reverse_map[chain]]
 *         group_count = len(temp)
 */
    __pyx_t_3 = PyObject_GetAttr(__pyx_v_self, __pyx_kp_reverse_map); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 717; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_3);
    __pyx_1 = PyObject_GetItem(__pyx_t_3, __pyx_v_chain); if (!__pyx_1) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 717; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_1);
    __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
    __pyx_t_3 = PyObject_RichCompare(__pyx_1, __pyx_int_neg_1, Py_EQ); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 717; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_3);
    __Pyx_DECREF(__pyx_1); __pyx_1 = 0;
    __pyx_t_5 = __Pyx_PyObject_IsTrue(__pyx_t_3); if (unlikely(__pyx_t_5 < 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 717; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
    if (__pyx_t_5) {
      goto __pyx_L31_continue;
      goto __pyx_L33;
    }
    __pyx_L33:;

    /* "/Users/sskory/Documents/yt-devel/yt/lagos/chainHOP/chainHOP.pyx":718
 *             # Don't attempt to fix non-assigned chains.
 *             if self.reverse_map[chain] == -1: continue
 *             self.reverse_map[chain] = secondary_map[self.reverse_map[chain]]             # <<<<<<<<<<<<<<
 *         group_count = len(temp)
 *         return group_count
 */
    __pyx_t_3 = PyObject_GetAttr(__pyx_v_self, __pyx_kp_reverse_map); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 718; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_3);
    __pyx_3 = PyObject_GetItem(__pyx_t_3, __pyx_v_chain); if (!__pyx_3) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 718; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_3);
    __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
    __pyx_2 = PyObject_GetItem(__pyx_v_secondary_map, __pyx_3); if (!__pyx_2) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 718; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_2);
    __Pyx_DECREF(__pyx_3); __pyx_3 = 0;
    __pyx_t_3 = PyObject_GetAttr(__pyx_v_self, __pyx_kp_reverse_map); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 718; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_3);
    if (PyObject_SetItem(__pyx_t_3, __pyx_v_chain, __pyx_2) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 718; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
    __Pyx_DECREF(__pyx_2); __pyx_2 = 0;
    __pyx_L31_continue:;
  }
  __Pyx_DECREF(__pyx_t_9); __pyx_t_9 = 0;

  /* "/Users/sskory/Documents/yt-devel/yt/lagos/chainHOP/chainHOP.pyx":719
 *             if self.reverse_map[chain] == -1: continue
 *             self.reverse_map[chain] = secondary_map[self.reverse_map[chain]]
 *         group_count = len(temp)             # <<<<<<<<<<<<<<
 *         return group_count
 * 
 */
  __pyx_t_2 = PyObject_Length(__pyx_v_temp); if (unlikely(__pyx_t_2 == -1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 719; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __pyx_v_group_count = __pyx_t_2;

  /* "/Users/sskory/Documents/yt-devel/yt/lagos/chainHOP/chainHOP.pyx":720
 *             self.reverse_map[chain] = secondary_map[self.reverse_map[chain]]
 *         group_count = len(temp)
 *         return group_count             # <<<<<<<<<<<<<<
 * 
 *     def _translate_groupIDs(object self, long group_count):
 */
  __Pyx_XDECREF(__pyx_r);
  __pyx_t_9 = PyInt_FromLong(__pyx_v_group_count); if (unlikely(!__pyx_t_9)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 720; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_9);
  __pyx_r = __pyx_t_9;
  __pyx_t_9 = 0;
  goto __pyx_L0;

  __pyx_r = Py_None; __Pyx_INCREF(Py_None);
  goto __pyx_L0;
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_1);
  __Pyx_XDECREF(__pyx_2);
  __Pyx_XDECREF(__pyx_3);
  __Pyx_XDECREF(__pyx_t_1);
  __Pyx_XDECREF(__pyx_t_3);
  __Pyx_XDECREF(__pyx_t_4);
  __Pyx_XDECREF(__pyx_t_8);
  __Pyx_XDECREF(__pyx_t_9);
  __Pyx_AddTraceback("yt.lagos.chainHOP.chainHOP.RunChainHOP._build_groups");
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_DECREF(__pyx_v_g_high);
  __Pyx_DECREF(__pyx_v_g_low);
  __Pyx_DECREF(__pyx_v_g_dens);
  __Pyx_DECREF(__pyx_v_densestbound);
  __Pyx_DECREF(__pyx_v_chainID);
  __Pyx_DECREF(__pyx_v_chain_high);
  __Pyx_DECREF(__pyx_v_chain_low);
  __Pyx_DECREF(__pyx_v_group_high);
  __Pyx_DECREF(__pyx_v_group_low);
  __Pyx_DECREF(__pyx_v_chID);
  __Pyx_DECREF(__pyx_v_j);
  __Pyx_DECREF(__pyx_v_temp);
  __Pyx_DECREF(__pyx_v_chain);
  __Pyx_DECREF(__pyx_v_secondary_map);
  __Pyx_DECREF(__pyx_v_i);
  __Pyx_DECREF(__pyx_v_ID);
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_FinishRefcountContext();
  return __pyx_r;
}

/* "/Users/sskory/Documents/yt-devel/yt/lagos/chainHOP/chainHOP.pyx":722
 *         return group_count
 * 
 *     def _translate_groupIDs(object self, long group_count):             # <<<<<<<<<<<<<<
 *         """
 *         Using the maps, convert the particle chainIDs into their locally-final
 */

static PyObject *__pyx_pf_2yt_5lagos_8chainHOP_8chainHOP_11RunChainHOP__translate_groupIDs(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static char __pyx_doc_2yt_5lagos_8chainHOP_8chainHOP_11RunChainHOP__translate_groupIDs[] = "\n        Using the maps, convert the particle chainIDs into their locally-final\n        groupIDs.\n        ";
static PyMethodDef __pyx_mdef_2yt_5lagos_8chainHOP_8chainHOP_11RunChainHOP__translate_groupIDs = {__Pyx_NAMESTR("_translate_groupIDs"), (PyCFunction)__pyx_pf_2yt_5lagos_8chainHOP_8chainHOP_11RunChainHOP__translate_groupIDs, METH_VARARGS|METH_KEYWORDS, __Pyx_DOCSTR(__pyx_doc_2yt_5lagos_8chainHOP_8chainHOP_11RunChainHOP__translate_groupIDs)};
static PyObject *__pyx_pf_2yt_5lagos_8chainHOP_8chainHOP_11RunChainHOP__translate_groupIDs(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  PyObject *__pyx_v_self = 0;
  long __pyx_v_group_count;
  long __pyx_v_i;
  double __pyx_v_max_dens;
  PyObject *__pyx_v_chainID;
  PyObject *__pyx_v_groupID;
  PyObject *__pyx_r = NULL;
  PyObject *__pyx_1 = 0;
  PyObject *__pyx_2 = 0;
  PyObject *__pyx_t_1 = NULL;
  long __pyx_t_2;
  long __pyx_t_3;
  int __pyx_t_4;
  PyObject *__pyx_t_5 = NULL;
  Py_ssize_t __pyx_t_6;
  double __pyx_t_7;
  PyObject *__pyx_t_8 = NULL;
  static PyObject **__pyx_pyargnames[] = {&__pyx_kp_self,&__pyx_kp_group_count,0};
  __Pyx_SetupRefcountContext("_translate_groupIDs");
  __pyx_self = __pyx_self;
  if (unlikely(__pyx_kwds)) {
    Py_ssize_t kw_args = PyDict_Size(__pyx_kwds);
    PyObject* values[2] = {0,0};
    switch (PyTuple_GET_SIZE(__pyx_args)) {
      case  2: values[1] = PyTuple_GET_ITEM(__pyx_args, 1);
      case  1: values[0] = PyTuple_GET_ITEM(__pyx_args, 0);
      case  0: break;
      default: goto __pyx_L5_argtuple_error;
    }
    switch (PyTuple_GET_SIZE(__pyx_args)) {
      case  0:
      values[0] = PyDict_GetItem(__pyx_kwds, __pyx_kp_self);
      if (likely(values[0])) kw_args--;
      else goto __pyx_L5_argtuple_error;
      case  1:
      values[1] = PyDict_GetItem(__pyx_kwds, __pyx_kp_group_count);
      if (likely(values[1])) kw_args--;
      else {
        __Pyx_RaiseArgtupleInvalid("_translate_groupIDs", 1, 2, 2, 1); {__pyx_filename = __pyx_f[0]; __pyx_lineno = 722; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
      }
    }
    if (unlikely(kw_args > 0)) {
      if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, PyTuple_GET_SIZE(__pyx_args), "_translate_groupIDs") < 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 722; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
    }
    __pyx_v_self = values[0];
    __pyx_v_group_count = __Pyx_PyInt_AsLong(values[1]); if (unlikely((__pyx_v_group_count == (long)-1) && PyErr_Occurred())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 722; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
  } else if (PyTuple_GET_SIZE(__pyx_args) != 2) {
    goto __pyx_L5_argtuple_error;
  } else {
    __pyx_v_self = PyTuple_GET_ITEM(__pyx_args, 0);
    __pyx_v_group_count = __Pyx_PyInt_AsLong(PyTuple_GET_ITEM(__pyx_args, 1)); if (unlikely((__pyx_v_group_count == (long)-1) && PyErr_Occurred())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 722; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
  }
  goto __pyx_L4_argument_unpacking_done;
  __pyx_L5_argtuple_error:;
  __Pyx_RaiseArgtupleInvalid("_translate_groupIDs", 1, 2, 2, PyTuple_GET_SIZE(__pyx_args)); {__pyx_filename = __pyx_f[0]; __pyx_lineno = 722; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
  __pyx_L3_error:;
  __Pyx_AddTraceback("yt.lagos.chainHOP.chainHOP.RunChainHOP._translate_groupIDs");
  return NULL;
  __pyx_L4_argument_unpacking_done:;
  __pyx_v_chainID = Py_None; __Pyx_INCREF(Py_None);
  __pyx_v_groupID = Py_None; __Pyx_INCREF(Py_None);

  /* "/Users/sskory/Documents/yt-devel/yt/lagos/chainHOP/chainHOP.pyx":729
 *         cdef long i
 *         cdef double max_dens
 *         for i in xrange(self.size):             # <<<<<<<<<<<<<<
 *             # Don't translate non-affiliated particles.
 *             if self.chainID[i] == -1: continue
 */
  __pyx_t_1 = PyObject_GetAttr(__pyx_v_self, __pyx_kp_size); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 729; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_t_2 = __Pyx_PyInt_AsLong(__pyx_t_1); if (unlikely((__pyx_t_2 == (long)-1) && PyErr_Occurred())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 729; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  for (__pyx_t_3 = 0; __pyx_t_3 < __pyx_t_2; __pyx_t_3+=1) {
    __pyx_v_i = __pyx_t_3;

    /* "/Users/sskory/Documents/yt-devel/yt/lagos/chainHOP/chainHOP.pyx":731
 *         for i in xrange(self.size):
 *             # Don't translate non-affiliated particles.
 *             if self.chainID[i] == -1: continue             # <<<<<<<<<<<<<<
 *             # We want to remove the group tag from padded particles,
 *             # so when we return it to HaloFinding, there is no duplication.
 */
    __pyx_t_1 = PyObject_GetAttr(__pyx_v_self, __pyx_kp_chainID); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 731; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_1);
    __pyx_1 = __Pyx_GetItemInt(__pyx_t_1, __pyx_v_i, sizeof(long), PyInt_FromLong); if (!__pyx_1) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 731; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_1);
    __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
    __pyx_t_1 = PyObject_RichCompare(__pyx_1, __pyx_int_neg_1, Py_EQ); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 731; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_1);
    __Pyx_DECREF(__pyx_1); __pyx_1 = 0;
    __pyx_t_4 = __Pyx_PyObject_IsTrue(__pyx_t_1); if (unlikely(__pyx_t_4 < 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 731; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
    if (__pyx_t_4) {
      goto __pyx_L6_continue;
      goto __pyx_L8;
    }
    __pyx_L8:;

    /* "/Users/sskory/Documents/yt-devel/yt/lagos/chainHOP/chainHOP.pyx":734
 *             # We want to remove the group tag from padded particles,
 *             # so when we return it to HaloFinding, there is no duplication.
 *             if self.is_inside[i]:             # <<<<<<<<<<<<<<
 *                 self.chainID[i] = self.reverse_map[self.chainID[i]]
 *             else:
 */
    __pyx_t_1 = PyObject_GetAttr(__pyx_v_self, __pyx_kp_is_inside); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 734; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_1);
    __pyx_1 = __Pyx_GetItemInt(__pyx_t_1, __pyx_v_i, sizeof(long), PyInt_FromLong); if (!__pyx_1) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 734; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_1);
    __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
    __pyx_t_4 = __Pyx_PyObject_IsTrue(__pyx_1); if (unlikely(__pyx_t_4 < 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 734; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_DECREF(__pyx_1); __pyx_1 = 0;
    if (__pyx_t_4) {

      /* "/Users/sskory/Documents/yt-devel/yt/lagos/chainHOP/chainHOP.pyx":735
 *             # so when we return it to HaloFinding, there is no duplication.
 *             if self.is_inside[i]:
 *                 self.chainID[i] = self.reverse_map[self.chainID[i]]             # <<<<<<<<<<<<<<
 *             else:
 *                 self.chainID[i] = -1
 */
      __pyx_t_1 = PyObject_GetAttr(__pyx_v_self, __pyx_kp_reverse_map); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 735; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_t_1);
      __pyx_t_5 = PyObject_GetAttr(__pyx_v_self, __pyx_kp_chainID); if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 735; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_t_5);
      __pyx_1 = __Pyx_GetItemInt(__pyx_t_5, __pyx_v_i, sizeof(long), PyInt_FromLong); if (!__pyx_1) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 735; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_1);
      __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
      __pyx_2 = PyObject_GetItem(__pyx_t_1, __pyx_1); if (!__pyx_2) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 735; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_2);
      __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
      __Pyx_DECREF(__pyx_1); __pyx_1 = 0;
      __pyx_t_1 = PyObject_GetAttr(__pyx_v_self, __pyx_kp_chainID); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 735; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_t_1);
      if (__Pyx_SetItemInt(__pyx_t_1, __pyx_v_i, __pyx_2, sizeof(long), PyInt_FromLong) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 735; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
      __Pyx_DECREF(__pyx_2); __pyx_2 = 0;
      goto __pyx_L9;
    }
    /*else*/ {

      /* "/Users/sskory/Documents/yt-devel/yt/lagos/chainHOP/chainHOP.pyx":737
 *                 self.chainID[i] = self.reverse_map[self.chainID[i]]
 *             else:
 *                 self.chainID[i] = -1             # <<<<<<<<<<<<<<
 *         # Create a densest_in_group, analogous to densest_in_chain.
 *         self.densest_in_group = {}
 */
      __pyx_t_1 = PyObject_GetAttr(__pyx_v_self, __pyx_kp_chainID); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 737; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_t_1);
      if (__Pyx_SetItemInt(__pyx_t_1, __pyx_v_i, __pyx_int_neg_1, sizeof(long), PyInt_FromLong) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 737; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
    }
    __pyx_L9:;
    __pyx_L6_continue:;
  }

  /* "/Users/sskory/Documents/yt-devel/yt/lagos/chainHOP/chainHOP.pyx":739
 *                 self.chainID[i] = -1
 *         # Create a densest_in_group, analogous to densest_in_chain.
 *         self.densest_in_group = {}             # <<<<<<<<<<<<<<
 *         for i in xrange(group_count):
 *             self.densest_in_group[i] = 0.0
 */
  __pyx_1 = PyDict_New(); if (unlikely(!__pyx_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 739; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(((PyObject *)__pyx_1));
  if (PyObject_SetAttr(__pyx_v_self, __pyx_kp_densest_in_group, ((PyObject *)__pyx_1)) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 739; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_DECREF(((PyObject *)__pyx_1)); __pyx_1 = 0;

  /* "/Users/sskory/Documents/yt-devel/yt/lagos/chainHOP/chainHOP.pyx":740
 *         # Create a densest_in_group, analogous to densest_in_chain.
 *         self.densest_in_group = {}
 *         for i in xrange(group_count):             # <<<<<<<<<<<<<<
 *             self.densest_in_group[i] = 0.0
 *         for chainID in self.densest_in_chain:
 */
  for (__pyx_t_3 = 0; __pyx_t_3 < __pyx_v_group_count; __pyx_t_3+=1) {
    __pyx_v_i = __pyx_t_3;

    /* "/Users/sskory/Documents/yt-devel/yt/lagos/chainHOP/chainHOP.pyx":741
 *         self.densest_in_group = {}
 *         for i in xrange(group_count):
 *             self.densest_in_group[i] = 0.0             # <<<<<<<<<<<<<<
 *         for chainID in self.densest_in_chain:
 *             groupID = self.reverse_map[chainID]
 */
    __pyx_t_1 = PyFloat_FromDouble(0.0); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 741; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_1);
    __pyx_t_5 = PyObject_GetAttr(__pyx_v_self, __pyx_kp_densest_in_group); if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 741; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_5);
    if (__Pyx_SetItemInt(__pyx_t_5, __pyx_v_i, __pyx_t_1, sizeof(long), PyInt_FromLong) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 741; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
    __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  }

  /* "/Users/sskory/Documents/yt-devel/yt/lagos/chainHOP/chainHOP.pyx":742
 *         for i in xrange(group_count):
 *             self.densest_in_group[i] = 0.0
 *         for chainID in self.densest_in_chain:             # <<<<<<<<<<<<<<
 *             groupID = self.reverse_map[chainID]
 *             if groupID == -1: continue
 */
  __pyx_t_1 = PyObject_GetAttr(__pyx_v_self, __pyx_kp_densest_in_chain); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 742; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_1);
  if (PyList_CheckExact(__pyx_t_1) || PyTuple_CheckExact(__pyx_t_1)) {
    __pyx_t_6 = 0; __pyx_t_5 = __pyx_t_1; __Pyx_INCREF(__pyx_t_5);
  } else {
    __pyx_t_6 = -1; __pyx_t_5 = PyObject_GetIter(__pyx_t_1); if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 742; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_5);
  }
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  for (;;) {
    if (likely(PyList_CheckExact(__pyx_t_5))) {
      if (__pyx_t_6 >= PyList_GET_SIZE(__pyx_t_5)) break;
      __pyx_t_1 = PyList_GET_ITEM(__pyx_t_5, __pyx_t_6); __Pyx_INCREF(__pyx_t_1); __pyx_t_6++;
    } else if (likely(PyTuple_CheckExact(__pyx_t_5))) {
      if (__pyx_t_6 >= PyTuple_GET_SIZE(__pyx_t_5)) break;
      __pyx_t_1 = PyTuple_GET_ITEM(__pyx_t_5, __pyx_t_6); __Pyx_INCREF(__pyx_t_1); __pyx_t_6++;
    } else {
      __pyx_t_1 = PyIter_Next(__pyx_t_5);
      if (!__pyx_t_1) {
        if (unlikely(PyErr_Occurred())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 742; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        break;
      }
      __Pyx_GOTREF(__pyx_t_1);
    }
    __Pyx_DECREF(__pyx_v_chainID);
    __pyx_v_chainID = __pyx_t_1;
    __pyx_t_1 = 0;

    /* "/Users/sskory/Documents/yt-devel/yt/lagos/chainHOP/chainHOP.pyx":743
 *             self.densest_in_group[i] = 0.0
 *         for chainID in self.densest_in_chain:
 *             groupID = self.reverse_map[chainID]             # <<<<<<<<<<<<<<
 *             if groupID == -1: continue
 *             max_dens = self.densest_in_chain[chainID]
 */
    __pyx_t_1 = PyObject_GetAttr(__pyx_v_self, __pyx_kp_reverse_map); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 743; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_1);
    __pyx_2 = PyObject_GetItem(__pyx_t_1, __pyx_v_chainID); if (!__pyx_2) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 743; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_2);
    __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
    __Pyx_DECREF(__pyx_v_groupID);
    __pyx_v_groupID = __pyx_2;
    __pyx_2 = 0;

    /* "/Users/sskory/Documents/yt-devel/yt/lagos/chainHOP/chainHOP.pyx":744
 *         for chainID in self.densest_in_chain:
 *             groupID = self.reverse_map[chainID]
 *             if groupID == -1: continue             # <<<<<<<<<<<<<<
 *             max_dens = self.densest_in_chain[chainID]
 *             if self.densest_in_group[groupID] < max_dens:
 */
    __pyx_t_1 = PyObject_RichCompare(__pyx_v_groupID, __pyx_int_neg_1, Py_EQ); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 744; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_1);
    __pyx_t_4 = __Pyx_PyObject_IsTrue(__pyx_t_1); if (unlikely(__pyx_t_4 < 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 744; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
    if (__pyx_t_4) {
      goto __pyx_L12_continue;
      goto __pyx_L14;
    }
    __pyx_L14:;

    /* "/Users/sskory/Documents/yt-devel/yt/lagos/chainHOP/chainHOP.pyx":745
 *             groupID = self.reverse_map[chainID]
 *             if groupID == -1: continue
 *             max_dens = self.densest_in_chain[chainID]             # <<<<<<<<<<<<<<
 *             if self.densest_in_group[groupID] < max_dens:
 *                 self.densest_in_group[groupID] = max_dens
 */
    __pyx_t_1 = PyObject_GetAttr(__pyx_v_self, __pyx_kp_densest_in_chain); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 745; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_1);
    __pyx_1 = PyObject_GetItem(__pyx_t_1, __pyx_v_chainID); if (!__pyx_1) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 745; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_1);
    __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
    __pyx_t_7 = __pyx_PyFloat_AsDouble(__pyx_1); if (unlikely(PyErr_Occurred())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 745; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_DECREF(__pyx_1); __pyx_1 = 0;
    __pyx_v_max_dens = __pyx_t_7;

    /* "/Users/sskory/Documents/yt-devel/yt/lagos/chainHOP/chainHOP.pyx":746
 *             if groupID == -1: continue
 *             max_dens = self.densest_in_chain[chainID]
 *             if self.densest_in_group[groupID] < max_dens:             # <<<<<<<<<<<<<<
 *                 self.densest_in_group[groupID] = max_dens
 * 
 */
    __pyx_t_1 = PyObject_GetAttr(__pyx_v_self, __pyx_kp_densest_in_group); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 746; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_1);
    __pyx_2 = PyObject_GetItem(__pyx_t_1, __pyx_v_groupID); if (!__pyx_2) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 746; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_2);
    __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
    __pyx_t_1 = PyFloat_FromDouble(__pyx_v_max_dens); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 746; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_1);
    __pyx_t_8 = PyObject_RichCompare(__pyx_2, __pyx_t_1, Py_LT); if (unlikely(!__pyx_t_8)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 746; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_8);
    __Pyx_DECREF(__pyx_2); __pyx_2 = 0;
    __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
    __pyx_t_4 = __Pyx_PyObject_IsTrue(__pyx_t_8); if (unlikely(__pyx_t_4 < 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 746; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
    if (__pyx_t_4) {

      /* "/Users/sskory/Documents/yt-devel/yt/lagos/chainHOP/chainHOP.pyx":747
 *             max_dens = self.densest_in_chain[chainID]
 *             if self.densest_in_group[groupID] < max_dens:
 *                 self.densest_in_group[groupID] = max_dens             # <<<<<<<<<<<<<<
 * 
 *     def _chain_hop(self):
 */
      __pyx_t_8 = PyFloat_FromDouble(__pyx_v_max_dens); if (unlikely(!__pyx_t_8)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 747; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_t_8);
      __pyx_t_1 = PyObject_GetAttr(__pyx_v_self, __pyx_kp_densest_in_group); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 747; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_t_1);
      if (PyObject_SetItem(__pyx_t_1, __pyx_v_groupID, __pyx_t_8) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 747; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
      __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
      goto __pyx_L15;
    }
    __pyx_L15:;
    __pyx_L12_continue:;
  }
  __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;

  __pyx_r = Py_None; __Pyx_INCREF(Py_None);
  goto __pyx_L0;
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_1);
  __Pyx_XDECREF(__pyx_2);
  __Pyx_XDECREF(__pyx_t_1);
  __Pyx_XDECREF(__pyx_t_5);
  __Pyx_XDECREF(__pyx_t_8);
  __Pyx_AddTraceback("yt.lagos.chainHOP.chainHOP.RunChainHOP._translate_groupIDs");
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_DECREF(__pyx_v_chainID);
  __Pyx_DECREF(__pyx_v_groupID);
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_FinishRefcountContext();
  return __pyx_r;
}

/* "/Users/sskory/Documents/yt-devel/yt/lagos/chainHOP/chainHOP.pyx":749
 *                 self.densest_in_group[groupID] = max_dens
 * 
 *     def _chain_hop(self):             # <<<<<<<<<<<<<<
 *         mylog.info("Running Cython version.")
 *         mylog.info('Building kd tree for %d particles...' % \
 */

static PyObject *__pyx_pf_2yt_5lagos_8chainHOP_8chainHOP_11RunChainHOP__chain_hop(PyObject *__pyx_self, PyObject *__pyx_v_self); /*proto*/
static PyMethodDef __pyx_mdef_2yt_5lagos_8chainHOP_8chainHOP_11RunChainHOP__chain_hop = {__Pyx_NAMESTR("_chain_hop"), (PyCFunction)__pyx_pf_2yt_5lagos_8chainHOP_8chainHOP_11RunChainHOP__chain_hop, METH_O, __Pyx_DOCSTR(0)};
static PyObject *__pyx_pf_2yt_5lagos_8chainHOP_8chainHOP_11RunChainHOP__chain_hop(PyObject *__pyx_self, PyObject *__pyx_v_self) {
  PyObject *__pyx_v_count;
  PyObject *__pyx_v_chain_count;
  PyObject *__pyx_v_group_count;
  PyObject *__pyx_r = NULL;
  PyObject *__pyx_1 = 0;
  PyObject *__pyx_t_1 = NULL;
  PyObject *__pyx_t_2 = NULL;
  PyObject *__pyx_t_3 = NULL;
  PyObject *__pyx_t_4 = NULL;
  Py_ssize_t __pyx_t_5;
  __Pyx_SetupRefcountContext("_chain_hop");
  __pyx_self = __pyx_self;
  __pyx_v_count = Py_None; __Pyx_INCREF(Py_None);
  __pyx_v_chain_count = Py_None; __Pyx_INCREF(Py_None);
  __pyx_v_group_count = Py_None; __Pyx_INCREF(Py_None);

  /* "/Users/sskory/Documents/yt-devel/yt/lagos/chainHOP/chainHOP.pyx":750
 * 
 *     def _chain_hop(self):
 *         mylog.info("Running Cython version.")             # <<<<<<<<<<<<<<
 *         mylog.info('Building kd tree for %d particles...' % \
 *             self.size)
 */
  __pyx_1 = __Pyx_GetName(__pyx_m, __pyx_kp_mylog); if (unlikely(!__pyx_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 750; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_1);
  __pyx_t_1 = PyObject_GetAttr(__pyx_1, __pyx_kp_info); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 750; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_DECREF(__pyx_1); __pyx_1 = 0;
  __pyx_t_2 = PyTuple_New(1); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 750; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(((PyObject *)__pyx_t_2));
  __Pyx_INCREF(__pyx_kp_70);
  PyTuple_SET_ITEM(__pyx_t_2, 0, __pyx_kp_70);
  __Pyx_GIVEREF(__pyx_kp_70);
  __pyx_t_3 = PyObject_Call(__pyx_t_1, ((PyObject *)__pyx_t_2), NULL); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 750; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_3);
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  __Pyx_DECREF(((PyObject *)__pyx_t_2)); __pyx_t_2 = 0;
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;

  /* "/Users/sskory/Documents/yt-devel/yt/lagos/chainHOP/chainHOP.pyx":751
 *     def _chain_hop(self):
 *         mylog.info("Running Cython version.")
 *         mylog.info('Building kd tree for %d particles...' % \             # <<<<<<<<<<<<<<
 *             self.size)
 *         self._init_kd_tree()
 */
  __pyx_1 = __Pyx_GetName(__pyx_m, __pyx_kp_mylog); if (unlikely(!__pyx_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 751; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_1);
  __pyx_t_3 = PyObject_GetAttr(__pyx_1, __pyx_kp_info); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 751; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_3);
  __Pyx_DECREF(__pyx_1); __pyx_1 = 0;

  /* "/Users/sskory/Documents/yt-devel/yt/lagos/chainHOP/chainHOP.pyx":752
 *         mylog.info("Running Cython version.")
 *         mylog.info('Building kd tree for %d particles...' % \
 *             self.size)             # <<<<<<<<<<<<<<
 *         self._init_kd_tree()
 *         # Mark particles in as being in/out of the domain.
 */
  __pyx_t_2 = PyObject_GetAttr(__pyx_v_self, __pyx_kp_size); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 752; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_2);
  __pyx_t_1 = PyNumber_Remainder(__pyx_kp_71, __pyx_t_2); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 751; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_t_2 = PyTuple_New(1); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 751; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(((PyObject *)__pyx_t_2));
  PyTuple_SET_ITEM(__pyx_t_2, 0, __pyx_t_1);
  __Pyx_GIVEREF(__pyx_t_1);
  __pyx_t_1 = 0;
  __pyx_t_1 = PyObject_Call(__pyx_t_3, ((PyObject *)__pyx_t_2), NULL); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 751; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  __Pyx_DECREF(((PyObject *)__pyx_t_2)); __pyx_t_2 = 0;
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;

  /* "/Users/sskory/Documents/yt-devel/yt/lagos/chainHOP/chainHOP.pyx":753
 *         mylog.info('Building kd tree for %d particles...' % \
 *             self.size)
 *         self._init_kd_tree()             # <<<<<<<<<<<<<<
 *         # Mark particles in as being in/out of the domain.
 *         self._is_inside()
 */
  __pyx_t_1 = PyObject_GetAttr(__pyx_v_self, __pyx_kp__init_kd_tree); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 753; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_t_2 = PyObject_Call(__pyx_t_1, ((PyObject *)__pyx_empty_tuple), NULL); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 753; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_2);
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;

  /* "/Users/sskory/Documents/yt-devel/yt/lagos/chainHOP/chainHOP.pyx":755
 *         self._init_kd_tree()
 *         # Mark particles in as being in/out of the domain.
 *         self._is_inside()             # <<<<<<<<<<<<<<
 *         # Loop over the particles to find NN for each.
 *         mylog.info('Finding nearest neighbors/density...')
 */
  __pyx_t_2 = PyObject_GetAttr(__pyx_v_self, __pyx_kp__is_inside); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 755; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_2);
  __pyx_t_1 = PyObject_Call(__pyx_t_2, ((PyObject *)__pyx_empty_tuple), NULL); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 755; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;

  /* "/Users/sskory/Documents/yt-devel/yt/lagos/chainHOP/chainHOP.pyx":757
 *         self._is_inside()
 *         # Loop over the particles to find NN for each.
 *         mylog.info('Finding nearest neighbors/density...')             # <<<<<<<<<<<<<<
 *         chainHOP_tags_dens()
 *         self.density = fKD.dens
 */
  __pyx_1 = __Pyx_GetName(__pyx_m, __pyx_kp_mylog); if (unlikely(!__pyx_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 757; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_1);
  __pyx_t_1 = PyObject_GetAttr(__pyx_1, __pyx_kp_info); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 757; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_DECREF(__pyx_1); __pyx_1 = 0;
  __pyx_t_2 = PyTuple_New(1); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 757; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(((PyObject *)__pyx_t_2));
  __Pyx_INCREF(__pyx_kp_72);
  PyTuple_SET_ITEM(__pyx_t_2, 0, __pyx_kp_72);
  __Pyx_GIVEREF(__pyx_kp_72);
  __pyx_t_3 = PyObject_Call(__pyx_t_1, ((PyObject *)__pyx_t_2), NULL); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 757; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_3);
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  __Pyx_DECREF(((PyObject *)__pyx_t_2)); __pyx_t_2 = 0;
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;

  /* "/Users/sskory/Documents/yt-devel/yt/lagos/chainHOP/chainHOP.pyx":758
 *         # Loop over the particles to find NN for each.
 *         mylog.info('Finding nearest neighbors/density...')
 *         chainHOP_tags_dens()             # <<<<<<<<<<<<<<
 *         self.density = fKD.dens
 *         self.NNtags = (fKD.nn_tags - 1).transpose()
 */
  __pyx_1 = __Pyx_GetName(__pyx_m, __pyx_kp_chainHOP_tags_dens); if (unlikely(!__pyx_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 758; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_1);
  __pyx_t_3 = PyObject_Call(__pyx_1, ((PyObject *)__pyx_empty_tuple), NULL); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 758; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_3);
  __Pyx_DECREF(__pyx_1); __pyx_1 = 0;
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;

  /* "/Users/sskory/Documents/yt-devel/yt/lagos/chainHOP/chainHOP.pyx":759
 *         mylog.info('Finding nearest neighbors/density...')
 *         chainHOP_tags_dens()
 *         self.density = fKD.dens             # <<<<<<<<<<<<<<
 *         self.NNtags = (fKD.nn_tags - 1).transpose()
 *         count = len(na.where(self.density >= self.threshold)[0])
 */
  __pyx_1 = __Pyx_GetName(__pyx_m, __pyx_kp_fKD); if (unlikely(!__pyx_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 759; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_1);
  __pyx_t_3 = PyObject_GetAttr(__pyx_1, __pyx_kp_dens); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 759; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_3);
  __Pyx_DECREF(__pyx_1); __pyx_1 = 0;
  if (PyObject_SetAttr(__pyx_v_self, __pyx_kp_density, __pyx_t_3) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 759; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;

  /* "/Users/sskory/Documents/yt-devel/yt/lagos/chainHOP/chainHOP.pyx":760
 *         chainHOP_tags_dens()
 *         self.density = fKD.dens
 *         self.NNtags = (fKD.nn_tags - 1).transpose()             # <<<<<<<<<<<<<<
 *         count = len(na.where(self.density >= self.threshold)[0])
 *         print 'count above thresh', count
 */
  __pyx_1 = __Pyx_GetName(__pyx_m, __pyx_kp_fKD); if (unlikely(!__pyx_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 760; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_1);
  __pyx_t_3 = PyObject_GetAttr(__pyx_1, __pyx_kp_nn_tags); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 760; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_3);
  __Pyx_DECREF(__pyx_1); __pyx_1 = 0;
  __pyx_t_2 = PyNumber_Subtract(__pyx_t_3, __pyx_int_1); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 760; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_2);
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  __pyx_t_3 = PyObject_GetAttr(__pyx_t_2, __pyx_kp_transpose); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 760; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_3);
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_t_2 = PyObject_Call(__pyx_t_3, ((PyObject *)__pyx_empty_tuple), NULL); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 760; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_2);
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  if (PyObject_SetAttr(__pyx_v_self, __pyx_kp_NNtags, __pyx_t_2) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 760; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;

  /* "/Users/sskory/Documents/yt-devel/yt/lagos/chainHOP/chainHOP.pyx":761
 *         self.density = fKD.dens
 *         self.NNtags = (fKD.nn_tags - 1).transpose()
 *         count = len(na.where(self.density >= self.threshold)[0])             # <<<<<<<<<<<<<<
 *         print 'count above thresh', count
 *         # Now each particle has NNtags, and a local self density.
 */
  __pyx_1 = __Pyx_GetName(__pyx_m, __pyx_kp_na); if (unlikely(!__pyx_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 761; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_1);
  __pyx_t_2 = PyObject_GetAttr(__pyx_1, __pyx_kp_where); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 761; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_2);
  __Pyx_DECREF(__pyx_1); __pyx_1 = 0;
  __pyx_t_3 = PyObject_GetAttr(__pyx_v_self, __pyx_kp_density); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 761; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_3);
  __pyx_t_1 = PyObject_GetAttr(__pyx_v_self, __pyx_kp_threshold); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 761; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_t_4 = PyObject_RichCompare(__pyx_t_3, __pyx_t_1, Py_GE); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 761; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_4);
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_t_1 = PyTuple_New(1); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 761; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(((PyObject *)__pyx_t_1));
  PyTuple_SET_ITEM(__pyx_t_1, 0, __pyx_t_4);
  __Pyx_GIVEREF(__pyx_t_4);
  __pyx_t_4 = 0;
  __pyx_t_4 = PyObject_Call(__pyx_t_2, ((PyObject *)__pyx_t_1), NULL); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 761; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_4);
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __Pyx_DECREF(((PyObject *)__pyx_t_1)); __pyx_t_1 = 0;
  __pyx_1 = __Pyx_GetItemInt(__pyx_t_4, 0, sizeof(long), PyInt_FromLong); if (!__pyx_1) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 761; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_1);
  __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
  __pyx_t_5 = PyObject_Length(__pyx_1); if (unlikely(__pyx_t_5 == -1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 761; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_DECREF(__pyx_1); __pyx_1 = 0;
  __pyx_t_4 = PyInt_FromSsize_t(__pyx_t_5); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 761; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_4);
  __Pyx_DECREF(__pyx_v_count);
  __pyx_v_count = __pyx_t_4;
  __pyx_t_4 = 0;

  /* "/Users/sskory/Documents/yt-devel/yt/lagos/chainHOP/chainHOP.pyx":762
 *         self.NNtags = (fKD.nn_tags - 1).transpose()
 *         count = len(na.where(self.density >= self.threshold)[0])
 *         print 'count above thresh', count             # <<<<<<<<<<<<<<
 *         # Now each particle has NNtags, and a local self density.
 *         # Let's find densest NN
 */
  __pyx_t_4 = PyTuple_New(2); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 762; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(((PyObject *)__pyx_t_4));
  __Pyx_INCREF(__pyx_kp_73);
  PyTuple_SET_ITEM(__pyx_t_4, 0, __pyx_kp_73);
  __Pyx_GIVEREF(__pyx_kp_73);
  __Pyx_INCREF(__pyx_v_count);
  PyTuple_SET_ITEM(__pyx_t_4, 1, __pyx_v_count);
  __Pyx_GIVEREF(__pyx_v_count);
  if (__Pyx_Print(((PyObject *)__pyx_t_4), 1) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 762; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_DECREF(((PyObject *)__pyx_t_4)); __pyx_t_4 = 0;

  /* "/Users/sskory/Documents/yt-devel/yt/lagos/chainHOP/chainHOP.pyx":765
 *         # Now each particle has NNtags, and a local self density.
 *         # Let's find densest NN
 *         mylog.info('Finding densest nearest neighbors...')             # <<<<<<<<<<<<<<
 *         self._densestNN()
 *         # Now we can free these.
 */
  __pyx_1 = __Pyx_GetName(__pyx_m, __pyx_kp_mylog); if (unlikely(!__pyx_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 765; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_1);
  __pyx_t_4 = PyObject_GetAttr(__pyx_1, __pyx_kp_info); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 765; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_4);
  __Pyx_DECREF(__pyx_1); __pyx_1 = 0;
  __pyx_t_1 = PyTuple_New(1); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 765; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(((PyObject *)__pyx_t_1));
  __Pyx_INCREF(__pyx_kp_74);
  PyTuple_SET_ITEM(__pyx_t_1, 0, __pyx_kp_74);
  __Pyx_GIVEREF(__pyx_kp_74);
  __pyx_t_2 = PyObject_Call(__pyx_t_4, ((PyObject *)__pyx_t_1), NULL); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 765; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_2);
  __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
  __Pyx_DECREF(((PyObject *)__pyx_t_1)); __pyx_t_1 = 0;
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;

  /* "/Users/sskory/Documents/yt-devel/yt/lagos/chainHOP/chainHOP.pyx":766
 *         # Let's find densest NN
 *         mylog.info('Finding densest nearest neighbors...')
 *         self._densestNN()             # <<<<<<<<<<<<<<
 *         # Now we can free these.
 *         free_tree() # Frees the kdtree object.
 */
  __pyx_t_2 = PyObject_GetAttr(__pyx_v_self, __pyx_kp__densestNN); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 766; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_2);
  __pyx_t_1 = PyObject_Call(__pyx_t_2, ((PyObject *)__pyx_empty_tuple), NULL); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 766; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;

  /* "/Users/sskory/Documents/yt-devel/yt/lagos/chainHOP/chainHOP.pyx":768
 *         self._densestNN()
 *         # Now we can free these.
 *         free_tree() # Frees the kdtree object.             # <<<<<<<<<<<<<<
 *         # Build the chain of links.
 *         mylog.info('Building particle chains...')
 */
  __pyx_1 = __Pyx_GetName(__pyx_m, __pyx_kp_free_tree); if (unlikely(!__pyx_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 768; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_1);
  __pyx_t_1 = PyObject_Call(__pyx_1, ((PyObject *)__pyx_empty_tuple), NULL); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 768; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_DECREF(__pyx_1); __pyx_1 = 0;
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;

  /* "/Users/sskory/Documents/yt-devel/yt/lagos/chainHOP/chainHOP.pyx":770
 *         free_tree() # Frees the kdtree object.
 *         # Build the chain of links.
 *         mylog.info('Building particle chains...')             # <<<<<<<<<<<<<<
 *         chain_count = self._build_chains()
 *         mylog.info('Gobally assigning chainIDs...')
 */
  __pyx_1 = __Pyx_GetName(__pyx_m, __pyx_kp_mylog); if (unlikely(!__pyx_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 770; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_1);
  __pyx_t_1 = PyObject_GetAttr(__pyx_1, __pyx_kp_info); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 770; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_DECREF(__pyx_1); __pyx_1 = 0;
  __pyx_t_2 = PyTuple_New(1); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 770; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(((PyObject *)__pyx_t_2));
  __Pyx_INCREF(__pyx_kp_75);
  PyTuple_SET_ITEM(__pyx_t_2, 0, __pyx_kp_75);
  __Pyx_GIVEREF(__pyx_kp_75);
  __pyx_t_4 = PyObject_Call(__pyx_t_1, ((PyObject *)__pyx_t_2), NULL); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 770; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_4);
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  __Pyx_DECREF(((PyObject *)__pyx_t_2)); __pyx_t_2 = 0;
  __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;

  /* "/Users/sskory/Documents/yt-devel/yt/lagos/chainHOP/chainHOP.pyx":771
 *         # Build the chain of links.
 *         mylog.info('Building particle chains...')
 *         chain_count = self._build_chains()             # <<<<<<<<<<<<<<
 *         mylog.info('Gobally assigning chainIDs...')
 *         self._globally_assign_chainIDs(chain_count)
 */
  __pyx_t_4 = PyObject_GetAttr(__pyx_v_self, __pyx_kp__build_chains); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 771; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_4);
  __pyx_t_2 = PyObject_Call(__pyx_t_4, ((PyObject *)__pyx_empty_tuple), NULL); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 771; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_2);
  __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
  __Pyx_DECREF(__pyx_v_chain_count);
  __pyx_v_chain_count = __pyx_t_2;
  __pyx_t_2 = 0;

  /* "/Users/sskory/Documents/yt-devel/yt/lagos/chainHOP/chainHOP.pyx":772
 *         mylog.info('Building particle chains...')
 *         chain_count = self._build_chains()
 *         mylog.info('Gobally assigning chainIDs...')             # <<<<<<<<<<<<<<
 *         self._globally_assign_chainIDs(chain_count)
 *         mylog.info('Globally finding densest in chains...')
 */
  __pyx_1 = __Pyx_GetName(__pyx_m, __pyx_kp_mylog); if (unlikely(!__pyx_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 772; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_1);
  __pyx_t_2 = PyObject_GetAttr(__pyx_1, __pyx_kp_info); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 772; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_2);
  __Pyx_DECREF(__pyx_1); __pyx_1 = 0;
  __pyx_t_4 = PyTuple_New(1); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 772; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(((PyObject *)__pyx_t_4));
  __Pyx_INCREF(__pyx_kp_76);
  PyTuple_SET_ITEM(__pyx_t_4, 0, __pyx_kp_76);
  __Pyx_GIVEREF(__pyx_kp_76);
  __pyx_t_1 = PyObject_Call(__pyx_t_2, ((PyObject *)__pyx_t_4), NULL); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 772; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __Pyx_DECREF(((PyObject *)__pyx_t_4)); __pyx_t_4 = 0;
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;

  /* "/Users/sskory/Documents/yt-devel/yt/lagos/chainHOP/chainHOP.pyx":773
 *         chain_count = self._build_chains()
 *         mylog.info('Gobally assigning chainIDs...')
 *         self._globally_assign_chainIDs(chain_count)             # <<<<<<<<<<<<<<
 *         mylog.info('Globally finding densest in chains...')
 *         self._create_global_densest_in_chain()
 */
  __pyx_t_1 = PyObject_GetAttr(__pyx_v_self, __pyx_kp_38); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 773; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_t_4 = PyTuple_New(1); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 773; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(((PyObject *)__pyx_t_4));
  __Pyx_INCREF(__pyx_v_chain_count);
  PyTuple_SET_ITEM(__pyx_t_4, 0, __pyx_v_chain_count);
  __Pyx_GIVEREF(__pyx_v_chain_count);
  __pyx_t_2 = PyObject_Call(__pyx_t_1, ((PyObject *)__pyx_t_4), NULL); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 773; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_2);
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  __Pyx_DECREF(((PyObject *)__pyx_t_4)); __pyx_t_4 = 0;
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;

  /* "/Users/sskory/Documents/yt-devel/yt/lagos/chainHOP/chainHOP.pyx":774
 *         mylog.info('Gobally assigning chainIDs...')
 *         self._globally_assign_chainIDs(chain_count)
 *         mylog.info('Globally finding densest in chains...')             # <<<<<<<<<<<<<<
 *         self._create_global_densest_in_chain()
 *         mylog.info('Building chain connections across tasks...')
 */
  __pyx_1 = __Pyx_GetName(__pyx_m, __pyx_kp_mylog); if (unlikely(!__pyx_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 774; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_1);
  __pyx_t_2 = PyObject_GetAttr(__pyx_1, __pyx_kp_info); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 774; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_2);
  __Pyx_DECREF(__pyx_1); __pyx_1 = 0;
  __pyx_t_4 = PyTuple_New(1); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 774; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(((PyObject *)__pyx_t_4));
  __Pyx_INCREF(__pyx_kp_77);
  PyTuple_SET_ITEM(__pyx_t_4, 0, __pyx_kp_77);
  __Pyx_GIVEREF(__pyx_kp_77);
  __pyx_t_1 = PyObject_Call(__pyx_t_2, ((PyObject *)__pyx_t_4), NULL); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 774; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __Pyx_DECREF(((PyObject *)__pyx_t_4)); __pyx_t_4 = 0;
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;

  /* "/Users/sskory/Documents/yt-devel/yt/lagos/chainHOP/chainHOP.pyx":775
 *         self._globally_assign_chainIDs(chain_count)
 *         mylog.info('Globally finding densest in chains...')
 *         self._create_global_densest_in_chain()             # <<<<<<<<<<<<<<
 *         mylog.info('Building chain connections across tasks...')
 *         self._connect_chains_across_tasks()
 */
  __pyx_t_1 = PyObject_GetAttr(__pyx_v_self, __pyx_kp_39); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 775; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_t_4 = PyObject_Call(__pyx_t_1, ((PyObject *)__pyx_empty_tuple), NULL); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 775; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_4);
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;

  /* "/Users/sskory/Documents/yt-devel/yt/lagos/chainHOP/chainHOP.pyx":776
 *         mylog.info('Globally finding densest in chains...')
 *         self._create_global_densest_in_chain()
 *         mylog.info('Building chain connections across tasks...')             # <<<<<<<<<<<<<<
 *         self._connect_chains_across_tasks()
 *         mylog.info('Communicating connected chains...')
 */
  __pyx_1 = __Pyx_GetName(__pyx_m, __pyx_kp_mylog); if (unlikely(!__pyx_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 776; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_1);
  __pyx_t_4 = PyObject_GetAttr(__pyx_1, __pyx_kp_info); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 776; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_4);
  __Pyx_DECREF(__pyx_1); __pyx_1 = 0;
  __pyx_t_1 = PyTuple_New(1); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 776; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(((PyObject *)__pyx_t_1));
  __Pyx_INCREF(__pyx_kp_78);
  PyTuple_SET_ITEM(__pyx_t_1, 0, __pyx_kp_78);
  __Pyx_GIVEREF(__pyx_kp_78);
  __pyx_t_2 = PyObject_Call(__pyx_t_4, ((PyObject *)__pyx_t_1), NULL); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 776; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_2);
  __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
  __Pyx_DECREF(((PyObject *)__pyx_t_1)); __pyx_t_1 = 0;
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;

  /* "/Users/sskory/Documents/yt-devel/yt/lagos/chainHOP/chainHOP.pyx":777
 *         self._create_global_densest_in_chain()
 *         mylog.info('Building chain connections across tasks...')
 *         self._connect_chains_across_tasks()             # <<<<<<<<<<<<<<
 *         mylog.info('Communicating connected chains...')
 *         self._communicate_annulus_chainIDs()
 */
  __pyx_t_2 = PyObject_GetAttr(__pyx_v_self, __pyx_kp_42); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 777; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_2);
  __pyx_t_1 = PyObject_Call(__pyx_t_2, ((PyObject *)__pyx_empty_tuple), NULL); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 777; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;

  /* "/Users/sskory/Documents/yt-devel/yt/lagos/chainHOP/chainHOP.pyx":778
 *         mylog.info('Building chain connections across tasks...')
 *         self._connect_chains_across_tasks()
 *         mylog.info('Communicating connected chains...')             # <<<<<<<<<<<<<<
 *         self._communicate_annulus_chainIDs()
 *         mylog.info('Connecting %d chains into groups...' % self.nchains)
 */
  __pyx_1 = __Pyx_GetName(__pyx_m, __pyx_kp_mylog); if (unlikely(!__pyx_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 778; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_1);
  __pyx_t_1 = PyObject_GetAttr(__pyx_1, __pyx_kp_info); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 778; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_DECREF(__pyx_1); __pyx_1 = 0;
  __pyx_t_2 = PyTuple_New(1); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 778; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(((PyObject *)__pyx_t_2));
  __Pyx_INCREF(__pyx_kp_79);
  PyTuple_SET_ITEM(__pyx_t_2, 0, __pyx_kp_79);
  __Pyx_GIVEREF(__pyx_kp_79);
  __pyx_t_4 = PyObject_Call(__pyx_t_1, ((PyObject *)__pyx_t_2), NULL); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 778; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_4);
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  __Pyx_DECREF(((PyObject *)__pyx_t_2)); __pyx_t_2 = 0;
  __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;

  /* "/Users/sskory/Documents/yt-devel/yt/lagos/chainHOP/chainHOP.pyx":779
 *         self._connect_chains_across_tasks()
 *         mylog.info('Communicating connected chains...')
 *         self._communicate_annulus_chainIDs()             # <<<<<<<<<<<<<<
 *         mylog.info('Connecting %d chains into groups...' % self.nchains)
 *         self._connect_chains()
 */
  __pyx_t_4 = PyObject_GetAttr(__pyx_v_self, __pyx_kp_43); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 779; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_4);
  __pyx_t_2 = PyObject_Call(__pyx_t_4, ((PyObject *)__pyx_empty_tuple), NULL); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 779; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_2);
  __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;

  /* "/Users/sskory/Documents/yt-devel/yt/lagos/chainHOP/chainHOP.pyx":780
 *         mylog.info('Communicating connected chains...')
 *         self._communicate_annulus_chainIDs()
 *         mylog.info('Connecting %d chains into groups...' % self.nchains)             # <<<<<<<<<<<<<<
 *         self._connect_chains()
 *         mylog.info('Communicating group links globally...')
 */
  __pyx_1 = __Pyx_GetName(__pyx_m, __pyx_kp_mylog); if (unlikely(!__pyx_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 780; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_1);
  __pyx_t_2 = PyObject_GetAttr(__pyx_1, __pyx_kp_info); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 780; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_2);
  __Pyx_DECREF(__pyx_1); __pyx_1 = 0;
  __pyx_t_4 = PyObject_GetAttr(__pyx_v_self, __pyx_kp_nchains); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 780; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_4);
  __pyx_t_1 = PyNumber_Remainder(__pyx_kp_80, __pyx_t_4); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 780; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
  __pyx_t_4 = PyTuple_New(1); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 780; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(((PyObject *)__pyx_t_4));
  PyTuple_SET_ITEM(__pyx_t_4, 0, __pyx_t_1);
  __Pyx_GIVEREF(__pyx_t_1);
  __pyx_t_1 = 0;
  __pyx_t_1 = PyObject_Call(__pyx_t_2, ((PyObject *)__pyx_t_4), NULL); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 780; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __Pyx_DECREF(((PyObject *)__pyx_t_4)); __pyx_t_4 = 0;
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;

  /* "/Users/sskory/Documents/yt-devel/yt/lagos/chainHOP/chainHOP.pyx":781
 *         self._communicate_annulus_chainIDs()
 *         mylog.info('Connecting %d chains into groups...' % self.nchains)
 *         self._connect_chains()             # <<<<<<<<<<<<<<
 *         mylog.info('Communicating group links globally...')
 *         self._make_global_chain_densest_n()
 */
  __pyx_t_1 = PyObject_GetAttr(__pyx_v_self, __pyx_kp__connect_chains); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 781; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_t_4 = PyObject_Call(__pyx_t_1, ((PyObject *)__pyx_empty_tuple), NULL); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 781; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_4);
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;

  /* "/Users/sskory/Documents/yt-devel/yt/lagos/chainHOP/chainHOP.pyx":782
 *         mylog.info('Connecting %d chains into groups...' % self.nchains)
 *         self._connect_chains()
 *         mylog.info('Communicating group links globally...')             # <<<<<<<<<<<<<<
 *         self._make_global_chain_densest_n()
 *         mylog.info('Building final groups...')
 */
  __pyx_1 = __Pyx_GetName(__pyx_m, __pyx_kp_mylog); if (unlikely(!__pyx_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 782; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_1);
  __pyx_t_4 = PyObject_GetAttr(__pyx_1, __pyx_kp_info); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 782; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_4);
  __Pyx_DECREF(__pyx_1); __pyx_1 = 0;
  __pyx_t_1 = PyTuple_New(1); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 782; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(((PyObject *)__pyx_t_1));
  __Pyx_INCREF(__pyx_kp_81);
  PyTuple_SET_ITEM(__pyx_t_1, 0, __pyx_kp_81);
  __Pyx_GIVEREF(__pyx_kp_81);
  __pyx_t_2 = PyObject_Call(__pyx_t_4, ((PyObject *)__pyx_t_1), NULL); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 782; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_2);
  __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
  __Pyx_DECREF(((PyObject *)__pyx_t_1)); __pyx_t_1 = 0;
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;

  /* "/Users/sskory/Documents/yt-devel/yt/lagos/chainHOP/chainHOP.pyx":783
 *         self._connect_chains()
 *         mylog.info('Communicating group links globally...')
 *         self._make_global_chain_densest_n()             # <<<<<<<<<<<<<<
 *         mylog.info('Building final groups...')
 *         group_count = self._build_groups()
 */
  __pyx_t_2 = PyObject_GetAttr(__pyx_v_self, __pyx_kp_44); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 783; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_2);
  __pyx_t_1 = PyObject_Call(__pyx_t_2, ((PyObject *)__pyx_empty_tuple), NULL); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 783; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;

  /* "/Users/sskory/Documents/yt-devel/yt/lagos/chainHOP/chainHOP.pyx":784
 *         mylog.info('Communicating group links globally...')
 *         self._make_global_chain_densest_n()
 *         mylog.info('Building final groups...')             # <<<<<<<<<<<<<<
 *         group_count = self._build_groups()
 *         self.group_count = group_count
 */
  __pyx_1 = __Pyx_GetName(__pyx_m, __pyx_kp_mylog); if (unlikely(!__pyx_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 784; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_1);
  __pyx_t_1 = PyObject_GetAttr(__pyx_1, __pyx_kp_info); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 784; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_DECREF(__pyx_1); __pyx_1 = 0;
  __pyx_t_2 = PyTuple_New(1); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 784; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(((PyObject *)__pyx_t_2));
  __Pyx_INCREF(__pyx_kp_82);
  PyTuple_SET_ITEM(__pyx_t_2, 0, __pyx_kp_82);
  __Pyx_GIVEREF(__pyx_kp_82);
  __pyx_t_4 = PyObject_Call(__pyx_t_1, ((PyObject *)__pyx_t_2), NULL); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 784; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_4);
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  __Pyx_DECREF(((PyObject *)__pyx_t_2)); __pyx_t_2 = 0;
  __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;

  /* "/Users/sskory/Documents/yt-devel/yt/lagos/chainHOP/chainHOP.pyx":785
 *         self._make_global_chain_densest_n()
 *         mylog.info('Building final groups...')
 *         group_count = self._build_groups()             # <<<<<<<<<<<<<<
 *         self.group_count = group_count
 *         mylog.info('Remapping particles to final groups...')
 */
  __pyx_t_4 = PyObject_GetAttr(__pyx_v_self, __pyx_kp__build_groups); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 785; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_4);
  __pyx_t_2 = PyObject_Call(__pyx_t_4, ((PyObject *)__pyx_empty_tuple), NULL); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 785; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_2);
  __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
  __Pyx_DECREF(__pyx_v_group_count);
  __pyx_v_group_count = __pyx_t_2;
  __pyx_t_2 = 0;

  /* "/Users/sskory/Documents/yt-devel/yt/lagos/chainHOP/chainHOP.pyx":786
 *         mylog.info('Building final groups...')
 *         group_count = self._build_groups()
 *         self.group_count = group_count             # <<<<<<<<<<<<<<
 *         mylog.info('Remapping particles to final groups...')
 *         self._translate_groupIDs(group_count)
 */
  if (PyObject_SetAttr(__pyx_v_self, __pyx_kp_group_count, __pyx_v_group_count) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 786; __pyx_clineno = __LINE__; goto __pyx_L1_error;}

  /* "/Users/sskory/Documents/yt-devel/yt/lagos/chainHOP/chainHOP.pyx":787
 *         group_count = self._build_groups()
 *         self.group_count = group_count
 *         mylog.info('Remapping particles to final groups...')             # <<<<<<<<<<<<<<
 *         self._translate_groupIDs(group_count)
 *         mylog.info('Found %d groups...' % group_count)
 */
  __pyx_1 = __Pyx_GetName(__pyx_m, __pyx_kp_mylog); if (unlikely(!__pyx_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 787; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_1);
  __pyx_t_2 = PyObject_GetAttr(__pyx_1, __pyx_kp_info); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 787; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_2);
  __Pyx_DECREF(__pyx_1); __pyx_1 = 0;
  __pyx_t_4 = PyTuple_New(1); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 787; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(((PyObject *)__pyx_t_4));
  __Pyx_INCREF(__pyx_kp_83);
  PyTuple_SET_ITEM(__pyx_t_4, 0, __pyx_kp_83);
  __Pyx_GIVEREF(__pyx_kp_83);
  __pyx_t_1 = PyObject_Call(__pyx_t_2, ((PyObject *)__pyx_t_4), NULL); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 787; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __Pyx_DECREF(((PyObject *)__pyx_t_4)); __pyx_t_4 = 0;
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;

  /* "/Users/sskory/Documents/yt-devel/yt/lagos/chainHOP/chainHOP.pyx":788
 *         self.group_count = group_count
 *         mylog.info('Remapping particles to final groups...')
 *         self._translate_groupIDs(group_count)             # <<<<<<<<<<<<<<
 *         mylog.info('Found %d groups...' % group_count)
 * 
 */
  __pyx_t_1 = PyObject_GetAttr(__pyx_v_self, __pyx_kp__translate_groupIDs); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 788; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_t_4 = PyTuple_New(1); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 788; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(((PyObject *)__pyx_t_4));
  __Pyx_INCREF(__pyx_v_group_count);
  PyTuple_SET_ITEM(__pyx_t_4, 0, __pyx_v_group_count);
  __Pyx_GIVEREF(__pyx_v_group_count);
  __pyx_t_2 = PyObject_Call(__pyx_t_1, ((PyObject *)__pyx_t_4), NULL); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 788; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_2);
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  __Pyx_DECREF(((PyObject *)__pyx_t_4)); __pyx_t_4 = 0;
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;

  /* "/Users/sskory/Documents/yt-devel/yt/lagos/chainHOP/chainHOP.pyx":789
 *         mylog.info('Remapping particles to final groups...')
 *         self._translate_groupIDs(group_count)
 *         mylog.info('Found %d groups...' % group_count)             # <<<<<<<<<<<<<<
 * 
 */
  __pyx_1 = __Pyx_GetName(__pyx_m, __pyx_kp_mylog); if (unlikely(!__pyx_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 789; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_1);
  __pyx_t_2 = PyObject_GetAttr(__pyx_1, __pyx_kp_info); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 789; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_2);
  __Pyx_DECREF(__pyx_1); __pyx_1 = 0;
  __pyx_t_4 = PyNumber_Remainder(__pyx_kp_84, __pyx_v_group_count); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 789; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_4);
  __pyx_t_1 = PyTuple_New(1); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 789; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(((PyObject *)__pyx_t_1));
  PyTuple_SET_ITEM(__pyx_t_1, 0, __pyx_t_4);
  __Pyx_GIVEREF(__pyx_t_4);
  __pyx_t_4 = 0;
  __pyx_t_4 = PyObject_Call(__pyx_t_2, ((PyObject *)__pyx_t_1), NULL); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 789; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_4);
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __Pyx_DECREF(((PyObject *)__pyx_t_1)); __pyx_t_1 = 0;
  __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;

  __pyx_r = Py_None; __Pyx_INCREF(Py_None);
  goto __pyx_L0;
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_1);
  __Pyx_XDECREF(__pyx_t_1);
  __Pyx_XDECREF(__pyx_t_2);
  __Pyx_XDECREF(__pyx_t_3);
  __Pyx_XDECREF(__pyx_t_4);
  __Pyx_AddTraceback("yt.lagos.chainHOP.chainHOP.RunChainHOP._chain_hop");
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_DECREF(__pyx_v_count);
  __Pyx_DECREF(__pyx_v_chain_count);
  __Pyx_DECREF(__pyx_v_group_count);
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_FinishRefcountContext();
  return __pyx_r;
}

/* "/Library/Frameworks/Python.framework/Versions/4.1.30101/lib/python2.5/site-packages/Cython-0.11.2-py2.5-macosx-10.3-i386.egg/Cython/Includes/numpy.pxd":65
 *         # experimental exception made for __getbuffer__ and __releasebuffer__
 *         # -- the details of this may change.
 *         def __getbuffer__(ndarray self, Py_buffer* info, int flags):             # <<<<<<<<<<<<<<
 *             # This implementation of getbuffer is geared towards Cython
 *             # requirements, and does not yet fullfill the PEP.
 */

static int __pyx_pf_5numpy_7ndarray___getbuffer__(PyObject *__pyx_v_self, Py_buffer *__pyx_v_info, int __pyx_v_flags); /*proto*/
static int __pyx_pf_5numpy_7ndarray___getbuffer__(PyObject *__pyx_v_self, Py_buffer *__pyx_v_info, int __pyx_v_flags) {
  int __pyx_v_copy_shape;
  int __pyx_v_i;
  int __pyx_v_ndim;
  int __pyx_v_endian_detector;
  int __pyx_v_little_endian;
  int __pyx_v_t;
  char *__pyx_v_f;
  PyArray_Descr *__pyx_v_descr = 0;
  int __pyx_v_offset;
  int __pyx_v_hasfields;
  int __pyx_r;
  int __pyx_t_1;
  PyObject *__pyx_t_2 = NULL;
  PyObject *__pyx_t_3 = NULL;
  int __pyx_t_4;
  int __pyx_t_5;
  int __pyx_t_6;
  char *__pyx_t_7;
  __Pyx_SetupRefcountContext("__getbuffer__");
  if (__pyx_v_info == NULL) return 0;
  __pyx_v_info->obj = Py_None; __Pyx_INCREF(Py_None);
  __Pyx_GIVEREF(__pyx_v_info->obj);

  /* "/Library/Frameworks/Python.framework/Versions/4.1.30101/lib/python2.5/site-packages/Cython-0.11.2-py2.5-macosx-10.3-i386.egg/Cython/Includes/numpy.pxd":71
 *             # of flags
 *             cdef int copy_shape, i, ndim
 *             cdef int endian_detector = 1             # <<<<<<<<<<<<<<
 *             cdef bint little_endian = ((<char*>&endian_detector)[0] != 0)
 * 
 */
  __pyx_v_endian_detector = 1;

  /* "/Library/Frameworks/Python.framework/Versions/4.1.30101/lib/python2.5/site-packages/Cython-0.11.2-py2.5-macosx-10.3-i386.egg/Cython/Includes/numpy.pxd":72
 *             cdef int copy_shape, i, ndim
 *             cdef int endian_detector = 1
 *             cdef bint little_endian = ((<char*>&endian_detector)[0] != 0)             # <<<<<<<<<<<<<<
 * 
 *             ndim = PyArray_NDIM(self)
 */
  __pyx_v_little_endian = ((((char *)(&__pyx_v_endian_detector))[0]) != 0);

  /* "/Library/Frameworks/Python.framework/Versions/4.1.30101/lib/python2.5/site-packages/Cython-0.11.2-py2.5-macosx-10.3-i386.egg/Cython/Includes/numpy.pxd":74
 *             cdef bint little_endian = ((<char*>&endian_detector)[0] != 0)
 * 
 *             ndim = PyArray_NDIM(self)             # <<<<<<<<<<<<<<
 * 
 *             if sizeof(npy_intp) != sizeof(Py_ssize_t):
 */
  __pyx_v_ndim = PyArray_NDIM(((PyArrayObject *)__pyx_v_self));

  /* "/Library/Frameworks/Python.framework/Versions/4.1.30101/lib/python2.5/site-packages/Cython-0.11.2-py2.5-macosx-10.3-i386.egg/Cython/Includes/numpy.pxd":76
 *             ndim = PyArray_NDIM(self)
 * 
 *             if sizeof(npy_intp) != sizeof(Py_ssize_t):             # <<<<<<<<<<<<<<
 *                 copy_shape = 1
 *             else:
 */
  __pyx_t_1 = ((sizeof(npy_intp)) != (sizeof(Py_ssize_t)));
  if (__pyx_t_1) {

    /* "/Library/Frameworks/Python.framework/Versions/4.1.30101/lib/python2.5/site-packages/Cython-0.11.2-py2.5-macosx-10.3-i386.egg/Cython/Includes/numpy.pxd":77
 * 
 *             if sizeof(npy_intp) != sizeof(Py_ssize_t):
 *                 copy_shape = 1             # <<<<<<<<<<<<<<
 *             else:
 *                 copy_shape = 0
 */
    __pyx_v_copy_shape = 1;
    goto __pyx_L5;
  }
  /*else*/ {

    /* "/Library/Frameworks/Python.framework/Versions/4.1.30101/lib/python2.5/site-packages/Cython-0.11.2-py2.5-macosx-10.3-i386.egg/Cython/Includes/numpy.pxd":79
 *                 copy_shape = 1
 *             else:
 *                 copy_shape = 0             # <<<<<<<<<<<<<<
 * 
 *             if ((flags & pybuf.PyBUF_C_CONTIGUOUS == pybuf.PyBUF_C_CONTIGUOUS)
 */
    __pyx_v_copy_shape = 0;
  }
  __pyx_L5:;

  /* "/Library/Frameworks/Python.framework/Versions/4.1.30101/lib/python2.5/site-packages/Cython-0.11.2-py2.5-macosx-10.3-i386.egg/Cython/Includes/numpy.pxd":81
 *                 copy_shape = 0
 * 
 *             if ((flags & pybuf.PyBUF_C_CONTIGUOUS == pybuf.PyBUF_C_CONTIGUOUS)             # <<<<<<<<<<<<<<
 *                 and not PyArray_CHKFLAGS(self, NPY_C_CONTIGUOUS)):
 *                 raise ValueError("ndarray is not C contiguous")
 */
  if (((__pyx_v_flags & PyBUF_C_CONTIGUOUS) == PyBUF_C_CONTIGUOUS)) {

    /* "/Library/Frameworks/Python.framework/Versions/4.1.30101/lib/python2.5/site-packages/Cython-0.11.2-py2.5-macosx-10.3-i386.egg/Cython/Includes/numpy.pxd":82
 * 
 *             if ((flags & pybuf.PyBUF_C_CONTIGUOUS == pybuf.PyBUF_C_CONTIGUOUS)
 *                 and not PyArray_CHKFLAGS(self, NPY_C_CONTIGUOUS)):             # <<<<<<<<<<<<<<
 *                 raise ValueError("ndarray is not C contiguous")
 * 
 */
    __pyx_t_1 = (!PyArray_CHKFLAGS(((PyArrayObject *)__pyx_v_self), NPY_C_CONTIGUOUS));
  } else {
    __pyx_t_1 = ((__pyx_v_flags & PyBUF_C_CONTIGUOUS) == PyBUF_C_CONTIGUOUS);
  }
  if (__pyx_t_1) {

    /* "/Library/Frameworks/Python.framework/Versions/4.1.30101/lib/python2.5/site-packages/Cython-0.11.2-py2.5-macosx-10.3-i386.egg/Cython/Includes/numpy.pxd":83
 *             if ((flags & pybuf.PyBUF_C_CONTIGUOUS == pybuf.PyBUF_C_CONTIGUOUS)
 *                 and not PyArray_CHKFLAGS(self, NPY_C_CONTIGUOUS)):
 *                 raise ValueError("ndarray is not C contiguous")             # <<<<<<<<<<<<<<
 * 
 *             if ((flags & pybuf.PyBUF_F_CONTIGUOUS == pybuf.PyBUF_F_CONTIGUOUS)
 */
    __pyx_t_2 = PyTuple_New(1); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 83; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(((PyObject *)__pyx_t_2));
    __Pyx_INCREF(__pyx_kp_1);
    PyTuple_SET_ITEM(__pyx_t_2, 0, __pyx_kp_1);
    __Pyx_GIVEREF(__pyx_kp_1);
    __pyx_t_3 = PyObject_Call(__pyx_builtin_ValueError, ((PyObject *)__pyx_t_2), NULL); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 83; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_3);
    __Pyx_DECREF(((PyObject *)__pyx_t_2)); __pyx_t_2 = 0;
    __Pyx_Raise(__pyx_t_3, 0, 0);
    __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
    {__pyx_filename = __pyx_f[1]; __pyx_lineno = 83; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    goto __pyx_L6;
  }
  __pyx_L6:;

  /* "/Library/Frameworks/Python.framework/Versions/4.1.30101/lib/python2.5/site-packages/Cython-0.11.2-py2.5-macosx-10.3-i386.egg/Cython/Includes/numpy.pxd":85
 *                 raise ValueError("ndarray is not C contiguous")
 * 
 *             if ((flags & pybuf.PyBUF_F_CONTIGUOUS == pybuf.PyBUF_F_CONTIGUOUS)             # <<<<<<<<<<<<<<
 *                 and not PyArray_CHKFLAGS(self, NPY_F_CONTIGUOUS)):
 *                 raise ValueError("ndarray is not Fortran contiguous")
 */
  if (((__pyx_v_flags & PyBUF_F_CONTIGUOUS) == PyBUF_F_CONTIGUOUS)) {

    /* "/Library/Frameworks/Python.framework/Versions/4.1.30101/lib/python2.5/site-packages/Cython-0.11.2-py2.5-macosx-10.3-i386.egg/Cython/Includes/numpy.pxd":86
 * 
 *             if ((flags & pybuf.PyBUF_F_CONTIGUOUS == pybuf.PyBUF_F_CONTIGUOUS)
 *                 and not PyArray_CHKFLAGS(self, NPY_F_CONTIGUOUS)):             # <<<<<<<<<<<<<<
 *                 raise ValueError("ndarray is not Fortran contiguous")
 * 
 */
    __pyx_t_1 = (!PyArray_CHKFLAGS(((PyArrayObject *)__pyx_v_self), NPY_F_CONTIGUOUS));
  } else {
    __pyx_t_1 = ((__pyx_v_flags & PyBUF_F_CONTIGUOUS) == PyBUF_F_CONTIGUOUS);
  }
  if (__pyx_t_1) {

    /* "/Library/Frameworks/Python.framework/Versions/4.1.30101/lib/python2.5/site-packages/Cython-0.11.2-py2.5-macosx-10.3-i386.egg/Cython/Includes/numpy.pxd":87
 *             if ((flags & pybuf.PyBUF_F_CONTIGUOUS == pybuf.PyBUF_F_CONTIGUOUS)
 *                 and not PyArray_CHKFLAGS(self, NPY_F_CONTIGUOUS)):
 *                 raise ValueError("ndarray is not Fortran contiguous")             # <<<<<<<<<<<<<<
 * 
 *             info.buf = PyArray_DATA(self)
 */
    __pyx_t_3 = PyTuple_New(1); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 87; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(((PyObject *)__pyx_t_3));
    __Pyx_INCREF(__pyx_kp_2);
    PyTuple_SET_ITEM(__pyx_t_3, 0, __pyx_kp_2);
    __Pyx_GIVEREF(__pyx_kp_2);
    __pyx_t_2 = PyObject_Call(__pyx_builtin_ValueError, ((PyObject *)__pyx_t_3), NULL); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 87; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_2);
    __Pyx_DECREF(((PyObject *)__pyx_t_3)); __pyx_t_3 = 0;
    __Pyx_Raise(__pyx_t_2, 0, 0);
    __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
    {__pyx_filename = __pyx_f[1]; __pyx_lineno = 87; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    goto __pyx_L7;
  }
  __pyx_L7:;

  /* "/Library/Frameworks/Python.framework/Versions/4.1.30101/lib/python2.5/site-packages/Cython-0.11.2-py2.5-macosx-10.3-i386.egg/Cython/Includes/numpy.pxd":89
 *                 raise ValueError("ndarray is not Fortran contiguous")
 * 
 *             info.buf = PyArray_DATA(self)             # <<<<<<<<<<<<<<
 *             info.ndim = ndim
 *             if copy_shape:
 */
  __pyx_v_info->buf = PyArray_DATA(((PyArrayObject *)__pyx_v_self));

  /* "/Library/Frameworks/Python.framework/Versions/4.1.30101/lib/python2.5/site-packages/Cython-0.11.2-py2.5-macosx-10.3-i386.egg/Cython/Includes/numpy.pxd":90
 * 
 *             info.buf = PyArray_DATA(self)
 *             info.ndim = ndim             # <<<<<<<<<<<<<<
 *             if copy_shape:
 *                 # Allocate new buffer for strides and shape info. This is allocated
 */
  __pyx_v_info->ndim = __pyx_v_ndim;

  /* "/Library/Frameworks/Python.framework/Versions/4.1.30101/lib/python2.5/site-packages/Cython-0.11.2-py2.5-macosx-10.3-i386.egg/Cython/Includes/numpy.pxd":91
 *             info.buf = PyArray_DATA(self)
 *             info.ndim = ndim
 *             if copy_shape:             # <<<<<<<<<<<<<<
 *                 # Allocate new buffer for strides and shape info. This is allocated
 *                 # as one block, strides first.
 */
  __pyx_t_4 = __pyx_v_copy_shape;
  if (__pyx_t_4) {

    /* "/Library/Frameworks/Python.framework/Versions/4.1.30101/lib/python2.5/site-packages/Cython-0.11.2-py2.5-macosx-10.3-i386.egg/Cython/Includes/numpy.pxd":94
 *                 # Allocate new buffer for strides and shape info. This is allocated
 *                 # as one block, strides first.
 *                 info.strides = <Py_ssize_t*>stdlib.malloc(sizeof(Py_ssize_t) * ndim * 2)             # <<<<<<<<<<<<<<
 *                 info.shape = info.strides + ndim
 *                 for i in range(ndim):
 */
    __pyx_v_info->strides = ((Py_ssize_t *)malloc((((sizeof(Py_ssize_t)) * __pyx_v_ndim) * 2)));

    /* "/Library/Frameworks/Python.framework/Versions/4.1.30101/lib/python2.5/site-packages/Cython-0.11.2-py2.5-macosx-10.3-i386.egg/Cython/Includes/numpy.pxd":95
 *                 # as one block, strides first.
 *                 info.strides = <Py_ssize_t*>stdlib.malloc(sizeof(Py_ssize_t) * ndim * 2)
 *                 info.shape = info.strides + ndim             # <<<<<<<<<<<<<<
 *                 for i in range(ndim):
 *                     info.strides[i] = PyArray_STRIDES(self)[i]
 */
    __pyx_v_info->shape = (__pyx_v_info->strides + __pyx_v_ndim);

    /* "/Library/Frameworks/Python.framework/Versions/4.1.30101/lib/python2.5/site-packages/Cython-0.11.2-py2.5-macosx-10.3-i386.egg/Cython/Includes/numpy.pxd":96
 *                 info.strides = <Py_ssize_t*>stdlib.malloc(sizeof(Py_ssize_t) * ndim * 2)
 *                 info.shape = info.strides + ndim
 *                 for i in range(ndim):             # <<<<<<<<<<<<<<
 *                     info.strides[i] = PyArray_STRIDES(self)[i]
 *                     info.shape[i] = PyArray_DIMS(self)[i]
 */
    for (__pyx_t_4 = 0; __pyx_t_4 < __pyx_v_ndim; __pyx_t_4+=1) {
      __pyx_v_i = __pyx_t_4;

      /* "/Library/Frameworks/Python.framework/Versions/4.1.30101/lib/python2.5/site-packages/Cython-0.11.2-py2.5-macosx-10.3-i386.egg/Cython/Includes/numpy.pxd":97
 *                 info.shape = info.strides + ndim
 *                 for i in range(ndim):
 *                     info.strides[i] = PyArray_STRIDES(self)[i]             # <<<<<<<<<<<<<<
 *                     info.shape[i] = PyArray_DIMS(self)[i]
 *             else:
 */
      (__pyx_v_info->strides[__pyx_v_i]) = (PyArray_STRIDES(((PyArrayObject *)__pyx_v_self))[__pyx_v_i]);

      /* "/Library/Frameworks/Python.framework/Versions/4.1.30101/lib/python2.5/site-packages/Cython-0.11.2-py2.5-macosx-10.3-i386.egg/Cython/Includes/numpy.pxd":98
 *                 for i in range(ndim):
 *                     info.strides[i] = PyArray_STRIDES(self)[i]
 *                     info.shape[i] = PyArray_DIMS(self)[i]             # <<<<<<<<<<<<<<
 *             else:
 *                 info.strides = <Py_ssize_t*>PyArray_STRIDES(self)
 */
      (__pyx_v_info->shape[__pyx_v_i]) = (PyArray_DIMS(((PyArrayObject *)__pyx_v_self))[__pyx_v_i]);
    }
    goto __pyx_L8;
  }
  /*else*/ {

    /* "/Library/Frameworks/Python.framework/Versions/4.1.30101/lib/python2.5/site-packages/Cython-0.11.2-py2.5-macosx-10.3-i386.egg/Cython/Includes/numpy.pxd":100
 *                     info.shape[i] = PyArray_DIMS(self)[i]
 *             else:
 *                 info.strides = <Py_ssize_t*>PyArray_STRIDES(self)             # <<<<<<<<<<<<<<
 *                 info.shape = <Py_ssize_t*>PyArray_DIMS(self)
 *             info.suboffsets = NULL
 */
    __pyx_v_info->strides = ((Py_ssize_t *)PyArray_STRIDES(((PyArrayObject *)__pyx_v_self)));

    /* "/Library/Frameworks/Python.framework/Versions/4.1.30101/lib/python2.5/site-packages/Cython-0.11.2-py2.5-macosx-10.3-i386.egg/Cython/Includes/numpy.pxd":101
 *             else:
 *                 info.strides = <Py_ssize_t*>PyArray_STRIDES(self)
 *                 info.shape = <Py_ssize_t*>PyArray_DIMS(self)             # <<<<<<<<<<<<<<
 *             info.suboffsets = NULL
 *             info.itemsize = PyArray_ITEMSIZE(self)
 */
    __pyx_v_info->shape = ((Py_ssize_t *)PyArray_DIMS(((PyArrayObject *)__pyx_v_self)));
  }
  __pyx_L8:;

  /* "/Library/Frameworks/Python.framework/Versions/4.1.30101/lib/python2.5/site-packages/Cython-0.11.2-py2.5-macosx-10.3-i386.egg/Cython/Includes/numpy.pxd":102
 *                 info.strides = <Py_ssize_t*>PyArray_STRIDES(self)
 *                 info.shape = <Py_ssize_t*>PyArray_DIMS(self)
 *             info.suboffsets = NULL             # <<<<<<<<<<<<<<
 *             info.itemsize = PyArray_ITEMSIZE(self)
 *             info.readonly = not PyArray_ISWRITEABLE(self)
 */
  __pyx_v_info->suboffsets = NULL;

  /* "/Library/Frameworks/Python.framework/Versions/4.1.30101/lib/python2.5/site-packages/Cython-0.11.2-py2.5-macosx-10.3-i386.egg/Cython/Includes/numpy.pxd":103
 *                 info.shape = <Py_ssize_t*>PyArray_DIMS(self)
 *             info.suboffsets = NULL
 *             info.itemsize = PyArray_ITEMSIZE(self)             # <<<<<<<<<<<<<<
 *             info.readonly = not PyArray_ISWRITEABLE(self)
 * 
 */
  __pyx_v_info->itemsize = PyArray_ITEMSIZE(((PyArrayObject *)__pyx_v_self));

  /* "/Library/Frameworks/Python.framework/Versions/4.1.30101/lib/python2.5/site-packages/Cython-0.11.2-py2.5-macosx-10.3-i386.egg/Cython/Includes/numpy.pxd":104
 *             info.suboffsets = NULL
 *             info.itemsize = PyArray_ITEMSIZE(self)
 *             info.readonly = not PyArray_ISWRITEABLE(self)             # <<<<<<<<<<<<<<
 * 
 *             cdef int t
 */
  __pyx_v_info->readonly = (!PyArray_ISWRITEABLE(((PyArrayObject *)__pyx_v_self)));

  /* "/Library/Frameworks/Python.framework/Versions/4.1.30101/lib/python2.5/site-packages/Cython-0.11.2-py2.5-macosx-10.3-i386.egg/Cython/Includes/numpy.pxd":107
 * 
 *             cdef int t
 *             cdef char* f = NULL             # <<<<<<<<<<<<<<
 *             cdef dtype descr = self.descr
 *             cdef list stack
 */
  __pyx_v_f = NULL;

  /* "/Library/Frameworks/Python.framework/Versions/4.1.30101/lib/python2.5/site-packages/Cython-0.11.2-py2.5-macosx-10.3-i386.egg/Cython/Includes/numpy.pxd":108
 *             cdef int t
 *             cdef char* f = NULL
 *             cdef dtype descr = self.descr             # <<<<<<<<<<<<<<
 *             cdef list stack
 *             cdef int offset
 */
  __Pyx_INCREF(((PyObject *)((PyArrayObject *)__pyx_v_self)->descr));
  __pyx_v_descr = ((PyArrayObject *)__pyx_v_self)->descr;

  /* "/Library/Frameworks/Python.framework/Versions/4.1.30101/lib/python2.5/site-packages/Cython-0.11.2-py2.5-macosx-10.3-i386.egg/Cython/Includes/numpy.pxd":112
 *             cdef int offset
 * 
 *             cdef bint hasfields = PyDataType_HASFIELDS(descr)             # <<<<<<<<<<<<<<
 * 
 *             if not hasfields and not copy_shape:
 */
  __pyx_v_hasfields = PyDataType_HASFIELDS(__pyx_v_descr);

  /* "/Library/Frameworks/Python.framework/Versions/4.1.30101/lib/python2.5/site-packages/Cython-0.11.2-py2.5-macosx-10.3-i386.egg/Cython/Includes/numpy.pxd":114
 *             cdef bint hasfields = PyDataType_HASFIELDS(descr)
 * 
 *             if not hasfields and not copy_shape:             # <<<<<<<<<<<<<<
 *                 # do not call releasebuffer
 *                 info.obj = None
 */
  if ((!__pyx_v_hasfields)) {
    __pyx_t_1 = (!__pyx_v_copy_shape);
  } else {
    __pyx_t_1 = (!__pyx_v_hasfields);
  }
  if (__pyx_t_1) {

    /* "/Library/Frameworks/Python.framework/Versions/4.1.30101/lib/python2.5/site-packages/Cython-0.11.2-py2.5-macosx-10.3-i386.egg/Cython/Includes/numpy.pxd":116
 *             if not hasfields and not copy_shape:
 *                 # do not call releasebuffer
 *                 info.obj = None             # <<<<<<<<<<<<<<
 *             else:
 *                 # need to call releasebuffer
 */
    __Pyx_INCREF(Py_None);
    __Pyx_GIVEREF(Py_None);
    __Pyx_GOTREF(__pyx_v_info->obj);
    __Pyx_DECREF(__pyx_v_info->obj);
    __pyx_v_info->obj = Py_None;
    goto __pyx_L11;
  }
  /*else*/ {

    /* "/Library/Frameworks/Python.framework/Versions/4.1.30101/lib/python2.5/site-packages/Cython-0.11.2-py2.5-macosx-10.3-i386.egg/Cython/Includes/numpy.pxd":119
 *             else:
 *                 # need to call releasebuffer
 *                 info.obj = self             # <<<<<<<<<<<<<<
 * 
 *             if not hasfields:
 */
    __Pyx_INCREF(__pyx_v_self);
    __Pyx_GIVEREF(__pyx_v_self);
    __Pyx_GOTREF(__pyx_v_info->obj);
    __Pyx_DECREF(__pyx_v_info->obj);
    __pyx_v_info->obj = __pyx_v_self;
  }
  __pyx_L11:;

  /* "/Library/Frameworks/Python.framework/Versions/4.1.30101/lib/python2.5/site-packages/Cython-0.11.2-py2.5-macosx-10.3-i386.egg/Cython/Includes/numpy.pxd":121
 *                 info.obj = self
 * 
 *             if not hasfields:             # <<<<<<<<<<<<<<
 *                 t = descr.type_num
 *                 if ((descr.byteorder == '>' and little_endian) or
 */
  __pyx_t_1 = (!__pyx_v_hasfields);
  if (__pyx_t_1) {

    /* "/Library/Frameworks/Python.framework/Versions/4.1.30101/lib/python2.5/site-packages/Cython-0.11.2-py2.5-macosx-10.3-i386.egg/Cython/Includes/numpy.pxd":122
 * 
 *             if not hasfields:
 *                 t = descr.type_num             # <<<<<<<<<<<<<<
 *                 if ((descr.byteorder == '>' and little_endian) or
 *                     (descr.byteorder == '<' and not little_endian)):
 */
    __pyx_v_t = __pyx_v_descr->type_num;

    /* "/Library/Frameworks/Python.framework/Versions/4.1.30101/lib/python2.5/site-packages/Cython-0.11.2-py2.5-macosx-10.3-i386.egg/Cython/Includes/numpy.pxd":123
 *             if not hasfields:
 *                 t = descr.type_num
 *                 if ((descr.byteorder == '>' and little_endian) or             # <<<<<<<<<<<<<<
 *                     (descr.byteorder == '<' and not little_endian)):
 *                     raise ValueError("Non-native byte order not supported")
 */
    if ((__pyx_v_descr->byteorder == '>')) {
      __pyx_t_1 = __pyx_v_little_endian;
    } else {
      __pyx_t_1 = (__pyx_v_descr->byteorder == '>');
    }
    if (!__pyx_t_1) {

      /* "/Library/Frameworks/Python.framework/Versions/4.1.30101/lib/python2.5/site-packages/Cython-0.11.2-py2.5-macosx-10.3-i386.egg/Cython/Includes/numpy.pxd":124
 *                 t = descr.type_num
 *                 if ((descr.byteorder == '>' and little_endian) or
 *                     (descr.byteorder == '<' and not little_endian)):             # <<<<<<<<<<<<<<
 *                     raise ValueError("Non-native byte order not supported")
 *                 if   t == NPY_BYTE:        f = "b"
 */
      if ((__pyx_v_descr->byteorder == '<')) {
        __pyx_t_5 = (!__pyx_v_little_endian);
      } else {
        __pyx_t_5 = (__pyx_v_descr->byteorder == '<');
      }
      __pyx_t_6 = __pyx_t_5;
    } else {
      __pyx_t_6 = __pyx_t_1;
    }
    if (__pyx_t_6) {

      /* "/Library/Frameworks/Python.framework/Versions/4.1.30101/lib/python2.5/site-packages/Cython-0.11.2-py2.5-macosx-10.3-i386.egg/Cython/Includes/numpy.pxd":125
 *                 if ((descr.byteorder == '>' and little_endian) or
 *                     (descr.byteorder == '<' and not little_endian)):
 *                     raise ValueError("Non-native byte order not supported")             # <<<<<<<<<<<<<<
 *                 if   t == NPY_BYTE:        f = "b"
 *                 elif t == NPY_UBYTE:       f = "B"
 */
      __pyx_t_2 = PyTuple_New(1); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 125; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(((PyObject *)__pyx_t_2));
      __Pyx_INCREF(__pyx_kp_5);
      PyTuple_SET_ITEM(__pyx_t_2, 0, __pyx_kp_5);
      __Pyx_GIVEREF(__pyx_kp_5);
      __pyx_t_3 = PyObject_Call(__pyx_builtin_ValueError, ((PyObject *)__pyx_t_2), NULL); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 125; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_t_3);
      __Pyx_DECREF(((PyObject *)__pyx_t_2)); __pyx_t_2 = 0;
      __Pyx_Raise(__pyx_t_3, 0, 0);
      __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
      {__pyx_filename = __pyx_f[1]; __pyx_lineno = 125; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      goto __pyx_L13;
    }
    __pyx_L13:;

    /* "/Library/Frameworks/Python.framework/Versions/4.1.30101/lib/python2.5/site-packages/Cython-0.11.2-py2.5-macosx-10.3-i386.egg/Cython/Includes/numpy.pxd":126
 *                     (descr.byteorder == '<' and not little_endian)):
 *                     raise ValueError("Non-native byte order not supported")
 *                 if   t == NPY_BYTE:        f = "b"             # <<<<<<<<<<<<<<
 *                 elif t == NPY_UBYTE:       f = "B"
 *                 elif t == NPY_SHORT:       f = "h"
 */
    switch (__pyx_v_t) {
      case NPY_BYTE:
      __pyx_v_f = __pyx_k_6;
      break;

      /* "/Library/Frameworks/Python.framework/Versions/4.1.30101/lib/python2.5/site-packages/Cython-0.11.2-py2.5-macosx-10.3-i386.egg/Cython/Includes/numpy.pxd":127
 *                     raise ValueError("Non-native byte order not supported")
 *                 if   t == NPY_BYTE:        f = "b"
 *                 elif t == NPY_UBYTE:       f = "B"             # <<<<<<<<<<<<<<
 *                 elif t == NPY_SHORT:       f = "h"
 *                 elif t == NPY_USHORT:      f = "H"
 */
      case NPY_UBYTE:
      __pyx_v_f = __pyx_k_7;
      break;

      /* "/Library/Frameworks/Python.framework/Versions/4.1.30101/lib/python2.5/site-packages/Cython-0.11.2-py2.5-macosx-10.3-i386.egg/Cython/Includes/numpy.pxd":128
 *                 if   t == NPY_BYTE:        f = "b"
 *                 elif t == NPY_UBYTE:       f = "B"
 *                 elif t == NPY_SHORT:       f = "h"             # <<<<<<<<<<<<<<
 *                 elif t == NPY_USHORT:      f = "H"
 *                 elif t == NPY_INT:         f = "i"
 */
      case NPY_SHORT:
      __pyx_v_f = __pyx_k_8;
      break;

      /* "/Library/Frameworks/Python.framework/Versions/4.1.30101/lib/python2.5/site-packages/Cython-0.11.2-py2.5-macosx-10.3-i386.egg/Cython/Includes/numpy.pxd":129
 *                 elif t == NPY_UBYTE:       f = "B"
 *                 elif t == NPY_SHORT:       f = "h"
 *                 elif t == NPY_USHORT:      f = "H"             # <<<<<<<<<<<<<<
 *                 elif t == NPY_INT:         f = "i"
 *                 elif t == NPY_UINT:        f = "I"
 */
      case NPY_USHORT:
      __pyx_v_f = __pyx_k_9;
      break;

      /* "/Library/Frameworks/Python.framework/Versions/4.1.30101/lib/python2.5/site-packages/Cython-0.11.2-py2.5-macosx-10.3-i386.egg/Cython/Includes/numpy.pxd":130
 *                 elif t == NPY_SHORT:       f = "h"
 *                 elif t == NPY_USHORT:      f = "H"
 *                 elif t == NPY_INT:         f = "i"             # <<<<<<<<<<<<<<
 *                 elif t == NPY_UINT:        f = "I"
 *                 elif t == NPY_LONG:        f = "l"
 */
      case NPY_INT:
      __pyx_v_f = __pyx_k_10;
      break;

      /* "/Library/Frameworks/Python.framework/Versions/4.1.30101/lib/python2.5/site-packages/Cython-0.11.2-py2.5-macosx-10.3-i386.egg/Cython/Includes/numpy.pxd":131
 *                 elif t == NPY_USHORT:      f = "H"
 *                 elif t == NPY_INT:         f = "i"
 *                 elif t == NPY_UINT:        f = "I"             # <<<<<<<<<<<<<<
 *                 elif t == NPY_LONG:        f = "l"
 *                 elif t == NPY_ULONG:       f = "L"
 */
      case NPY_UINT:
      __pyx_v_f = __pyx_k_11;
      break;

      /* "/Library/Frameworks/Python.framework/Versions/4.1.30101/lib/python2.5/site-packages/Cython-0.11.2-py2.5-macosx-10.3-i386.egg/Cython/Includes/numpy.pxd":132
 *                 elif t == NPY_INT:         f = "i"
 *                 elif t == NPY_UINT:        f = "I"
 *                 elif t == NPY_LONG:        f = "l"             # <<<<<<<<<<<<<<
 *                 elif t == NPY_ULONG:       f = "L"
 *                 elif t == NPY_LONGLONG:    f = "q"
 */
      case NPY_LONG:
      __pyx_v_f = __pyx_k_12;
      break;

      /* "/Library/Frameworks/Python.framework/Versions/4.1.30101/lib/python2.5/site-packages/Cython-0.11.2-py2.5-macosx-10.3-i386.egg/Cython/Includes/numpy.pxd":133
 *                 elif t == NPY_UINT:        f = "I"
 *                 elif t == NPY_LONG:        f = "l"
 *                 elif t == NPY_ULONG:       f = "L"             # <<<<<<<<<<<<<<
 *                 elif t == NPY_LONGLONG:    f = "q"
 *                 elif t == NPY_ULONGLONG:   f = "Q"
 */
      case NPY_ULONG:
      __pyx_v_f = __pyx_k_13;
      break;

      /* "/Library/Frameworks/Python.framework/Versions/4.1.30101/lib/python2.5/site-packages/Cython-0.11.2-py2.5-macosx-10.3-i386.egg/Cython/Includes/numpy.pxd":134
 *                 elif t == NPY_LONG:        f = "l"
 *                 elif t == NPY_ULONG:       f = "L"
 *                 elif t == NPY_LONGLONG:    f = "q"             # <<<<<<<<<<<<<<
 *                 elif t == NPY_ULONGLONG:   f = "Q"
 *                 elif t == NPY_FLOAT:       f = "f"
 */
      case NPY_LONGLONG:
      __pyx_v_f = __pyx_k_14;
      break;

      /* "/Library/Frameworks/Python.framework/Versions/4.1.30101/lib/python2.5/site-packages/Cython-0.11.2-py2.5-macosx-10.3-i386.egg/Cython/Includes/numpy.pxd":135
 *                 elif t == NPY_ULONG:       f = "L"
 *                 elif t == NPY_LONGLONG:    f = "q"
 *                 elif t == NPY_ULONGLONG:   f = "Q"             # <<<<<<<<<<<<<<
 *                 elif t == NPY_FLOAT:       f = "f"
 *                 elif t == NPY_DOUBLE:      f = "d"
 */
      case NPY_ULONGLONG:
      __pyx_v_f = __pyx_k_15;
      break;

      /* "/Library/Frameworks/Python.framework/Versions/4.1.30101/lib/python2.5/site-packages/Cython-0.11.2-py2.5-macosx-10.3-i386.egg/Cython/Includes/numpy.pxd":136
 *                 elif t == NPY_LONGLONG:    f = "q"
 *                 elif t == NPY_ULONGLONG:   f = "Q"
 *                 elif t == NPY_FLOAT:       f = "f"             # <<<<<<<<<<<<<<
 *                 elif t == NPY_DOUBLE:      f = "d"
 *                 elif t == NPY_LONGDOUBLE:  f = "g"
 */
      case NPY_FLOAT:
      __pyx_v_f = __pyx_k_16;
      break;

      /* "/Library/Frameworks/Python.framework/Versions/4.1.30101/lib/python2.5/site-packages/Cython-0.11.2-py2.5-macosx-10.3-i386.egg/Cython/Includes/numpy.pxd":137
 *                 elif t == NPY_ULONGLONG:   f = "Q"
 *                 elif t == NPY_FLOAT:       f = "f"
 *                 elif t == NPY_DOUBLE:      f = "d"             # <<<<<<<<<<<<<<
 *                 elif t == NPY_LONGDOUBLE:  f = "g"
 *                 elif t == NPY_CFLOAT:      f = "Zf"
 */
      case NPY_DOUBLE:
      __pyx_v_f = __pyx_k_17;
      break;

      /* "/Library/Frameworks/Python.framework/Versions/4.1.30101/lib/python2.5/site-packages/Cython-0.11.2-py2.5-macosx-10.3-i386.egg/Cython/Includes/numpy.pxd":138
 *                 elif t == NPY_FLOAT:       f = "f"
 *                 elif t == NPY_DOUBLE:      f = "d"
 *                 elif t == NPY_LONGDOUBLE:  f = "g"             # <<<<<<<<<<<<<<
 *                 elif t == NPY_CFLOAT:      f = "Zf"
 *                 elif t == NPY_CDOUBLE:     f = "Zd"
 */
      case NPY_LONGDOUBLE:
      __pyx_v_f = __pyx_k_18;
      break;

      /* "/Library/Frameworks/Python.framework/Versions/4.1.30101/lib/python2.5/site-packages/Cython-0.11.2-py2.5-macosx-10.3-i386.egg/Cython/Includes/numpy.pxd":139
 *                 elif t == NPY_DOUBLE:      f = "d"
 *                 elif t == NPY_LONGDOUBLE:  f = "g"
 *                 elif t == NPY_CFLOAT:      f = "Zf"             # <<<<<<<<<<<<<<
 *                 elif t == NPY_CDOUBLE:     f = "Zd"
 *                 elif t == NPY_CLONGDOUBLE: f = "Zg"
 */
      case NPY_CFLOAT:
      __pyx_v_f = __pyx_k_19;
      break;

      /* "/Library/Frameworks/Python.framework/Versions/4.1.30101/lib/python2.5/site-packages/Cython-0.11.2-py2.5-macosx-10.3-i386.egg/Cython/Includes/numpy.pxd":140
 *                 elif t == NPY_LONGDOUBLE:  f = "g"
 *                 elif t == NPY_CFLOAT:      f = "Zf"
 *                 elif t == NPY_CDOUBLE:     f = "Zd"             # <<<<<<<<<<<<<<
 *                 elif t == NPY_CLONGDOUBLE: f = "Zg"
 *                 elif t == NPY_OBJECT:      f = "O"
 */
      case NPY_CDOUBLE:
      __pyx_v_f = __pyx_k_20;
      break;

      /* "/Library/Frameworks/Python.framework/Versions/4.1.30101/lib/python2.5/site-packages/Cython-0.11.2-py2.5-macosx-10.3-i386.egg/Cython/Includes/numpy.pxd":141
 *                 elif t == NPY_CFLOAT:      f = "Zf"
 *                 elif t == NPY_CDOUBLE:     f = "Zd"
 *                 elif t == NPY_CLONGDOUBLE: f = "Zg"             # <<<<<<<<<<<<<<
 *                 elif t == NPY_OBJECT:      f = "O"
 *                 else:
 */
      case NPY_CLONGDOUBLE:
      __pyx_v_f = __pyx_k_21;
      break;

      /* "/Library/Frameworks/Python.framework/Versions/4.1.30101/lib/python2.5/site-packages/Cython-0.11.2-py2.5-macosx-10.3-i386.egg/Cython/Includes/numpy.pxd":142
 *                 elif t == NPY_CDOUBLE:     f = "Zd"
 *                 elif t == NPY_CLONGDOUBLE: f = "Zg"
 *                 elif t == NPY_OBJECT:      f = "O"             # <<<<<<<<<<<<<<
 *                 else:
 *                     raise ValueError("unknown dtype code in numpy.pxd (%d)" % t)
 */
      case NPY_OBJECT:
      __pyx_v_f = __pyx_k_22;
      break;
      default:

      /* "/Library/Frameworks/Python.framework/Versions/4.1.30101/lib/python2.5/site-packages/Cython-0.11.2-py2.5-macosx-10.3-i386.egg/Cython/Includes/numpy.pxd":144
 *                 elif t == NPY_OBJECT:      f = "O"
 *                 else:
 *                     raise ValueError("unknown dtype code in numpy.pxd (%d)" % t)             # <<<<<<<<<<<<<<
 *                 info.format = f
 *                 return
 */
      __pyx_t_3 = PyInt_FromLong(__pyx_v_t); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 144; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_t_3);
      __pyx_t_2 = PyNumber_Remainder(__pyx_kp_23, __pyx_t_3); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 144; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_t_2);
      __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
      __pyx_t_3 = PyTuple_New(1); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 144; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(((PyObject *)__pyx_t_3));
      PyTuple_SET_ITEM(__pyx_t_3, 0, __pyx_t_2);
      __Pyx_GIVEREF(__pyx_t_2);
      __pyx_t_2 = 0;
      __pyx_t_2 = PyObject_Call(__pyx_builtin_ValueError, ((PyObject *)__pyx_t_3), NULL); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 144; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_t_2);
      __Pyx_DECREF(((PyObject *)__pyx_t_3)); __pyx_t_3 = 0;
      __Pyx_Raise(__pyx_t_2, 0, 0);
      __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
      {__pyx_filename = __pyx_f[1]; __pyx_lineno = 144; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      break;
    }

    /* "/Library/Frameworks/Python.framework/Versions/4.1.30101/lib/python2.5/site-packages/Cython-0.11.2-py2.5-macosx-10.3-i386.egg/Cython/Includes/numpy.pxd":145
 *                 else:
 *                     raise ValueError("unknown dtype code in numpy.pxd (%d)" % t)
 *                 info.format = f             # <<<<<<<<<<<<<<
 *                 return
 *             else:
 */
    __pyx_v_info->format = __pyx_v_f;

    /* "/Library/Frameworks/Python.framework/Versions/4.1.30101/lib/python2.5/site-packages/Cython-0.11.2-py2.5-macosx-10.3-i386.egg/Cython/Includes/numpy.pxd":146
 *                     raise ValueError("unknown dtype code in numpy.pxd (%d)" % t)
 *                 info.format = f
 *                 return             # <<<<<<<<<<<<<<
 *             else:
 *                 info.format = <char*>stdlib.malloc(_buffer_format_string_len)
 */
    __pyx_r = 0;
    goto __pyx_L0;
    goto __pyx_L12;
  }
  /*else*/ {

    /* "/Library/Frameworks/Python.framework/Versions/4.1.30101/lib/python2.5/site-packages/Cython-0.11.2-py2.5-macosx-10.3-i386.egg/Cython/Includes/numpy.pxd":148
 *                 return
 *             else:
 *                 info.format = <char*>stdlib.malloc(_buffer_format_string_len)             # <<<<<<<<<<<<<<
 *                 info.format[0] = '^' # Native data types, manual alignment
 *                 offset = 0
 */
    __pyx_v_info->format = ((char *)malloc(255));

    /* "/Library/Frameworks/Python.framework/Versions/4.1.30101/lib/python2.5/site-packages/Cython-0.11.2-py2.5-macosx-10.3-i386.egg/Cython/Includes/numpy.pxd":149
 *             else:
 *                 info.format = <char*>stdlib.malloc(_buffer_format_string_len)
 *                 info.format[0] = '^' # Native data types, manual alignment             # <<<<<<<<<<<<<<
 *                 offset = 0
 *                 f = _util_dtypestring(descr, info.format + 1,
 */
    (__pyx_v_info->format[0]) = '^';

    /* "/Library/Frameworks/Python.framework/Versions/4.1.30101/lib/python2.5/site-packages/Cython-0.11.2-py2.5-macosx-10.3-i386.egg/Cython/Includes/numpy.pxd":150
 *                 info.format = <char*>stdlib.malloc(_buffer_format_string_len)
 *                 info.format[0] = '^' # Native data types, manual alignment
 *                 offset = 0             # <<<<<<<<<<<<<<
 *                 f = _util_dtypestring(descr, info.format + 1,
 *                                       info.format + _buffer_format_string_len,
 */
    __pyx_v_offset = 0;

    /* "/Library/Frameworks/Python.framework/Versions/4.1.30101/lib/python2.5/site-packages/Cython-0.11.2-py2.5-macosx-10.3-i386.egg/Cython/Includes/numpy.pxd":153
 *                 f = _util_dtypestring(descr, info.format + 1,
 *                                       info.format + _buffer_format_string_len,
 *                                       &offset)             # <<<<<<<<<<<<<<
 *                 f[0] = 0 # Terminate format string
 * 
 */
    __pyx_t_7 = __pyx_f_5numpy__util_dtypestring(__pyx_v_descr, (__pyx_v_info->format + 1), (__pyx_v_info->format + 255), (&__pyx_v_offset)); if (unlikely(__pyx_t_7 == NULL)) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 151; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __pyx_v_f = __pyx_t_7;

    /* "/Library/Frameworks/Python.framework/Versions/4.1.30101/lib/python2.5/site-packages/Cython-0.11.2-py2.5-macosx-10.3-i386.egg/Cython/Includes/numpy.pxd":154
 *                                       info.format + _buffer_format_string_len,
 *                                       &offset)
 *                 f[0] = 0 # Terminate format string             # <<<<<<<<<<<<<<
 * 
 *         def __releasebuffer__(ndarray self, Py_buffer* info):
 */
    (__pyx_v_f[0]) = 0;
  }
  __pyx_L12:;

  __pyx_r = 0;
  goto __pyx_L0;
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_2);
  __Pyx_XDECREF(__pyx_t_3);
  __Pyx_AddTraceback("numpy.ndarray.__getbuffer__");
  __pyx_r = -1;
  __Pyx_GOTREF(__pyx_v_info->obj);
  __Pyx_DECREF(__pyx_v_info->obj); __pyx_v_info->obj = NULL;
  goto __pyx_L2;
  __pyx_L0:;
  if (__pyx_v_info->obj == Py_None) {
    __Pyx_GOTREF(Py_None);
    __Pyx_DECREF(Py_None); __pyx_v_info->obj = NULL;
  }
  __pyx_L2:;
  __Pyx_XDECREF((PyObject *)__pyx_v_descr);
  __Pyx_FinishRefcountContext();
  return __pyx_r;
}

/* "/Library/Frameworks/Python.framework/Versions/4.1.30101/lib/python2.5/site-packages/Cython-0.11.2-py2.5-macosx-10.3-i386.egg/Cython/Includes/numpy.pxd":156
 *                 f[0] = 0 # Terminate format string
 * 
 *         def __releasebuffer__(ndarray self, Py_buffer* info):             # <<<<<<<<<<<<<<
 *             if PyArray_HASFIELDS(self):
 *                 stdlib.free(info.format)
 */

static void __pyx_pf_5numpy_7ndarray___releasebuffer__(PyObject *__pyx_v_self, Py_buffer *__pyx_v_info); /*proto*/
static void __pyx_pf_5numpy_7ndarray___releasebuffer__(PyObject *__pyx_v_self, Py_buffer *__pyx_v_info) {
  int __pyx_t_1;
  int __pyx_t_2;
  __Pyx_SetupRefcountContext("__releasebuffer__");

  /* "/Library/Frameworks/Python.framework/Versions/4.1.30101/lib/python2.5/site-packages/Cython-0.11.2-py2.5-macosx-10.3-i386.egg/Cython/Includes/numpy.pxd":157
 * 
 *         def __releasebuffer__(ndarray self, Py_buffer* info):
 *             if PyArray_HASFIELDS(self):             # <<<<<<<<<<<<<<
 *                 stdlib.free(info.format)
 *             if sizeof(npy_intp) != sizeof(Py_ssize_t):
 */
  __pyx_t_1 = PyArray_HASFIELDS(((PyArrayObject *)__pyx_v_self));
  if (__pyx_t_1) {

    /* "/Library/Frameworks/Python.framework/Versions/4.1.30101/lib/python2.5/site-packages/Cython-0.11.2-py2.5-macosx-10.3-i386.egg/Cython/Includes/numpy.pxd":158
 *         def __releasebuffer__(ndarray self, Py_buffer* info):
 *             if PyArray_HASFIELDS(self):
 *                 stdlib.free(info.format)             # <<<<<<<<<<<<<<
 *             if sizeof(npy_intp) != sizeof(Py_ssize_t):
 *                 stdlib.free(info.strides)
 */
    free(__pyx_v_info->format);
    goto __pyx_L5;
  }
  __pyx_L5:;

  /* "/Library/Frameworks/Python.framework/Versions/4.1.30101/lib/python2.5/site-packages/Cython-0.11.2-py2.5-macosx-10.3-i386.egg/Cython/Includes/numpy.pxd":159
 *             if PyArray_HASFIELDS(self):
 *                 stdlib.free(info.format)
 *             if sizeof(npy_intp) != sizeof(Py_ssize_t):             # <<<<<<<<<<<<<<
 *                 stdlib.free(info.strides)
 *                 # info.shape was stored after info.strides in the same block
 */
  __pyx_t_2 = ((sizeof(npy_intp)) != (sizeof(Py_ssize_t)));
  if (__pyx_t_2) {

    /* "/Library/Frameworks/Python.framework/Versions/4.1.30101/lib/python2.5/site-packages/Cython-0.11.2-py2.5-macosx-10.3-i386.egg/Cython/Includes/numpy.pxd":160
 *                 stdlib.free(info.format)
 *             if sizeof(npy_intp) != sizeof(Py_ssize_t):
 *                 stdlib.free(info.strides)             # <<<<<<<<<<<<<<
 *                 # info.shape was stored after info.strides in the same block
 * 
 */
    free(__pyx_v_info->strides);
    goto __pyx_L6;
  }
  __pyx_L6:;

  __Pyx_FinishRefcountContext();
}

/* "/Library/Frameworks/Python.framework/Versions/4.1.30101/lib/python2.5/site-packages/Cython-0.11.2-py2.5-macosx-10.3-i386.egg/Cython/Includes/numpy.pxd":277
 * ctypedef npy_cdouble     complex_t
 * 
 * cdef inline char* _util_dtypestring(dtype descr, char* f, char* end, int* offset) except NULL:             # <<<<<<<<<<<<<<
 *     # Recursive utility function used in __getbuffer__ to get format
 *     # string. The new location in the format string is returned.
 */

static INLINE char *__pyx_f_5numpy__util_dtypestring(PyArray_Descr *__pyx_v_descr, char *__pyx_v_f, char *__pyx_v_end, int *__pyx_v_offset) {
  PyArray_Descr *__pyx_v_child;
  PyObject *__pyx_v_i;
  int __pyx_v_endian_detector;
  int __pyx_v_little_endian;
  PyObject *__pyx_v_new_offset;
  PyObject *__pyx_v_t;
  char *__pyx_r;
  PyObject *__pyx_1 = 0;
  Py_ssize_t __pyx_t_1;
  PyObject *__pyx_t_2 = NULL;
  PyObject *__pyx_t_3 = NULL;
  PyObject *__pyx_t_4 = NULL;
  PyObject *__pyx_t_5 = NULL;
  int __pyx_t_6;
  int __pyx_t_7;
  int __pyx_t_8;
  char *__pyx_t_9;
  __Pyx_SetupRefcountContext("_util_dtypestring");
  __pyx_v_child = ((PyArray_Descr *)Py_None); __Pyx_INCREF(Py_None);
  __pyx_v_i = ((PyObject *)Py_None); __Pyx_INCREF(Py_None);
  __pyx_v_new_offset = Py_None; __Pyx_INCREF(Py_None);
  __pyx_v_t = Py_None; __Pyx_INCREF(Py_None);

  /* "/Library/Frameworks/Python.framework/Versions/4.1.30101/lib/python2.5/site-packages/Cython-0.11.2-py2.5-macosx-10.3-i386.egg/Cython/Includes/numpy.pxd":284
 *     cdef int delta_offset
 *     cdef tuple i
 *     cdef int endian_detector = 1             # <<<<<<<<<<<<<<
 *     cdef bint little_endian = ((<char*>&endian_detector)[0] != 0)
 * 
 */
  __pyx_v_endian_detector = 1;

  /* "/Library/Frameworks/Python.framework/Versions/4.1.30101/lib/python2.5/site-packages/Cython-0.11.2-py2.5-macosx-10.3-i386.egg/Cython/Includes/numpy.pxd":285
 *     cdef tuple i
 *     cdef int endian_detector = 1
 *     cdef bint little_endian = ((<char*>&endian_detector)[0] != 0)             # <<<<<<<<<<<<<<
 * 
 *     for i in descr.fields.itervalues():
 */
  __pyx_v_little_endian = ((((char *)(&__pyx_v_endian_detector))[0]) != 0);

  /* "/Library/Frameworks/Python.framework/Versions/4.1.30101/lib/python2.5/site-packages/Cython-0.11.2-py2.5-macosx-10.3-i386.egg/Cython/Includes/numpy.pxd":287
 *     cdef bint little_endian = ((<char*>&endian_detector)[0] != 0)
 * 
 *     for i in descr.fields.itervalues():             # <<<<<<<<<<<<<<
 *         child = i[0]
 *         new_offset = i[1]
 */
  __pyx_t_2 = PyObject_GetAttr(__pyx_v_descr->fields, __pyx_kp_itervalues); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 287; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_2);
  __pyx_t_3 = PyObject_Call(__pyx_t_2, ((PyObject *)__pyx_empty_tuple), NULL); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 287; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_3);
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  if (PyList_CheckExact(__pyx_t_3) || PyTuple_CheckExact(__pyx_t_3)) {
    __pyx_t_1 = 0; __pyx_t_2 = __pyx_t_3; __Pyx_INCREF(__pyx_t_2);
  } else {
    __pyx_t_1 = -1; __pyx_t_2 = PyObject_GetIter(__pyx_t_3); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 287; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_2);
  }
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  for (;;) {
    if (likely(PyList_CheckExact(__pyx_t_2))) {
      if (__pyx_t_1 >= PyList_GET_SIZE(__pyx_t_2)) break;
      __pyx_t_3 = PyList_GET_ITEM(__pyx_t_2, __pyx_t_1); __Pyx_INCREF(__pyx_t_3); __pyx_t_1++;
    } else if (likely(PyTuple_CheckExact(__pyx_t_2))) {
      if (__pyx_t_1 >= PyTuple_GET_SIZE(__pyx_t_2)) break;
      __pyx_t_3 = PyTuple_GET_ITEM(__pyx_t_2, __pyx_t_1); __Pyx_INCREF(__pyx_t_3); __pyx_t_1++;
    } else {
      __pyx_t_3 = PyIter_Next(__pyx_t_2);
      if (!__pyx_t_3) {
        if (unlikely(PyErr_Occurred())) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 287; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        break;
      }
      __Pyx_GOTREF(__pyx_t_3);
    }
    if (!(likely(PyTuple_CheckExact(__pyx_t_3)) || (__pyx_t_3) == Py_None || (PyErr_Format(PyExc_TypeError, "Expected tuple, got %s", Py_TYPE(__pyx_t_3)->tp_name), 0))) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 287; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_DECREF(((PyObject *)__pyx_v_i));
    __pyx_v_i = ((PyObject *)__pyx_t_3);
    __pyx_t_3 = 0;

    /* "/Library/Frameworks/Python.framework/Versions/4.1.30101/lib/python2.5/site-packages/Cython-0.11.2-py2.5-macosx-10.3-i386.egg/Cython/Includes/numpy.pxd":288
 * 
 *     for i in descr.fields.itervalues():
 *         child = i[0]             # <<<<<<<<<<<<<<
 *         new_offset = i[1]
 * 
 */
    __pyx_1 = __Pyx_GetItemInt_Tuple(((PyObject *)__pyx_v_i), 0, sizeof(long), PyInt_FromLong); if (!__pyx_1) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 288; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_1);
    if (!(__Pyx_TypeTest(__pyx_1, __pyx_ptype_5numpy_dtype))) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 288; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_DECREF(((PyObject *)__pyx_v_child));
    __pyx_v_child = ((PyArray_Descr *)__pyx_1);
    __pyx_1 = 0;

    /* "/Library/Frameworks/Python.framework/Versions/4.1.30101/lib/python2.5/site-packages/Cython-0.11.2-py2.5-macosx-10.3-i386.egg/Cython/Includes/numpy.pxd":289
 *     for i in descr.fields.itervalues():
 *         child = i[0]
 *         new_offset = i[1]             # <<<<<<<<<<<<<<
 * 
 *         if (end - f) - (new_offset - offset[0]) < 15:
 */
    __pyx_1 = __Pyx_GetItemInt_Tuple(((PyObject *)__pyx_v_i), 1, sizeof(long), PyInt_FromLong); if (!__pyx_1) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 289; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_1);
    __Pyx_DECREF(__pyx_v_new_offset);
    __pyx_v_new_offset = __pyx_1;
    __pyx_1 = 0;

    /* "/Library/Frameworks/Python.framework/Versions/4.1.30101/lib/python2.5/site-packages/Cython-0.11.2-py2.5-macosx-10.3-i386.egg/Cython/Includes/numpy.pxd":291
 *         new_offset = i[1]
 * 
 *         if (end - f) - (new_offset - offset[0]) < 15:             # <<<<<<<<<<<<<<
 *             raise RuntimeError("Format string allocated too short, see comment in numpy.pxd")
 * 
 */
    __pyx_t_3 = PyInt_FromLong((__pyx_v_end - __pyx_v_f)); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 291; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_3);
    __pyx_t_4 = PyInt_FromLong((__pyx_v_offset[0])); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 291; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_4);
    __pyx_t_5 = PyNumber_Subtract(__pyx_v_new_offset, __pyx_t_4); if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 291; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_5);
    __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
    __pyx_t_4 = PyNumber_Subtract(__pyx_t_3, __pyx_t_5); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 291; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_4);
    __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
    __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
    __pyx_t_5 = PyObject_RichCompare(__pyx_t_4, __pyx_int_15, Py_LT); if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 291; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_5);
    __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
    __pyx_t_6 = __Pyx_PyObject_IsTrue(__pyx_t_5); if (unlikely(__pyx_t_6 < 0)) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 291; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
    if (__pyx_t_6) {

      /* "/Library/Frameworks/Python.framework/Versions/4.1.30101/lib/python2.5/site-packages/Cython-0.11.2-py2.5-macosx-10.3-i386.egg/Cython/Includes/numpy.pxd":292
 * 
 *         if (end - f) - (new_offset - offset[0]) < 15:
 *             raise RuntimeError("Format string allocated too short, see comment in numpy.pxd")             # <<<<<<<<<<<<<<
 * 
 *         if ((child.byteorder == '>' and little_endian) or
 */
      __pyx_t_5 = PyTuple_New(1); if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 292; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(((PyObject *)__pyx_t_5));
      __Pyx_INCREF(__pyx_kp_25);
      PyTuple_SET_ITEM(__pyx_t_5, 0, __pyx_kp_25);
      __Pyx_GIVEREF(__pyx_kp_25);
      __pyx_t_4 = PyObject_Call(__pyx_builtin_RuntimeError, ((PyObject *)__pyx_t_5), NULL); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 292; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_t_4);
      __Pyx_DECREF(((PyObject *)__pyx_t_5)); __pyx_t_5 = 0;
      __Pyx_Raise(__pyx_t_4, 0, 0);
      __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
      {__pyx_filename = __pyx_f[1]; __pyx_lineno = 292; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      goto __pyx_L5;
    }
    __pyx_L5:;

    /* "/Library/Frameworks/Python.framework/Versions/4.1.30101/lib/python2.5/site-packages/Cython-0.11.2-py2.5-macosx-10.3-i386.egg/Cython/Includes/numpy.pxd":294
 *             raise RuntimeError("Format string allocated too short, see comment in numpy.pxd")
 * 
 *         if ((child.byteorder == '>' and little_endian) or             # <<<<<<<<<<<<<<
 *             (child.byteorder == '<' and not little_endian)):
 *             raise ValueError("Non-native byte order not supported")
 */
    if ((__pyx_v_child->byteorder == '>')) {
      __pyx_t_6 = __pyx_v_little_endian;
    } else {
      __pyx_t_6 = (__pyx_v_child->byteorder == '>');
    }
    if (!__pyx_t_6) {

      /* "/Library/Frameworks/Python.framework/Versions/4.1.30101/lib/python2.5/site-packages/Cython-0.11.2-py2.5-macosx-10.3-i386.egg/Cython/Includes/numpy.pxd":295
 * 
 *         if ((child.byteorder == '>' and little_endian) or
 *             (child.byteorder == '<' and not little_endian)):             # <<<<<<<<<<<<<<
 *             raise ValueError("Non-native byte order not supported")
 *             # One could encode it in the format string and have Cython
 */
      if ((__pyx_v_child->byteorder == '<')) {
        __pyx_t_7 = (!__pyx_v_little_endian);
      } else {
        __pyx_t_7 = (__pyx_v_child->byteorder == '<');
      }
      __pyx_t_8 = __pyx_t_7;
    } else {
      __pyx_t_8 = __pyx_t_6;
    }
    if (__pyx_t_8) {

      /* "/Library/Frameworks/Python.framework/Versions/4.1.30101/lib/python2.5/site-packages/Cython-0.11.2-py2.5-macosx-10.3-i386.egg/Cython/Includes/numpy.pxd":296
 *         if ((child.byteorder == '>' and little_endian) or
 *             (child.byteorder == '<' and not little_endian)):
 *             raise ValueError("Non-native byte order not supported")             # <<<<<<<<<<<<<<
 *             # One could encode it in the format string and have Cython
 *             # complain instead, BUT: < and > in format strings also imply
 */
      __pyx_t_4 = PyTuple_New(1); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 296; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(((PyObject *)__pyx_t_4));
      __Pyx_INCREF(__pyx_kp_28);
      PyTuple_SET_ITEM(__pyx_t_4, 0, __pyx_kp_28);
      __Pyx_GIVEREF(__pyx_kp_28);
      __pyx_t_5 = PyObject_Call(__pyx_builtin_ValueError, ((PyObject *)__pyx_t_4), NULL); if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 296; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_t_5);
      __Pyx_DECREF(((PyObject *)__pyx_t_4)); __pyx_t_4 = 0;
      __Pyx_Raise(__pyx_t_5, 0, 0);
      __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
      {__pyx_filename = __pyx_f[1]; __pyx_lineno = 296; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      goto __pyx_L6;
    }
    __pyx_L6:;

    /* "/Library/Frameworks/Python.framework/Versions/4.1.30101/lib/python2.5/site-packages/Cython-0.11.2-py2.5-macosx-10.3-i386.egg/Cython/Includes/numpy.pxd":306
 * 
 *         # Output padding bytes
 *         while offset[0] < new_offset:             # <<<<<<<<<<<<<<
 *             f[0] = 120 # "x"; pad byte
 *             f += 1
 */
    while (1) {
      __pyx_t_5 = PyInt_FromLong((__pyx_v_offset[0])); if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 306; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_t_5);
      __pyx_t_4 = PyObject_RichCompare(__pyx_t_5, __pyx_v_new_offset, Py_LT); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 306; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_t_4);
      __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
      __pyx_t_8 = __Pyx_PyObject_IsTrue(__pyx_t_4); if (unlikely(__pyx_t_8 < 0)) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 306; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
      if (!__pyx_t_8) break;

      /* "/Library/Frameworks/Python.framework/Versions/4.1.30101/lib/python2.5/site-packages/Cython-0.11.2-py2.5-macosx-10.3-i386.egg/Cython/Includes/numpy.pxd":307
 *         # Output padding bytes
 *         while offset[0] < new_offset:
 *             f[0] = 120 # "x"; pad byte             # <<<<<<<<<<<<<<
 *             f += 1
 *             offset[0] += 1
 */
      (__pyx_v_f[0]) = 120;

      /* "/Library/Frameworks/Python.framework/Versions/4.1.30101/lib/python2.5/site-packages/Cython-0.11.2-py2.5-macosx-10.3-i386.egg/Cython/Includes/numpy.pxd":308
 *         while offset[0] < new_offset:
 *             f[0] = 120 # "x"; pad byte
 *             f += 1             # <<<<<<<<<<<<<<
 *             offset[0] += 1
 * 
 */
      __pyx_v_f += 1;

      /* "/Library/Frameworks/Python.framework/Versions/4.1.30101/lib/python2.5/site-packages/Cython-0.11.2-py2.5-macosx-10.3-i386.egg/Cython/Includes/numpy.pxd":309
 *             f[0] = 120 # "x"; pad byte
 *             f += 1
 *             offset[0] += 1             # <<<<<<<<<<<<<<
 * 
 *         offset[0] += child.itemsize
 */
      (__pyx_v_offset[0]) += 1;
    }

    /* "/Library/Frameworks/Python.framework/Versions/4.1.30101/lib/python2.5/site-packages/Cython-0.11.2-py2.5-macosx-10.3-i386.egg/Cython/Includes/numpy.pxd":311
 *             offset[0] += 1
 * 
 *         offset[0] += child.itemsize             # <<<<<<<<<<<<<<
 * 
 *         if not PyDataType_HASFIELDS(child):
 */
    (__pyx_v_offset[0]) += __pyx_v_child->elsize;

    /* "/Library/Frameworks/Python.framework/Versions/4.1.30101/lib/python2.5/site-packages/Cython-0.11.2-py2.5-macosx-10.3-i386.egg/Cython/Includes/numpy.pxd":313
 *         offset[0] += child.itemsize
 * 
 *         if not PyDataType_HASFIELDS(child):             # <<<<<<<<<<<<<<
 *             t = child.type_num
 *             if end - f < 5:
 */
    __pyx_t_8 = (!PyDataType_HASFIELDS(__pyx_v_child));
    if (__pyx_t_8) {

      /* "/Library/Frameworks/Python.framework/Versions/4.1.30101/lib/python2.5/site-packages/Cython-0.11.2-py2.5-macosx-10.3-i386.egg/Cython/Includes/numpy.pxd":314
 * 
 *         if not PyDataType_HASFIELDS(child):
 *             t = child.type_num             # <<<<<<<<<<<<<<
 *             if end - f < 5:
 *                 raise RuntimeError("Format string allocated too short.")
 */
      __pyx_t_4 = PyInt_FromLong(__pyx_v_child->type_num); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 314; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_t_4);
      __Pyx_DECREF(__pyx_v_t);
      __pyx_v_t = __pyx_t_4;
      __pyx_t_4 = 0;

      /* "/Library/Frameworks/Python.framework/Versions/4.1.30101/lib/python2.5/site-packages/Cython-0.11.2-py2.5-macosx-10.3-i386.egg/Cython/Includes/numpy.pxd":315
 *         if not PyDataType_HASFIELDS(child):
 *             t = child.type_num
 *             if end - f < 5:             # <<<<<<<<<<<<<<
 *                 raise RuntimeError("Format string allocated too short.")
 * 
 */
      __pyx_t_8 = ((__pyx_v_end - __pyx_v_f) < 5);
      if (__pyx_t_8) {

        /* "/Library/Frameworks/Python.framework/Versions/4.1.30101/lib/python2.5/site-packages/Cython-0.11.2-py2.5-macosx-10.3-i386.egg/Cython/Includes/numpy.pxd":316
 *             t = child.type_num
 *             if end - f < 5:
 *                 raise RuntimeError("Format string allocated too short.")             # <<<<<<<<<<<<<<
 * 
 *             # Until ticket #99 is fixed, use integers to avoid warnings
 */
        __pyx_t_4 = PyTuple_New(1); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 316; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        __Pyx_GOTREF(((PyObject *)__pyx_t_4));
        __Pyx_INCREF(__pyx_kp_29);
        PyTuple_SET_ITEM(__pyx_t_4, 0, __pyx_kp_29);
        __Pyx_GIVEREF(__pyx_kp_29);
        __pyx_t_5 = PyObject_Call(__pyx_builtin_RuntimeError, ((PyObject *)__pyx_t_4), NULL); if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 316; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        __Pyx_GOTREF(__pyx_t_5);
        __Pyx_DECREF(((PyObject *)__pyx_t_4)); __pyx_t_4 = 0;
        __Pyx_Raise(__pyx_t_5, 0, 0);
        __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
        {__pyx_filename = __pyx_f[1]; __pyx_lineno = 316; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        goto __pyx_L10;
      }
      __pyx_L10:;

      /* "/Library/Frameworks/Python.framework/Versions/4.1.30101/lib/python2.5/site-packages/Cython-0.11.2-py2.5-macosx-10.3-i386.egg/Cython/Includes/numpy.pxd":319
 * 
 *             # Until ticket #99 is fixed, use integers to avoid warnings
 *             if   t == NPY_BYTE:        f[0] =  98 #"b"             # <<<<<<<<<<<<<<
 *             elif t == NPY_UBYTE:       f[0] =  66 #"B"
 *             elif t == NPY_SHORT:       f[0] = 104 #"h"
 */
      __pyx_t_5 = PyInt_FromLong(NPY_BYTE); if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 319; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_t_5);
      __pyx_t_4 = PyObject_RichCompare(__pyx_v_t, __pyx_t_5, Py_EQ); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 319; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_t_4);
      __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
      __pyx_t_8 = __Pyx_PyObject_IsTrue(__pyx_t_4); if (unlikely(__pyx_t_8 < 0)) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 319; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
      if (__pyx_t_8) {
        (__pyx_v_f[0]) = 98;
        goto __pyx_L11;
      }

      /* "/Library/Frameworks/Python.framework/Versions/4.1.30101/lib/python2.5/site-packages/Cython-0.11.2-py2.5-macosx-10.3-i386.egg/Cython/Includes/numpy.pxd":320
 *             # Until ticket #99 is fixed, use integers to avoid warnings
 *             if   t == NPY_BYTE:        f[0] =  98 #"b"
 *             elif t == NPY_UBYTE:       f[0] =  66 #"B"             # <<<<<<<<<<<<<<
 *             elif t == NPY_SHORT:       f[0] = 104 #"h"
 *             elif t == NPY_USHORT:      f[0] =  72 #"H"
 */
      __pyx_t_4 = PyInt_FromLong(NPY_UBYTE); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 320; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_t_4);
      __pyx_t_5 = PyObject_RichCompare(__pyx_v_t, __pyx_t_4, Py_EQ); if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 320; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_t_5);
      __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
      __pyx_t_8 = __Pyx_PyObject_IsTrue(__pyx_t_5); if (unlikely(__pyx_t_8 < 0)) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 320; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
      if (__pyx_t_8) {
        (__pyx_v_f[0]) = 66;
        goto __pyx_L11;
      }

      /* "/Library/Frameworks/Python.framework/Versions/4.1.30101/lib/python2.5/site-packages/Cython-0.11.2-py2.5-macosx-10.3-i386.egg/Cython/Includes/numpy.pxd":321
 *             if   t == NPY_BYTE:        f[0] =  98 #"b"
 *             elif t == NPY_UBYTE:       f[0] =  66 #"B"
 *             elif t == NPY_SHORT:       f[0] = 104 #"h"             # <<<<<<<<<<<<<<
 *             elif t == NPY_USHORT:      f[0] =  72 #"H"
 *             elif t == NPY_INT:         f[0] = 105 #"i"
 */
      __pyx_t_5 = PyInt_FromLong(NPY_SHORT); if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 321; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_t_5);
      __pyx_t_4 = PyObject_RichCompare(__pyx_v_t, __pyx_t_5, Py_EQ); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 321; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_t_4);
      __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
      __pyx_t_8 = __Pyx_PyObject_IsTrue(__pyx_t_4); if (unlikely(__pyx_t_8 < 0)) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 321; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
      if (__pyx_t_8) {
        (__pyx_v_f[0]) = 104;
        goto __pyx_L11;
      }

      /* "/Library/Frameworks/Python.framework/Versions/4.1.30101/lib/python2.5/site-packages/Cython-0.11.2-py2.5-macosx-10.3-i386.egg/Cython/Includes/numpy.pxd":322
 *             elif t == NPY_UBYTE:       f[0] =  66 #"B"
 *             elif t == NPY_SHORT:       f[0] = 104 #"h"
 *             elif t == NPY_USHORT:      f[0] =  72 #"H"             # <<<<<<<<<<<<<<
 *             elif t == NPY_INT:         f[0] = 105 #"i"
 *             elif t == NPY_UINT:        f[0] =  73 #"I"
 */
      __pyx_t_4 = PyInt_FromLong(NPY_USHORT); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 322; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_t_4);
      __pyx_t_5 = PyObject_RichCompare(__pyx_v_t, __pyx_t_4, Py_EQ); if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 322; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_t_5);
      __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
      __pyx_t_8 = __Pyx_PyObject_IsTrue(__pyx_t_5); if (unlikely(__pyx_t_8 < 0)) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 322; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
      if (__pyx_t_8) {
        (__pyx_v_f[0]) = 72;
        goto __pyx_L11;
      }

      /* "/Library/Frameworks/Python.framework/Versions/4.1.30101/lib/python2.5/site-packages/Cython-0.11.2-py2.5-macosx-10.3-i386.egg/Cython/Includes/numpy.pxd":323
 *             elif t == NPY_SHORT:       f[0] = 104 #"h"
 *             elif t == NPY_USHORT:      f[0] =  72 #"H"
 *             elif t == NPY_INT:         f[0] = 105 #"i"             # <<<<<<<<<<<<<<
 *             elif t == NPY_UINT:        f[0] =  73 #"I"
 *             elif t == NPY_LONG:        f[0] = 108 #"l"
 */
      __pyx_t_5 = PyInt_FromLong(NPY_INT); if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 323; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_t_5);
      __pyx_t_4 = PyObject_RichCompare(__pyx_v_t, __pyx_t_5, Py_EQ); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 323; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_t_4);
      __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
      __pyx_t_8 = __Pyx_PyObject_IsTrue(__pyx_t_4); if (unlikely(__pyx_t_8 < 0)) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 323; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
      if (__pyx_t_8) {
        (__pyx_v_f[0]) = 105;
        goto __pyx_L11;
      }

      /* "/Library/Frameworks/Python.framework/Versions/4.1.30101/lib/python2.5/site-packages/Cython-0.11.2-py2.5-macosx-10.3-i386.egg/Cython/Includes/numpy.pxd":324
 *             elif t == NPY_USHORT:      f[0] =  72 #"H"
 *             elif t == NPY_INT:         f[0] = 105 #"i"
 *             elif t == NPY_UINT:        f[0] =  73 #"I"             # <<<<<<<<<<<<<<
 *             elif t == NPY_LONG:        f[0] = 108 #"l"
 *             elif t == NPY_ULONG:       f[0] = 76  #"L"
 */
      __pyx_t_4 = PyInt_FromLong(NPY_UINT); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 324; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_t_4);
      __pyx_t_5 = PyObject_RichCompare(__pyx_v_t, __pyx_t_4, Py_EQ); if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 324; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_t_5);
      __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
      __pyx_t_8 = __Pyx_PyObject_IsTrue(__pyx_t_5); if (unlikely(__pyx_t_8 < 0)) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 324; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
      if (__pyx_t_8) {
        (__pyx_v_f[0]) = 73;
        goto __pyx_L11;
      }

      /* "/Library/Frameworks/Python.framework/Versions/4.1.30101/lib/python2.5/site-packages/Cython-0.11.2-py2.5-macosx-10.3-i386.egg/Cython/Includes/numpy.pxd":325
 *             elif t == NPY_INT:         f[0] = 105 #"i"
 *             elif t == NPY_UINT:        f[0] =  73 #"I"
 *             elif t == NPY_LONG:        f[0] = 108 #"l"             # <<<<<<<<<<<<<<
 *             elif t == NPY_ULONG:       f[0] = 76  #"L"
 *             elif t == NPY_LONGLONG:    f[0] = 113 #"q"
 */
      __pyx_t_5 = PyInt_FromLong(NPY_LONG); if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 325; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_t_5);
      __pyx_t_4 = PyObject_RichCompare(__pyx_v_t, __pyx_t_5, Py_EQ); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 325; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_t_4);
      __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
      __pyx_t_8 = __Pyx_PyObject_IsTrue(__pyx_t_4); if (unlikely(__pyx_t_8 < 0)) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 325; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
      if (__pyx_t_8) {
        (__pyx_v_f[0]) = 108;
        goto __pyx_L11;
      }

      /* "/Library/Frameworks/Python.framework/Versions/4.1.30101/lib/python2.5/site-packages/Cython-0.11.2-py2.5-macosx-10.3-i386.egg/Cython/Includes/numpy.pxd":326
 *             elif t == NPY_UINT:        f[0] =  73 #"I"
 *             elif t == NPY_LONG:        f[0] = 108 #"l"
 *             elif t == NPY_ULONG:       f[0] = 76  #"L"             # <<<<<<<<<<<<<<
 *             elif t == NPY_LONGLONG:    f[0] = 113 #"q"
 *             elif t == NPY_ULONGLONG:   f[0] = 81  #"Q"
 */
      __pyx_t_4 = PyInt_FromLong(NPY_ULONG); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 326; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_t_4);
      __pyx_t_5 = PyObject_RichCompare(__pyx_v_t, __pyx_t_4, Py_EQ); if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 326; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_t_5);
      __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
      __pyx_t_8 = __Pyx_PyObject_IsTrue(__pyx_t_5); if (unlikely(__pyx_t_8 < 0)) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 326; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
      if (__pyx_t_8) {
        (__pyx_v_f[0]) = 76;
        goto __pyx_L11;
      }

      /* "/Library/Frameworks/Python.framework/Versions/4.1.30101/lib/python2.5/site-packages/Cython-0.11.2-py2.5-macosx-10.3-i386.egg/Cython/Includes/numpy.pxd":327
 *             elif t == NPY_LONG:        f[0] = 108 #"l"
 *             elif t == NPY_ULONG:       f[0] = 76  #"L"
 *             elif t == NPY_LONGLONG:    f[0] = 113 #"q"             # <<<<<<<<<<<<<<
 *             elif t == NPY_ULONGLONG:   f[0] = 81  #"Q"
 *             elif t == NPY_FLOAT:       f[0] = 102 #"f"
 */
      __pyx_t_5 = PyInt_FromLong(NPY_LONGLONG); if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 327; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_t_5);
      __pyx_t_4 = PyObject_RichCompare(__pyx_v_t, __pyx_t_5, Py_EQ); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 327; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_t_4);
      __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
      __pyx_t_8 = __Pyx_PyObject_IsTrue(__pyx_t_4); if (unlikely(__pyx_t_8 < 0)) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 327; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
      if (__pyx_t_8) {
        (__pyx_v_f[0]) = 113;
        goto __pyx_L11;
      }

      /* "/Library/Frameworks/Python.framework/Versions/4.1.30101/lib/python2.5/site-packages/Cython-0.11.2-py2.5-macosx-10.3-i386.egg/Cython/Includes/numpy.pxd":328
 *             elif t == NPY_ULONG:       f[0] = 76  #"L"
 *             elif t == NPY_LONGLONG:    f[0] = 113 #"q"
 *             elif t == NPY_ULONGLONG:   f[0] = 81  #"Q"             # <<<<<<<<<<<<<<
 *             elif t == NPY_FLOAT:       f[0] = 102 #"f"
 *             elif t == NPY_DOUBLE:      f[0] = 100 #"d"
 */
      __pyx_t_4 = PyInt_FromLong(NPY_ULONGLONG); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 328; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_t_4);
      __pyx_t_5 = PyObject_RichCompare(__pyx_v_t, __pyx_t_4, Py_EQ); if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 328; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_t_5);
      __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
      __pyx_t_8 = __Pyx_PyObject_IsTrue(__pyx_t_5); if (unlikely(__pyx_t_8 < 0)) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 328; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
      if (__pyx_t_8) {
        (__pyx_v_f[0]) = 81;
        goto __pyx_L11;
      }

      /* "/Library/Frameworks/Python.framework/Versions/4.1.30101/lib/python2.5/site-packages/Cython-0.11.2-py2.5-macosx-10.3-i386.egg/Cython/Includes/numpy.pxd":329
 *             elif t == NPY_LONGLONG:    f[0] = 113 #"q"
 *             elif t == NPY_ULONGLONG:   f[0] = 81  #"Q"
 *             elif t == NPY_FLOAT:       f[0] = 102 #"f"             # <<<<<<<<<<<<<<
 *             elif t == NPY_DOUBLE:      f[0] = 100 #"d"
 *             elif t == NPY_LONGDOUBLE:  f[0] = 103 #"g"
 */
      __pyx_t_5 = PyInt_FromLong(NPY_FLOAT); if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 329; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_t_5);
      __pyx_t_4 = PyObject_RichCompare(__pyx_v_t, __pyx_t_5, Py_EQ); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 329; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_t_4);
      __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
      __pyx_t_8 = __Pyx_PyObject_IsTrue(__pyx_t_4); if (unlikely(__pyx_t_8 < 0)) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 329; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
      if (__pyx_t_8) {
        (__pyx_v_f[0]) = 102;
        goto __pyx_L11;
      }

      /* "/Library/Frameworks/Python.framework/Versions/4.1.30101/lib/python2.5/site-packages/Cython-0.11.2-py2.5-macosx-10.3-i386.egg/Cython/Includes/numpy.pxd":330
 *             elif t == NPY_ULONGLONG:   f[0] = 81  #"Q"
 *             elif t == NPY_FLOAT:       f[0] = 102 #"f"
 *             elif t == NPY_DOUBLE:      f[0] = 100 #"d"             # <<<<<<<<<<<<<<
 *             elif t == NPY_LONGDOUBLE:  f[0] = 103 #"g"
 *             elif t == NPY_CFLOAT:      f[0] = 90; f[1] = 102; f += 1 # Zf
 */
      __pyx_t_4 = PyInt_FromLong(NPY_DOUBLE); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 330; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_t_4);
      __pyx_t_5 = PyObject_RichCompare(__pyx_v_t, __pyx_t_4, Py_EQ); if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 330; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_t_5);
      __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
      __pyx_t_8 = __Pyx_PyObject_IsTrue(__pyx_t_5); if (unlikely(__pyx_t_8 < 0)) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 330; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
      if (__pyx_t_8) {
        (__pyx_v_f[0]) = 100;
        goto __pyx_L11;
      }

      /* "/Library/Frameworks/Python.framework/Versions/4.1.30101/lib/python2.5/site-packages/Cython-0.11.2-py2.5-macosx-10.3-i386.egg/Cython/Includes/numpy.pxd":331
 *             elif t == NPY_FLOAT:       f[0] = 102 #"f"
 *             elif t == NPY_DOUBLE:      f[0] = 100 #"d"
 *             elif t == NPY_LONGDOUBLE:  f[0] = 103 #"g"             # <<<<<<<<<<<<<<
 *             elif t == NPY_CFLOAT:      f[0] = 90; f[1] = 102; f += 1 # Zf
 *             elif t == NPY_CDOUBLE:     f[0] = 90; f[1] = 100; f += 1 # Zd
 */
      __pyx_t_5 = PyInt_FromLong(NPY_LONGDOUBLE); if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 331; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_t_5);
      __pyx_t_4 = PyObject_RichCompare(__pyx_v_t, __pyx_t_5, Py_EQ); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 331; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_t_4);
      __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
      __pyx_t_8 = __Pyx_PyObject_IsTrue(__pyx_t_4); if (unlikely(__pyx_t_8 < 0)) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 331; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
      if (__pyx_t_8) {
        (__pyx_v_f[0]) = 103;
        goto __pyx_L11;
      }

      /* "/Library/Frameworks/Python.framework/Versions/4.1.30101/lib/python2.5/site-packages/Cython-0.11.2-py2.5-macosx-10.3-i386.egg/Cython/Includes/numpy.pxd":332
 *             elif t == NPY_DOUBLE:      f[0] = 100 #"d"
 *             elif t == NPY_LONGDOUBLE:  f[0] = 103 #"g"
 *             elif t == NPY_CFLOAT:      f[0] = 90; f[1] = 102; f += 1 # Zf             # <<<<<<<<<<<<<<
 *             elif t == NPY_CDOUBLE:     f[0] = 90; f[1] = 100; f += 1 # Zd
 *             elif t == NPY_CLONGDOUBLE: f[0] = 90; f[1] = 103; f += 1 # Zg
 */
      __pyx_t_4 = PyInt_FromLong(NPY_CFLOAT); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 332; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_t_4);
      __pyx_t_5 = PyObject_RichCompare(__pyx_v_t, __pyx_t_4, Py_EQ); if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 332; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_t_5);
      __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
      __pyx_t_8 = __Pyx_PyObject_IsTrue(__pyx_t_5); if (unlikely(__pyx_t_8 < 0)) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 332; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
      if (__pyx_t_8) {
        (__pyx_v_f[0]) = 90;
        (__pyx_v_f[1]) = 102;
        __pyx_v_f += 1;
        goto __pyx_L11;
      }

      /* "/Library/Frameworks/Python.framework/Versions/4.1.30101/lib/python2.5/site-packages/Cython-0.11.2-py2.5-macosx-10.3-i386.egg/Cython/Includes/numpy.pxd":333
 *             elif t == NPY_LONGDOUBLE:  f[0] = 103 #"g"
 *             elif t == NPY_CFLOAT:      f[0] = 90; f[1] = 102; f += 1 # Zf
 *             elif t == NPY_CDOUBLE:     f[0] = 90; f[1] = 100; f += 1 # Zd             # <<<<<<<<<<<<<<
 *             elif t == NPY_CLONGDOUBLE: f[0] = 90; f[1] = 103; f += 1 # Zg
 *             elif t == NPY_OBJECT:      f[0] = 79 #"O"
 */
      __pyx_t_5 = PyInt_FromLong(NPY_CDOUBLE); if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 333; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_t_5);
      __pyx_t_4 = PyObject_RichCompare(__pyx_v_t, __pyx_t_5, Py_EQ); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 333; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_t_4);
      __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
      __pyx_t_8 = __Pyx_PyObject_IsTrue(__pyx_t_4); if (unlikely(__pyx_t_8 < 0)) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 333; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
      if (__pyx_t_8) {
        (__pyx_v_f[0]) = 90;
        (__pyx_v_f[1]) = 100;
        __pyx_v_f += 1;
        goto __pyx_L11;
      }

      /* "/Library/Frameworks/Python.framework/Versions/4.1.30101/lib/python2.5/site-packages/Cython-0.11.2-py2.5-macosx-10.3-i386.egg/Cython/Includes/numpy.pxd":334
 *             elif t == NPY_CFLOAT:      f[0] = 90; f[1] = 102; f += 1 # Zf
 *             elif t == NPY_CDOUBLE:     f[0] = 90; f[1] = 100; f += 1 # Zd
 *             elif t == NPY_CLONGDOUBLE: f[0] = 90; f[1] = 103; f += 1 # Zg             # <<<<<<<<<<<<<<
 *             elif t == NPY_OBJECT:      f[0] = 79 #"O"
 *             else:
 */
      __pyx_t_4 = PyInt_FromLong(NPY_CLONGDOUBLE); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 334; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_t_4);
      __pyx_t_5 = PyObject_RichCompare(__pyx_v_t, __pyx_t_4, Py_EQ); if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 334; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_t_5);
      __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
      __pyx_t_8 = __Pyx_PyObject_IsTrue(__pyx_t_5); if (unlikely(__pyx_t_8 < 0)) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 334; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
      if (__pyx_t_8) {
        (__pyx_v_f[0]) = 90;
        (__pyx_v_f[1]) = 103;
        __pyx_v_f += 1;
        goto __pyx_L11;
      }

      /* "/Library/Frameworks/Python.framework/Versions/4.1.30101/lib/python2.5/site-packages/Cython-0.11.2-py2.5-macosx-10.3-i386.egg/Cython/Includes/numpy.pxd":335
 *             elif t == NPY_CDOUBLE:     f[0] = 90; f[1] = 100; f += 1 # Zd
 *             elif t == NPY_CLONGDOUBLE: f[0] = 90; f[1] = 103; f += 1 # Zg
 *             elif t == NPY_OBJECT:      f[0] = 79 #"O"             # <<<<<<<<<<<<<<
 *             else:
 *                 raise ValueError("unknown dtype code in numpy.pxd (%d)" % t)
 */
      __pyx_t_5 = PyInt_FromLong(NPY_OBJECT); if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 335; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_t_5);
      __pyx_t_4 = PyObject_RichCompare(__pyx_v_t, __pyx_t_5, Py_EQ); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 335; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_t_4);
      __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
      __pyx_t_8 = __Pyx_PyObject_IsTrue(__pyx_t_4); if (unlikely(__pyx_t_8 < 0)) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 335; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
      if (__pyx_t_8) {
        (__pyx_v_f[0]) = 79;
        goto __pyx_L11;
      }
      /*else*/ {

        /* "/Library/Frameworks/Python.framework/Versions/4.1.30101/lib/python2.5/site-packages/Cython-0.11.2-py2.5-macosx-10.3-i386.egg/Cython/Includes/numpy.pxd":337
 *             elif t == NPY_OBJECT:      f[0] = 79 #"O"
 *             else:
 *                 raise ValueError("unknown dtype code in numpy.pxd (%d)" % t)             # <<<<<<<<<<<<<<
 *             f += 1
 *         else:
 */
        __pyx_t_4 = PyNumber_Remainder(__pyx_kp_30, __pyx_v_t); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 337; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        __Pyx_GOTREF(__pyx_t_4);
        __pyx_t_5 = PyTuple_New(1); if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 337; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        __Pyx_GOTREF(((PyObject *)__pyx_t_5));
        PyTuple_SET_ITEM(__pyx_t_5, 0, __pyx_t_4);
        __Pyx_GIVEREF(__pyx_t_4);
        __pyx_t_4 = 0;
        __pyx_t_4 = PyObject_Call(__pyx_builtin_ValueError, ((PyObject *)__pyx_t_5), NULL); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 337; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        __Pyx_GOTREF(__pyx_t_4);
        __Pyx_DECREF(((PyObject *)__pyx_t_5)); __pyx_t_5 = 0;
        __Pyx_Raise(__pyx_t_4, 0, 0);
        __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
        {__pyx_filename = __pyx_f[1]; __pyx_lineno = 337; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      }
      __pyx_L11:;

      /* "/Library/Frameworks/Python.framework/Versions/4.1.30101/lib/python2.5/site-packages/Cython-0.11.2-py2.5-macosx-10.3-i386.egg/Cython/Includes/numpy.pxd":338
 *             else:
 *                 raise ValueError("unknown dtype code in numpy.pxd (%d)" % t)
 *             f += 1             # <<<<<<<<<<<<<<
 *         else:
 *             # Cython ignores struct boundary information ("T{...}"),
 */
      __pyx_v_f += 1;
      goto __pyx_L9;
    }
    /*else*/ {

      /* "/Library/Frameworks/Python.framework/Versions/4.1.30101/lib/python2.5/site-packages/Cython-0.11.2-py2.5-macosx-10.3-i386.egg/Cython/Includes/numpy.pxd":342
 *             # Cython ignores struct boundary information ("T{...}"),
 *             # so don't output it
 *             f = _util_dtypestring(child, f, end, offset)             # <<<<<<<<<<<<<<
 *     return f
 * 
 */
      __pyx_t_9 = __pyx_f_5numpy__util_dtypestring(__pyx_v_child, __pyx_v_f, __pyx_v_end, __pyx_v_offset); if (unlikely(__pyx_t_9 == NULL)) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 342; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __pyx_v_f = __pyx_t_9;
    }
    __pyx_L9:;
  }
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;

  /* "/Library/Frameworks/Python.framework/Versions/4.1.30101/lib/python2.5/site-packages/Cython-0.11.2-py2.5-macosx-10.3-i386.egg/Cython/Includes/numpy.pxd":343
 *             # so don't output it
 *             f = _util_dtypestring(child, f, end, offset)
 *     return f             # <<<<<<<<<<<<<<
 * 
 */
  __pyx_r = __pyx_v_f;
  goto __pyx_L0;

  __pyx_r = 0;
  goto __pyx_L0;
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_1);
  __Pyx_XDECREF(__pyx_t_2);
  __Pyx_XDECREF(__pyx_t_3);
  __Pyx_XDECREF(__pyx_t_4);
  __Pyx_XDECREF(__pyx_t_5);
  __Pyx_AddTraceback("numpy._util_dtypestring");
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_DECREF((PyObject *)__pyx_v_child);
  __Pyx_DECREF(__pyx_v_i);
  __Pyx_DECREF(__pyx_v_new_offset);
  __Pyx_DECREF(__pyx_v_t);
  __Pyx_FinishRefcountContext();
  return __pyx_r;
}

static struct PyMethodDef __pyx_methods[] = {
  {0, 0, 0, 0}
};

static void __pyx_init_filenames(void); /*proto*/

char* __pyx_import_star_type_names[] = {
  0
};

static int __pyx_import_star_set(PyObject *o, PyObject* py_name, char *name) {
  char** type_name = __pyx_import_star_type_names;
  while (*type_name) {
    if (__Pyx_StrEq(name, *type_name)) {
      PyErr_Format(PyExc_TypeError, "Cannot overwrite C type %s", name);
      goto bad;
    }
    type_name++;
  }
  if (0);
  else {
    if (PyObject_SetAttr(__pyx_m, py_name, o) < 0) goto bad;
  }
  return 0;
  __Pyx_AddTraceback("yt.lagos.chainHOP.chainHOP");
  bad:
  Py_DECREF(o);
  return -1;
}


/* import_all_from is an unexposed function from ceval.c */

static int
__Pyx_import_all_from(PyObject *locals, PyObject *v)
{
    PyObject *all = __Pyx_GetAttrString(v, "__all__");
    PyObject *dict, *name, *value;
    int skip_leading_underscores = 0;
    int pos, err;

    if (all == NULL) {
        if (!PyErr_ExceptionMatches(PyExc_AttributeError))
            return -1; /* Unexpected error */
        PyErr_Clear();
        dict = __Pyx_GetAttrString(v, "__dict__");
        if (dict == NULL) {
            if (!PyErr_ExceptionMatches(PyExc_AttributeError))
                return -1;
            PyErr_SetString(PyExc_ImportError,
            "from-import-* object has no __dict__ and no __all__");
            return -1;
        }
        all = PyMapping_Keys(dict);
        Py_DECREF(dict);
        if (all == NULL)
            return -1;
        skip_leading_underscores = 1;
    }

    for (pos = 0, err = 0; ; pos++) {
        name = PySequence_GetItem(all, pos);
        if (name == NULL) {
            if (!PyErr_ExceptionMatches(PyExc_IndexError))
                err = -1;
            else
                PyErr_Clear();
            break;
        }
        if (skip_leading_underscores &&
#if PY_MAJOR_VERSION < 3
            PyString_Check(name) &&
            PyString_AS_STRING(name)[0] == '_')
#else
            PyUnicode_Check(name) &&
            PyUnicode_AS_UNICODE(name)[0] == '_')
#endif
        {
            Py_DECREF(name);
            continue;
        }
        value = PyObject_GetAttr(v, name);
        if (value == NULL)
            err = -1;
        else if (PyDict_CheckExact(locals))
            err = PyDict_SetItem(locals, name, value);
        else
            err = PyObject_SetItem(locals, name, value);
        Py_DECREF(name);
        Py_XDECREF(value);
        if (err != 0)
            break;
    }
    Py_DECREF(all);
    return err;
}


static int __pyx_import_star(PyObject* m) {

    int i;
    int ret = -1;
    char* s;
    PyObject *locals = 0;
    PyObject *list = 0;
    PyObject *name;
    PyObject *item;
    
    locals = PyDict_New();              if (!locals) goto bad;
    if (__Pyx_import_all_from(locals, m) < 0) goto bad;
    list = PyDict_Items(locals);        if (!list) goto bad;
    
    for(i=0; i<PyList_GET_SIZE(list); i++) {
        name = PyTuple_GET_ITEM(PyList_GET_ITEM(list, i), 0);
        item = PyTuple_GET_ITEM(PyList_GET_ITEM(list, i), 1);
#if PY_MAJOR_VERSION < 3
        s = PyString_AsString(name);
#else
        s = PyUnicode_AsString(name);
#endif
        if (!s) goto bad;
        if (__pyx_import_star_set(item, name, s) < 0) goto bad;
    }
    ret = 0;
    
bad:
    Py_XDECREF(locals);
    Py_XDECREF(list);
    return ret;
}


#if PY_MAJOR_VERSION >= 3
static struct PyModuleDef __pyx_moduledef = {
    PyModuleDef_HEAD_INIT,
    __Pyx_NAMESTR("chainHOP"),
    0, /* m_doc */
    -1, /* m_size */
    __pyx_methods /* m_methods */,
    NULL, /* m_reload */
    NULL, /* m_traverse */
    NULL, /* m_clear */
    NULL /* m_free */
};
#endif

static __Pyx_StringTabEntry __pyx_string_tab[] = {
  {&__pyx_kp___main__, __pyx_k___main__, sizeof(__pyx_k___main__), 1, 1, 1},
  {&__pyx_kp_self, __pyx_k_self, sizeof(__pyx_k_self), 1, 1, 1},
  {&__pyx_kp_period, __pyx_k_period, sizeof(__pyx_k_period), 1, 1, 1},
  {&__pyx_kp_padding, __pyx_k_padding, sizeof(__pyx_k_padding), 1, 1, 1},
  {&__pyx_kp_num_neighbors, __pyx_k_num_neighbors, sizeof(__pyx_k_num_neighbors), 1, 1, 1},
  {&__pyx_kp_bounds, __pyx_k_bounds, sizeof(__pyx_k_bounds), 1, 1, 1},
  {&__pyx_kp_xpos, __pyx_k_xpos, sizeof(__pyx_k_xpos), 1, 1, 1},
  {&__pyx_kp_ypos, __pyx_k_ypos, sizeof(__pyx_k_ypos), 1, 1, 1},
  {&__pyx_kp_zpos, __pyx_k_zpos, sizeof(__pyx_k_zpos), 1, 1, 1},
  {&__pyx_kp_index, __pyx_k_index, sizeof(__pyx_k_index), 1, 1, 1},
  {&__pyx_kp_mass, __pyx_k_mass, sizeof(__pyx_k_mass), 1, 1, 1},
  {&__pyx_kp_threshold, __pyx_k_threshold, sizeof(__pyx_k_threshold), 1, 1, 1},
  {&__pyx_kp_i, __pyx_k_i, sizeof(__pyx_k_i), 1, 1, 1},
  {&__pyx_kp_shift, __pyx_k_shift, sizeof(__pyx_k_shift), 1, 1, 1},
  {&__pyx_kp_pi, __pyx_k_pi, sizeof(__pyx_k_pi), 1, 1, 1},
  {&__pyx_kp_chainIDmax, __pyx_k_chainIDmax, sizeof(__pyx_k_chainIDmax), 1, 1, 1},
  {&__pyx_kp_chain_count, __pyx_k_chain_count, sizeof(__pyx_k_chain_count), 1, 1, 1},
  {&__pyx_kp_31, __pyx_k_31, sizeof(__pyx_k_31), 1, 1, 1},
  {&__pyx_kp_chainID, __pyx_k_chainID, sizeof(__pyx_k_chainID), 1, 1, 1},
  {&__pyx_kp_group_count, __pyx_k_group_count, sizeof(__pyx_k_group_count), 1, 1, 1},
  {&__pyx_kp_math, __pyx_k_math, sizeof(__pyx_k_math), 1, 1, 1},
  {&__pyx_kp_bisect, __pyx_k_bisect, sizeof(__pyx_k_bisect), 1, 1, 1},
  {&__pyx_kp_insort, __pyx_k_insort, sizeof(__pyx_k_insort), 1, 1, 1},
  {&__pyx_kp_sets, __pyx_k_sets, sizeof(__pyx_k_sets), 1, 1, 1},
  {&__pyx_kp_Set, __pyx_k_Set, sizeof(__pyx_k_Set), 1, 1, 1},
  {&__pyx_kp_32, __pyx_k_32, sizeof(__pyx_k_32), 1, 1, 1},
  {&__pyx_kp_33, __pyx_k_33, sizeof(__pyx_k_33), 1, 1, 1},
  {&__pyx_kp_34, __pyx_k_34, sizeof(__pyx_k_34), 1, 1, 1},
  {&__pyx_kp_35, __pyx_k_35, sizeof(__pyx_k_35), 1, 1, 1},
  {&__pyx_kp_MPI, __pyx_k_MPI, sizeof(__pyx_k_MPI), 1, 1, 1},
  {&__pyx_kp_Forthon, __pyx_k_Forthon, sizeof(__pyx_k_Forthon), 1, 1, 1},
  {&__pyx_kp_RunChainHOP, __pyx_k_RunChainHOP, sizeof(__pyx_k_RunChainHOP), 0, 1, 1},
  {&__pyx_kp_36, __pyx_k_36, sizeof(__pyx_k_36), 1, 1, 1},
  {&__pyx_kp___init__, __pyx_k___init__, sizeof(__pyx_k___init__), 1, 1, 1},
  {&__pyx_kp__init_kd_tree, __pyx_k__init_kd_tree, sizeof(__pyx_k__init_kd_tree), 1, 1, 1},
  {&__pyx_kp__is_inside, __pyx_k__is_inside, sizeof(__pyx_k__is_inside), 1, 1, 1},
  {&__pyx_kp__find_shift_padded, __pyx_k__find_shift_padded, sizeof(__pyx_k__find_shift_padded), 1, 1, 1},
  {&__pyx_kp__find_shift_real, __pyx_k__find_shift_real, sizeof(__pyx_k__find_shift_real), 1, 1, 1},
  {&__pyx_kp__translate_shift, __pyx_k__translate_shift, sizeof(__pyx_k__translate_shift), 1, 1, 1},
  {&__pyx_kp__densestNN, __pyx_k__densestNN, sizeof(__pyx_k__densestNN), 1, 1, 1},
  {&__pyx_kp__build_chains, __pyx_k__build_chains, sizeof(__pyx_k__build_chains), 1, 1, 1},
  {&__pyx_kp__recurse_links, __pyx_k__recurse_links, sizeof(__pyx_k__recurse_links), 1, 1, 1},
  {&__pyx_kp_38, __pyx_k_38, sizeof(__pyx_k_38), 1, 1, 1},
  {&__pyx_kp_39, __pyx_k_39, sizeof(__pyx_k_39), 1, 1, 1},
  {&__pyx_kp_40, __pyx_k_40, sizeof(__pyx_k_40), 1, 1, 1},
  {&__pyx_kp_41, __pyx_k_41, sizeof(__pyx_k_41), 1, 1, 1},
  {&__pyx_kp_42, __pyx_k_42, sizeof(__pyx_k_42), 1, 1, 1},
  {&__pyx_kp_43, __pyx_k_43, sizeof(__pyx_k_43), 1, 1, 1},
  {&__pyx_kp__connect_chains, __pyx_k__connect_chains, sizeof(__pyx_k__connect_chains), 1, 1, 1},
  {&__pyx_kp_44, __pyx_k_44, sizeof(__pyx_k_44), 1, 1, 1},
  {&__pyx_kp__build_groups, __pyx_k__build_groups, sizeof(__pyx_k__build_groups), 1, 1, 1},
  {&__pyx_kp__translate_groupIDs, __pyx_k__translate_groupIDs, sizeof(__pyx_k__translate_groupIDs), 1, 1, 1},
  {&__pyx_kp__chain_hop, __pyx_k__chain_hop, sizeof(__pyx_k__chain_hop), 1, 1, 1},
  {&__pyx_kp_saddlethresh, __pyx_k_saddlethresh, sizeof(__pyx_k_saddlethresh), 1, 1, 1},
  {&__pyx_kp_peakthresh, __pyx_k_peakthresh, sizeof(__pyx_k_peakthresh), 1, 1, 1},
  {&__pyx_kp_size, __pyx_k_size, sizeof(__pyx_k_size), 1, 1, 1},
  {&__pyx_kp_na, __pyx_k_na, sizeof(__pyx_k_na), 0, 1, 1},
  {&__pyx_kp_array, __pyx_k_array, sizeof(__pyx_k_array), 1, 1, 1},
  {&__pyx_kp_dtype, __pyx_k_dtype, sizeof(__pyx_k_dtype), 1, 1, 1},
  {&__pyx_kp_45, __pyx_k_45, sizeof(__pyx_k_45), 0, 1, 0},
  {&__pyx_kp_padded_particles, __pyx_k_padded_particles, sizeof(__pyx_k_padded_particles), 1, 1, 1},
  {&__pyx_kp_nMerge, __pyx_k_nMerge, sizeof(__pyx_k_nMerge), 1, 1, 1},
  {&__pyx_kp_d, __pyx_k_d, sizeof(__pyx_k_d), 1, 1, 1},
  {&__pyx_kp_ones, __pyx_k_ones, sizeof(__pyx_k_ones), 1, 1, 1},
  {&__pyx_kp_46, __pyx_k_46, sizeof(__pyx_k_46), 0, 1, 0},
  {&__pyx_kp_empty, __pyx_k_empty, sizeof(__pyx_k_empty), 1, 1, 1},
  {&__pyx_kp_47, __pyx_k_47, sizeof(__pyx_k_47), 0, 1, 0},
  {&__pyx_kp_fKD, __pyx_k_fKD, sizeof(__pyx_k_fKD), 1, 1, 1},
  {&__pyx_kp_nn_tags, __pyx_k_nn_tags, sizeof(__pyx_k_nn_tags), 1, 1, 1},
  {&__pyx_kp_zeros, __pyx_k_zeros, sizeof(__pyx_k_zeros), 1, 1, 1},
  {&__pyx_kp_48, __pyx_k_48, sizeof(__pyx_k_48), 0, 1, 0},
  {&__pyx_kp_dens, __pyx_k_dens, sizeof(__pyx_k_dens), 1, 1, 1},
  {&__pyx_kp_49, __pyx_k_49, sizeof(__pyx_k_49), 0, 1, 0},
  {&__pyx_kp_50, __pyx_k_50, sizeof(__pyx_k_50), 0, 1, 0},
  {&__pyx_kp_pos, __pyx_k_pos, sizeof(__pyx_k_pos), 1, 1, 1},
  {&__pyx_kp_51, __pyx_k_51, sizeof(__pyx_k_51), 0, 1, 0},
  {&__pyx_kp_qv, __pyx_k_qv, sizeof(__pyx_k_qv), 1, 1, 1},
  {&__pyx_kp_nn, __pyx_k_nn, sizeof(__pyx_k_nn), 1, 1, 1},
  {&__pyx_kp_nparts, __pyx_k_nparts, sizeof(__pyx_k_nparts), 1, 1, 1},
  {&__pyx_kp_sort, __pyx_k_sort, sizeof(__pyx_k_sort), 1, 1, 1},
  {&__pyx_kp_rearrange, __pyx_k_rearrange, sizeof(__pyx_k_rearrange), 1, 1, 1},
  {&__pyx_kp_create_tree, __pyx_k_create_tree, sizeof(__pyx_k_create_tree), 1, 1, 1},
  {&__pyx_kp_transpose, __pyx_k_transpose, sizeof(__pyx_k_transpose), 1, 1, 1},
  {&__pyx_kp_all, __pyx_k_all, sizeof(__pyx_k_all), 1, 1, 1},
  {&__pyx_kp_axis, __pyx_k_axis, sizeof(__pyx_k_axis), 1, 1, 1},
  {&__pyx_kp_is_inside, __pyx_k_is_inside, sizeof(__pyx_k_is_inside), 1, 1, 1},
  {&__pyx_kp_invert, __pyx_k_invert, sizeof(__pyx_k_invert), 1, 1, 1},
  {&__pyx_kp_bitwise_and, __pyx_k_bitwise_and, sizeof(__pyx_k_bitwise_and), 1, 1, 1},
  {&__pyx_kp_is_inside_annulus, __pyx_k_is_inside_annulus, sizeof(__pyx_k_is_inside_annulus), 1, 1, 1},
  {&__pyx_kp_rev_index, __pyx_k_rev_index, sizeof(__pyx_k_rev_index), 1, 1, 1},
  {&__pyx_kp_xrange, __pyx_k_xrange, sizeof(__pyx_k_xrange), 1, 1, 1},
  {&__pyx_kp_52, __pyx_k_52, sizeof(__pyx_k_52), 0, 1, 0},
  {&__pyx_kp_53, __pyx_k_53, sizeof(__pyx_k_53), 0, 1, 0},
  {&__pyx_kp_54, __pyx_k_54, sizeof(__pyx_k_54), 0, 1, 0},
  {&__pyx_kp_55, __pyx_k_55, sizeof(__pyx_k_55), 0, 1, 0},
  {&__pyx_kp_56, __pyx_k_56, sizeof(__pyx_k_56), 0, 1, 0},
  {&__pyx_kp_57, __pyx_k_57, sizeof(__pyx_k_57), 0, 1, 0},
  {&__pyx_kp_append, __pyx_k_append, sizeof(__pyx_k_append), 1, 1, 1},
  {&__pyx_kp_argmax, __pyx_k_argmax, sizeof(__pyx_k_argmax), 1, 1, 1},
  {&__pyx_kp_abs, __pyx_k_abs, sizeof(__pyx_k_abs), 1, 1, 1},
  {&__pyx_kp_58, __pyx_k_58, sizeof(__pyx_k_58), 0, 1, 0},
  {&__pyx_kp_59, __pyx_k_59, sizeof(__pyx_k_59), 0, 1, 0},
  {&__pyx_kp_densestNN, __pyx_k_densestNN, sizeof(__pyx_k_densestNN), 1, 1, 1},
  {&__pyx_kp_60, __pyx_k_60, sizeof(__pyx_k_60), 0, 1, 0},
  {&__pyx_kp_chunk_tags, __pyx_k_chunk_tags, sizeof(__pyx_k_chunk_tags), 1, 1, 1},
  {&__pyx_kp_min, __pyx_k_min, sizeof(__pyx_k_min), 1, 1, 1},
  {&__pyx_kp_start, __pyx_k_start, sizeof(__pyx_k_start), 1, 1, 1},
  {&__pyx_kp_finish, __pyx_k_finish, sizeof(__pyx_k_finish), 1, 1, 1},
  {&__pyx_kp_61, __pyx_k_61, sizeof(__pyx_k_61), 1, 1, 1},
  {&__pyx_kp_take, __pyx_k_take, sizeof(__pyx_k_take), 1, 1, 1},
  {&__pyx_kp_density, __pyx_k_density, sizeof(__pyx_k_density), 1, 1, 1},
  {&__pyx_kp_densest_in_chain, __pyx_k_densest_in_chain, sizeof(__pyx_k_densest_in_chain), 1, 1, 1},
  {&__pyx_kp_62, __pyx_k_62, sizeof(__pyx_k_62), 0, 1, 0},
  {&__pyx_kp__mpi_info_dict, __pyx_k__mpi_info_dict, sizeof(__pyx_k__mpi_info_dict), 1, 1, 1},
  {&__pyx_kp_mine, __pyx_k_mine, sizeof(__pyx_k_mine), 1, 1, 1},
  {&__pyx_kp_sum, __pyx_k_sum, sizeof(__pyx_k_sum), 1, 1, 1},
  {&__pyx_kp_values, __pyx_k_values, sizeof(__pyx_k_values), 1, 1, 1},
  {&__pyx_kp_nchains, __pyx_k_nchains, sizeof(__pyx_k_nchains), 1, 1, 1},
  {&__pyx_kp_my_first_id, __pyx_k_my_first_id, sizeof(__pyx_k_my_first_id), 1, 1, 1},
  {&__pyx_kp_items, __pyx_k_items, sizeof(__pyx_k_items), 1, 1, 1},
  {&__pyx_kp_copy, __pyx_k_copy, sizeof(__pyx_k_copy), 1, 1, 1},
  {&__pyx_kp__mpi_joindict, __pyx_k__mpi_joindict, sizeof(__pyx_k__mpi_joindict), 1, 1, 1},
  {&__pyx_kp_63, __pyx_k_63, sizeof(__pyx_k_63), 1, 1, 1},
  {&__pyx_kp_global_padded_count, __pyx_k_global_padded_count, sizeof(__pyx_k_global_padded_count), 1, 1, 1},
  {&__pyx_kp_64, __pyx_k_64, sizeof(__pyx_k_64), 0, 1, 0},
  {&__pyx_kp_recv_real_indices, __pyx_k_recv_real_indices, sizeof(__pyx_k_recv_real_indices), 1, 1, 1},
  {&__pyx_kp_65, __pyx_k_65, sizeof(__pyx_k_65), 0, 1, 0},
  {&__pyx_kp_recv_chainIDs, __pyx_k_recv_chainIDs, sizeof(__pyx_k_recv_chainIDs), 1, 1, 1},
  {&__pyx_kp_66, __pyx_k_66, sizeof(__pyx_k_66), 0, 1, 0},
  {&__pyx_kp_67, __pyx_k_67, sizeof(__pyx_k_67), 0, 1, 0},
  {&__pyx_kp_COMM_WORLD, __pyx_k_COMM_WORLD, sizeof(__pyx_k_COMM_WORLD), 1, 1, 1},
  {&__pyx_kp_Sendrecv, __pyx_k_Sendrecv, sizeof(__pyx_k_Sendrecv), 1, 1, 1},
  {&__pyx_kp_uphill_real_indices, __pyx_k_uphill_real_indices, sizeof(__pyx_k_uphill_real_indices), 1, 1, 1},
  {&__pyx_kp_INT, __pyx_k_INT, sizeof(__pyx_k_INT), 1, 1, 1},
  {&__pyx_kp_uphill_chainIDs, __pyx_k_uphill_chainIDs, sizeof(__pyx_k_uphill_chainIDs), 1, 1, 1},
  {&__pyx_kp_enumerate, __pyx_k_enumerate, sizeof(__pyx_k_enumerate), 1, 1, 1},
  {&__pyx_kp_KeyError, __pyx_k_KeyError, sizeof(__pyx_k_KeyError), 1, 1, 1},
  {&__pyx_kp_max, __pyx_k_max, sizeof(__pyx_k_max), 1, 1, 1},
  {&__pyx_kp_68, __pyx_k_68, sizeof(__pyx_k_68), 0, 1, 0},
  {&__pyx_kp_69, __pyx_k_69, sizeof(__pyx_k_69), 0, 1, 0},
  {&__pyx_kp_chain_densest_n, __pyx_k_chain_densest_n, sizeof(__pyx_k_chain_densest_n), 1, 1, 1},
  {&__pyx_kp_reverse_map, __pyx_k_reverse_map, sizeof(__pyx_k_reverse_map), 1, 1, 1},
  {&__pyx_kp_NNtags, __pyx_k_NNtags, sizeof(__pyx_k_NNtags), 1, 1, 1},
  {&__pyx_kp__mpi_maxdict, __pyx_k__mpi_maxdict, sizeof(__pyx_k__mpi_maxdict), 1, 1, 1},
  {&__pyx_kp_pop, __pyx_k_pop, sizeof(__pyx_k_pop), 1, 1, 1},
  {&__pyx_kp_densest_in_group, __pyx_k_densest_in_group, sizeof(__pyx_k_densest_in_group), 1, 1, 1},
  {&__pyx_kp_mylog, __pyx_k_mylog, sizeof(__pyx_k_mylog), 1, 1, 1},
  {&__pyx_kp_info, __pyx_k_info, sizeof(__pyx_k_info), 1, 1, 1},
  {&__pyx_kp_chainHOP_tags_dens, __pyx_k_chainHOP_tags_dens, sizeof(__pyx_k_chainHOP_tags_dens), 1, 1, 1},
  {&__pyx_kp_where, __pyx_k_where, sizeof(__pyx_k_where), 1, 1, 1},
  {&__pyx_kp_free_tree, __pyx_k_free_tree, sizeof(__pyx_k_free_tree), 1, 1, 1},
  {&__pyx_kp_70, __pyx_k_70, sizeof(__pyx_k_70), 0, 0, 0},
  {&__pyx_kp_71, __pyx_k_71, sizeof(__pyx_k_71), 0, 0, 0},
  {&__pyx_kp_72, __pyx_k_72, sizeof(__pyx_k_72), 0, 0, 0},
  {&__pyx_kp_73, __pyx_k_73, sizeof(__pyx_k_73), 0, 0, 0},
  {&__pyx_kp_74, __pyx_k_74, sizeof(__pyx_k_74), 0, 0, 0},
  {&__pyx_kp_75, __pyx_k_75, sizeof(__pyx_k_75), 0, 0, 0},
  {&__pyx_kp_76, __pyx_k_76, sizeof(__pyx_k_76), 0, 0, 0},
  {&__pyx_kp_77, __pyx_k_77, sizeof(__pyx_k_77), 0, 0, 0},
  {&__pyx_kp_78, __pyx_k_78, sizeof(__pyx_k_78), 0, 0, 0},
  {&__pyx_kp_79, __pyx_k_79, sizeof(__pyx_k_79), 0, 0, 0},
  {&__pyx_kp_80, __pyx_k_80, sizeof(__pyx_k_80), 0, 0, 0},
  {&__pyx_kp_81, __pyx_k_81, sizeof(__pyx_k_81), 0, 0, 0},
  {&__pyx_kp_82, __pyx_k_82, sizeof(__pyx_k_82), 0, 0, 0},
  {&__pyx_kp_83, __pyx_k_83, sizeof(__pyx_k_83), 0, 0, 0},
  {&__pyx_kp_84, __pyx_k_84, sizeof(__pyx_k_84), 0, 0, 0},
  {&__pyx_kp___getbuffer__, __pyx_k___getbuffer__, sizeof(__pyx_k___getbuffer__), 1, 1, 1},
  {&__pyx_kp___releasebuffer__, __pyx_k___releasebuffer__, sizeof(__pyx_k___releasebuffer__), 1, 1, 1},
  {&__pyx_kp_flags, __pyx_k_flags, sizeof(__pyx_k_flags), 1, 1, 1},
  {&__pyx_kp_ValueError, __pyx_k_ValueError, sizeof(__pyx_k_ValueError), 1, 1, 1},
  {&__pyx_kp_range, __pyx_k_range, sizeof(__pyx_k_range), 1, 1, 1},
  {&__pyx_kp_itervalues, __pyx_k_itervalues, sizeof(__pyx_k_itervalues), 1, 1, 1},
  {&__pyx_kp_RuntimeError, __pyx_k_RuntimeError, sizeof(__pyx_k_RuntimeError), 1, 1, 1},
  {&__pyx_kp_1, __pyx_k_1, sizeof(__pyx_k_1), 0, 0, 0},
  {&__pyx_kp_2, __pyx_k_2, sizeof(__pyx_k_2), 0, 0, 0},
  {&__pyx_kp_5, __pyx_k_5, sizeof(__pyx_k_5), 0, 0, 0},
  {&__pyx_kp_23, __pyx_k_23, sizeof(__pyx_k_23), 0, 0, 0},
  {&__pyx_kp_25, __pyx_k_25, sizeof(__pyx_k_25), 0, 0, 0},
  {&__pyx_kp_28, __pyx_k_28, sizeof(__pyx_k_28), 0, 0, 0},
  {&__pyx_kp_29, __pyx_k_29, sizeof(__pyx_k_29), 0, 0, 0},
  {&__pyx_kp_30, __pyx_k_30, sizeof(__pyx_k_30), 0, 0, 0},
  {0, 0, 0, 0, 0, 0}
};
static int __Pyx_InitCachedBuiltins(void) {
  __pyx_builtin_xrange = __Pyx_GetName(__pyx_b, __pyx_kp_xrange); if (!__pyx_builtin_xrange) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 93; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __pyx_builtin_min = __Pyx_GetName(__pyx_b, __pyx_kp_min); if (!__pyx_builtin_min) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 229; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __pyx_builtin_sum = __Pyx_GetName(__pyx_b, __pyx_kp_sum); if (!__pyx_builtin_sum) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 312; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __pyx_builtin_enumerate = __Pyx_GetName(__pyx_b, __pyx_kp_enumerate); if (!__pyx_builtin_enumerate) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 425; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __pyx_builtin_KeyError = __Pyx_GetName(__pyx_b, __pyx_kp_KeyError); if (!__pyx_builtin_KeyError) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 436; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __pyx_builtin_max = __Pyx_GetName(__pyx_b, __pyx_kp_max); if (!__pyx_builtin_max) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 514; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __pyx_builtin_ValueError = __Pyx_GetName(__pyx_b, __pyx_kp_ValueError); if (!__pyx_builtin_ValueError) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 83; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __pyx_builtin_range = __Pyx_GetName(__pyx_b, __pyx_kp_range); if (!__pyx_builtin_range) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 96; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __pyx_builtin_RuntimeError = __Pyx_GetName(__pyx_b, __pyx_kp_RuntimeError); if (!__pyx_builtin_RuntimeError) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 292; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  return 0;
  __pyx_L1_error:;
  return -1;
}

static int __Pyx_InitGlobals(void) {
  __pyx_int_3 = PyInt_FromLong(3); if (unlikely(!__pyx_int_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1; __pyx_clineno = __LINE__; goto __pyx_L1_error;};
  __pyx_int_4 = PyInt_FromLong(4); if (unlikely(!__pyx_int_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1; __pyx_clineno = __LINE__; goto __pyx_L1_error;};
  __pyx_int_neg_1 = PyInt_FromLong(-1); if (unlikely(!__pyx_int_neg_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1; __pyx_clineno = __LINE__; goto __pyx_L1_error;};
  __pyx_int_2 = PyInt_FromLong(2); if (unlikely(!__pyx_int_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1; __pyx_clineno = __LINE__; goto __pyx_L1_error;};
  __pyx_int_0 = PyInt_FromLong(0); if (unlikely(!__pyx_int_0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1; __pyx_clineno = __LINE__; goto __pyx_L1_error;};
  __pyx_int_1 = PyInt_FromLong(1); if (unlikely(!__pyx_int_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1; __pyx_clineno = __LINE__; goto __pyx_L1_error;};
  __pyx_int_5 = PyInt_FromLong(5); if (unlikely(!__pyx_int_5)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1; __pyx_clineno = __LINE__; goto __pyx_L1_error;};
  __pyx_int_6 = PyInt_FromLong(6); if (unlikely(!__pyx_int_6)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1; __pyx_clineno = __LINE__; goto __pyx_L1_error;};
  __pyx_int_7 = PyInt_FromLong(7); if (unlikely(!__pyx_int_7)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1; __pyx_clineno = __LINE__; goto __pyx_L1_error;};
  __pyx_int_8 = PyInt_FromLong(8); if (unlikely(!__pyx_int_8)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1; __pyx_clineno = __LINE__; goto __pyx_L1_error;};
  __pyx_int_9 = PyInt_FromLong(9); if (unlikely(!__pyx_int_9)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1; __pyx_clineno = __LINE__; goto __pyx_L1_error;};
  __pyx_int_10 = PyInt_FromLong(10); if (unlikely(!__pyx_int_10)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1; __pyx_clineno = __LINE__; goto __pyx_L1_error;};
  __pyx_int_11 = PyInt_FromLong(11); if (unlikely(!__pyx_int_11)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1; __pyx_clineno = __LINE__; goto __pyx_L1_error;};
  __pyx_int_12 = PyInt_FromLong(12); if (unlikely(!__pyx_int_12)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1; __pyx_clineno = __LINE__; goto __pyx_L1_error;};
  __pyx_int_13 = PyInt_FromLong(13); if (unlikely(!__pyx_int_13)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1; __pyx_clineno = __LINE__; goto __pyx_L1_error;};
  __pyx_int_14 = PyInt_FromLong(14); if (unlikely(!__pyx_int_14)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1; __pyx_clineno = __LINE__; goto __pyx_L1_error;};
  __pyx_int_15 = PyInt_FromLong(15); if (unlikely(!__pyx_int_15)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1; __pyx_clineno = __LINE__; goto __pyx_L1_error;};
  __pyx_int_16 = PyInt_FromLong(16); if (unlikely(!__pyx_int_16)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1; __pyx_clineno = __LINE__; goto __pyx_L1_error;};
  __pyx_int_17 = PyInt_FromLong(17); if (unlikely(!__pyx_int_17)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1; __pyx_clineno = __LINE__; goto __pyx_L1_error;};
  __pyx_int_18 = PyInt_FromLong(18); if (unlikely(!__pyx_int_18)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1; __pyx_clineno = __LINE__; goto __pyx_L1_error;};
  __pyx_int_19 = PyInt_FromLong(19); if (unlikely(!__pyx_int_19)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1; __pyx_clineno = __LINE__; goto __pyx_L1_error;};
  __pyx_int_20 = PyInt_FromLong(20); if (unlikely(!__pyx_int_20)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1; __pyx_clineno = __LINE__; goto __pyx_L1_error;};
  __pyx_int_21 = PyInt_FromLong(21); if (unlikely(!__pyx_int_21)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1; __pyx_clineno = __LINE__; goto __pyx_L1_error;};
  __pyx_int_22 = PyInt_FromLong(22); if (unlikely(!__pyx_int_22)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1; __pyx_clineno = __LINE__; goto __pyx_L1_error;};
  __pyx_int_23 = PyInt_FromLong(23); if (unlikely(!__pyx_int_23)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1; __pyx_clineno = __LINE__; goto __pyx_L1_error;};
  __pyx_int_24 = PyInt_FromLong(24); if (unlikely(!__pyx_int_24)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1; __pyx_clineno = __LINE__; goto __pyx_L1_error;};
  __pyx_int_25 = PyInt_FromLong(25); if (unlikely(!__pyx_int_25)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1; __pyx_clineno = __LINE__; goto __pyx_L1_error;};
  __pyx_int_26 = PyInt_FromLong(26); if (unlikely(!__pyx_int_26)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1; __pyx_clineno = __LINE__; goto __pyx_L1_error;};
  __pyx_int_27 = PyInt_FromLong(27); if (unlikely(!__pyx_int_27)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1; __pyx_clineno = __LINE__; goto __pyx_L1_error;};
  if (__Pyx_InitStrings(__pyx_string_tab) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1; __pyx_clineno = __LINE__; goto __pyx_L1_error;};
  return 0;
  __pyx_L1_error:;
  return -1;
}

#if PY_MAJOR_VERSION < 3
PyMODINIT_FUNC initchainHOP(void); /*proto*/
PyMODINIT_FUNC initchainHOP(void)
#else
PyMODINIT_FUNC PyInit_chainHOP(void); /*proto*/
PyMODINIT_FUNC PyInit_chainHOP(void)
#endif
{
  PyObject *__pyx_1 = 0;
  PyObject *__pyx_2 = 0;
  PyObject *__pyx_3 = 0;
  PyObject *__pyx_t_1 = NULL;
  #ifdef CYTHON_REFNANNY
  void* __pyx_refchk = NULL;
  __Pyx_Refnanny = __Pyx_ImportRefcountAPI("refnanny");
  if (!__Pyx_Refnanny) {
      PyErr_Clear();
      __Pyx_Refnanny = __Pyx_ImportRefcountAPI("Cython.Runtime.refnanny");
      if (!__Pyx_Refnanny)
          Py_FatalError("failed to import refnanny module");
  }
  __pyx_refchk = __Pyx_Refnanny->NewContext("PyMODINIT_FUNC PyInit_chainHOP(void)", __LINE__, __FILE__);
  #endif
  __pyx_empty_tuple = PyTuple_New(0); if (unlikely(!__pyx_empty_tuple)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  /*--- Library function declarations ---*/
  __pyx_init_filenames();
  /*--- Threads initialization code ---*/
  #if defined(__PYX_FORCE_INIT_THREADS) && __PYX_FORCE_INIT_THREADS
  #ifdef WITH_THREAD /* Python build with threading support? */
  PyEval_InitThreads();
  #endif
  #endif
  /*--- Initialize various global constants etc. ---*/
  if (unlikely(__Pyx_InitGlobals() < 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  /*--- Module creation code ---*/
  #if PY_MAJOR_VERSION < 3
  __pyx_m = Py_InitModule4(__Pyx_NAMESTR("chainHOP"), __pyx_methods, 0, 0, PYTHON_API_VERSION);
  #else
  __pyx_m = PyModule_Create(&__pyx_moduledef);
  #endif
  if (!__pyx_m) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1; __pyx_clineno = __LINE__; goto __pyx_L1_error;};
  #if PY_MAJOR_VERSION < 3
  Py_INCREF(__pyx_m);
  #endif
  __pyx_b = PyImport_AddModule(__Pyx_NAMESTR(__Pyx_BUILTIN_MODULE_NAME));
  if (!__pyx_b) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1; __pyx_clineno = __LINE__; goto __pyx_L1_error;};
  if (__Pyx_SetAttrString(__pyx_m, "__builtins__", __pyx_b) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1; __pyx_clineno = __LINE__; goto __pyx_L1_error;};
  if (__pyx_module_is_main_yt__lagos__chainHOP__chainHOP) {
    if (__Pyx_SetAttrString(__pyx_m, "__name__", __pyx_kp___main__) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1; __pyx_clineno = __LINE__; goto __pyx_L1_error;};
  }
  /*--- Builtin init code ---*/
  if (unlikely(__Pyx_InitCachedBuiltins() < 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __pyx_skip_dispatch = 0;
  /*--- Global init code ---*/
  /*--- Function export code ---*/
  /*--- Type init code ---*/
  /*--- Type import code ---*/
  __pyx_ptype_5numpy_dtype = __Pyx_ImportType("numpy", "dtype", sizeof(PyArray_Descr)); if (unlikely(!__pyx_ptype_5numpy_dtype)) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 43; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __pyx_ptype_5numpy_ndarray = __Pyx_ImportType("numpy", "ndarray", sizeof(PyArrayObject)); if (unlikely(!__pyx_ptype_5numpy_ndarray)) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 51; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  /*--- Function import code ---*/
  /*--- Execution code ---*/

  /* "/Users/sskory/Documents/yt-devel/yt/lagos/chainHOP/chainHOP.pyx":1
 * import math             # <<<<<<<<<<<<<<
 * from bisect import insort
 * from sets import Set
 */
  __pyx_1 = __Pyx_Import(__pyx_kp_math, 0); if (unlikely(!__pyx_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_1);
  if (PyObject_SetAttr(__pyx_m, __pyx_kp_math, __pyx_1) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_DECREF(__pyx_1); __pyx_1 = 0;

  /* "/Users/sskory/Documents/yt-devel/yt/lagos/chainHOP/chainHOP.pyx":2
 * import math
 * from bisect import insort             # <<<<<<<<<<<<<<
 * from sets import Set
 * 
 */
  __pyx_t_1 = PyList_New(1); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(((PyObject *)__pyx_t_1));
  __Pyx_INCREF(__pyx_kp_insort);
  PyList_SET_ITEM(__pyx_t_1, 0, __pyx_kp_insort);
  __Pyx_GIVEREF(__pyx_kp_insort);
  __pyx_1 = __Pyx_Import(__pyx_kp_bisect, ((PyObject *)__pyx_t_1)); if (unlikely(!__pyx_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_1);
  __Pyx_DECREF(((PyObject *)__pyx_t_1)); __pyx_t_1 = 0;
  __pyx_2 = PyObject_GetAttr(__pyx_1, __pyx_kp_insort); if (unlikely(!__pyx_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_2);
  if (PyObject_SetAttr(__pyx_m, __pyx_kp_insort, __pyx_2) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_DECREF(__pyx_2); __pyx_2 = 0;
  __Pyx_DECREF(__pyx_1); __pyx_1 = 0;

  /* "/Users/sskory/Documents/yt-devel/yt/lagos/chainHOP/chainHOP.pyx":3
 * import math
 * from bisect import insort
 * from sets import Set             # <<<<<<<<<<<<<<
 * 
 * from yt.lagos import *
 */
  __pyx_t_1 = PyList_New(1); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 3; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(((PyObject *)__pyx_t_1));
  __Pyx_INCREF(__pyx_kp_Set);
  PyList_SET_ITEM(__pyx_t_1, 0, __pyx_kp_Set);
  __Pyx_GIVEREF(__pyx_kp_Set);
  __pyx_1 = __Pyx_Import(__pyx_kp_sets, ((PyObject *)__pyx_t_1)); if (unlikely(!__pyx_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 3; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_1);
  __Pyx_DECREF(((PyObject *)__pyx_t_1)); __pyx_t_1 = 0;
  __pyx_2 = PyObject_GetAttr(__pyx_1, __pyx_kp_Set); if (unlikely(!__pyx_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 3; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_2);
  if (PyObject_SetAttr(__pyx_m, __pyx_kp_Set, __pyx_2) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 3; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_DECREF(__pyx_2); __pyx_2 = 0;
  __Pyx_DECREF(__pyx_1); __pyx_1 = 0;

  /* "/Users/sskory/Documents/yt-devel/yt/lagos/chainHOP/chainHOP.pyx":5
 * from sets import Set
 * 
 * from yt.lagos import *             # <<<<<<<<<<<<<<
 * from yt.extensions.kdtree import *
 * from mpi4py import MPI
 */
  __pyx_t_1 = PyList_New(1); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 5; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(((PyObject *)__pyx_t_1));
  __Pyx_INCREF(__pyx_kp_33);
  PyList_SET_ITEM(__pyx_t_1, 0, __pyx_kp_33);
  __Pyx_GIVEREF(__pyx_kp_33);
  __pyx_1 = __Pyx_Import(__pyx_kp_32, ((PyObject *)__pyx_t_1)); if (unlikely(!__pyx_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 5; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_1);
  __Pyx_DECREF(((PyObject *)__pyx_t_1)); __pyx_t_1 = 0;
  if (__pyx_import_star(__pyx_1) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 5; __pyx_clineno = __LINE__; goto __pyx_L1_error;};
  __Pyx_DECREF(__pyx_1); __pyx_1 = 0;

  /* "/Users/sskory/Documents/yt-devel/yt/lagos/chainHOP/chainHOP.pyx":6
 * 
 * from yt.lagos import *
 * from yt.extensions.kdtree import *             # <<<<<<<<<<<<<<
 * from mpi4py import MPI
 * from Forthon import *
 */
  __pyx_t_1 = PyList_New(1); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 6; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(((PyObject *)__pyx_t_1));
  __Pyx_INCREF(__pyx_kp_33);
  PyList_SET_ITEM(__pyx_t_1, 0, __pyx_kp_33);
  __Pyx_GIVEREF(__pyx_kp_33);
  __pyx_1 = __Pyx_Import(__pyx_kp_34, ((PyObject *)__pyx_t_1)); if (unlikely(!__pyx_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 6; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_1);
  __Pyx_DECREF(((PyObject *)__pyx_t_1)); __pyx_t_1 = 0;
  if (__pyx_import_star(__pyx_1) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 6; __pyx_clineno = __LINE__; goto __pyx_L1_error;};
  __Pyx_DECREF(__pyx_1); __pyx_1 = 0;

  /* "/Users/sskory/Documents/yt-devel/yt/lagos/chainHOP/chainHOP.pyx":7
 * from yt.lagos import *
 * from yt.extensions.kdtree import *
 * from mpi4py import MPI             # <<<<<<<<<<<<<<
 * from Forthon import *
 * 
 */
  __pyx_t_1 = PyList_New(1); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 7; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(((PyObject *)__pyx_t_1));
  __Pyx_INCREF(__pyx_kp_MPI);
  PyList_SET_ITEM(__pyx_t_1, 0, __pyx_kp_MPI);
  __Pyx_GIVEREF(__pyx_kp_MPI);
  __pyx_1 = __Pyx_Import(__pyx_kp_35, ((PyObject *)__pyx_t_1)); if (unlikely(!__pyx_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 7; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_1);
  __Pyx_DECREF(((PyObject *)__pyx_t_1)); __pyx_t_1 = 0;
  __pyx_2 = PyObject_GetAttr(__pyx_1, __pyx_kp_MPI); if (unlikely(!__pyx_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 7; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_2);
  if (PyObject_SetAttr(__pyx_m, __pyx_kp_MPI, __pyx_2) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 7; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_DECREF(__pyx_2); __pyx_2 = 0;
  __Pyx_DECREF(__pyx_1); __pyx_1 = 0;

  /* "/Users/sskory/Documents/yt-devel/yt/lagos/chainHOP/chainHOP.pyx":8
 * from yt.extensions.kdtree import *
 * from mpi4py import MPI
 * from Forthon import *             # <<<<<<<<<<<<<<
 * 
 * cimport numpy as na
 */
  __pyx_t_1 = PyList_New(1); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 8; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(((PyObject *)__pyx_t_1));
  __Pyx_INCREF(__pyx_kp_33);
  PyList_SET_ITEM(__pyx_t_1, 0, __pyx_kp_33);
  __Pyx_GIVEREF(__pyx_kp_33);
  __pyx_1 = __Pyx_Import(__pyx_kp_Forthon, ((PyObject *)__pyx_t_1)); if (unlikely(!__pyx_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 8; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_1);
  __Pyx_DECREF(((PyObject *)__pyx_t_1)); __pyx_t_1 = 0;
  if (__pyx_import_star(__pyx_1) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 8; __pyx_clineno = __LINE__; goto __pyx_L1_error;};
  __Pyx_DECREF(__pyx_1); __pyx_1 = 0;

  /* "/Users/sskory/Documents/yt-devel/yt/lagos/chainHOP/chainHOP.pyx":12
 * cimport numpy as na
 * 
 * class RunChainHOP(ParallelAnalysisInterface):             # <<<<<<<<<<<<<<
 *     def __init__(self, period, padding, num_neighbors, bounds,
 *             xpos, ypos, zpos, index, mass, threshold=160.0):
 */
  __pyx_1 = PyDict_New(); if (unlikely(!__pyx_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 12; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(((PyObject *)__pyx_1));
  __pyx_2 = __Pyx_GetName(__pyx_m, __pyx_kp_36); if (unlikely(!__pyx_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 12; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_2);
  __pyx_t_1 = PyTuple_New(1); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 12; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(((PyObject *)__pyx_t_1));
  PyTuple_SET_ITEM(__pyx_t_1, 0, __pyx_2);
  __Pyx_GIVEREF(__pyx_2);
  __pyx_2 = 0;
  __pyx_2 = __Pyx_CreateClass(((PyObject *)__pyx_t_1), ((PyObject *)__pyx_1), __pyx_kp_RunChainHOP, "yt.lagos.chainHOP.chainHOP"); if (unlikely(!__pyx_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 12; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_2);
  __Pyx_DECREF(((PyObject *)__pyx_t_1)); __pyx_t_1 = 0;

  /* "/Users/sskory/Documents/yt-devel/yt/lagos/chainHOP/chainHOP.pyx":14
 * class RunChainHOP(ParallelAnalysisInterface):
 *     def __init__(self, period, padding, num_neighbors, bounds,
 *             xpos, ypos, zpos, index, mass, threshold=160.0):             # <<<<<<<<<<<<<<
 *         self.threshold = threshold
 *         self.saddlethresh = 2.5 * threshold
 */
  __pyx_t_1 = PyFloat_FromDouble(160.0); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 14; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_k_37 = __pyx_t_1;
  __pyx_t_1 = 0;
  __Pyx_GIVEREF(__pyx_k_37);

  /* "/Users/sskory/Documents/yt-devel/yt/lagos/chainHOP/chainHOP.pyx":13
 * 
 * class RunChainHOP(ParallelAnalysisInterface):
 *     def __init__(self, period, padding, num_neighbors, bounds,             # <<<<<<<<<<<<<<
 *             xpos, ypos, zpos, index, mass, threshold=160.0):
 *         self.threshold = threshold
 */
  __pyx_t_1 = PyCFunction_New(&__pyx_mdef_2yt_5lagos_8chainHOP_8chainHOP_11RunChainHOP___init__, 0); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 13; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_3 = PyMethod_New(__pyx_t_1, 0, __pyx_2); if (unlikely(!__pyx_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 13; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_3);
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  if (PyObject_SetAttr(__pyx_2, __pyx_kp___init__, __pyx_3) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 13; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_DECREF(__pyx_3); __pyx_3 = 0;

  /* "/Users/sskory/Documents/yt-devel/yt/lagos/chainHOP/chainHOP.pyx":35
 * 
 * 
 *     def _init_kd_tree(object self):             # <<<<<<<<<<<<<<
 *         """
 *         Set up the data objects that get passed to the kD-tree code.
 */
  __pyx_t_1 = PyCFunction_New(&__pyx_mdef_2yt_5lagos_8chainHOP_8chainHOP_11RunChainHOP__init_kd_tree, 0); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 35; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_3 = PyMethod_New(__pyx_t_1, 0, __pyx_2); if (unlikely(!__pyx_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 35; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_3);
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  if (PyObject_SetAttr(__pyx_2, __pyx_kp__init_kd_tree, __pyx_3) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 35; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_DECREF(__pyx_3); __pyx_3 = 0;

  /* "/Users/sskory/Documents/yt-devel/yt/lagos/chainHOP/chainHOP.pyx":59
 *         create_tree()
 * 
 *     def _is_inside(object self):             # <<<<<<<<<<<<<<
 *         """
 *         There are three classes of particles.
 */
  __pyx_t_1 = PyCFunction_New(&__pyx_mdef_2yt_5lagos_8chainHOP_8chainHOP_11RunChainHOP__is_inside, 0); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 59; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_3 = PyMethod_New(__pyx_t_1, 0, __pyx_2); if (unlikely(!__pyx_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 59; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_3);
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  if (PyObject_SetAttr(__pyx_2, __pyx_kp__is_inside, __pyx_3) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 59; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_DECREF(__pyx_3); __pyx_3 = 0;

  /* "/Users/sskory/Documents/yt-devel/yt/lagos/chainHOP/chainHOP.pyx":102
 *     # in handy in the future, if needed.
 * 
 *     def _find_shift_padded(self, i):             # <<<<<<<<<<<<<<
 *         """
 *         Find the shift vector for a padded particle.
 */
  __pyx_t_1 = PyCFunction_New(&__pyx_mdef_2yt_5lagos_8chainHOP_8chainHOP_11RunChainHOP__find_shift_padded, 0); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 102; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_3 = PyMethod_New(__pyx_t_1, 0, __pyx_2); if (unlikely(!__pyx_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 102; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_3);
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  if (PyObject_SetAttr(__pyx_2, __pyx_kp__find_shift_padded, __pyx_3) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 102; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_DECREF(__pyx_3); __pyx_3 = 0;

  /* "/Users/sskory/Documents/yt-devel/yt/lagos/chainHOP/chainHOP.pyx":140
 *         return shift
 * 
 *     def _find_shift_real(self, i):             # <<<<<<<<<<<<<<
 *         """
 *         Find shift vectors for a particle in the 'real' region. A particle
 */
  __pyx_t_1 = PyCFunction_New(&__pyx_mdef_2yt_5lagos_8chainHOP_8chainHOP_11RunChainHOP__find_shift_real, 0); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 140; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_3 = PyMethod_New(__pyx_t_1, 0, __pyx_2); if (unlikely(!__pyx_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 140; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_3);
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  if (PyObject_SetAttr(__pyx_2, __pyx_kp__find_shift_real, __pyx_3) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 140; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_DECREF(__pyx_3); __pyx_3 = 0;

  /* "/Users/sskory/Documents/yt-devel/yt/lagos/chainHOP/chainHOP.pyx":188
 * 
 * 
 *     def _translate_shift(object self, i=None, shift=None):             # <<<<<<<<<<<<<<
 *         """
 *         Given an integer, return the corresponding shift, and given a shift
 */
  __pyx_t_1 = PyCFunction_New(&__pyx_mdef_2yt_5lagos_8chainHOP_8chainHOP_11RunChainHOP__translate_shift, 0); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 188; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_3 = PyMethod_New(__pyx_t_1, 0, __pyx_2); if (unlikely(!__pyx_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 188; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_3);
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  if (PyObject_SetAttr(__pyx_2, __pyx_kp__translate_shift, __pyx_3) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 188; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_DECREF(__pyx_3); __pyx_3 = 0;

  /* "/Users/sskory/Documents/yt-devel/yt/lagos/chainHOP/chainHOP.pyx":212
 *                     return key
 * 
 *     def _densestNN(object self):             # <<<<<<<<<<<<<<
 *         """
 *         For all particles, find their densest nearest neighbor. It is done in
 */
  __pyx_t_1 = PyCFunction_New(&__pyx_mdef_2yt_5lagos_8chainHOP_8chainHOP_11RunChainHOP__densestNN, 0); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 212; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_3 = PyMethod_New(__pyx_t_1, 0, __pyx_2); if (unlikely(!__pyx_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 212; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_3);
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  if (PyObject_SetAttr(__pyx_2, __pyx_kp__densestNN, __pyx_3) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 212; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_DECREF(__pyx_3); __pyx_3 = 0;

  /* "/Users/sskory/Documents/yt-devel/yt/lagos/chainHOP/chainHOP.pyx":247
 *             start = finish + 1
 * 
 *     def _build_chains(object self):             # <<<<<<<<<<<<<<
 *         """
 *         Build the first round of particle chains. If the particle is too low in
 */
  __pyx_t_1 = PyCFunction_New(&__pyx_mdef_2yt_5lagos_8chainHOP_8chainHOP_11RunChainHOP__build_chains, 0); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 247; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_3 = PyMethod_New(__pyx_t_1, 0, __pyx_2); if (unlikely(!__pyx_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 247; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_3);
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  if (PyObject_SetAttr(__pyx_2, __pyx_kp__build_chains, __pyx_3) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 247; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_DECREF(__pyx_3); __pyx_3 = 0;

  /* "/Users/sskory/Documents/yt-devel/yt/lagos/chainHOP/chainHOP.pyx":272
 *         return chainIDmax
 * 
 *     def _recurse_links(object self, long pi, int chainIDmax):             # <<<<<<<<<<<<<<
 *         """
 *         Recurse up the chain to a) a self-highest density particle,
 */
  __pyx_t_1 = PyCFunction_New(&__pyx_mdef_2yt_5lagos_8chainHOP_8chainHOP_11RunChainHOP__recurse_links, 0); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 272; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_3 = PyMethod_New(__pyx_t_1, 0, __pyx_2); if (unlikely(!__pyx_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 272; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_3);
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  if (PyObject_SetAttr(__pyx_2, __pyx_kp__recurse_links, __pyx_3) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 272; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_DECREF(__pyx_3); __pyx_3 = 0;

  /* "/Users/sskory/Documents/yt-devel/yt/lagos/chainHOP/chainHOP.pyx":305
 *             return chainIDnew
 * 
 *     def _globally_assign_chainIDs(object self, int chain_count):             # <<<<<<<<<<<<<<
 *         """
 *         Convert local chainIDs into globally unique chainIDs.
 */
  __pyx_t_1 = PyCFunction_New(&__pyx_mdef_2yt_5lagos_8chainHOP_8chainHOP_11RunChainHOP__globally_assign_chainIDs, 0); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 305; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_3 = PyMethod_New(__pyx_t_1, 0, __pyx_2); if (unlikely(!__pyx_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 305; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_3);
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  if (PyObject_SetAttr(__pyx_2, __pyx_kp_38, __pyx_3) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 305; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_DECREF(__pyx_3); __pyx_3 = 0;

  /* "/Users/sskory/Documents/yt-devel/yt/lagos/chainHOP/chainHOP.pyx":320
 *         self.chainID += select
 * 
 *     def _create_global_densest_in_chain(object self):             # <<<<<<<<<<<<<<
 *         """
 *         With the globally unique chainIDs, update densest_in_chain.
 */
  __pyx_t_1 = PyCFunction_New(&__pyx_mdef_2yt_5lagos_8chainHOP_8chainHOP_11RunChainHOP__create_global_densest_in_chain, 0); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 320; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_3 = PyMethod_New(__pyx_t_1, 0, __pyx_2); if (unlikely(!__pyx_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 320; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_3);
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  if (PyObject_SetAttr(__pyx_2, __pyx_kp_39, __pyx_3) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 320; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_DECREF(__pyx_3); __pyx_3 = 0;

  /* "/Users/sskory/Documents/yt-devel/yt/lagos/chainHOP/chainHOP.pyx":332
 *         self.densest_in_chain = self._mpi_joindict(self.densest_in_chain)
 * 
 *     def _communicate_uphill_info(object self):             # <<<<<<<<<<<<<<
 *         """
 *         Communicate the links to the correct neighbors from uphill_info.
 */
  __pyx_t_1 = PyCFunction_New(&__pyx_mdef_2yt_5lagos_8chainHOP_8chainHOP_11RunChainHOP__communicate_uphill_info, 0); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 332; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_3 = PyMethod_New(__pyx_t_1, 0, __pyx_2); if (unlikely(!__pyx_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 332; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_3);
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  if (PyObject_SetAttr(__pyx_2, __pyx_kp_40, __pyx_3) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 332; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_DECREF(__pyx_3); __pyx_3 = 0;

  /* "/Users/sskory/Documents/yt-devel/yt/lagos/chainHOP/chainHOP.pyx":389
 *             so_far += opp_size
 * 
 *     def _recurse_global_chain_links(object self, chainID_translate_map_global, int chainID):             # <<<<<<<<<<<<<<
 *         """
 *         Step up the global chain links until we reach the self-densest chain,
 */
  __pyx_t_1 = PyCFunction_New(&__pyx_mdef_2yt_5lagos_8chainHOP_8chainHOP_11RunChainHOP__recurse_global_chain_links, 0); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 389; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_3 = PyMethod_New(__pyx_t_1, 0, __pyx_2); if (unlikely(!__pyx_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 389; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_3);
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  if (PyObject_SetAttr(__pyx_2, __pyx_kp_41, __pyx_3) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 389; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_DECREF(__pyx_3); __pyx_3 = 0;

  /* "/Users/sskory/Documents/yt-devel/yt/lagos/chainHOP/chainHOP.pyx":403
 * 
 * 
 *     def _connect_chains_across_tasks(object self):             # <<<<<<<<<<<<<<
 *         """
 *         Using the uphill links of chains, chains are linked across boundaries.
 */
  __pyx_t_1 = PyCFunction_New(&__pyx_mdef_2yt_5lagos_8chainHOP_8chainHOP_11RunChainHOP__connect_chains_across_tasks, 0); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 403; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_3 = PyMethod_New(__pyx_t_1, 0, __pyx_2); if (unlikely(!__pyx_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 403; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_3);
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  if (PyObject_SetAttr(__pyx_2, __pyx_kp_42, __pyx_3) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 403; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_DECREF(__pyx_3); __pyx_3 = 0;

  /* "/Users/sskory/Documents/yt-devel/yt/lagos/chainHOP/chainHOP.pyx":489
 *             self.chainID[i] = new_chainID
 * 
 *     def _communicate_annulus_chainIDs(object self):             # <<<<<<<<<<<<<<
 *         """
 *         Transmit all of our chainID-ed particles that are within self.padding
 */
  __pyx_t_1 = PyCFunction_New(&__pyx_mdef_2yt_5lagos_8chainHOP_8chainHOP_11RunChainHOP__communicate_annulus_chainIDs, 0); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 489; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_3 = PyMethod_New(__pyx_t_1, 0, __pyx_2); if (unlikely(!__pyx_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 489; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_3);
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  if (PyObject_SetAttr(__pyx_2, __pyx_kp_43, __pyx_3) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 489; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_DECREF(__pyx_3); __pyx_3 = 0;

  /* "/Users/sskory/Documents/yt-devel/yt/lagos/chainHOP/chainHOP.pyx":547
 *                     continue
 * 
 *     def _connect_chains(object self):             # <<<<<<<<<<<<<<
 *         """
 *         With the set of particle chains, build a mapping of connected chainIDs
 */
  __pyx_t_1 = PyCFunction_New(&__pyx_mdef_2yt_5lagos_8chainHOP_8chainHOP_11RunChainHOP__connect_chains, 0); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 547; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_3 = PyMethod_New(__pyx_t_1, 0, __pyx_2); if (unlikely(!__pyx_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 547; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_3);
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  if (PyObject_SetAttr(__pyx_2, __pyx_kp__connect_chains, __pyx_3) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 547; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_DECREF(__pyx_3); __pyx_3 = 0;

  /* "/Users/sskory/Documents/yt-devel/yt/lagos/chainHOP/chainHOP.pyx":608
 *                     continue
 * 
 *     def _make_global_chain_densest_n(object self):             # <<<<<<<<<<<<<<
 *         """
 *         We want to record the maximum boundary density between all chains on
 */
  __pyx_t_1 = PyCFunction_New(&__pyx_mdef_2yt_5lagos_8chainHOP_8chainHOP_11RunChainHOP__make_global_chain_densest_n, 0); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 608; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_3 = PyMethod_New(__pyx_t_1, 0, __pyx_2); if (unlikely(!__pyx_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 608; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_3);
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  if (PyObject_SetAttr(__pyx_2, __pyx_kp_44, __pyx_3) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 608; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_DECREF(__pyx_3); __pyx_3 = 0;

  /* "/Users/sskory/Documents/yt-devel/yt/lagos/chainHOP/chainHOP.pyx":620
 *                 self._mpi_maxdict(self.chain_densest_n[higher_chain])
 * 
 *     def _build_groups(object self):             # <<<<<<<<<<<<<<
 *         """
 *         With the collection of possible chain links, build groups.
 */
  __pyx_t_1 = PyCFunction_New(&__pyx_mdef_2yt_5lagos_8chainHOP_8chainHOP_11RunChainHOP__build_groups, 0); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 620; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_3 = PyMethod_New(__pyx_t_1, 0, __pyx_2); if (unlikely(!__pyx_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 620; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_3);
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  if (PyObject_SetAttr(__pyx_2, __pyx_kp__build_groups, __pyx_3) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 620; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_DECREF(__pyx_3); __pyx_3 = 0;

  /* "/Users/sskory/Documents/yt-devel/yt/lagos/chainHOP/chainHOP.pyx":722
 *         return group_count
 * 
 *     def _translate_groupIDs(object self, long group_count):             # <<<<<<<<<<<<<<
 *         """
 *         Using the maps, convert the particle chainIDs into their locally-final
 */
  __pyx_t_1 = PyCFunction_New(&__pyx_mdef_2yt_5lagos_8chainHOP_8chainHOP_11RunChainHOP__translate_groupIDs, 0); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 722; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_3 = PyMethod_New(__pyx_t_1, 0, __pyx_2); if (unlikely(!__pyx_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 722; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_3);
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  if (PyObject_SetAttr(__pyx_2, __pyx_kp__translate_groupIDs, __pyx_3) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 722; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_DECREF(__pyx_3); __pyx_3 = 0;

  /* "/Users/sskory/Documents/yt-devel/yt/lagos/chainHOP/chainHOP.pyx":749
 *                 self.densest_in_group[groupID] = max_dens
 * 
 *     def _chain_hop(self):             # <<<<<<<<<<<<<<
 *         mylog.info("Running Cython version.")
 *         mylog.info('Building kd tree for %d particles...' % \
 */
  __pyx_t_1 = PyCFunction_New(&__pyx_mdef_2yt_5lagos_8chainHOP_8chainHOP_11RunChainHOP__chain_hop, 0); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 749; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_3 = PyMethod_New(__pyx_t_1, 0, __pyx_2); if (unlikely(!__pyx_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 749; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_3);
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  if (PyObject_SetAttr(__pyx_2, __pyx_kp__chain_hop, __pyx_3) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 749; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_DECREF(__pyx_3); __pyx_3 = 0;
  if (PyObject_SetAttr(__pyx_m, __pyx_kp_RunChainHOP, __pyx_2) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 12; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_DECREF(__pyx_2); __pyx_2 = 0;
  __Pyx_DECREF(((PyObject *)__pyx_1)); __pyx_1 = 0;

  /* "/Library/Frameworks/Python.framework/Versions/4.1.30101/lib/python2.5/site-packages/Cython-0.11.2-py2.5-macosx-10.3-i386.egg/Cython/Includes/stdlib.pxd":2
 * 
 * cdef extern from "stdlib.h" nogil:             # <<<<<<<<<<<<<<
 *     void free(void *ptr)
 *     void *malloc(size_t size)
 */
  goto __pyx_L0;
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_1);
  __Pyx_XDECREF(__pyx_2);
  __Pyx_XDECREF(__pyx_3);
  __Pyx_XDECREF(__pyx_t_1);
  __Pyx_AddTraceback("yt.lagos.chainHOP.chainHOP");
  Py_DECREF(__pyx_m); __pyx_m = 0;
  __pyx_L0:;
  __Pyx_FinishRefcountContext();
  #if PY_MAJOR_VERSION < 3
  return;
  #else
  return __pyx_m;
  #endif
}

static const char *__pyx_filenames[] = {
  "chainHOP.pyx",
  "numpy.pxd",
};

/* Runtime support code */

static void __pyx_init_filenames(void) {
  __pyx_f = __pyx_filenames;
}

static void __Pyx_RaiseDoubleKeywordsError(
    const char* func_name,
    PyObject* kw_name)
{
    PyErr_Format(PyExc_TypeError,
        #if PY_MAJOR_VERSION >= 3
        "%s() got multiple values for keyword argument '%U'", func_name, kw_name);
        #else
        "%s() got multiple values for keyword argument '%s'", func_name,
        PyString_AS_STRING(kw_name));
        #endif
}

static void __Pyx_RaiseArgtupleInvalid(
    const char* func_name,
    int exact,
    Py_ssize_t num_min,
    Py_ssize_t num_max,
    Py_ssize_t num_found)
{
    Py_ssize_t num_expected;
    const char *number, *more_or_less;

    if (num_found < num_min) {
        num_expected = num_min;
        more_or_less = "at least";
    } else {
        num_expected = num_max;
        more_or_less = "at most";
    }
    if (exact) {
        more_or_less = "exactly";
    }
    number = (num_expected == 1) ? "" : "s";
    PyErr_Format(PyExc_TypeError,
        #if PY_VERSION_HEX < 0x02050000
            "%s() takes %s %d positional argument%s (%d given)",
        #else
            "%s() takes %s %zd positional argument%s (%zd given)",
        #endif
        func_name, more_or_less, num_expected, number, num_found);
}

static int __Pyx_ParseOptionalKeywords(
    PyObject *kwds,
    PyObject **argnames[],
    PyObject *kwds2,
    PyObject *values[],
    Py_ssize_t num_pos_args,
    const char* function_name)
{
    PyObject *key = 0, *value = 0;
    Py_ssize_t pos = 0;
    PyObject*** name;
    PyObject*** first_kw_arg = argnames + num_pos_args;

    while (PyDict_Next(kwds, &pos, &key, &value)) {
        name = first_kw_arg;
        while (*name && (**name != key)) name++;
        if (*name) {
            values[name-argnames] = value;
        } else {
            #if PY_MAJOR_VERSION < 3
            if (unlikely(!PyString_CheckExact(key)) && unlikely(!PyString_Check(key))) {
            #else
            if (unlikely(!PyUnicode_CheckExact(key)) && unlikely(!PyUnicode_Check(key))) {
            #endif
                goto invalid_keyword_type;
            } else {
                for (name = first_kw_arg; *name; name++) {
                    #if PY_MAJOR_VERSION >= 3
                    if (PyUnicode_GET_SIZE(**name) == PyUnicode_GET_SIZE(key) &&
                        PyUnicode_Compare(**name, key) == 0) break;
                    #else
                    if (PyString_GET_SIZE(**name) == PyString_GET_SIZE(key) &&
                        _PyString_Eq(**name, key)) break;
                    #endif
                }
                if (*name) {
                    values[name-argnames] = value;
                } else {
                    /* unexpected keyword found */
                    for (name=argnames; name != first_kw_arg; name++) {
                        if (**name == key) goto arg_passed_twice;
                        #if PY_MAJOR_VERSION >= 3
                        if (PyUnicode_GET_SIZE(**name) == PyUnicode_GET_SIZE(key) &&
                            PyUnicode_Compare(**name, key) == 0) goto arg_passed_twice;
                        #else
                        if (PyString_GET_SIZE(**name) == PyString_GET_SIZE(key) &&
                            _PyString_Eq(**name, key)) goto arg_passed_twice;
                        #endif
                    }
                    if (kwds2) {
                        if (unlikely(PyDict_SetItem(kwds2, key, value))) goto bad;
                    } else {
                        goto invalid_keyword;
                    }
                }
            }
        }
    }
    return 0;
arg_passed_twice:
    __Pyx_RaiseDoubleKeywordsError(function_name, **name);
    goto bad;
invalid_keyword_type:
    PyErr_Format(PyExc_TypeError,
        "%s() keywords must be strings", function_name);
    goto bad;
invalid_keyword:
    PyErr_Format(PyExc_TypeError,
    #if PY_MAJOR_VERSION < 3
        "%s() got an unexpected keyword argument '%s'",
        function_name, PyString_AsString(key));
    #else
        "%s() got an unexpected keyword argument '%U'",
        function_name, key);
    #endif
bad:
    return -1;
}

static int __Pyx_TypeTest(PyObject *obj, PyTypeObject *type) {
    if (!type) {
        PyErr_Format(PyExc_SystemError, "Missing type object");
        return 0;
    }
    if (obj == Py_None || PyObject_TypeCheck(obj, type))
        return 1;
    PyErr_Format(PyExc_TypeError, "Cannot convert %s to %s",
        Py_TYPE(obj)->tp_name, type->tp_name);
    return 0;
}



static int __Pyx_GetException(PyObject **type, PyObject **value, PyObject **tb) {
    PyObject *tmp_type, *tmp_value, *tmp_tb;
    PyThreadState *tstate = PyThreadState_GET();
    *type = tstate->curexc_type;
    *value = tstate->curexc_value;
    *tb = tstate->curexc_traceback;
    tstate->curexc_type = 0;
    tstate->curexc_value = 0;
    tstate->curexc_traceback = 0;
    PyErr_NormalizeException(type, value, tb);
    if (PyErr_Occurred())
        goto bad;
    Py_INCREF(*type);
    Py_INCREF(*value);
    Py_INCREF(*tb);
    tmp_type = tstate->exc_type;
    tmp_value = tstate->exc_value;
    tmp_tb = tstate->exc_traceback;
    tstate->exc_type = *type;
    tstate->exc_value = *value;
    tstate->exc_traceback = *tb;
    /* Make sure tstate is in a consistent state when we XDECREF
    these objects (XDECREF may run arbitrary code). */
    Py_XDECREF(tmp_type);
    Py_XDECREF(tmp_value);
    Py_XDECREF(tmp_tb);
    return 0;
bad:
    Py_XDECREF(*type);
    Py_XDECREF(*value);
    Py_XDECREF(*tb);
    return -1;
}


static INLINE void __Pyx_ExceptionSave(PyObject **type, PyObject **value, PyObject **tb) {
    PyThreadState *tstate = PyThreadState_GET();
    *type = tstate->exc_type;
    *value = tstate->exc_value;
    *tb = tstate->exc_traceback;
    Py_XINCREF(*type);
    Py_XINCREF(*value);
    Py_XINCREF(*tb);
}

static void __Pyx_ExceptionReset(PyObject *type, PyObject *value, PyObject *tb) {
    PyObject *tmp_type, *tmp_value, *tmp_tb;
    PyThreadState *tstate = PyThreadState_GET();
    tmp_type = tstate->exc_type;
    tmp_value = tstate->exc_value;
    tmp_tb = tstate->exc_traceback;
    tstate->exc_type = type;
    tstate->exc_value = value;
    tstate->exc_traceback = tb;
    Py_XDECREF(tmp_type);
    Py_XDECREF(tmp_value);
    Py_XDECREF(tmp_tb);
}

static PyObject *__Pyx_Import(PyObject *name, PyObject *from_list) {
    PyObject *__import__ = 0;
    PyObject *empty_list = 0;
    PyObject *module = 0;
    PyObject *global_dict = 0;
    PyObject *empty_dict = 0;
    PyObject *list;
    __import__ = __Pyx_GetAttrString(__pyx_b, "__import__");
    if (!__import__)
        goto bad;
    if (from_list)
        list = from_list;
    else {
        empty_list = PyList_New(0);
        if (!empty_list)
            goto bad;
        list = empty_list;
    }
    global_dict = PyModule_GetDict(__pyx_m);
    if (!global_dict)
        goto bad;
    empty_dict = PyDict_New();
    if (!empty_dict)
        goto bad;
    module = PyObject_CallFunctionObjArgs(__import__,
        name, global_dict, empty_dict, list, NULL);
bad:
    Py_XDECREF(empty_list);
    Py_XDECREF(__import__);
    Py_XDECREF(empty_dict);
    return module;
}

static PyObject *__Pyx_GetName(PyObject *dict, PyObject *name) {
    PyObject *result;
    result = PyObject_GetAttr(dict, name);
    if (!result)
        PyErr_SetObject(PyExc_NameError, name);
    return result;
}

static PyObject *__Pyx_CreateClass(
    PyObject *bases, PyObject *dict, PyObject *name, const char *modname)
{
    PyObject *py_modname;
    PyObject *result = 0;

    #if PY_MAJOR_VERSION < 3
    py_modname = PyString_FromString(modname);
    #else
    py_modname = PyUnicode_FromString(modname);
    #endif
    if (!py_modname)
        goto bad;
    if (PyDict_SetItemString(dict, "__module__", py_modname) < 0)
        goto bad;
    #if PY_MAJOR_VERSION < 3
    result = PyClass_New(bases, dict, name);
    #else
    result = PyObject_CallFunctionObjArgs((PyObject *)&PyType_Type, name, bases, dict, NULL);
    #endif
bad:
    Py_XDECREF(py_modname);
    return result;
}

static INLINE void __Pyx_RaiseNeedMoreValuesError(Py_ssize_t index) {
    PyErr_Format(PyExc_ValueError,
        #if PY_VERSION_HEX < 0x02050000
                 "need more than %d value%s to unpack", (int)index,
        #else
                 "need more than %zd value%s to unpack", index,
        #endif
                 (index == 1) ? "" : "s");
}

static INLINE void __Pyx_RaiseTooManyValuesError(void) {
    PyErr_SetString(PyExc_ValueError, "too many values to unpack");
}

static PyObject *__Pyx_UnpackItem(PyObject *iter, Py_ssize_t index) {
    PyObject *item;
    if (!(item = PyIter_Next(iter))) {
        if (!PyErr_Occurred()) {
            __Pyx_RaiseNeedMoreValuesError(index);
        }
    }
    return item;
}

static int __Pyx_EndUnpack(PyObject *iter) {
    PyObject *item;
    if ((item = PyIter_Next(iter))) {
        Py_DECREF(item);
        __Pyx_RaiseTooManyValuesError();
        return -1;
    }
    else if (!PyErr_Occurred())
        return 0;
    else
        return -1;
}

#if PY_MAJOR_VERSION < 3
static PyObject *__Pyx_GetStdout(void) {
    PyObject *f = PySys_GetObject((char *)"stdout");
    if (!f) {
        PyErr_SetString(PyExc_RuntimeError, "lost sys.stdout");
    }
    return f;
}

static int __Pyx_Print(PyObject *arg_tuple, int newline) {
    PyObject *f;
    PyObject* v;
    int i;

    if (!(f = __Pyx_GetStdout()))
        return -1;
    for (i=0; i < PyTuple_GET_SIZE(arg_tuple); i++) {
        if (PyFile_SoftSpace(f, 1)) {
            if (PyFile_WriteString(" ", f) < 0)
                return -1;
        }
        v = PyTuple_GET_ITEM(arg_tuple, i);
        if (PyFile_WriteObject(v, f, Py_PRINT_RAW) < 0)
            return -1;
        if (PyString_Check(v)) {
            char *s = PyString_AsString(v);
            Py_ssize_t len = PyString_Size(v);
            if (len > 0 &&
                isspace(Py_CHARMASK(s[len-1])) &&
                s[len-1] != ' ')
                    PyFile_SoftSpace(f, 0);
        }
    }
    if (newline) {
        if (PyFile_WriteString("\n", f) < 0)
            return -1;
        PyFile_SoftSpace(f, 0);
    }
    return 0;
}

#else /* Python 3 has a print function */

static int __Pyx_Print(PyObject *arg_tuple, int newline) {
    PyObject* kwargs = 0;
    PyObject* result = 0;
    PyObject* end_string;
    if (!__pyx_print) {
        __pyx_print = __Pyx_GetAttrString(__pyx_b, "print");
        if (!__pyx_print)
            return -1;
    }
    if (!newline) {
        if (!__pyx_print_kwargs) {
            __pyx_print_kwargs = PyDict_New();
            if (!__pyx_print_kwargs)
                return -1;
            end_string = PyUnicode_FromStringAndSize(" ", 1);
            if (!end_string)
                return -1;
            if (PyDict_SetItemString(__pyx_print_kwargs, "end", end_string) < 0) {
                Py_DECREF(end_string);
                return -1;
            }
            Py_DECREF(end_string);
        }
        kwargs = __pyx_print_kwargs;
    }
    result = PyObject_Call(__pyx_print, arg_tuple, kwargs);
    if (!result)
        return -1;
    Py_DECREF(result);
    return 0;
}

#endif

static void __Pyx_Raise(PyObject *type, PyObject *value, PyObject *tb) {
    Py_XINCREF(type);
    Py_XINCREF(value);
    Py_XINCREF(tb);
    /* First, check the traceback argument, replacing None with NULL. */
    if (tb == Py_None) {
        Py_DECREF(tb);
        tb = 0;
    }
    else if (tb != NULL && !PyTraceBack_Check(tb)) {
        PyErr_SetString(PyExc_TypeError,
            "raise: arg 3 must be a traceback or None");
        goto raise_error;
    }
    /* Next, replace a missing value with None */
    if (value == NULL) {
        value = Py_None;
        Py_INCREF(value);
    }
    #if PY_VERSION_HEX < 0x02050000
    if (!PyClass_Check(type))
    #else
    if (!PyType_Check(type))
    #endif
    {
        /* Raising an instance.  The value should be a dummy. */
        if (value != Py_None) {
            PyErr_SetString(PyExc_TypeError,
                "instance exception may not have a separate value");
            goto raise_error;
        }
        /* Normalize to raise <class>, <instance> */
        Py_DECREF(value);
        value = type;
        #if PY_VERSION_HEX < 0x02050000
            if (PyInstance_Check(type)) {
                type = (PyObject*) ((PyInstanceObject*)type)->in_class;
                Py_INCREF(type);
            }
            else {
                type = 0;
                PyErr_SetString(PyExc_TypeError,
                    "raise: exception must be an old-style class or instance");
                goto raise_error;
            }
        #else
            type = (PyObject*) Py_TYPE(type);
            Py_INCREF(type);
            if (!PyType_IsSubtype((PyTypeObject *)type, (PyTypeObject *)PyExc_BaseException)) {
                PyErr_SetString(PyExc_TypeError,
                    "raise: exception class must be a subclass of BaseException");
                goto raise_error;
            }
        #endif
    }
    __Pyx_ErrRestore(type, value, tb);
    return;
raise_error:
    Py_XDECREF(value);
    Py_XDECREF(type);
    Py_XDECREF(tb);
    return;
}

static INLINE void __Pyx_ErrRestore(PyObject *type, PyObject *value, PyObject *tb) {
    PyObject *tmp_type, *tmp_value, *tmp_tb;
    PyThreadState *tstate = PyThreadState_GET();

#if PY_MAJOR_VERSION >= 3
    /* Note: this is a temporary work-around to prevent crashes in Python 3.0 */
    if ((tstate->exc_type != NULL) & (tstate->exc_type != Py_None)) {
        tmp_type = tstate->exc_type;
        tmp_value = tstate->exc_value;
        tmp_tb = tstate->exc_traceback;
        PyErr_NormalizeException(&type, &value, &tb);
        PyErr_NormalizeException(&tmp_type, &tmp_value, &tmp_tb);
        tstate->exc_type = 0;
        tstate->exc_value = 0;
        tstate->exc_traceback = 0;
        PyException_SetContext(value, tmp_value);
        Py_DECREF(tmp_type);
        Py_XDECREF(tmp_tb);
    }
#endif

    tmp_type = tstate->curexc_type;
    tmp_value = tstate->curexc_value;
    tmp_tb = tstate->curexc_traceback;
    tstate->curexc_type = type;
    tstate->curexc_value = value;
    tstate->curexc_traceback = tb;
    Py_XDECREF(tmp_type);
    Py_XDECREF(tmp_value);
    Py_XDECREF(tmp_tb);
}

static INLINE void __Pyx_ErrFetch(PyObject **type, PyObject **value, PyObject **tb) {
    PyThreadState *tstate = PyThreadState_GET();
    *type = tstate->curexc_type;
    *value = tstate->curexc_value;
    *tb = tstate->curexc_traceback;

    tstate->curexc_type = 0;
    tstate->curexc_value = 0;
    tstate->curexc_traceback = 0;
}


static INLINE int __Pyx_StrEq(const char *s1, const char *s2) {
     while (*s1 != '\0' && *s1 == *s2) { s1++; s2++; }
     return *s1 == *s2;
}

static INLINE unsigned char __Pyx_PyInt_AsUnsignedChar(PyObject* x) {
    if (sizeof(unsigned char) < sizeof(long)) {
        long val = __Pyx_PyInt_AsLong(x);
        if (unlikely(val != (long)(unsigned char)val)) {
            if (unlikely(val == -1 && PyErr_Occurred()))
                return (unsigned char)-1;
            if (unlikely(val < 0)) {
                PyErr_SetString(PyExc_OverflowError,
                                "can't convert negative value to unsigned char");
                return (unsigned char)-1;
            }
            PyErr_SetString(PyExc_OverflowError,
                           "value too large to convert to unsigned char");
            return (unsigned char)-1;
        }
        return (unsigned char)val;
    }
    return (unsigned char)__Pyx_PyInt_AsUnsignedLong(x);
}

static INLINE unsigned short __Pyx_PyInt_AsUnsignedShort(PyObject* x) {
    if (sizeof(unsigned short) < sizeof(long)) {
        long val = __Pyx_PyInt_AsLong(x);
        if (unlikely(val != (long)(unsigned short)val)) {
            if (unlikely(val == -1 && PyErr_Occurred()))
                return (unsigned short)-1;
            if (unlikely(val < 0)) {
                PyErr_SetString(PyExc_OverflowError,
                                "can't convert negative value to unsigned short");
                return (unsigned short)-1;
            }
            PyErr_SetString(PyExc_OverflowError,
                           "value too large to convert to unsigned short");
            return (unsigned short)-1;
        }
        return (unsigned short)val;
    }
    return (unsigned short)__Pyx_PyInt_AsUnsignedLong(x);
}

static INLINE unsigned int __Pyx_PyInt_AsUnsignedInt(PyObject* x) {
    if (sizeof(unsigned int) < sizeof(long)) {
        long val = __Pyx_PyInt_AsLong(x);
        if (unlikely(val != (long)(unsigned int)val)) {
            if (unlikely(val == -1 && PyErr_Occurred()))
                return (unsigned int)-1;
            if (unlikely(val < 0)) {
                PyErr_SetString(PyExc_OverflowError,
                                "can't convert negative value to unsigned int");
                return (unsigned int)-1;
            }
            PyErr_SetString(PyExc_OverflowError,
                           "value too large to convert to unsigned int");
            return (unsigned int)-1;
        }
        return (unsigned int)val;
    }
    return (unsigned int)__Pyx_PyInt_AsUnsignedLong(x);
}

static INLINE char __Pyx_PyInt_AsChar(PyObject* x) {
    if (sizeof(char) < sizeof(long)) {
        long val = __Pyx_PyInt_AsLong(x);
        if (unlikely(val != (long)(char)val)) {
            if (unlikely(val == -1 && PyErr_Occurred()))
                return (char)-1;
            PyErr_SetString(PyExc_OverflowError,
                           "value too large to convert to char");
            return (char)-1;
        }
        return (char)val;
    }
    return (char)__Pyx_PyInt_AsLong(x);
}

static INLINE short __Pyx_PyInt_AsShort(PyObject* x) {
    if (sizeof(short) < sizeof(long)) {
        long val = __Pyx_PyInt_AsLong(x);
        if (unlikely(val != (long)(short)val)) {
            if (unlikely(val == -1 && PyErr_Occurred()))
                return (short)-1;
            PyErr_SetString(PyExc_OverflowError,
                           "value too large to convert to short");
            return (short)-1;
        }
        return (short)val;
    }
    return (short)__Pyx_PyInt_AsLong(x);
}

static INLINE int __Pyx_PyInt_AsInt(PyObject* x) {
    if (sizeof(int) < sizeof(long)) {
        long val = __Pyx_PyInt_AsLong(x);
        if (unlikely(val != (long)(int)val)) {
            if (unlikely(val == -1 && PyErr_Occurred()))
                return (int)-1;
            PyErr_SetString(PyExc_OverflowError,
                           "value too large to convert to int");
            return (int)-1;
        }
        return (int)val;
    }
    return (int)__Pyx_PyInt_AsLong(x);
}

static INLINE signed char __Pyx_PyInt_AsSignedChar(PyObject* x) {
    if (sizeof(signed char) < sizeof(long)) {
        long val = __Pyx_PyInt_AsLong(x);
        if (unlikely(val != (long)(signed char)val)) {
            if (unlikely(val == -1 && PyErr_Occurred()))
                return (signed char)-1;
            PyErr_SetString(PyExc_OverflowError,
                           "value too large to convert to signed char");
            return (signed char)-1;
        }
        return (signed char)val;
    }
    return (signed char)__Pyx_PyInt_AsSignedLong(x);
}

static INLINE signed short __Pyx_PyInt_AsSignedShort(PyObject* x) {
    if (sizeof(signed short) < sizeof(long)) {
        long val = __Pyx_PyInt_AsLong(x);
        if (unlikely(val != (long)(signed short)val)) {
            if (unlikely(val == -1 && PyErr_Occurred()))
                return (signed short)-1;
            PyErr_SetString(PyExc_OverflowError,
                           "value too large to convert to signed short");
            return (signed short)-1;
        }
        return (signed short)val;
    }
    return (signed short)__Pyx_PyInt_AsSignedLong(x);
}

static INLINE signed int __Pyx_PyInt_AsSignedInt(PyObject* x) {
    if (sizeof(signed int) < sizeof(long)) {
        long val = __Pyx_PyInt_AsLong(x);
        if (unlikely(val != (long)(signed int)val)) {
            if (unlikely(val == -1 && PyErr_Occurred()))
                return (signed int)-1;
            PyErr_SetString(PyExc_OverflowError,
                           "value too large to convert to signed int");
            return (signed int)-1;
        }
        return (signed int)val;
    }
    return (signed int)__Pyx_PyInt_AsSignedLong(x);
}

static INLINE unsigned long __Pyx_PyInt_AsUnsignedLong(PyObject* x) {
#if PY_VERSION_HEX < 0x03000000
    if (likely(PyInt_CheckExact(x) || PyInt_Check(x))) {
        long val = PyInt_AS_LONG(x);
        if (unlikely(val < 0)) {
            PyErr_SetString(PyExc_OverflowError,
                            "can't convert negative value to unsigned long");
            return (unsigned long)-1;
        }
        return (unsigned long)val;
    } else
#endif
    if (likely(PyLong_CheckExact(x) || PyLong_Check(x))) {
        if (unlikely(Py_SIZE(x) < 0)) {
            PyErr_SetString(PyExc_OverflowError,
                            "can't convert negative value to unsigned long");
            return (unsigned long)-1;
        }
        return PyLong_AsUnsignedLong(x);
    } else {
        unsigned long val;
        PyObject *tmp = __Pyx_PyNumber_Int(x);
        if (!tmp) return (unsigned long)-1;
        val = __Pyx_PyInt_AsUnsignedLong(tmp);
        Py_DECREF(tmp);
        return val;
    }
}

static INLINE unsigned PY_LONG_LONG __Pyx_PyInt_AsUnsignedLongLong(PyObject* x) {
#if PY_VERSION_HEX < 0x03000000
    if (likely(PyInt_CheckExact(x) || PyInt_Check(x))) {
        long val = PyInt_AS_LONG(x);
        if (unlikely(val < 0)) {
            PyErr_SetString(PyExc_OverflowError,
                            "can't convert negative value to unsigned PY_LONG_LONG");
            return (unsigned PY_LONG_LONG)-1;
        }
        return (unsigned PY_LONG_LONG)val;
    } else
#endif
    if (likely(PyLong_CheckExact(x) || PyLong_Check(x))) {
        if (unlikely(Py_SIZE(x) < 0)) {
            PyErr_SetString(PyExc_OverflowError,
                            "can't convert negative value to unsigned PY_LONG_LONG");
            return (unsigned PY_LONG_LONG)-1;
        }
        return PyLong_AsUnsignedLongLong(x);
    } else {
        unsigned PY_LONG_LONG val;
        PyObject *tmp = __Pyx_PyNumber_Int(x);
        if (!tmp) return (unsigned PY_LONG_LONG)-1;
        val = __Pyx_PyInt_AsUnsignedLongLong(tmp);
        Py_DECREF(tmp);
        return val;
    }
}

static INLINE long __Pyx_PyInt_AsLong(PyObject* x) {
#if PY_VERSION_HEX < 0x03000000
    if (likely(PyInt_CheckExact(x) || PyInt_Check(x))) {
        long val = PyInt_AS_LONG(x);
        return (long)val;
    } else
#endif
    if (likely(PyLong_CheckExact(x) || PyLong_Check(x))) {
        return PyLong_AsLong(x);
    } else {
        long val;
        PyObject *tmp = __Pyx_PyNumber_Int(x);
        if (!tmp) return (long)-1;
        val = __Pyx_PyInt_AsLong(tmp);
        Py_DECREF(tmp);
        return val;
    }
}

static INLINE PY_LONG_LONG __Pyx_PyInt_AsLongLong(PyObject* x) {
#if PY_VERSION_HEX < 0x03000000
    if (likely(PyInt_CheckExact(x) || PyInt_Check(x))) {
        long val = PyInt_AS_LONG(x);
        return (PY_LONG_LONG)val;
    } else
#endif
    if (likely(PyLong_CheckExact(x) || PyLong_Check(x))) {
        return PyLong_AsLongLong(x);
    } else {
        PY_LONG_LONG val;
        PyObject *tmp = __Pyx_PyNumber_Int(x);
        if (!tmp) return (PY_LONG_LONG)-1;
        val = __Pyx_PyInt_AsLongLong(tmp);
        Py_DECREF(tmp);
        return val;
    }
}

static INLINE signed long __Pyx_PyInt_AsSignedLong(PyObject* x) {
#if PY_VERSION_HEX < 0x03000000
    if (likely(PyInt_CheckExact(x) || PyInt_Check(x))) {
        long val = PyInt_AS_LONG(x);
        return (signed long)val;
    } else
#endif
    if (likely(PyLong_CheckExact(x) || PyLong_Check(x))) {
        return PyLong_AsLong(x);
    } else {
        signed long val;
        PyObject *tmp = __Pyx_PyNumber_Int(x);
        if (!tmp) return (signed long)-1;
        val = __Pyx_PyInt_AsSignedLong(tmp);
        Py_DECREF(tmp);
        return val;
    }
}

static INLINE signed PY_LONG_LONG __Pyx_PyInt_AsSignedLongLong(PyObject* x) {
#if PY_VERSION_HEX < 0x03000000
    if (likely(PyInt_CheckExact(x) || PyInt_Check(x))) {
        long val = PyInt_AS_LONG(x);
        return (signed PY_LONG_LONG)val;
    } else
#endif
    if (likely(PyLong_CheckExact(x) || PyLong_Check(x))) {
        return PyLong_AsLongLong(x);
    } else {
        signed PY_LONG_LONG val;
        PyObject *tmp = __Pyx_PyNumber_Int(x);
        if (!tmp) return (signed PY_LONG_LONG)-1;
        val = __Pyx_PyInt_AsSignedLongLong(tmp);
        Py_DECREF(tmp);
        return val;
    }
}

#ifndef __PYX_HAVE_RT_ImportType
#define __PYX_HAVE_RT_ImportType
static PyTypeObject *__Pyx_ImportType(const char *module_name, const char *class_name,
    long size)
{
    PyObject *py_module = 0;
    PyObject *result = 0;
    PyObject *py_name = 0;

    py_module = __Pyx_ImportModule(module_name);
    if (!py_module)
        goto bad;
    #if PY_MAJOR_VERSION < 3
    py_name = PyString_FromString(class_name);
    #else
    py_name = PyUnicode_FromString(class_name);
    #endif
    if (!py_name)
        goto bad;
    result = PyObject_GetAttr(py_module, py_name);
    Py_DECREF(py_name);
    py_name = 0;
    Py_DECREF(py_module);
    py_module = 0;
    if (!result)
        goto bad;
    if (!PyType_Check(result)) {
        PyErr_Format(PyExc_TypeError, 
            "%s.%s is not a type object",
            module_name, class_name);
        goto bad;
    }
    if (((PyTypeObject *)result)->tp_basicsize != size) {
        PyErr_Format(PyExc_ValueError, 
            "%s.%s does not appear to be the correct type object",
            module_name, class_name);
        goto bad;
    }
    return (PyTypeObject *)result;
bad:
    Py_XDECREF(py_module);
    Py_XDECREF(result);
    return 0;
}
#endif

#ifndef __PYX_HAVE_RT_ImportModule
#define __PYX_HAVE_RT_ImportModule
static PyObject *__Pyx_ImportModule(const char *name) {
    PyObject *py_name = 0;
    PyObject *py_module = 0;

    #if PY_MAJOR_VERSION < 3
    py_name = PyString_FromString(name);
    #else
    py_name = PyUnicode_FromString(name);
    #endif
    if (!py_name)
        goto bad;
    py_module = PyImport_Import(py_name);
    Py_DECREF(py_name);
    return py_module;
bad:
    Py_XDECREF(py_name);
    return 0;
}
#endif

#include "compile.h"
#include "frameobject.h"
#include "traceback.h"

static void __Pyx_AddTraceback(const char *funcname) {
    PyObject *py_srcfile = 0;
    PyObject *py_funcname = 0;
    PyObject *py_globals = 0;
    PyObject *empty_string = 0;
    PyCodeObject *py_code = 0;
    PyFrameObject *py_frame = 0;

    #if PY_MAJOR_VERSION < 3
    py_srcfile = PyString_FromString(__pyx_filename);
    #else
    py_srcfile = PyUnicode_FromString(__pyx_filename);
    #endif
    if (!py_srcfile) goto bad;
    if (__pyx_clineno) {
        #if PY_MAJOR_VERSION < 3
        py_funcname = PyString_FromFormat( "%s (%s:%d)", funcname, __pyx_cfilenm, __pyx_clineno);
        #else
        py_funcname = PyUnicode_FromFormat( "%s (%s:%d)", funcname, __pyx_cfilenm, __pyx_clineno);
        #endif
    }
    else {
        #if PY_MAJOR_VERSION < 3
        py_funcname = PyString_FromString(funcname);
        #else
        py_funcname = PyUnicode_FromString(funcname);
        #endif
    }
    if (!py_funcname) goto bad;
    py_globals = PyModule_GetDict(__pyx_m);
    if (!py_globals) goto bad;
    #if PY_MAJOR_VERSION < 3
    empty_string = PyString_FromStringAndSize("", 0);
    #else
    empty_string = PyBytes_FromStringAndSize("", 0);
    #endif
    if (!empty_string) goto bad;
    py_code = PyCode_New(
        0,            /*int argcount,*/
        #if PY_MAJOR_VERSION >= 3
        0,            /*int kwonlyargcount,*/
        #endif
        0,            /*int nlocals,*/
        0,            /*int stacksize,*/
        0,            /*int flags,*/
        empty_string, /*PyObject *code,*/
        __pyx_empty_tuple,  /*PyObject *consts,*/
        __pyx_empty_tuple,  /*PyObject *names,*/
        __pyx_empty_tuple,  /*PyObject *varnames,*/
        __pyx_empty_tuple,  /*PyObject *freevars,*/
        __pyx_empty_tuple,  /*PyObject *cellvars,*/
        py_srcfile,   /*PyObject *filename,*/
        py_funcname,  /*PyObject *name,*/
        __pyx_lineno,   /*int firstlineno,*/
        empty_string  /*PyObject *lnotab*/
    );
    if (!py_code) goto bad;
    py_frame = PyFrame_New(
        PyThreadState_GET(), /*PyThreadState *tstate,*/
        py_code,             /*PyCodeObject *code,*/
        py_globals,          /*PyObject *globals,*/
        0                    /*PyObject *locals*/
    );
    if (!py_frame) goto bad;
    py_frame->f_lineno = __pyx_lineno;
    PyTraceBack_Here(py_frame);
bad:
    Py_XDECREF(py_srcfile);
    Py_XDECREF(py_funcname);
    Py_XDECREF(empty_string);
    Py_XDECREF(py_code);
    Py_XDECREF(py_frame);
}

static int __Pyx_InitStrings(__Pyx_StringTabEntry *t) {
    while (t->p) {
        #if PY_MAJOR_VERSION < 3
        if (t->is_unicode && (!t->is_identifier)) {
            *t->p = PyUnicode_DecodeUTF8(t->s, t->n - 1, NULL);
        } else if (t->intern) {
            *t->p = PyString_InternFromString(t->s);
        } else {
            *t->p = PyString_FromStringAndSize(t->s, t->n - 1);
        }
        #else  /* Python 3+ has unicode identifiers */
        if (t->is_identifier || (t->is_unicode && t->intern)) {
            *t->p = PyUnicode_InternFromString(t->s);
        } else if (t->is_unicode) {
            *t->p = PyUnicode_FromStringAndSize(t->s, t->n - 1);
        } else {
            *t->p = PyBytes_FromStringAndSize(t->s, t->n - 1);
        }
        #endif
        if (!*t->p)
            return -1;
        ++t;
    }
    return 0;
}

/* Type Conversion Functions */

static INLINE int __Pyx_PyObject_IsTrue(PyObject* x) {
   if (x == Py_True) return 1;
   else if ((x == Py_False) | (x == Py_None)) return 0;
   else return PyObject_IsTrue(x);
}

static INLINE PyObject* __Pyx_PyNumber_Int(PyObject* x) {
  PyNumberMethods *m;
  const char *name = NULL;
  PyObject *res = NULL;
#if PY_VERSION_HEX < 0x03000000
  if (PyInt_Check(x) || PyLong_Check(x))
#else
  if (PyLong_Check(x))
#endif
    return Py_INCREF(x), x;
  m = Py_TYPE(x)->tp_as_number;
#if PY_VERSION_HEX < 0x03000000
  if (m && m->nb_int) {
    name = "int";
    res = PyNumber_Int(x);
  }
  else if (m && m->nb_long) {
    name = "long";
    res = PyNumber_Long(x);
  }
#else
  if (m && m->nb_int) {
    name = "int";
    res = PyNumber_Long(x);
  }
#endif
  if (res) {
#if PY_VERSION_HEX < 0x03000000
    if (!PyInt_Check(res) && !PyLong_Check(res)) {
#else
    if (!PyLong_Check(res)) {
#endif
      PyErr_Format(PyExc_TypeError,
                   "__%s__ returned non-%s (type %.200s)",
                   name, name, Py_TYPE(res)->tp_name);
      Py_DECREF(res);
      return NULL;
    }
  }
  else if (!PyErr_Occurred()) {
    PyErr_SetString(PyExc_TypeError,
                    "an integer is required");
  }
  return res;
}

static INLINE Py_ssize_t __Pyx_PyIndex_AsSsize_t(PyObject* b) {
  Py_ssize_t ival;
  PyObject* x = PyNumber_Index(b);
  if (!x) return -1;
  ival = PyInt_AsSsize_t(x);
  Py_DECREF(x);
  return ival;
}

static INLINE PyObject * __Pyx_PyInt_FromSize_t(size_t ival) {
#if PY_VERSION_HEX < 0x02050000
   if (ival <= LONG_MAX)
       return PyInt_FromLong((long)ival);
   else {
       unsigned char *bytes = (unsigned char *) &ival;
       int one = 1; int little = (int)*(unsigned char*)&one;
       return _PyLong_FromByteArray(bytes, sizeof(size_t), little, 0);
   }
#else
   return PyInt_FromSize_t(ival);
#endif
}

static INLINE size_t __Pyx_PyInt_AsSize_t(PyObject* x) {
   unsigned PY_LONG_LONG val = __Pyx_PyInt_AsUnsignedLongLong(x);
   if (unlikely(val == (unsigned PY_LONG_LONG)-1 && PyErr_Occurred())) {
       return (size_t)-1;
   } else if (unlikely(val != (unsigned PY_LONG_LONG)(size_t)val)) {
       PyErr_SetString(PyExc_OverflowError,
                       "value too large to convert to size_t");
       return (size_t)-1;
   }
   return (size_t)val;
}


